window.storyFormat({"name":"SugarCube","version":"2.37.3","description":"A full featured, highly customizable story format.  See its <a href=\"http://www.motoslave.net/sugarcube/2/#documentation\" target=\"_blank\">documentation</a>.","author":"Thomas Michael Edwards","image":"icon.svg","url":"http://www.motoslave.net/sugarcube/","license":"BSD-2-Clause","proofing":false,"source":"<!DOCTYPE html>\n<html data-init=\"no-js\">\n<head>\n<meta charset=\"UTF-8\" />\n<title>{{STORY_NAME}}</title>\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<meta name=\"application-name\" content=\"SugarCube\" />\n<meta name=\"version\" content=\"2.37.3\" />\n<!--\n\nSugarCube (v2.37.3): A free (gratis and libre) story format.\n\nCopyright © 2013–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>.\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n1. Redistributions of source code must retain the above copyright notice, this\n   list of conditions and the following disclaimer.\n2. Redistributions in binary form must reproduce the above copyright notice,\n   this list of conditions and the following disclaimer in the documentation\n   and/or other materials provided with the distribution.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR\nANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\n-->\n<script id=\"script-libraries\" type=\"text/javascript\">\nif(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute(\"data-init\", \"loading\");\n/*! @source http://purl.eligrey.com/github/classList.js/blob/1.2.20171210/classList.js */\n\"document\"in self&&(\"classList\"in document.createElement(\"_\")&&(!document.createElementNS||\"classList\"in document.createElementNS(\"http://www.w3.org/2000/svg\",\"g\"))||!function(t){\"use strict\";if(\"Element\"in t){var e=\"classList\",n=\"prototype\",i=t.Element[n],s=Object,r=String[n].trim||function(){return this.replace(/^\\s+|\\s+$/g,\"\")},o=Array[n].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},c=function(t,e){this.name=t,this.code=DOMException[t],this.message=e},a=function(t,e){if(\"\"===e)throw new c(\"SYNTAX_ERR\",\"The token must not be empty.\");if(/\\s/.test(e))throw new c(\"INVALID_CHARACTER_ERR\",\"The token must not contain space characters.\");return o.call(t,e)},l=function(t){for(var e=r.call(t.getAttribute(\"class\")||\"\"),n=e?e.split(/\\s+/):[],i=0,s=n.length;s>i;i++)this.push(n[i]);this._updateClassName=function(){t.setAttribute(\"class\",this.toString())}},u=l[n]=[],h=function(){return new l(this)};if(c[n]=Error[n],u.item=function(t){return this[t]||null},u.contains=function(t){return~a(this,t+\"\")},u.add=function(){var t,e=arguments,n=0,i=e.length,s=!1;do t=e[n]+\"\",~a(this,t)||(this.push(t),s=!0);while(++n<i);s&&this._updateClassName()},u.remove=function(){var t,e,n=arguments,i=0,s=n.length,r=!1;do for(t=n[i]+\"\",e=a(this,t);~e;)this.splice(e,1),r=!0,e=a(this,t);while(++i<s);r&&this._updateClassName()},u.toggle=function(t,e){var n=this.contains(t),i=n?e!==!0&&\"remove\":e!==!1&&\"add\";return i&&this[i](t),e===!0||e===!1?e:!n},u.replace=function(t,e){var n=a(t+\"\");~n&&(this.splice(n,1,e),this._updateClassName())},u.toString=function(){return this.join(\" \")},s.defineProperty){var f={get:h,enumerable:!0,configurable:!0};try{s.defineProperty(i,e,f)}catch(p){void 0!==p.number&&-2146823252!==p.number||(f.enumerable=!1,s.defineProperty(i,e,f))}}else s[n].__defineGetter__&&i.__defineGetter__(e,h)}}(self),function(){\"use strict\";var t=document.createElement(\"_\");if(t.classList.add(\"c1\",\"c2\"),!t.classList.contains(\"c2\")){var e=function(t){var e=DOMTokenList.prototype[t];DOMTokenList.prototype[t]=function(t){var n,i=arguments.length;for(n=0;i>n;n++)t=arguments[n],e.call(this,t)}};e(\"add\"),e(\"remove\")}if(t.classList.toggle(\"c3\",!1),t.classList.contains(\"c3\")){var n=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(t,e){return 1 in arguments&&!this.contains(t)==!e?e:n.call(this,t)}}\"replace\"in document.createElement(\"_\").classList||(DOMTokenList.prototype.replace=function(t,e){var n=this.toString().split(\" \"),i=n.indexOf(t+\"\");~i&&(n=n.slice(i),this.remove.apply(this,n),this.add(e),this.add.apply(this,n.slice(1)))}),t=null}());\n/*!\n * https://github.com/es-shims/es5-shim\n * @license es5-shim Copyright 2009-2020 by contributors, MIT License\n * see https://github.com/es-shims/es5-shim/blob/v4.5.14/LICENSE\n */\n(function(t,r){\"use strict\";if(typeof define===\"function\"&&define.amd){define(r)}else if(typeof exports===\"object\"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol===\"function\"&&typeof Symbol.toStringTag===\"symbol\";var D;var S=Function.prototype.toString,x=/^\\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\\/\\/.*\\n/g,\"\");var n=e.replace(/\\/\\*[.\\s\\S]*\\*\\//g,\"\");var i=n.replace(/\\n/gm,\" \").replace(/ {2}/g,\" \");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j=\"[object Function]\",I=\"[object GeneratorFunction]\",D=function isCallable(t){if(!t){return false}if(typeof t!==\"function\"&&typeof t!==\"object\"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F=\"[object RegExp]\";M=function isRegex(t){if(typeof t!==\"object\"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A=\"[object String]\";N=function isString(t){if(typeof t===\"string\"){return true}if(typeof t!==\"object\"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,\"x\",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!==\"object\"&&r!==\"function\"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError(\"can't convert \"+t+\" to object\")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError(\"Function.prototype.bind called on incompatible \"+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,\"$\"+l)}a=i(\"binder\",\"return function (\"+y.call(u,\",\")+\"){ return binder.apply(this, arguments); }\")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document===\"object\"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)===\"[object Array]\"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e(\"a\");var at=it[0]!==\"a\"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call(\"foo\",function(t,e,n){if(typeof n!==\"object\"){r=false}});t.call([1],function(){\"use strict\";e=typeof this===\"string\"},\"x\")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.forEach callback must be a function\")}while(++n<i){if(n in e){if(typeof a===\"undefined\"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,\"\"):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError(\"Array.prototype.map callback must be a function\")}for(var f=0;f<i;f++){if(f in n){if(typeof o===\"undefined\"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.filter callback must be a function\")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o===\"undefined\"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.every callback must be a function\")}for(var a=0;a<n;a++){if(a in e&&!(typeof i===\"undefined\"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError(\"Array.prototype.some callback must be a function\")}for(var a=0;a<n;a++){if(a in e&&(typeof i===\"undefined\"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call(\"es5\",function(t,r,e,n){return n})===\"object\"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError(\"Array.prototype.reduce callback must be a function\")}if(n===0&&arguments.length===1){throw new TypeError(\"reduce of empty array with no initial value\")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError(\"reduce of empty array with no initial value\")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call(\"es5\",function(t,r,e,n){return n})===\"object\"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,\"\"):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError(\"Array.prototype.reduceRight callback must be a function\")}if(n===0&&arguments.length===1){throw new TypeError(\"reduceRight of empty array with no initial value\")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError(\"reduceRight of empty array with no initial value\")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,\"\"):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,\"\"):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!==\"number\"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]=\"x\";r.splice(1,1);return r.indexOf(\"x\")===7}();var pt=function(){var t=256;var r=[];r[t]=\"a\";r.splice(t+1,0,\"b\");return r[t]===\"a\"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=arguments.length===0?0:arguments.length===1?i-f:b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call(\"123\",\",\")!==\"1,2,3\"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t===\"undefined\"?\",\":t;return yt.call(N(this)?Q(this,\"\"):this,r)}},dt)}var gt=[1,2].join(undefined)!==\"1,2\";if(gt){P(r,{join:function join(t){var r=typeof t===\"undefined\"?\",\":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!==\"undefined\"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!==\"undefined\"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,\"\"):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t===\"undefined\"){return rt(this)}if(!D(t)){throw new TypeError(\"Array.prototype.sort callback must be a function\")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},\"toString\");var Ot=tt(function(){},\"prototype\");var Et=!G(\"x\",\"0\");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window===\"undefined\"){return false}for(var t in window){try{if(!It[\"$\"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]===\"object\"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window===\"undefined\"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=[\"toString\",\"toLocaleString\",\"valueOf\",\"hasOwnProperty\",\"isPrototypeOf\",\"propertyIsEnumerable\",\"constructor\"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)===\"[object Arguments]\"};var Ct=function isArguments(t){return t!==null&&typeof t===\"object\"&&typeof t.length===\"number\"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t===\"object\";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError(\"Object.keys called on a non-object\")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l===\"prototype\")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v===\"constructor\")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!==\"Mon, 01 Jan -45875 11:59:59 GMT\";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!==\"Tue Jan 02 -45875\";Ht=!/^Thu Dec 10 2015 \\d\\d:\\d\\d:\\d\\d GMT[-+]\\d\\d\\d\\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!==\"Mon Jan 01 -45875\";Ht=!/^Wed Dec 09 2015 \\d\\d:\\d\\d:\\d\\d GMT[-+]\\d\\d\\d\\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"];var ir=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+\", \"+(r<10?\"0\"+r:r)+\" \"+ir[e]+\" \"+n+\" \"+(i<10?\"0\"+i:i)+\":\"+(a<10?\"0\"+a:a)+\":\"+(o<10?\"0\"+o:o)+\" GMT\"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+\" \"+ir[e]+\" \"+(r<10?\"0\"+r:r)+\" \"+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError(\"this is not a Date object.\")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+\" \"+ir[e]+\" \"+(r<10?\"0\"+r:r)+\" \"+n+\" \"+(i<10?\"0\"+i:i)+\":\"+(a<10?\"0\"+a:a)+\":\"+(o<10?\"0\"+o:o)+\" GMT\"+(f>0?\"-\":\"+\")+(u<10?\"0\"+u:u)+(l<10?\"0\"+l:l)};if(R){e.defineProperty(Date.prototype,\"toString\",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr=\"-000001\";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!==\"1969-12-31T23:59:59.999Z\";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError(\"Date.prototype.toISOString called on non-finite value.\")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?\"-\":t>9999?\"+\":\"\")+K(\"00000\"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K(\"00\"+e[n],-2)}return t+\"-\"+W(e,0,2).join(\"-\")+\"T\"+W(e,2).join(\":\")+\".\"+K(\"000\"+er(this),-3)+\"Z\"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n===\"number\"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError(\"toISOString property is not callable\")}return i.call(r)}}var vr=Date.parse(\"+033658-09-27T01:46:40.000Z\")===1e15;var hr=!isNaN(Date.parse(\"2012-04-04T24:00:00.500Z\"))||!isNaN(Date.parse(\"2012-11-31T23:59:59.000Z\"))||!isNaN(Date.parse(\"2012-12-31T23:59:60.000Z\"));var pr=isNaN(Date.parse(\"2000-01-01T00:00:00.000Z\"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp(\"^\"+\"(\\\\d{4}|[+-]\\\\d{6})\"+\"(?:-(\\\\d{2})\"+\"(?:-(\\\\d{2})\"+\"(?:\"+\"T(\\\\d{2})\"+\":(\\\\d{2})\"+\"(?:\"+\":(\\\\d{2})\"+\"(?:(\\\\.\\\\d{1,}))?\"+\")?\"+\"(\"+\"Z|\"+\"(?:\"+\"([-+])\"+\"(\\\\d{2})\"+\":(\\\\d{2})\"+\")\"+\")?)?)?)?\"+\"$\");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]===\"-\"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!==\"0.000\"||.9.toFixed(0)!==\"1\"||1.255.toFixed(2)!==\"1.25\"||(1000000000000000128).toFixed(0)!==\"1000000000000000128\");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r=\"\";while(--t>=0){if(r!==\"\"||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===\"\"){r=e}else{r+=K(\"0000000\",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError(\"Number.toFixed called with invalid number of decimals\")}e=u(this);if(Y(e)){return\"NaN\"}if(e<=-1e21||e>=1e21){return o(e)}n=\"\";if(e<0){n=\"-\";e=-e}i=\"0\";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K(\"0.00000000000000000000\",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K(\"0.0000000000000000000\",0,r-s+2)+i}else{i=n+K(i,0,s-r)+\".\"+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)===\"1\"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t===\"undefined\"?mr.call(this):mr.call(this,t)}},Tr);if(\"ab\".split(/(?:ab)*/).length!==2||\".\".split(/(.?)(.?)/).length!==4||\"tesst\".split(/(s)*/)[1]===\"t\"||\"test\".split(/(?:)/,-1).length!==4||\"\".split(/.?/).length||\".\".split(/()()/).length>1){(function(){var t=typeof/()??/.exec(\"\")[1]===\"undefined\";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e===\"undefined\"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?\"i\":\"\")+(e.multiline?\"m\":\"\")+(e.unicode?\"u\":\"\")+(e.sticky?\"y\":\"\"),f=0,u,l,s,c;var h=new RegExp(e.source,o+\"g\");if(!t){u=new RegExp(\"^\"+h.source+\"$(?!\\\\s)\",o)}var p=typeof n===\"undefined\"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]===\"undefined\"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test(\"\")){_(a,\"\")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if(\"0\".split(void 0,0).length){f.split=function split(t,r){if(typeof t===\"undefined\"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];\"x\".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]===\"undefined\"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or=\"\".substr&&\"0b\".substr(-1)!==\"b\";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er=\"\\t\\n\\x0B\\f\\r \\xa0\\u1680\\u2000\\u2001\\u2002\\u2003\"+\"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\"+\"\\u2029\\ufeff\";var jr=\"\\u200b\";var Ir=\"[\"+Er+\"]\";var Mr=new RegExp(\"^\"+Ir+Ir+\"*\");var Ur=new RegExp(Ir+Ir+\"*$\");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}return o(this).replace(Mr,\"\").replace(Ur,\"\")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&\"abc\\u3042\\u3044\".lastIndexOf(\"\\u3042\\u3044\",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+\"08\")!==8||parseInt(Er+\"0x16\")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e===\"symbol\"){\"\"+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat(\"-0\")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)===\"-\"?-0:n}}(parseFloat)}if(String(new RangeError(\"test\"))!==\"RangeError: test\"){var kr=function toString(){if(typeof this===\"undefined\"||this===null){throw new TypeError(\"can't convert \"+this+\" to object\")}var t=this.name;if(typeof t===\"undefined\"){t=\"Error\"}else if(typeof t!==\"string\"){t=o(t)}var r=this.message;if(typeof r===\"undefined\"){r=\"\"}else if(typeof r!==\"string\"){r=o(r)}if(!t){return r}if(!r){return t}return t+\": \"+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,\"message\");if(Error.prototype.message!==\"\"){Error.prototype.message=\"\"}Ar(Error.prototype,\"name\")}if(String(/a/gim)!==\"/a/gim\"){var Rr=function toString(){var t=\"/\"+this.source+\"/\";if(this.global){t+=\"g\"}if(this.ignoreCase){t+=\"i\"}if(this.multiline){t+=\"m\"}return t};RegExp.prototype.toString=Rr}});\n/*!\n * https://github.com/paulmillr/es6-shim\n * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)\n *   and contributors,  MIT License\n * es6-shim: v0.35.4\n * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE\n * Details and documentation:\n * https://github.com/paulmillr/es6-shim/\n */\n(function(e,t){if(typeof define===\"function\"&&define.amd){define(t)}else if(typeof exports===\"object\"){module.exports=t()}else{e.returnExports=t()}})(this,function(){\"use strict\";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},\"x\",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name===\"foo\";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/===\"function\"?function IsCallableSlow(e){return typeof e===\"function\"&&g(e)===\"[object Function]\"}:function IsCallableFast(e){return typeof e===\"function\"};var m={getter:function(e,t,r){if(!s){throw new TypeError(\"getters require true ES5 support\")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError(\"getters require true ES5 support\")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if(\"value\"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,\"toString\",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!==\"undefined\"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!==\"undefined\"){return self}if(typeof window!==\"undefined\"){return window}if(typeof global!==\"undefined\"){return global}throw new Error(\"unable to locate global object\")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype[\"delete\"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||\"@@species\";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e===\"number\"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)===\"[object Arguments]\"};var ee=function isArguments(e){return e!==null&&typeof e===\"object\"&&typeof e.length===\"number\"&&e.length>=0&&g(e)!==\"[object Array]\"&&g(e.callee)===\"[object Function]\"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!==\"function\"&&typeof e!==\"object\"},string:function(e){return g(e)===\"[object String]\"},regex:function(e){return g(e)===\"[object RegExp]\"},symbol:function(e){return typeof S.Symbol===\"function\"&&typeof e===\"symbol\"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $===\"function\"&&typeof $[\"for\"]===\"function\"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:\"_es6-shim iterator_\";if(S.Set&&typeof(new S.Set)[\"@@iterator\"]===\"function\"){ie=\"@@iterator\"}if(!S.Reflect){h(S,\"Reflect\",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document===\"undefined\"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+\" is not a function\")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||\"Cannot call method on \"+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e===\"function\"||typeof e===\"object\"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)===\"[object Symbol]\"){throw new TypeError(\"Cannot convert a Symbol value to a number\")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!==\"undefined\"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,\"value\")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError(\"value is not an iterable\")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError(\"bad iterator\")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError(\"Method not callable: \"+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,\"return\");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError(\"Iterator's return method returned a non-object.\")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError(\"bad iterator\")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r===\"undefined\"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError(\"Bad constructor\")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError(\"Bad @@species\")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i=\"<\"+t;if(r!==\"\"){var a=ce.ToString(n);var u=a.replace(/\"/g,\"&quot;\");i+=\" \"+r+'=\"'+u+'\"'}var f=i+\">\";var s=f+o;return s+\"</\"+t+\">\"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!==\"undefined\"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$[\"for\"](\"Symbol.\"+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le(\"search\");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!==\"undefined\"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,\"search\",ye)}if(!re.symbol($.replace)){var he=le(\"replace\");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!==\"undefined\"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,\"replace\",ge)}if(!re.symbol($.split)){var de=le(\"split\");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!==\"undefined\"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,\"split\",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return\"a\".match(e)!==42}();if(!we||je){var Se=le(\"match\");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!==\"undefined\"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,\"match\",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,\"constructor\",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError(\"property is nonconfigurable\")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError(\"Constructor requires `new`: \"+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,\"fromCodePoint\",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError(\"Invalid code point \"+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join(\"\")},raw:function raw(e){var t=ce.ToObject(e,\"bad callSite\");var r=ce.ToObject(t.raw,\"bad raw value\");var n=r.length;var o=ce.ToLength(n);if(o<=0){return\"\"}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:\"\";c=ce.ToString(f);M(i,c);a+=1}return i.join(\"\")}};if(String.raw&&String.raw({raw:{0:\"x\",1:\"y\",length:2}})!==\"xy\"){ne(String,\"raw\",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return\"\"}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError(\"repeat count must be less than infinity and not overflow maximum string size\")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method \"startsWith\" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method \"endsWith\" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o===\"undefined\"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('\"includes\" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&\"a\".includes(\"a\",Infinity)!==false){ne(String.prototype,\"includes\",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return\"/a/\".startsWith(/a/)});var ze=a(function(){return\"abc\".startsWith(\"a\",Infinity)===false});if(!De||!ze){ne(String.prototype,\"startsWith\",Fe.startsWith);ne(String.prototype,\"endsWith\",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return\"/a/\".startsWith(e)});if(!qe){ne(String.prototype,\"startsWith\",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return\"/a/\".endsWith(e)});if(!We){ne(String.prototype,\"endsWith\",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return\"/a/\".includes(e)});if(!Ge){ne(String.prototype,\"includes\",Fe.includes)}}b(String.prototype,Fe);var He=[\"\\t\\n\\x0B\\f\\r \\xa0\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\",\"\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\u2028\",\"\\u2029\\ufeff\"].join(\"\");var Ve=new RegExp(\"(^[\"+He+\"]+)|([\"+He+\"]+$)\",\"g\");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,\"\")};var Ue=[\"\\x85\",\"\\u200b\",\"\\ufffe\"].join(\"\");var $e=new RegExp(\"[\"+Ue+\"]\",\"g\");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,\"trim\",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e===\"undefined\"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n===\"undefined\"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError(\"Array.from: when provided, the second argument must be a function\")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!==\"undefined\";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i===\"undefined\"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i===\"undefined\"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError(\"Not an ArrayIterator\")}if(typeof t!==\"undefined\"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n===\"key\"){o=e}else if(n===\"value\"){o=t[e]}else if(n===\"entry\"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,\"of\",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f===\"undefined\"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t===\"undefined\"?0:t);r=ce.ToInteger(typeof r===\"undefined\"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError(\"Array#find: predicate must be a function\")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError(\"Array#findIndex: predicate must be a function\")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,\"key\")},values:function values(){return new q(this,\"value\")},entries:function entries(){return new q(this,\"entry\")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!==\"values\"){var tt=Array.prototype.values;ne(Array.prototype,\"values\",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,\"indexOf\",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,\"from\",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,\"from\",function from(e){if(arguments.length>1&&typeof arguments[1]!==\"undefined\"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError(\"should not reach here\")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,\"forEach\",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,\"map\",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,\"filter\",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,\"some\",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,\"every\",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,\"reduce\",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,\"reduceRight\",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number(\"0o10\")!==8;var bt=Number(\"0b10\")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf===\"function\"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString===\"function\"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError(\"No default value\")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,\"number\")}else{r=0}if(typeof r===\"string\"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,\"Number\",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,\"parseInt\",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,\"find\",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,\"findIndex\",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,\"Cannot convert undefined or null to object\");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,\"xy\")}catch(t){return e[1]===\"y\"}}();if(_t){ne(Object,\"assign\",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError(\"cannot set prototype on a non-object\")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError(\"can only set prototype to an object or null\"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,\"__proto__\")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys(\"foo\")});if(!Lt){var Ft=Object.keys;ne(Object,\"keys\",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,\"keys\",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames(\"foo\")});if(!qt){var Wt=typeof window===\"object\"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,\"getOwnPropertyNames\",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)===\"[object Window]\"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor(\"foo\",\"bar\")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,\"getOwnPropertyDescriptor\",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal(\"foo\")});if(!Bt){var Ut=Object.seal;ne(Object,\"seal\",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed(\"foo\")});if(!$t){var Jt=Object.isSealed;ne(Object,\"isSealed\",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze(\"foo\")});if(!Xt){var Kt=Object.freeze;ne(Object,\"freeze\",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen(\"foo\")});if(!Zt){var Yt=Object.isFrozen;ne(Object,\"isFrozen\",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions(\"foo\")});if(!Qt){var er=Object.preventExtensions;ne(Object,\"preventExtensions\",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible(\"foo\")});if(!tr){var rr=Object.isExtensible;ne(Object,\"isExtensible\",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf(\"foo\")});if(!nr){var or=Object.getPrototypeOf;ne(Object,\"getPrototypeOf\",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError(\"Method called on incompatible type: must be an object.\")}var e=\"\";if(this.global){e+=\"g\"}if(this.ignoreCase){e+=\"i\"}if(this.multiline){e+=\"m\"}if(this.unicode){e+=\"u\"}if(this.sticky){e+=\"y\"}return e};m.getter(RegExp.prototype,\"flags\",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,\"i\"))===\"/a/i\"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:\"abc\"})===\"/abc/\"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:\"a\",flags:\"b\"})===\"/a/b\"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,\"toString\",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return\"/\"+r+\"/\"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,\"flags\").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,\"source\")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t===\"undefined\"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t===\"undefined\"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t===\"undefined\"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,\"RegExp\",gr)}if(s){var dr={input:\"$_\",lastMatch:\"$&\",lastParen:\"$+\",leftContext:\"$`\",rightContext:\"$'\"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,\"sinh\",Cr.sinh,Math.sinh(710)===Infinity);h(Math,\"cosh\",Cr.cosh,Math.cosh(710)===Infinity);h(Math,\"log1p\",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,\"asinh\",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,\"asinh\",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,\"atanh\",Cr.atanh,Math.atanh(1e-300)===0);h(Math,\"tanh\",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);\nh(Math,\"acosh\",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,\"acosh\",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,\"cbrt\",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,\"sinh\",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,\"expm1\",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,\"round\",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,\"imul\",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!==\"function\"&&typeof e!==\"object\"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise===\"undefined\"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError(\"Bad promise constructor\")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError(\"Bad Promise implementation!\")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError(\"Bad promise constructor\")}};var n;if(typeof window!==\"undefined\"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t=\"zero-timeout-message\";var r=function(r){M(e,r);window.postMessage(t,\"*\")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener(\"message\",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process===\"object\"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError(\"Self resolution\"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires \"new\"')}if(this&&this._promise){throw new TypeError(\"Bad construction\")}if(!ce.IsCallable(t)){throw new TypeError(\"not a valid resolver\")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError(\"Promise is not object\")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError(\"Promise is not object\")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError(\"Bad promise constructor\")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError(\"Bad promise constructor\")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{\"catch\":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError(\"not a promise\")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError(\"unexpected Promise state\")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr===\"function\"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},\"then\",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,\"Promise\",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,\"all\",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,\"race\",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,\"resolve\",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,\"reject\",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,\"all\");Mt(Promise,\"race\");Mt(Promise,\"resolve\");Mt(Promise,\"reject\");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(\":\")===t.join(\":\")};var Kr=Xr([\"z\",\"a\",\"bb\"]);var Zr=Xr([\"z\",1,\"a\",\"3\",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return\"^\"+ce.ToString(e)}else if(typeof e===\"string\"){return\"$\"+e}else if(typeof e===\"number\"){if(!Zr){return\"n\"+e}return e}else if(typeof e===\"boolean\"){return\"b\"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError(\"Iterator value \"+e+\" is not an entry object\")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError(\"bad map\")}i=ce.GetIterator(o)}if(typeof i!==\"undefined\"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError(\"Iterator value \"+f+\" is not an entry object\")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError(\"bad set\")}i=ce.GetIterator(o)}if(typeof i!==\"undefined\"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError(\"Method Map.prototype.\"+t+\" called on incompatible receiver \"+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,\"[[MapIterator]]\");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError(\"Not a MapIterator\")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i===\"undefined\"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t===\"key\"){n=e.key}else if(t===\"value\"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}if(this&&this._es6map){throw new TypeError(\"Bad construction\")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,\"size\",function(){if(typeof this._size===\"undefined\"){throw new TypeError(\"size method called on incompatible Map\")}return this._size});b(a,{get:function get(e){o(this,\"get\");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,\"has\");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!==\"undefined\"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,\"set\");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!==\"undefined\"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},\"delete\":function(t){o(this,\"delete\");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]===\"undefined\"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,\"clear\");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,\"keys\");return new i(this,\"key\")},values:function values(){o(this,\"values\");return new i(this,\"value\")},entries:function entries(){o(this,\"entries\");return new i(this,\"key+value\")},forEach:function forEach(e){o(this,\"forEach\");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!==\"undefined\"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError(\"Set.prototype.\"+r+\" called on incompatible receiver \"+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires \"new\"')}if(this&&this._es6set){throw new TypeError(\"Bad construction\")}var e=Ae(this,Set,o,{_es6set:true,\"[[SetData]]\":null,_storage:Qr()});if(!e._es6set){throw new TypeError(\"bad set\")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t===\"^null\"){return null}else if(t===\"^undefined\"){return void 0}else{var r=t.charAt(0);if(r===\"$\"){return C(t,1)}else if(r===\"n\"){return+C(t,1)}else if(r===\"b\"){return t===\"btrue\"}}return+t};var u=function ensureMap(e){if(!e[\"[[SetData]]\"]){var t=new rn.Map;e[\"[[SetData]]\"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e[\"[[SetData]]\"]=t}e._storage=null};m.getter(i.prototype,\"size\",function(){r(this,\"size\");if(this._storage){return n(this._storage).length}u(this);return this[\"[[SetData]]\"].size});b(i.prototype,{has:function has(e){r(this,\"has\");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this[\"[[SetData]]\"].has(e)},add:function add(e){r(this,\"add\");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this[\"[[SetData]]\"].set(e,e);return this},\"delete\":function(e){r(this,\"delete\");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this[\"[[SetData]]\"][\"delete\"](e)},clear:function clear(){r(this,\"clear\");if(this._storage){this._storage=Qr()}if(this[\"[[SetData]]\"]){this[\"[[SetData]]\"].clear()}},values:function values(){r(this,\"values\");u(this);return new f(this[\"[[SetData]]\"].values())},entries:function entries(){r(this,\"entries\");u(this);return new f(this[\"[[SetData]]\"].entries())},forEach:function forEach(e){r(this,\"forEach\");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this[\"[[SetData]]\"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,\"keys\",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError(\"Not a SetIterator\")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype[\"delete\"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,\"constructor\",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,\"set\",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype[\"delete\"]&&Set.prototype.add&&Set.prototype.has&&function(e){e[\"delete\"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype[\"delete\"];Set.prototype[\"delete\"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype[\"delete\"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires \"new\"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,\"constructor\",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires \"new\"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,\"constructor\",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!==\"function\"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!==\"function\"||typeof S.Set.prototype.keys!==\"function\"||typeof S.Map.prototype.forEach!==\"function\"||typeof S.Set.prototype.forEach!==\"function\"||u(S.Map)||u(S.Set)||typeof jn.keys().next!==\"function\"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,\"keys\",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!==\"has\"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,\"has\",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError(\"target must be an object\")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError(\"First argument must be a constructor.\")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError(\"new.target must be a constructor.\")}return ce.Construct(e,t,r,\"internal\")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if(\"value\"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if(\"value\"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError(\"proto must be an object or null\")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!==\"getPrototypeOf\"){ne(S.Reflect,\"getPrototypeOf\",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,\"setPrototypeOf\",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,\"test\",{value:1});var t=typeof Object.preventExtensions!==\"function\"||!S.Reflect.defineProperty(Object.preventExtensions({}),\"test\",{});return e&&t})){ne(S.Reflect,\"defineProperty\",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,\"construct\",En.construct)}}if(String(new Date(NaN))!==\"Invalid Date\"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return\"Invalid Date\"}return ce.Call(_n,this)};ne(Date.prototype,\"toString\",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,\"a\",\"name\",e)},big:function big(){return ce.CreateHTML(this,\"big\",\"\",\"\")},blink:function blink(){return ce.CreateHTML(this,\"blink\",\"\",\"\")},bold:function bold(){return ce.CreateHTML(this,\"b\",\"\",\"\")},fixed:function fixed(){return ce.CreateHTML(this,\"tt\",\"\",\"\")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,\"font\",\"color\",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,\"font\",\"size\",e)},italics:function italics(){return ce.CreateHTML(this,\"i\",\"\",\"\")},link:function link(e){return ce.CreateHTML(this,\"a\",\"href\",e)},small:function small(){return ce.CreateHTML(this,\"small\",\"\",\"\")},strike:function strike(){return ce.CreateHTML(this,\"strike\",\"\",\"\")},sub:function sub(){return ce.CreateHTML(this,\"sub\",\"\",\"\")},sup:function sub(){return ce.CreateHTML(this,\"sup\",\"\",\"\")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,\"\",' \" ');var i=P([],o.match(/\"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON===\"object\"&&typeof JSON.stringify===\"function\"?JSON.stringify:null;if(!e){return false}if(typeof e($())!==\"undefined\"){return true}if(e([$()])!==\"[null]\"){return true}var t={a:$()};t[$()]=true;if(e(t)!==\"{}\"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))===\"{}\"&&JSON.stringify([Object($())])===\"[{}]\"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,\"stringify\",function stringify(e){if(typeof e===\"symbol\"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!==\"symbol\"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});\n/*! jQuery v3.7.1 | (c) OpenJS Foundation and other contributors | jquery.org/license */\n!function(e,t){\"use strict\";\"object\"==typeof module&&\"object\"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error(\"jQuery requires a window with a document\");return t(e)}:t(e)}(\"undefined\"!=typeof window?window:this,function(ie,e){\"use strict\";var oe=[],r=Object.getPrototypeOf,ae=oe.slice,g=oe.flat?function(e){return oe.flat.call(e)}:function(e){return oe.concat.apply([],e)},s=oe.push,se=oe.indexOf,n={},i=n.toString,ue=n.hasOwnProperty,o=ue.toString,a=o.call(Object),le={},v=function(e){return\"function\"==typeof e&&\"number\"!=typeof e.nodeType&&\"function\"!=typeof e.item},y=function(e){return null!=e&&e===e.window},C=ie.document,u={type:!0,src:!0,nonce:!0,noModule:!0};function m(e,t,n){var r,i,o=(n=n||C).createElement(\"script\");if(o.text=e,t)for(r in u)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function x(e){return null==e?e+\"\":\"object\"==typeof e||\"function\"==typeof e?n[i.call(e)]||\"object\":typeof e}var t=\"3.7.1\",l=/HTML$/i,ce=function(e,t){return new ce.fn.init(e,t)};function c(e){var t=!!e&&\"length\"in e&&e.length,n=x(e);return!v(e)&&!y(e)&&(\"array\"===n||0===t||\"number\"==typeof t&&0<t&&t-1 in e)}function fe(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}ce.fn=ce.prototype={jquery:t,constructor:ce,length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?ae.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=ce.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return ce.each(this,e)},map:function(n){return this.pushStack(ce.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(ce.grep(this,function(e,t){return(t+1)%2}))},odd:function(){return this.pushStack(ce.grep(this,function(e,t){return t%2}))},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:s,sort:oe.sort,splice:oe.splice},ce.extend=ce.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for(\"boolean\"==typeof a&&(l=a,a=arguments[s]||{},s++),\"object\"==typeof a||v(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],\"__proto__\"!==t&&a!==r&&(l&&r&&(ce.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||ce.isPlainObject(n)?n:{},i=!1,a[t]=ce.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},ce.extend({expando:\"jQuery\"+(t+Math.random()).replace(/\\D/g,\"\"),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||\"[object Object]\"!==i.call(e))&&(!(t=r(e))||\"function\"==typeof(n=ue.call(t,\"constructor\")&&t.constructor)&&o.call(n)===a)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t,n){m(e,{nonce:t&&t.nonce},n)},each:function(e,t){var n,r=0;if(c(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},text:function(e){var t,n=\"\",r=0,i=e.nodeType;if(!i)while(t=e[r++])n+=ce.text(t);return 1===i||11===i?e.textContent:9===i?e.documentElement.textContent:3===i||4===i?e.nodeValue:n},makeArray:function(e,t){var n=t||[];return null!=e&&(c(Object(e))?ce.merge(n,\"string\"==typeof e?[e]:e):s.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:se.call(t,e,n)},isXMLDoc:function(e){var t=e&&e.namespaceURI,n=e&&(e.ownerDocument||e).documentElement;return!l.test(t||n&&n.nodeName||\"HTML\")},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(c(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g(a)},guid:1,support:le}),\"function\"==typeof Symbol&&(ce.fn[Symbol.iterator]=oe[Symbol.iterator]),ce.each(\"Boolean Number String Function Array Date RegExp Object Error Symbol\".split(\" \"),function(e,t){n[\"[object \"+t+\"]\"]=t.toLowerCase()});var pe=oe.pop,de=oe.sort,he=oe.splice,ge=\"[\\\\x20\\\\t\\\\r\\\\n\\\\f]\",ve=new RegExp(\"^\"+ge+\"+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)\"+ge+\"+$\",\"g\");ce.contains=function(e,t){var n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(e.contains?e.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))};var f=/([\\0-\\x1f\\x7f]|^-?\\d)|^-$|[^\\x80-\\uFFFF\\w-]/g;function p(e,t){return t?\"\\0\"===e?\"\\ufffd\":e.slice(0,-1)+\"\\\\\"+e.charCodeAt(e.length-1).toString(16)+\" \":\"\\\\\"+e}ce.escapeSelector=function(e){return(e+\"\").replace(f,p)};var ye=C,me=s;!function(){var e,b,w,o,a,T,r,C,d,i,k=me,S=ce.expando,E=0,n=0,s=W(),c=W(),u=W(),h=W(),l=function(e,t){return e===t&&(a=!0),0},f=\"checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped\",t=\"(?:\\\\\\\\[\\\\da-fA-F]{1,6}\"+ge+\"?|\\\\\\\\[^\\\\r\\\\n\\\\f]|[\\\\w-]|[^\\0-\\\\x7f])+\",p=\"\\\\[\"+ge+\"*(\"+t+\")(?:\"+ge+\"*([*^$|!~]?=)\"+ge+\"*(?:'((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\"|(\"+t+\"))|)\"+ge+\"*\\\\]\",g=\":(\"+t+\")(?:\\\\((('((?:\\\\\\\\.|[^\\\\\\\\'])*)'|\\\"((?:\\\\\\\\.|[^\\\\\\\\\\\"])*)\\\")|((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|\"+p+\")*)|.*)\\\\)|)\",v=new RegExp(ge+\"+\",\"g\"),y=new RegExp(\"^\"+ge+\"*,\"+ge+\"*\"),m=new RegExp(\"^\"+ge+\"*([>+~]|\"+ge+\")\"+ge+\"*\"),x=new RegExp(ge+\"|>\"),j=new RegExp(g),A=new RegExp(\"^\"+t+\"$\"),D={ID:new RegExp(\"^#(\"+t+\")\"),CLASS:new RegExp(\"^\\\\.(\"+t+\")\"),TAG:new RegExp(\"^(\"+t+\"|[*])\"),ATTR:new RegExp(\"^\"+p),PSEUDO:new RegExp(\"^\"+g),CHILD:new RegExp(\"^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(\"+ge+\"*(even|odd|(([+-]|)(\\\\d*)n|)\"+ge+\"*(?:([+-]|)\"+ge+\"*(\\\\d+)|))\"+ge+\"*\\\\)|)\",\"i\"),bool:new RegExp(\"^(?:\"+f+\")$\",\"i\"),needsContext:new RegExp(\"^\"+ge+\"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(\"+ge+\"*((?:-\\\\d)?\\\\d*)\"+ge+\"*\\\\)|)(?=[^-]|$)\",\"i\")},N=/^(?:input|select|textarea|button)$/i,q=/^h\\d$/i,L=/^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/,H=/[+~]/,O=new RegExp(\"\\\\\\\\[\\\\da-fA-F]{1,6}\"+ge+\"?|\\\\\\\\([^\\\\r\\\\n\\\\f])\",\"g\"),P=function(e,t){var n=\"0x\"+e.slice(1)-65536;return t||(n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320))},M=function(){V()},R=J(function(e){return!0===e.disabled&&fe(e,\"fieldset\")},{dir:\"parentNode\",next:\"legend\"});try{k.apply(oe=ae.call(ye.childNodes),ye.childNodes),oe[ye.childNodes.length].nodeType}catch(e){k={apply:function(e,t){me.apply(e,ae.call(t))},call:function(e){me.apply(e,ae.call(arguments,1))}}}function I(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],\"string\"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&(V(e),e=e||T,C)){if(11!==p&&(u=L.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return k.call(n,a),n}else if(f&&(a=f.getElementById(i))&&I.contains(e,a)&&a.id===i)return k.call(n,a),n}else{if(u[2])return k.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&e.getElementsByClassName)return k.apply(n,e.getElementsByClassName(i)),n}if(!(h[t+\" \"]||d&&d.test(t))){if(c=t,f=e,1===p&&(x.test(t)||m.test(t))){(f=H.test(t)&&U(e.parentNode)||e)==e&&le.scope||((s=e.getAttribute(\"id\"))?s=ce.escapeSelector(s):e.setAttribute(\"id\",s=S)),o=(l=Y(t)).length;while(o--)l[o]=(s?\"#\"+s:\":scope\")+\" \"+Q(l[o]);c=l.join(\",\")}try{return k.apply(n,f.querySelectorAll(c)),n}catch(e){h(t,!0)}finally{s===S&&e.removeAttribute(\"id\")}}}return re(t.replace(ve,\"$1\"),e,n,r)}function W(){var r=[];return function e(t,n){return r.push(t+\" \")>b.cacheLength&&delete e[r.shift()],e[t+\" \"]=n}}function F(e){return e[S]=!0,e}function $(e){var t=T.createElement(\"fieldset\");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function B(t){return function(e){return fe(e,\"input\")&&e.type===t}}function _(t){return function(e){return(fe(e,\"input\")||fe(e,\"button\"))&&e.type===t}}function z(t){return function(e){return\"form\"in e?e.parentNode&&!1===e.disabled?\"label\"in e?\"label\"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&R(e)===t:e.disabled===t:\"label\"in e&&e.disabled===t}}function X(a){return F(function(o){return o=+o,F(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function U(e){return e&&\"undefined\"!=typeof e.getElementsByTagName&&e}function V(e){var t,n=e?e.ownerDocument||e:ye;return n!=T&&9===n.nodeType&&n.documentElement&&(r=(T=n).documentElement,C=!ce.isXMLDoc(T),i=r.matches||r.webkitMatchesSelector||r.msMatchesSelector,r.msMatchesSelector&&ye!=T&&(t=T.defaultView)&&t.top!==t&&t.addEventListener(\"unload\",M),le.getById=$(function(e){return r.appendChild(e).id=ce.expando,!T.getElementsByName||!T.getElementsByName(ce.expando).length}),le.disconnectedMatch=$(function(e){return i.call(e,\"*\")}),le.scope=$(function(){return T.querySelectorAll(\":scope\")}),le.cssHas=$(function(){try{return T.querySelector(\":has(*,:jqfake)\"),!1}catch(e){return!0}}),le.getById?(b.filter.ID=function(e){var t=e.replace(O,P);return function(e){return e.getAttribute(\"id\")===t}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&C){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(O,P);return function(e){var t=\"undefined\"!=typeof e.getAttributeNode&&e.getAttributeNode(\"id\");return t&&t.value===n}},b.find.ID=function(e,t){if(\"undefined\"!=typeof t.getElementById&&C){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode(\"id\"))&&n.value===e)return[o]}return[]}}),b.find.TAG=function(e,t){return\"undefined\"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):t.querySelectorAll(e)},b.find.CLASS=function(e,t){if(\"undefined\"!=typeof t.getElementsByClassName&&C)return t.getElementsByClassName(e)},d=[],$(function(e){var t;r.appendChild(e).innerHTML=\"<a id='\"+S+\"' href='' disabled='disabled'></a><select id='\"+S+\"-\\r\\\\' disabled='disabled'><option selected=''></option></select>\",e.querySelectorAll(\"[selected]\").length||d.push(\"\\\\[\"+ge+\"*(?:value|\"+f+\")\"),e.querySelectorAll(\"[id~=\"+S+\"-]\").length||d.push(\"~=\"),e.querySelectorAll(\"a#\"+S+\"+*\").length||d.push(\".#.+[+~]\"),e.querySelectorAll(\":checked\").length||d.push(\":checked\"),(t=T.createElement(\"input\")).setAttribute(\"type\",\"hidden\"),e.appendChild(t).setAttribute(\"name\",\"D\"),r.appendChild(e).disabled=!0,2!==e.querySelectorAll(\":disabled\").length&&d.push(\":enabled\",\":disabled\"),(t=T.createElement(\"input\")).setAttribute(\"name\",\"\"),e.appendChild(t),e.querySelectorAll(\"[name='']\").length||d.push(\"\\\\[\"+ge+\"*name\"+ge+\"*=\"+ge+\"*(?:''|\\\"\\\")\")}),le.cssHas||d.push(\":has\"),d=d.length&&new RegExp(d.join(\"|\")),l=function(e,t){if(e===t)return a=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)==(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!le.sortDetached&&t.compareDocumentPosition(e)===n?e===T||e.ownerDocument==ye&&I.contains(ye,e)?-1:t===T||t.ownerDocument==ye&&I.contains(ye,t)?1:o?se.call(o,e)-se.call(o,t):0:4&n?-1:1)}),T}for(e in I.matches=function(e,t){return I(e,null,null,t)},I.matchesSelector=function(e,t){if(V(e),C&&!h[t+\" \"]&&(!d||!d.test(t)))try{var n=i.call(e,t);if(n||le.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){h(t,!0)}return 0<I(t,T,null,[e]).length},I.contains=function(e,t){return(e.ownerDocument||e)!=T&&V(e),ce.contains(e,t)},I.attr=function(e,t){(e.ownerDocument||e)!=T&&V(e);var n=b.attrHandle[t.toLowerCase()],r=n&&ue.call(b.attrHandle,t.toLowerCase())?n(e,t,!C):void 0;return void 0!==r?r:e.getAttribute(t)},I.error=function(e){throw new Error(\"Syntax error, unrecognized expression: \"+e)},ce.uniqueSort=function(e){var t,n=[],r=0,i=0;if(a=!le.sortStable,o=!le.sortStable&&ae.call(e,0),de.call(e,l),a){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)he.call(e,n[r],1)}return o=null,e},ce.fn.uniqueSort=function(){return this.pushStack(ce.uniqueSort(ae.apply(this)))},(b=ce.expr={cacheLength:50,createPseudo:F,match:D,attrHandle:{},find:{},relative:{\">\":{dir:\"parentNode\",first:!0},\" \":{dir:\"parentNode\"},\"+\":{dir:\"previousSibling\",first:!0},\"~\":{dir:\"previousSibling\"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(O,P),e[3]=(e[3]||e[4]||e[5]||\"\").replace(O,P),\"~=\"===e[2]&&(e[3]=\" \"+e[3]+\" \"),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),\"nth\"===e[1].slice(0,3)?(e[3]||I.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*(\"even\"===e[3]||\"odd\"===e[3])),e[5]=+(e[7]+e[8]||\"odd\"===e[3])):e[3]&&I.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return D.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||\"\":n&&j.test(n)&&(t=Y(n,!0))&&(t=n.indexOf(\")\",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(O,P).toLowerCase();return\"*\"===e?function(){return!0}:function(e){return fe(e,t)}},CLASS:function(e){var t=s[e+\" \"];return t||(t=new RegExp(\"(^|\"+ge+\")\"+e+\"(\"+ge+\"|$)\"))&&s(e,function(e){return t.test(\"string\"==typeof e.className&&e.className||\"undefined\"!=typeof e.getAttribute&&e.getAttribute(\"class\")||\"\")})},ATTR:function(n,r,i){return function(e){var t=I.attr(e,n);return null==t?\"!=\"===r:!r||(t+=\"\",\"=\"===r?t===i:\"!=\"===r?t!==i:\"^=\"===r?i&&0===t.indexOf(i):\"*=\"===r?i&&-1<t.indexOf(i):\"$=\"===r?i&&t.slice(-i.length)===i:\"~=\"===r?-1<(\" \"+t.replace(v,\" \")+\" \").indexOf(i):\"|=\"===r&&(t===i||t.slice(0,i.length+1)===i+\"-\"))}},CHILD:function(d,e,t,h,g){var v=\"nth\"!==d.slice(0,3),y=\"last\"!==d.slice(-4),m=\"of-type\"===e;return 1===h&&0===g?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u=v!==y?\"nextSibling\":\"previousSibling\",l=e.parentNode,c=m&&e.nodeName.toLowerCase(),f=!n&&!m,p=!1;if(l){if(v){while(u){o=e;while(o=o[u])if(m?fe(o,c):1===o.nodeType)return!1;s=u=\"only\"===d&&!s&&\"nextSibling\"}return!0}if(s=[y?l.firstChild:l.lastChild],y&&f){p=(a=(r=(i=l[S]||(l[S]={}))[d]||[])[0]===E&&r[1])&&r[2],o=a&&l.childNodes[a];while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if(1===o.nodeType&&++p&&o===e){i[d]=[E,a,p];break}}else if(f&&(p=a=(r=(i=e[S]||(e[S]={}))[d]||[])[0]===E&&r[1]),!1===p)while(o=++a&&o&&o[u]||(p=a=0)||s.pop())if((m?fe(o,c):1===o.nodeType)&&++p&&(f&&((i=o[S]||(o[S]={}))[d]=[E,p]),o===e))break;return(p-=g)===h||p%h==0&&0<=p/h}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||I.error(\"unsupported pseudo: \"+e);return a[S]?a(o):1<a.length?(t=[e,e,\"\",o],b.setFilters.hasOwnProperty(e.toLowerCase())?F(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=se.call(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:F(function(e){var r=[],i=[],s=ne(e.replace(ve,\"$1\"));return s[S]?F(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:F(function(t){return function(e){return 0<I(t,e).length}}),contains:F(function(t){return t=t.replace(O,P),function(e){return-1<(e.textContent||ce.text(e)).indexOf(t)}}),lang:F(function(n){return A.test(n||\"\")||I.error(\"unsupported lang: \"+n),n=n.replace(O,P).toLowerCase(),function(e){var t;do{if(t=C?e.lang:e.getAttribute(\"xml:lang\")||e.getAttribute(\"lang\"))return(t=t.toLowerCase())===n||0===t.indexOf(n+\"-\")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=ie.location&&ie.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===r},focus:function(e){return e===function(){try{return T.activeElement}catch(e){}}()&&T.hasFocus()&&!!(e.type||e.href||~e.tabIndex)},enabled:z(!1),disabled:z(!0),checked:function(e){return fe(e,\"input\")&&!!e.checked||fe(e,\"option\")&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return q.test(e.nodeName)},input:function(e){return N.test(e.nodeName)},button:function(e){return fe(e,\"input\")&&\"button\"===e.type||fe(e,\"button\")},text:function(e){var t;return fe(e,\"input\")&&\"text\"===e.type&&(null==(t=e.getAttribute(\"type\"))||\"text\"===t.toLowerCase())},first:X(function(){return[0]}),last:X(function(e,t){return[t-1]}),eq:X(function(e,t,n){return[n<0?n+t:n]}),even:X(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:X(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:X(function(e,t,n){var r;for(r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:X(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=B(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=_(e);function G(){}function Y(e,t){var n,r,i,o,a,s,u,l=c[e+\" \"];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=y.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=m.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(ve,\" \")}),a=a.slice(n.length)),b.filter)!(r=D[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?I.error(e):c(e,s).slice(0)}function Q(e){for(var t=0,n=e.length,r=\"\";t<n;t++)r+=e[t].value;return r}function J(a,e,t){var s=e.dir,u=e.next,l=u||s,c=t&&\"parentNode\"===l,f=n++;return e.first?function(e,t,n){while(e=e[s])if(1===e.nodeType||c)return a(e,t,n);return!1}:function(e,t,n){var r,i,o=[E,f];if(n){while(e=e[s])if((1===e.nodeType||c)&&a(e,t,n))return!0}else while(e=e[s])if(1===e.nodeType||c)if(i=e[S]||(e[S]={}),u&&fe(e,u))e=e[s]||e;else{if((r=i[l])&&r[0]===E&&r[1]===f)return o[2]=r[2];if((i[l]=o)[2]=a(e,t,n))return!0}return!1}}function K(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Z(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function ee(d,h,g,v,y,e){return v&&!v[S]&&(v=ee(v)),y&&!y[S]&&(y=ee(y,e)),F(function(e,t,n,r){var i,o,a,s,u=[],l=[],c=t.length,f=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)I(e,t[r],n);return n}(h||\"*\",n.nodeType?[n]:n,[]),p=!d||!e&&h?f:Z(f,u,d,n,r);if(g?g(p,s=y||(e?d:c||v)?[]:t,n,r):s=p,v){i=Z(s,l),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(s[l[o]]=!(p[l[o]]=a))}if(e){if(y||d){if(y){i=[],o=s.length;while(o--)(a=s[o])&&i.push(p[o]=a);y(null,s=[],i,r)}o=s.length;while(o--)(a=s[o])&&-1<(i=y?se.call(e,a):u[o])&&(e[i]=!(t[i]=a))}}else s=Z(s===t?s.splice(c,s.length):s),y?y(null,t,s,r):k.apply(t,s)})}function te(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[\" \"],s=o?1:0,u=J(function(e){return e===i},a,!0),l=J(function(e){return-1<se.call(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!=w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[J(K(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[S]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return ee(1<s&&K(c),1<s&&Q(e.slice(0,s-1).concat({value:\" \"===e[s-2].type?\"*\":\"\"})).replace(ve,\"$1\"),t,s<n&&te(e.slice(s,n)),n<r&&te(e=e.slice(n)),n<r&&Q(e))}c.push(t)}return K(c)}function ne(e,t){var n,v,y,m,x,r,i=[],o=[],a=u[e+\" \"];if(!a){t||(t=Y(e)),n=t.length;while(n--)(a=te(t[n]))[S]?i.push(a):o.push(a);(a=u(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l=\"0\",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG(\"*\",i),h=E+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t==T||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument==T||(V(o),n=!C);while(s=v[a++])if(s(o,t||T,n)){k.call(r,o);break}i&&(E=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=pe.call(r));f=Z(f)}k.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&ce.uniqueSort(r)}return i&&(E=h,w=p),c},m?F(r):r))).selector=e}return a}function re(e,t,n,r){var i,o,a,s,u,l=\"function\"==typeof e&&e,c=!r&&Y(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&\"ID\"===(a=o[0]).type&&9===t.nodeType&&C&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(O,P),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=D.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(O,P),H.test(o[0].type)&&U(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&Q(o)))return k.apply(n,r),n;break}}}return(l||ne(e,c))(r,t,!C,n,!t||H.test(e)&&U(t.parentNode)||t),n}G.prototype=b.filters=b.pseudos,b.setFilters=new G,le.sortStable=S.split(\"\").sort(l).join(\"\")===S,V(),le.sortDetached=$(function(e){return 1&e.compareDocumentPosition(T.createElement(\"fieldset\"))}),ce.find=I,ce.expr[\":\"]=ce.expr.pseudos,ce.unique=ce.uniqueSort,I.compile=ne,I.select=re,I.setDocument=V,I.tokenize=Y,I.escape=ce.escapeSelector,I.getText=ce.text,I.isXML=ce.isXMLDoc,I.selectors=ce.expr,I.support=ce.support,I.uniqueSort=ce.uniqueSort}();var d=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&ce(e).is(n))break;r.push(e)}return r},h=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},b=ce.expr.match.needsContext,w=/^<([a-z][^\\/\\0>:\\x20\\t\\r\\n\\f]*)[\\x20\\t\\r\\n\\f]*\\/?>(?:<\\/\\1>|)$/i;function T(e,n,r){return v(n)?ce.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?ce.grep(e,function(e){return e===n!==r}):\"string\"!=typeof n?ce.grep(e,function(e){return-1<se.call(n,e)!==r}):ce.filter(n,e,r)}ce.filter=function(e,t,n){var r=t[0];return n&&(e=\":not(\"+e+\")\"),1===t.length&&1===r.nodeType?ce.find.matchesSelector(r,e)?[r]:[]:ce.find.matches(e,ce.grep(t,function(e){return 1===e.nodeType}))},ce.fn.extend({find:function(e){var t,n,r=this.length,i=this;if(\"string\"!=typeof e)return this.pushStack(ce(e).filter(function(){for(t=0;t<r;t++)if(ce.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)ce.find(e,i[t],n);return 1<r?ce.uniqueSort(n):n},filter:function(e){return this.pushStack(T(this,e||[],!1))},not:function(e){return this.pushStack(T(this,e||[],!0))},is:function(e){return!!T(this,\"string\"==typeof e&&b.test(e)?ce(e):e||[],!1).length}});var k,S=/^(?:\\s*(<[\\w\\W]+>)[^>]*|#([\\w-]+))$/;(ce.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||k,\"string\"==typeof e){if(!(r=\"<\"===e[0]&&\">\"===e[e.length-1]&&3<=e.length?[null,e,null]:S.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ce?t[0]:t,ce.merge(this,ce.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:C,!0)),w.test(r[1])&&ce.isPlainObject(t))for(r in t)v(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=C.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):v(e)?void 0!==n.ready?n.ready(e):e(ce):ce.makeArray(e,this)}).prototype=ce.fn,k=ce(C);var E=/^(?:parents|prev(?:Until|All))/,j={children:!0,contents:!0,next:!0,prev:!0};function A(e,t){while((e=e[t])&&1!==e.nodeType);return e}ce.fn.extend({has:function(e){var t=ce(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ce.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a=\"string\"!=typeof e&&ce(e);if(!b.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&ce.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?ce.uniqueSort(o):o)},index:function(e){return e?\"string\"==typeof e?se.call(ce(e),this[0]):se.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ce.uniqueSort(ce.merge(this.get(),ce(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ce.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return d(e,\"parentNode\")},parentsUntil:function(e,t,n){return d(e,\"parentNode\",n)},next:function(e){return A(e,\"nextSibling\")},prev:function(e){return A(e,\"previousSibling\")},nextAll:function(e){return d(e,\"nextSibling\")},prevAll:function(e){return d(e,\"previousSibling\")},nextUntil:function(e,t,n){return d(e,\"nextSibling\",n)},prevUntil:function(e,t,n){return d(e,\"previousSibling\",n)},siblings:function(e){return h((e.parentNode||{}).firstChild,e)},children:function(e){return h(e.firstChild)},contents:function(e){return null!=e.contentDocument&&r(e.contentDocument)?e.contentDocument:(fe(e,\"template\")&&(e=e.content||e),ce.merge([],e.childNodes))}},function(r,i){ce.fn[r]=function(e,t){var n=ce.map(this,i,e);return\"Until\"!==r.slice(-5)&&(t=e),t&&\"string\"==typeof t&&(n=ce.filter(t,n)),1<this.length&&(j[r]||ce.uniqueSort(n),E.test(r)&&n.reverse()),this.pushStack(n)}});var D=/[^\\x20\\t\\r\\n\\f]+/g;function N(e){return e}function q(e){throw e}function L(e,t,n,r){var i;try{e&&v(i=e.promise)?i.call(e).done(t).fail(n):e&&v(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}ce.Callbacks=function(r){var e,n;r=\"string\"==typeof r?(e=r,n={},ce.each(e.match(D)||[],function(e,t){n[t]=!0}),n):ce.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:\"\")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){ce.each(e,function(e,t){v(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&\"string\"!==x(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return ce.each(arguments,function(e,t){var n;while(-1<(n=ce.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<ce.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t=\"\",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=\"\"),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},ce.extend({Deferred:function(e){var o=[[\"notify\",\"progress\",ce.Callbacks(\"memory\"),ce.Callbacks(\"memory\"),2],[\"resolve\",\"done\",ce.Callbacks(\"once memory\"),ce.Callbacks(\"once memory\"),0,\"resolved\"],[\"reject\",\"fail\",ce.Callbacks(\"once memory\"),ce.Callbacks(\"once memory\"),1,\"rejected\"]],i=\"pending\",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},\"catch\":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return ce.Deferred(function(r){ce.each(o,function(e,t){var n=v(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&v(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+\"With\"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError(\"Thenable self-resolution\");t=e&&(\"object\"==typeof e||\"function\"==typeof e)&&e.then,v(t)?s?t.call(e,l(u,o,N,s),l(u,o,q,s)):(u++,t.call(e,l(u,o,N,s),l(u,o,q,s),l(u,o,N,o.notifyWith))):(a!==N&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){ce.Deferred.exceptionHook&&ce.Deferred.exceptionHook(e,t.error),u<=i+1&&(a!==q&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(ce.Deferred.getErrorHook?t.error=ce.Deferred.getErrorHook():ce.Deferred.getStackHook&&(t.error=ce.Deferred.getStackHook()),ie.setTimeout(t))}}return ce.Deferred(function(e){o[0][3].add(l(0,e,v(r)?r:N,e.notifyWith)),o[1][3].add(l(0,e,v(t)?t:N)),o[2][3].add(l(0,e,v(n)?n:q))}).promise()},promise:function(e){return null!=e?ce.extend(e,a):a}},s={};return ce.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+\"With\"](this===s?void 0:this,arguments),this},s[t[0]+\"With\"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=ae.call(arguments),o=ce.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?ae.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(L(e,o.done(a(t)).resolve,o.reject,!n),\"pending\"===o.state()||v(i[t]&&i[t].then)))return o.then();while(t--)L(i[t],a(t),o.reject);return o.promise()}});var H=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;ce.Deferred.exceptionHook=function(e,t){ie.console&&ie.console.warn&&e&&H.test(e.name)&&ie.console.warn(\"jQuery.Deferred exception: \"+e.message,e.stack,t)},ce.readyException=function(e){ie.setTimeout(function(){throw e})};var O=ce.Deferred();function P(){C.removeEventListener(\"DOMContentLoaded\",P),ie.removeEventListener(\"load\",P),ce.ready()}ce.fn.ready=function(e){return O.then(e)[\"catch\"](function(e){ce.readyException(e)}),this},ce.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--ce.readyWait:ce.isReady)||(ce.isReady=!0)!==e&&0<--ce.readyWait||O.resolveWith(C,[ce])}}),ce.ready.then=O.then,\"complete\"===C.readyState||\"loading\"!==C.readyState&&!C.documentElement.doScroll?ie.setTimeout(ce.ready):(C.addEventListener(\"DOMContentLoaded\",P),ie.addEventListener(\"load\",P));var M=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if(\"object\"===x(n))for(s in i=!0,n)M(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,v(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ce(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},R=/^-ms-/,I=/-([a-z])/g;function W(e,t){return t.toUpperCase()}function F(e){return e.replace(R,\"ms-\").replace(I,W)}var $=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function B(){this.expando=ce.expando+B.uid++}B.uid=1,B.prototype={cache:function(e){var t=e[this.expando];return t||(t={},$(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if(\"string\"==typeof t)i[F(t)]=n;else for(r in t)i[F(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][F(t)]},access:function(e,t,n){return void 0===t||t&&\"string\"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(F):(t=F(t))in r?[t]:t.match(D)||[]).length;while(n--)delete r[t[n]]}(void 0===t||ce.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ce.isEmptyObject(t)}};var _=new B,z=new B,X=/^(?:\\{[\\w\\W]*\\}|\\[[\\w\\W]*\\])$/,U=/[A-Z]/g;function V(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r=\"data-\"+t.replace(U,\"-$&\").toLowerCase(),\"string\"==typeof(n=e.getAttribute(r))){try{n=\"true\"===(i=n)||\"false\"!==i&&(\"null\"===i?null:i===+i+\"\"?+i:X.test(i)?JSON.parse(i):i)}catch(e){}z.set(e,t,n)}else n=void 0;return n}ce.extend({hasData:function(e){return z.hasData(e)||_.hasData(e)},data:function(e,t,n){return z.access(e,t,n)},removeData:function(e,t){z.remove(e,t)},_data:function(e,t,n){return _.access(e,t,n)},_removeData:function(e,t){_.remove(e,t)}}),ce.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=z.get(o),1===o.nodeType&&!_.get(o,\"hasDataAttrs\"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf(\"data-\")&&(r=F(r.slice(5)),V(o,r,i[r]));_.set(o,\"hasDataAttrs\",!0)}return i}return\"object\"==typeof n?this.each(function(){z.set(this,n)}):M(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=z.get(o,n))?t:void 0!==(t=V(o,n))?t:void 0;this.each(function(){z.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){z.remove(this,e)})}}),ce.extend({queue:function(e,t,n){var r;if(e)return t=(t||\"fx\")+\"queue\",r=_.get(e,t),n&&(!r||Array.isArray(n)?r=_.access(e,t,ce.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||\"fx\";var n=ce.queue(e,t),r=n.length,i=n.shift(),o=ce._queueHooks(e,t);\"inprogress\"===i&&(i=n.shift(),r--),i&&(\"fx\"===t&&n.unshift(\"inprogress\"),delete o.stop,i.call(e,function(){ce.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+\"queueHooks\";return _.get(e,n)||_.access(e,n,{empty:ce.Callbacks(\"once memory\").add(function(){_.remove(e,[t+\"queue\",n])})})}}),ce.fn.extend({queue:function(t,n){var e=2;return\"string\"!=typeof t&&(n=t,t=\"fx\",e--),arguments.length<e?ce.queue(this[0],t):void 0===n?this:this.each(function(){var e=ce.queue(this,t,n);ce._queueHooks(this,t),\"fx\"===t&&\"inprogress\"!==e[0]&&ce.dequeue(this,t)})},dequeue:function(e){return this.each(function(){ce.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||\"fx\",[])},promise:function(e,t){var n,r=1,i=ce.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};\"string\"!=typeof e&&(t=e,e=void 0),e=e||\"fx\";while(a--)(n=_.get(o[a],e+\"queueHooks\"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var G=/[+-]?(?:\\d*\\.|)\\d+(?:[eE][+-]?\\d+|)/.source,Y=new RegExp(\"^(?:([+-])=|)(\"+G+\")([a-z%]*)$\",\"i\"),Q=[\"Top\",\"Right\",\"Bottom\",\"Left\"],J=C.documentElement,K=function(e){return ce.contains(e.ownerDocument,e)},Z={composed:!0};J.getRootNode&&(K=function(e){return ce.contains(e.ownerDocument,e)||e.getRootNode(Z)===e.ownerDocument});var ee=function(e,t){return\"none\"===(e=t||e).style.display||\"\"===e.style.display&&K(e)&&\"none\"===ce.css(e,\"display\")};function te(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return ce.css(e,t,\"\")},u=s(),l=n&&n[3]||(ce.cssNumber[t]?\"\":\"px\"),c=e.nodeType&&(ce.cssNumber[t]||\"px\"!==l&&+u)&&Y.exec(ce.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)ce.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,ce.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ne={};function re(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?(\"none\"===n&&(l[c]=_.get(r,\"display\")||null,l[c]||(r.style.display=\"\")),\"\"===r.style.display&&ee(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ne[s])||(o=a.body.appendChild(a.createElement(s)),u=ce.css(o,\"display\"),o.parentNode.removeChild(o),\"none\"===u&&(u=\"block\"),ne[s]=u)))):\"none\"!==n&&(l[c]=\"none\",_.set(r,\"display\",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}ce.fn.extend({show:function(){return re(this,!0)},hide:function(){return re(this)},toggle:function(e){return\"boolean\"==typeof e?e?this.show():this.hide():this.each(function(){ee(this)?ce(this).show():ce(this).hide()})}});var xe,be,we=/^(?:checkbox|radio)$/i,Te=/<([a-z][^\\/\\0>\\x20\\t\\r\\n\\f]*)/i,Ce=/^$|^module$|\\/(?:java|ecma)script/i;xe=C.createDocumentFragment().appendChild(C.createElement(\"div\")),(be=C.createElement(\"input\")).setAttribute(\"type\",\"radio\"),be.setAttribute(\"checked\",\"checked\"),be.setAttribute(\"name\",\"t\"),xe.appendChild(be),le.checkClone=xe.cloneNode(!0).cloneNode(!0).lastChild.checked,xe.innerHTML=\"<textarea>x</textarea>\",le.noCloneChecked=!!xe.cloneNode(!0).lastChild.defaultValue,xe.innerHTML=\"<option></option>\",le.option=!!xe.lastChild;var ke={thead:[1,\"<table>\",\"</table>\"],col:[2,\"<table><colgroup>\",\"</colgroup></table>\"],tr:[2,\"<table><tbody>\",\"</tbody></table>\"],td:[3,\"<table><tbody><tr>\",\"</tr></tbody></table>\"],_default:[0,\"\",\"\"]};function Se(e,t){var n;return n=\"undefined\"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||\"*\"):\"undefined\"!=typeof e.querySelectorAll?e.querySelectorAll(t||\"*\"):[],void 0===t||t&&fe(e,t)?ce.merge([e],n):n}function Ee(e,t){for(var n=0,r=e.length;n<r;n++)_.set(e[n],\"globalEval\",!t||_.get(t[n],\"globalEval\"))}ke.tbody=ke.tfoot=ke.colgroup=ke.caption=ke.thead,ke.th=ke.td,le.option||(ke.optgroup=ke.option=[1,\"<select multiple='multiple'>\",\"</select>\"]);var je=/<|&#?\\w+;/;function Ae(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if(\"object\"===x(o))ce.merge(p,o.nodeType?[o]:o);else if(je.test(o)){a=a||f.appendChild(t.createElement(\"div\")),s=(Te.exec(o)||[\"\",\"\"])[1].toLowerCase(),u=ke[s]||ke._default,a.innerHTML=u[1]+ce.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;ce.merge(p,a.childNodes),(a=f.firstChild).textContent=\"\"}else p.push(t.createTextNode(o));f.textContent=\"\",d=0;while(o=p[d++])if(r&&-1<ce.inArray(o,r))i&&i.push(o);else if(l=K(o),a=Se(f.appendChild(o),\"script\"),l&&Ee(a),n){c=0;while(o=a[c++])Ce.test(o.type||\"\")&&n.push(o)}return f}var De=/^([^.]*)(?:\\.(.+)|)/;function Ne(){return!0}function qe(){return!1}function Le(e,t,n,r,i,o){var a,s;if(\"object\"==typeof t){for(s in\"string\"!=typeof n&&(r=r||n,n=void 0),t)Le(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&(\"string\"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=qe;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return ce().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=ce.guid++)),e.each(function(){ce.event.add(this,t,i,r,n)})}function He(e,r,t){t?(_.set(e,r,!1),ce.event.add(e,r,{namespace:!1,handler:function(e){var t,n=_.get(this,r);if(1&e.isTrigger&&this[r]){if(n)(ce.event.special[r]||{}).delegateType&&e.stopPropagation();else if(n=ae.call(arguments),_.set(this,r,n),this[r](),t=_.get(this,r),_.set(this,r,!1),n!==t)return e.stopImmediatePropagation(),e.preventDefault(),t}else n&&(_.set(this,r,ce.event.trigger(n[0],n.slice(1),this)),e.stopPropagation(),e.isImmediatePropagationStopped=Ne)}})):void 0===_.get(e,r)&&ce.event.add(e,r,Ne)}ce.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.get(t);if($(t)){n.handler&&(n=(o=n).handler,i=o.selector),i&&ce.find.matchesSelector(J,i),n.guid||(n.guid=ce.guid++),(u=v.events)||(u=v.events=Object.create(null)),(a=v.handle)||(a=v.handle=function(e){return\"undefined\"!=typeof ce&&ce.event.triggered!==e.type?ce.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||\"\").match(D)||[\"\"]).length;while(l--)d=g=(s=De.exec(e[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d&&(f=ce.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ce.event.special[d]||{},c=ce.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ce.expr.match.needsContext.test(i),namespace:h.join(\".\")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ce.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=_.hasData(e)&&_.get(e);if(v&&(u=v.events)){l=(t=(t||\"\").match(D)||[\"\"]).length;while(l--)if(d=g=(s=De.exec(t[l])||[])[1],h=(s[2]||\"\").split(\".\").sort(),d){f=ce.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&(\"**\"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ce.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ce.event.remove(e,d+t[l],n,r,!0);ce.isEmptyObject(u)&&_.remove(e,\"handle events\")}},dispatch:function(e){var t,n,r,i,o,a,s=new Array(arguments.length),u=ce.event.fix(e),l=(_.get(this,\"events\")||Object.create(null))[u.type]||[],c=ce.event.special[u.type]||{};for(s[0]=u,t=1;t<arguments.length;t++)s[t]=arguments[t];if(u.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,u)){a=ce.event.handlers.call(this,u,l),t=0;while((i=a[t++])&&!u.isPropagationStopped()){u.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!u.isImmediatePropagationStopped())u.rnamespace&&!1!==o.namespace&&!u.rnamespace.test(o.namespace)||(u.handleObj=o,u.data=o.data,void 0!==(r=((ce.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,s))&&!1===(u.result=r)&&(u.preventDefault(),u.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,u),u.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!(\"click\"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(\"click\"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+\" \"]&&(a[i]=r.needsContext?-1<ce(i,this).index(l):ce.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(ce.Event.prototype,t,{enumerable:!0,configurable:!0,get:v(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[ce.expando]?e:new ce.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,\"input\")&&He(t,\"click\",!0),!1},trigger:function(e){var t=this||e;return we.test(t.type)&&t.click&&fe(t,\"input\")&&He(t,\"click\"),!0},_default:function(e){var t=e.target;return we.test(t.type)&&t.click&&fe(t,\"input\")&&_.get(t,\"click\")||fe(t,\"a\")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ce.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ce.Event=function(e,t){if(!(this instanceof ce.Event))return new ce.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?Ne:qe,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&ce.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[ce.expando]=!0},ce.Event.prototype={constructor:ce.Event,isDefaultPrevented:qe,isPropagationStopped:qe,isImmediatePropagationStopped:qe,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Ne,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Ne,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Ne,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ce.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,\"char\":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},ce.event.addProp),ce.each({focus:\"focusin\",blur:\"focusout\"},function(r,i){function o(e){if(C.documentMode){var t=_.get(this,\"handle\"),n=ce.event.fix(e);n.type=\"focusin\"===e.type?\"focus\":\"blur\",n.isSimulated=!0,t(e),n.target===n.currentTarget&&t(n)}else ce.event.simulate(i,e.target,ce.event.fix(e))}ce.event.special[r]={setup:function(){var e;if(He(this,r,!0),!C.documentMode)return!1;(e=_.get(this,i))||this.addEventListener(i,o),_.set(this,i,(e||0)+1)},trigger:function(){return He(this,r),!0},teardown:function(){var e;if(!C.documentMode)return!1;(e=_.get(this,i)-1)?_.set(this,i,e):(this.removeEventListener(i,o),_.remove(this,i))},_default:function(e){return _.get(e.target,r)},delegateType:i},ce.event.special[i]={setup:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i);n||(C.documentMode?this.addEventListener(i,o):e.addEventListener(r,o,!0)),_.set(t,i,(n||0)+1)},teardown:function(){var e=this.ownerDocument||this.document||this,t=C.documentMode?this:e,n=_.get(t,i)-1;n?_.set(t,i,n):(C.documentMode?this.removeEventListener(i,o):e.removeEventListener(r,o,!0),_.remove(t,i))}}}),ce.each({mouseenter:\"mouseover\",mouseleave:\"mouseout\",pointerenter:\"pointerover\",pointerleave:\"pointerout\"},function(e,i){ce.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||ce.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),ce.fn.extend({on:function(e,t,n,r){return Le(this,e,t,n,r)},one:function(e,t,n,r){return Le(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ce(e.delegateTarget).off(r.namespace?r.origType+\".\"+r.namespace:r.origType,r.selector,r.handler),this;if(\"object\"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&\"function\"!=typeof t||(n=t,t=void 0),!1===n&&(n=qe),this.each(function(){ce.event.remove(this,e,n,t)})}});var Oe=/<script|<style|<link/i,Pe=/checked\\s*(?:[^=]|=\\s*.checked.)/i,Me=/^\\s*<!\\[CDATA\\[|\\]\\]>\\s*$/g;function Re(e,t){return fe(e,\"table\")&&fe(11!==t.nodeType?t:t.firstChild,\"tr\")&&ce(e).children(\"tbody\")[0]||e}function Ie(e){return e.type=(null!==e.getAttribute(\"type\"))+\"/\"+e.type,e}function We(e){return\"true/\"===(e.type||\"\").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute(\"type\"),e}function Fe(e,t){var n,r,i,o,a,s;if(1===t.nodeType){if(_.hasData(e)&&(s=_.get(e).events))for(i in _.remove(t,\"handle events\"),s)for(n=0,r=s[i].length;n<r;n++)ce.event.add(t,i,s[i][n]);z.hasData(e)&&(o=z.access(e),a=ce.extend({},o),z.set(t,a))}}function $e(n,r,i,o){r=g(r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=v(d);if(h||1<f&&\"string\"==typeof d&&!le.checkClone&&Pe.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),$e(t,r,i,o)});if(f&&(t=(e=Ae(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=ce.map(Se(e,\"script\"),Ie)).length;c<f;c++)u=e,c!==p&&(u=ce.clone(u,!0,!0),s&&ce.merge(a,Se(u,\"script\"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,ce.map(a,We),c=0;c<s;c++)u=a[c],Ce.test(u.type||\"\")&&!_.access(u,\"globalEval\")&&ce.contains(l,u)&&(u.src&&\"module\"!==(u.type||\"\").toLowerCase()?ce._evalUrl&&!u.noModule&&ce._evalUrl(u.src,{nonce:u.nonce||u.getAttribute(\"nonce\")},l):m(u.textContent.replace(Me,\"\"),u,l))}return n}function Be(e,t,n){for(var r,i=t?ce.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ce.cleanData(Se(r)),r.parentNode&&(n&&K(r)&&Ee(Se(r,\"script\")),r.parentNode.removeChild(r));return e}ce.extend({htmlPrefilter:function(e){return e},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=K(e);if(!(le.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ce.isXMLDoc(e)))for(a=Se(c),r=0,i=(o=Se(e)).length;r<i;r++)s=o[r],u=a[r],void 0,\"input\"===(l=u.nodeName.toLowerCase())&&we.test(s.type)?u.checked=s.checked:\"input\"!==l&&\"textarea\"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||Se(e),a=a||Se(c),r=0,i=o.length;r<i;r++)Fe(o[r],a[r]);else Fe(e,c);return 0<(a=Se(c,\"script\")).length&&Ee(a,!f&&Se(e,\"script\")),c},cleanData:function(e){for(var t,n,r,i=ce.event.special,o=0;void 0!==(n=e[o]);o++)if($(n)){if(t=n[_.expando]){if(t.events)for(r in t.events)i[r]?ce.event.remove(n,r):ce.removeEvent(n,r,t.handle);n[_.expando]=void 0}n[z.expando]&&(n[z.expando]=void 0)}}}),ce.fn.extend({detach:function(e){return Be(this,e,!0)},remove:function(e){return Be(this,e)},text:function(e){return M(this,function(e){return void 0===e?ce.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return $e(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Re(this,e).appendChild(e)})},prepend:function(){return $e(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Re(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return $e(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ce.cleanData(Se(e,!1)),e.textContent=\"\");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ce.clone(this,e,t)})},html:function(e){return M(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if(\"string\"==typeof e&&!Oe.test(e)&&!ke[(Te.exec(e)||[\"\",\"\"])[1].toLowerCase()]){e=ce.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(ce.cleanData(Se(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return $e(this,arguments,function(e){var t=this.parentNode;ce.inArray(this,n)<0&&(ce.cleanData(Se(this)),t&&t.replaceChild(e,this))},n)}}),ce.each({appendTo:\"append\",prependTo:\"prepend\",insertBefore:\"before\",insertAfter:\"after\",replaceAll:\"replaceWith\"},function(e,a){ce.fn[e]=function(e){for(var t,n=[],r=ce(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),ce(r[o])[a](t),s.apply(n,t.get());return this.pushStack(n)}});var _e=new RegExp(\"^(\"+G+\")(?!px)[a-z%]+$\",\"i\"),ze=/^--/,Xe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=ie),t.getComputedStyle(e)},Ue=function(e,t,n){var r,i,o={};for(i in t)o[i]=e.style[i],e.style[i]=t[i];for(i in r=n.call(e),t)e.style[i]=o[i];return r},Ve=new RegExp(Q.join(\"|\"),\"i\");function Ge(e,t,n){var r,i,o,a,s=ze.test(t),u=e.style;return(n=n||Xe(e))&&(a=n.getPropertyValue(t)||n[t],s&&a&&(a=a.replace(ve,\"$1\")||void 0),\"\"!==a||K(e)||(a=ce.style(e,t)),!le.pixelBoxStyles()&&_e.test(a)&&Ve.test(t)&&(r=u.width,i=u.minWidth,o=u.maxWidth,u.minWidth=u.maxWidth=u.width=a,a=n.width,u.width=r,u.minWidth=i,u.maxWidth=o)),void 0!==a?a+\"\":a}function Ye(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(l){u.style.cssText=\"position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0\",l.style.cssText=\"position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%\",J.appendChild(u).appendChild(l);var e=ie.getComputedStyle(l);n=\"1%\"!==e.top,s=12===t(e.marginLeft),l.style.right=\"60%\",o=36===t(e.right),r=36===t(e.width),l.style.position=\"absolute\",i=12===t(l.offsetWidth/3),J.removeChild(u),l=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s,u=C.createElement(\"div\"),l=C.createElement(\"div\");l.style&&(l.style.backgroundClip=\"content-box\",l.cloneNode(!0).style.backgroundClip=\"\",le.clearCloneStyle=\"content-box\"===l.style.backgroundClip,ce.extend(le,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),s},scrollboxSize:function(){return e(),i},reliableTrDimensions:function(){var e,t,n,r;return null==a&&(e=C.createElement(\"table\"),t=C.createElement(\"tr\"),n=C.createElement(\"div\"),e.style.cssText=\"position:absolute;left:-11111px;border-collapse:separate\",t.style.cssText=\"box-sizing:content-box;border:1px solid\",t.style.height=\"1px\",n.style.height=\"9px\",n.style.display=\"block\",J.appendChild(e).appendChild(t).appendChild(n),r=ie.getComputedStyle(t),a=parseInt(r.height,10)+parseInt(r.borderTopWidth,10)+parseInt(r.borderBottomWidth,10)===t.offsetHeight,J.removeChild(e)),a}}))}();var Qe=[\"Webkit\",\"Moz\",\"ms\"],Je=C.createElement(\"div\").style,Ke={};function Ze(e){var t=ce.cssProps[e]||Ke[e];return t||(e in Je?e:Ke[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Qe.length;while(n--)if((e=Qe[n]+t)in Je)return e}(e)||e)}var et=/^(none|table(?!-c[ea]).+)/,tt={position:\"absolute\",visibility:\"hidden\",display:\"block\"},nt={letterSpacing:\"0\",fontWeight:\"400\"};function rt(e,t,n){var r=Y.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||\"px\"):t}function it(e,t,n,r,i,o){var a=\"width\"===t?1:0,s=0,u=0,l=0;if(n===(r?\"border\":\"content\"))return 0;for(;a<4;a+=2)\"margin\"===n&&(l+=ce.css(e,n+Q[a],!0,i)),r?(\"content\"===n&&(u-=ce.css(e,\"padding\"+Q[a],!0,i)),\"margin\"!==n&&(u-=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i))):(u+=ce.css(e,\"padding\"+Q[a],!0,i),\"padding\"!==n?u+=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i):s+=ce.css(e,\"border\"+Q[a]+\"Width\",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e[\"offset\"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u+l}function ot(e,t,n){var r=Xe(e),i=(!le.boxSizingReliable()||n)&&\"border-box\"===ce.css(e,\"boxSizing\",!1,r),o=i,a=Ge(e,t,r),s=\"offset\"+t[0].toUpperCase()+t.slice(1);if(_e.test(a)){if(!n)return a;a=\"auto\"}return(!le.boxSizingReliable()&&i||!le.reliableTrDimensions()&&fe(e,\"tr\")||\"auto\"===a||!parseFloat(a)&&\"inline\"===ce.css(e,\"display\",!1,r))&&e.getClientRects().length&&(i=\"border-box\"===ce.css(e,\"boxSizing\",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+it(e,t,n||(i?\"border\":\"content\"),o,r,a)+\"px\"}function at(e,t,n,r,i){return new at.prototype.init(e,t,n,r,i)}ce.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,\"opacity\");return\"\"===n?\"1\":n}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=F(t),u=ze.test(t),l=e.style;if(u||(t=Ze(s)),a=ce.cssHooks[t]||ce.cssHooks[s],void 0===n)return a&&\"get\"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];\"string\"===(o=typeof n)&&(i=Y.exec(n))&&i[1]&&(n=te(e,t,i),o=\"number\"),null!=n&&n==n&&(\"number\"!==o||u||(n+=i&&i[3]||(ce.cssNumber[s]?\"\":\"px\")),le.clearCloneStyle||\"\"!==n||0!==t.indexOf(\"background\")||(l[t]=\"inherit\"),a&&\"set\"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=F(t);return ze.test(t)||(t=Ze(s)),(a=ce.cssHooks[t]||ce.cssHooks[s])&&\"get\"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=Ge(e,t,r)),\"normal\"===i&&t in nt&&(i=nt[t]),\"\"===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ce.each([\"height\",\"width\"],function(e,u){ce.cssHooks[u]={get:function(e,t,n){if(t)return!et.test(ce.css(e,\"display\"))||e.getClientRects().length&&e.getBoundingClientRect().width?ot(e,u,n):Ue(e,tt,function(){return ot(e,u,n)})},set:function(e,t,n){var r,i=Xe(e),o=!le.scrollboxSize()&&\"absolute\"===i.position,a=(o||n)&&\"border-box\"===ce.css(e,\"boxSizing\",!1,i),s=n?it(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e[\"offset\"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-it(e,u,\"border\",!1,i)-.5)),s&&(r=Y.exec(t))&&\"px\"!==(r[3]||\"px\")&&(e.style[u]=t,t=ce.css(e,u)),rt(0,t,s)}}}),ce.cssHooks.marginLeft=Ye(le.reliableMarginLeft,function(e,t){if(t)return(parseFloat(Ge(e,\"marginLeft\"))||e.getBoundingClientRect().left-Ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+\"px\"}),ce.each({margin:\"\",padding:\"\",border:\"Width\"},function(i,o){ce.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r=\"string\"==typeof e?e.split(\" \"):[e];t<4;t++)n[i+Q[t]+o]=r[t]||r[t-2]||r[0];return n}},\"margin\"!==i&&(ce.cssHooks[i+o].set=rt)}),ce.fn.extend({css:function(e,t){return M(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Xe(e),i=t.length;a<i;a++)o[t[a]]=ce.css(e,t[a],!1,r);return o}return void 0!==n?ce.style(e,t,n):ce.css(e,t)},e,t,1<arguments.length)}}),((ce.Tween=at).prototype={constructor:at,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ce.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ce.cssNumber[n]?\"\":\"px\")},cur:function(){var e=at.propHooks[this.prop];return e&&e.get?e.get(this):at.propHooks._default.get(this)},run:function(e){var t,n=at.propHooks[this.prop];return this.options.duration?this.pos=t=ce.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):at.propHooks._default.set(this),this}}).init.prototype=at.prototype,(at.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ce.css(e.elem,e.prop,\"\"))&&\"auto\"!==t?t:0},set:function(e){ce.fx.step[e.prop]?ce.fx.step[e.prop](e):1!==e.elem.nodeType||!ce.cssHooks[e.prop]&&null==e.elem.style[Ze(e.prop)]?e.elem[e.prop]=e.now:ce.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=at.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ce.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:\"swing\"},ce.fx=at.prototype.init,ce.fx.step={};var st,ut,lt,ct,ft=/^(?:toggle|show|hide)$/,pt=/queueHooks$/;function dt(){ut&&(!1===C.hidden&&ie.requestAnimationFrame?ie.requestAnimationFrame(dt):ie.setTimeout(dt,ce.fx.interval),ce.fx.tick())}function ht(){return ie.setTimeout(function(){st=void 0}),st=Date.now()}function gt(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i[\"margin\"+(n=Q[r])]=i[\"padding\"+n]=e;return t&&(i.opacity=i.width=e),i}function vt(e,t,n){for(var r,i=(yt.tweeners[t]||[]).concat(yt.tweeners[\"*\"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function yt(o,e,t){var n,a,r=0,i=yt.prefilters.length,s=ce.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=st||ht(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:ce.extend({},e),opts:ce.extend(!0,{specialEasing:{},easing:ce.easing._default},t),originalProperties:e,originalOptions:t,startTime:st||ht(),duration:t.duration,tweens:[],createTween:function(e,t){var n=ce.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=F(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=ce.cssHooks[r])&&\"expand\"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=yt.prefilters[r].call(l,o,c,l.opts))return v(n.stop)&&(ce._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return ce.map(c,vt,l),v(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),ce.fx.timer(ce.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}ce.Animation=ce.extend(yt,{tweeners:{\"*\":[function(e,t){var n=this.createTween(e,t);return te(n.elem,e,Y.exec(t),n),n}]},tweener:function(e,t){v(e)?(t=e,e=[\"*\"]):e=e.match(D);for(var n,r=0,i=e.length;r<i;r++)n=e[r],yt.tweeners[n]=yt.tweeners[n]||[],yt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f=\"width\"in t||\"height\"in t,p=this,d={},h=e.style,g=e.nodeType&&ee(e),v=_.get(e,\"fxshow\");for(r in n.queue||(null==(a=ce._queueHooks(e,\"fx\")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,ce.queue(e,\"fx\").length||a.empty.fire()})})),t)if(i=t[r],ft.test(i)){if(delete t[r],o=o||\"toggle\"===i,i===(g?\"hide\":\"show\")){if(\"show\"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||ce.style(e,r)}if((u=!ce.isEmptyObject(t))||!ce.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=_.get(e,\"display\")),\"none\"===(c=ce.css(e,\"display\"))&&(l?c=l:(re([e],!0),l=e.style.display||l,c=ce.css(e,\"display\"),re([e]))),(\"inline\"===c||\"inline-block\"===c&&null!=l)&&\"none\"===ce.css(e,\"float\")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l=\"none\"===c?\"\":c)),h.display=\"inline-block\")),n.overflow&&(h.overflow=\"hidden\",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?\"hidden\"in v&&(g=v.hidden):v=_.access(e,\"fxshow\",{display:l}),o&&(v.hidden=!g),g&&re([e],!0),p.done(function(){for(r in g||re([e]),_.remove(e,\"fxshow\"),d)ce.style(e,r,d[r])})),u=vt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?yt.prefilters.unshift(e):yt.prefilters.push(e)}}),ce.speed=function(e,t,n){var r=e&&\"object\"==typeof e?ce.extend({},e):{complete:n||!n&&t||v(e)&&e,duration:e,easing:n&&t||t&&!v(t)&&t};return ce.fx.off?r.duration=0:\"number\"!=typeof r.duration&&(r.duration in ce.fx.speeds?r.duration=ce.fx.speeds[r.duration]:r.duration=ce.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue=\"fx\"),r.old=r.complete,r.complete=function(){v(r.old)&&r.old.call(this),r.queue&&ce.dequeue(this,r.queue)},r},ce.fn.extend({fadeTo:function(e,t,n,r){return this.filter(ee).css(\"opacity\",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=ce.isEmptyObject(t),o=ce.speed(e,n,r),a=function(){var e=yt(this,ce.extend({},t),o);(i||_.get(this,\"finish\"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return\"string\"!=typeof i&&(o=e,e=i,i=void 0),e&&this.queue(i||\"fx\",[]),this.each(function(){var e=!0,t=null!=i&&i+\"queueHooks\",n=ce.timers,r=_.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&pt.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||ce.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||\"fx\"),this.each(function(){var e,t=_.get(this),n=t[a+\"queue\"],r=t[a+\"queueHooks\"],i=ce.timers,o=n?n.length:0;for(t.finish=!0,ce.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),ce.each([\"toggle\",\"show\",\"hide\"],function(e,r){var i=ce.fn[r];ce.fn[r]=function(e,t,n){return null==e||\"boolean\"==typeof e?i.apply(this,arguments):this.animate(gt(r,!0),e,t,n)}}),ce.each({slideDown:gt(\"show\"),slideUp:gt(\"hide\"),slideToggle:gt(\"toggle\"),fadeIn:{opacity:\"show\"},fadeOut:{opacity:\"hide\"},fadeToggle:{opacity:\"toggle\"}},function(e,r){ce.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),ce.timers=[],ce.fx.tick=function(){var e,t=0,n=ce.timers;for(st=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ce.fx.stop(),st=void 0},ce.fx.timer=function(e){ce.timers.push(e),ce.fx.start()},ce.fx.interval=13,ce.fx.start=function(){ut||(ut=!0,dt())},ce.fx.stop=function(){ut=null},ce.fx.speeds={slow:600,fast:200,_default:400},ce.fn.delay=function(r,e){return r=ce.fx&&ce.fx.speeds[r]||r,e=e||\"fx\",this.queue(e,function(e,t){var n=ie.setTimeout(e,r);t.stop=function(){ie.clearTimeout(n)}})},lt=C.createElement(\"input\"),ct=C.createElement(\"select\").appendChild(C.createElement(\"option\")),lt.type=\"checkbox\",le.checkOn=\"\"!==lt.value,le.optSelected=ct.selected,(lt=C.createElement(\"input\")).value=\"t\",lt.type=\"radio\",le.radioValue=\"t\"===lt.value;var mt,xt=ce.expr.attrHandle;ce.fn.extend({attr:function(e,t){return M(this,ce.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){ce.removeAttr(this,e)})}}),ce.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return\"undefined\"==typeof e.getAttribute?ce.prop(e,t,n):(1===o&&ce.isXMLDoc(e)||(i=ce.attrHooks[t.toLowerCase()]||(ce.expr.match.bool.test(t)?mt:void 0)),void 0!==n?null===n?void ce.removeAttr(e,t):i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+\"\"),n):i&&\"get\"in i&&null!==(r=i.get(e,t))?r:null==(r=ce.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!le.radioValue&&\"radio\"===t&&fe(e,\"input\")){var n=e.value;return e.setAttribute(\"type\",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(D);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),mt={set:function(e,t,n){return!1===t?ce.removeAttr(e,n):e.setAttribute(n,n),n}},ce.each(ce.expr.match.bool.source.match(/\\w+/g),function(e,t){var a=xt[t]||ce.find.attr;xt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=xt[o],xt[o]=r,r=null!=a(e,t,n)?o:null,xt[o]=i),r}});var bt=/^(?:input|select|textarea|button)$/i,wt=/^(?:a|area)$/i;function Tt(e){return(e.match(D)||[]).join(\" \")}function Ct(e){return e.getAttribute&&e.getAttribute(\"class\")||\"\"}function kt(e){return Array.isArray(e)?e:\"string\"==typeof e&&e.match(D)||[]}ce.fn.extend({prop:function(e,t){return M(this,ce.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[ce.propFix[e]||e]})}}),ce.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ce.isXMLDoc(e)||(t=ce.propFix[t]||t,i=ce.propHooks[t]),void 0!==n?i&&\"set\"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&\"get\"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ce.find.attr(e,\"tabindex\");return t?parseInt(t,10):bt.test(e.nodeName)||wt.test(e.nodeName)&&e.href?0:-1}}},propFix:{\"for\":\"htmlFor\",\"class\":\"className\"}}),le.optSelected||(ce.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ce.each([\"tabIndex\",\"readOnly\",\"maxLength\",\"cellSpacing\",\"cellPadding\",\"rowSpan\",\"colSpan\",\"useMap\",\"frameBorder\",\"contentEditable\"],function(){ce.propFix[this.toLowerCase()]=this}),ce.fn.extend({addClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).addClass(t.call(this,e,Ct(this)))}):(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&\" \"+Tt(r)+\" \"){for(o=0;o<e.length;o++)i=e[o],n.indexOf(\" \"+i+\" \")<0&&(n+=i+\" \");a=Tt(n),r!==a&&this.setAttribute(\"class\",a)}}):this},removeClass:function(t){var e,n,r,i,o,a;return v(t)?this.each(function(e){ce(this).removeClass(t.call(this,e,Ct(this)))}):arguments.length?(e=kt(t)).length?this.each(function(){if(r=Ct(this),n=1===this.nodeType&&\" \"+Tt(r)+\" \"){for(o=0;o<e.length;o++){i=e[o];while(-1<n.indexOf(\" \"+i+\" \"))n=n.replace(\" \"+i+\" \",\" \")}a=Tt(n),r!==a&&this.setAttribute(\"class\",a)}}):this:this.attr(\"class\",\"\")},toggleClass:function(t,n){var e,r,i,o,a=typeof t,s=\"string\"===a||Array.isArray(t);return v(t)?this.each(function(e){ce(this).toggleClass(t.call(this,e,Ct(this),n),n)}):\"boolean\"==typeof n&&s?n?this.addClass(t):this.removeClass(t):(e=kt(t),this.each(function(){if(s)for(o=ce(this),i=0;i<e.length;i++)r=e[i],o.hasClass(r)?o.removeClass(r):o.addClass(r);else void 0!==t&&\"boolean\"!==a||((r=Ct(this))&&_.set(this,\"__className__\",r),this.setAttribute&&this.setAttribute(\"class\",r||!1===t?\"\":_.get(this,\"__className__\")||\"\"))}))},hasClass:function(e){var t,n,r=0;t=\" \"+e+\" \";while(n=this[r++])if(1===n.nodeType&&-1<(\" \"+Tt(Ct(n))+\" \").indexOf(t))return!0;return!1}});var St=/\\r/g;ce.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=v(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,ce(this).val()):n)?t=\"\":\"number\"==typeof t?t+=\"\":Array.isArray(t)&&(t=ce.map(t,function(e){return null==e?\"\":e+\"\"})),(r=ce.valHooks[this.type]||ce.valHooks[this.nodeName.toLowerCase()])&&\"set\"in r&&void 0!==r.set(this,t,\"value\")||(this.value=t))})):t?(r=ce.valHooks[t.type]||ce.valHooks[t.nodeName.toLowerCase()])&&\"get\"in r&&void 0!==(e=r.get(t,\"value\"))?e:\"string\"==typeof(e=t.value)?e.replace(St,\"\"):null==e?\"\":e:void 0}}),ce.extend({valHooks:{option:{get:function(e){var t=ce.find.attr(e,\"value\");return null!=t?t:Tt(ce.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a=\"select-one\"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!fe(n.parentNode,\"optgroup\"))){if(t=ce(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=ce.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<ce.inArray(ce.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ce.each([\"radio\",\"checkbox\"],function(){ce.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<ce.inArray(ce(e).val(),t)}},le.checkOn||(ce.valHooks[this].get=function(e){return null===e.getAttribute(\"value\")?\"on\":e.value})});var Et=ie.location,jt={guid:Date.now()},At=/\\?/;ce.parseXML=function(e){var t,n;if(!e||\"string\"!=typeof e)return null;try{t=(new ie.DOMParser).parseFromString(e,\"text/xml\")}catch(e){}return n=t&&t.getElementsByTagName(\"parsererror\")[0],t&&!n||ce.error(\"Invalid XML: \"+(n?ce.map(n.childNodes,function(e){return e.textContent}).join(\"\\n\"):e)),t};var Dt=/^(?:focusinfocus|focusoutblur)$/,Nt=function(e){e.stopPropagation()};ce.extend(ce.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||C],d=ue.call(e,\"type\")?e.type:e,h=ue.call(e,\"namespace\")?e.namespace.split(\".\"):[];if(o=f=a=n=n||C,3!==n.nodeType&&8!==n.nodeType&&!Dt.test(d+ce.event.triggered)&&(-1<d.indexOf(\".\")&&(d=(h=d.split(\".\")).shift(),h.sort()),u=d.indexOf(\":\")<0&&\"on\"+d,(e=e[ce.expando]?e:new ce.Event(d,\"object\"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join(\".\"),e.rnamespace=e.namespace?new RegExp(\"(^|\\\\.)\"+h.join(\"\\\\.(?:.*\\\\.|)\")+\"(\\\\.|$)\"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:ce.makeArray(t,[e]),c=ce.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!y(n)){for(s=c.delegateType||d,Dt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||C)&&p.push(a.defaultView||a.parentWindow||ie)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(_.get(o,\"events\")||Object.create(null))[e.type]&&_.get(o,\"handle\"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&$(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!$(n)||u&&v(n[d])&&!y(n)&&((a=n[u])&&(n[u]=null),ce.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Nt),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Nt),ce.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=ce.extend(new ce.Event,n,{type:e,isSimulated:!0});ce.event.trigger(r,null,t)}}),ce.fn.extend({trigger:function(e,t){return this.each(function(){ce.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ce.event.trigger(e,t,n,!0)}});var qt=/\\[\\]$/,Lt=/\\r?\\n/g,Ht=/^(?:submit|button|image|reset|file)$/i,Ot=/^(?:input|select|textarea|keygen)/i;function Pt(n,e,r,i){var t;if(Array.isArray(e))ce.each(e,function(e,t){r||qt.test(n)?i(n,t):Pt(n+\"[\"+(\"object\"==typeof t&&null!=t?e:\"\")+\"]\",t,r,i)});else if(r||\"object\"!==x(e))i(n,e);else for(t in e)Pt(n+\"[\"+t+\"]\",e[t],r,i)}ce.param=function(e,t){var n,r=[],i=function(e,t){var n=v(t)?t():t;r[r.length]=encodeURIComponent(e)+\"=\"+encodeURIComponent(null==n?\"\":n)};if(null==e)return\"\";if(Array.isArray(e)||e.jquery&&!ce.isPlainObject(e))ce.each(e,function(){i(this.name,this.value)});else for(n in e)Pt(n,e[n],t,i);return r.join(\"&\")},ce.fn.extend({serialize:function(){return ce.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ce.prop(this,\"elements\");return e?ce.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ce(this).is(\":disabled\")&&Ot.test(this.nodeName)&&!Ht.test(e)&&(this.checked||!we.test(e))}).map(function(e,t){var n=ce(this).val();return null==n?null:Array.isArray(n)?ce.map(n,function(e){return{name:t.name,value:e.replace(Lt,\"\\r\\n\")}}):{name:t.name,value:n.replace(Lt,\"\\r\\n\")}}).get()}});var Mt=/%20/g,Rt=/#.*$/,It=/([?&])_=[^&]*/,Wt=/^(.*?):[ \\t]*([^\\r\\n]*)$/gm,Ft=/^(?:GET|HEAD)$/,$t=/^\\/\\//,Bt={},_t={},zt=\"*/\".concat(\"*\"),Xt=C.createElement(\"a\");function Ut(o){return function(e,t){\"string\"!=typeof e&&(t=e,e=\"*\");var n,r=0,i=e.toLowerCase().match(D)||[];if(v(t))while(n=i[r++])\"+\"===n[0]?(n=n.slice(1)||\"*\",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function Vt(t,i,o,a){var s={},u=t===_t;function l(e){var r;return s[e]=!0,ce.each(t[e]||[],function(e,t){var n=t(i,o,a);return\"string\"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s[\"*\"]&&l(\"*\")}function Gt(e,t){var n,r,i=ce.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ce.extend(!0,e,r),e}Xt.href=Et.href,ce.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:\"GET\",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:\"application/x-www-form-urlencoded; charset=UTF-8\",accepts:{\"*\":zt,text:\"text/plain\",html:\"text/html\",xml:\"application/xml, text/xml\",json:\"application/json, text/javascript\"},contents:{xml:/\\bxml\\b/,html:/\\bhtml/,json:/\\bjson\\b/},responseFields:{xml:\"responseXML\",text:\"responseText\",json:\"responseJSON\"},converters:{\"* text\":String,\"text html\":!0,\"text json\":JSON.parse,\"text xml\":ce.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Gt(Gt(e,ce.ajaxSettings),t):Gt(ce.ajaxSettings,e)},ajaxPrefilter:Ut(Bt),ajaxTransport:Ut(_t),ajax:function(e,t){\"object\"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=ce.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?ce(y):ce.event,x=ce.Deferred(),b=ce.Callbacks(\"once memory\"),w=v.statusCode||{},a={},s={},u=\"canceled\",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Wt.exec(p))n[t[1].toLowerCase()+\" \"]=(n[t[1].toLowerCase()+\" \"]||[]).concat(t[2])}t=n[e.toLowerCase()+\" \"]}return null==t?null:t.join(\", \")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+\"\").replace($t,Et.protocol+\"//\"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||\"*\").toLowerCase().match(D)||[\"\"],null==v.crossDomain){r=C.createElement(\"a\");try{r.href=v.url,r.href=r.href,v.crossDomain=Xt.protocol+\"//\"+Xt.host!=r.protocol+\"//\"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&\"string\"!=typeof v.data&&(v.data=ce.param(v.data,v.traditional)),Vt(Bt,v,t,T),h)return T;for(i in(g=ce.event&&v.global)&&0==ce.active++&&ce.event.trigger(\"ajaxStart\"),v.type=v.type.toUpperCase(),v.hasContent=!Ft.test(v.type),f=v.url.replace(Rt,\"\"),v.hasContent?v.data&&v.processData&&0===(v.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&(v.data=v.data.replace(Mt,\"+\")):(o=v.url.slice(f.length),v.data&&(v.processData||\"string\"==typeof v.data)&&(f+=(At.test(f)?\"&\":\"?\")+v.data,delete v.data),!1===v.cache&&(f=f.replace(It,\"$1\"),o=(At.test(f)?\"&\":\"?\")+\"_=\"+jt.guid+++o),v.url=f+o),v.ifModified&&(ce.lastModified[f]&&T.setRequestHeader(\"If-Modified-Since\",ce.lastModified[f]),ce.etag[f]&&T.setRequestHeader(\"If-None-Match\",ce.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader(\"Content-Type\",v.contentType),T.setRequestHeader(\"Accept\",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+(\"*\"!==v.dataTypes[0]?\", \"+zt+\"; q=0.01\":\"\"):v.accepts[\"*\"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u=\"abort\",b.add(v.complete),T.done(v.success),T.fail(v.error),c=Vt(_t,v,t,T)){if(T.readyState=1,g&&m.trigger(\"ajaxSend\",[T,v]),h)return T;v.async&&0<v.timeout&&(d=ie.setTimeout(function(){T.abort(\"timeout\")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,\"No Transport\");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&ie.clearTimeout(d),c=void 0,p=r||\"\",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while(\"*\"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader(\"Content-Type\"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+\" \"+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),!i&&-1<ce.inArray(\"script\",v.dataTypes)&&ce.inArray(\"json\",v.dataTypes)<0&&(v.converters[\"text script\"]=function(){}),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if(\"*\"===o)o=u;else if(\"*\"!==u&&u!==o){if(!(a=l[u+\" \"+o]||l[\"* \"+o]))for(i in l)if((s=i.split(\" \"))[1]===o&&(a=l[u+\" \"+s[0]]||l[\"* \"+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e[\"throws\"])t=a(t);else try{t=a(t)}catch(e){return{state:\"parsererror\",error:a?e:\"No conversion from \"+u+\" to \"+o}}}return{state:\"success\",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader(\"Last-Modified\"))&&(ce.lastModified[f]=u),(u=T.getResponseHeader(\"etag\"))&&(ce.etag[f]=u)),204===e||\"HEAD\"===v.type?l=\"nocontent\":304===e?l=\"notmodified\":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l=\"error\",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+\"\",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?\"ajaxSuccess\":\"ajaxError\",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger(\"ajaxComplete\",[T,v]),--ce.active||ce.event.trigger(\"ajaxStop\")))}return T},getJSON:function(e,t,n){return ce.get(e,t,n,\"json\")},getScript:function(e,t){return ce.get(e,void 0,t,\"script\")}}),ce.each([\"get\",\"post\"],function(e,i){ce[i]=function(e,t,n,r){return v(t)&&(r=r||n,n=t,t=void 0),ce.ajax(ce.extend({url:e,type:i,dataType:r,data:t,success:n},ce.isPlainObject(e)&&e))}}),ce.ajaxPrefilter(function(e){var t;for(t in e.headers)\"content-type\"===t.toLowerCase()&&(e.contentType=e.headers[t]||\"\")}),ce._evalUrl=function(e,t,n){return ce.ajax({url:e,type:\"GET\",dataType:\"script\",cache:!0,async:!1,global:!1,converters:{\"text script\":function(){}},dataFilter:function(e){ce.globalEval(e,t,n)}})},ce.fn.extend({wrapAll:function(e){var t;return this[0]&&(v(e)&&(e=e.call(this[0])),t=ce(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return v(n)?this.each(function(e){ce(this).wrapInner(n.call(this,e))}):this.each(function(){var e=ce(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=v(t);return this.each(function(e){ce(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not(\"body\").each(function(){ce(this).replaceWith(this.childNodes)}),this}}),ce.expr.pseudos.hidden=function(e){return!ce.expr.pseudos.visible(e)},ce.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},ce.ajaxSettings.xhr=function(){try{return new ie.XMLHttpRequest}catch(e){}};var Yt={0:200,1223:204},Qt=ce.ajaxSettings.xhr();le.cors=!!Qt&&\"withCredentials\"in Qt,le.ajax=Qt=!!Qt,ce.ajaxTransport(function(i){var o,a;if(le.cors||Qt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e[\"X-Requested-With\"]||(e[\"X-Requested-With\"]=\"XMLHttpRequest\"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,\"abort\"===e?r.abort():\"error\"===e?\"number\"!=typeof r.status?t(0,\"error\"):t(r.status,r.statusText):t(Yt[r.status]||r.status,r.statusText,\"text\"!==(r.responseType||\"text\")||\"string\"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o(\"error\"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&ie.setTimeout(function(){o&&a()})},o=o(\"abort\");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),ce.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),ce.ajaxSetup({accepts:{script:\"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript\"},contents:{script:/\\b(?:java|ecma)script\\b/},converters:{\"text script\":function(e){return ce.globalEval(e),e}}}),ce.ajaxPrefilter(\"script\",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type=\"GET\")}),ce.ajaxTransport(\"script\",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=ce(\"<script>\").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on(\"load error\",i=function(e){r.remove(),i=null,e&&t(\"error\"===e.type?404:200,e.type)}),C.head.appendChild(r[0])},abort:function(){i&&i()}}});var Jt,Kt=[],Zt=/(=)\\?(?=&|$)|\\?\\?/;ce.ajaxSetup({jsonp:\"callback\",jsonpCallback:function(){var e=Kt.pop()||ce.expando+\"_\"+jt.guid++;return this[e]=!0,e}}),ce.ajaxPrefilter(\"json jsonp\",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Zt.test(e.url)?\"url\":\"string\"==typeof e.data&&0===(e.contentType||\"\").indexOf(\"application/x-www-form-urlencoded\")&&Zt.test(e.data)&&\"data\");if(a||\"jsonp\"===e.dataTypes[0])return r=e.jsonpCallback=v(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Zt,\"$1\"+r):!1!==e.jsonp&&(e.url+=(At.test(e.url)?\"&\":\"?\")+e.jsonp+\"=\"+r),e.converters[\"script json\"]=function(){return o||ce.error(r+\" was not called\"),o[0]},e.dataTypes[0]=\"json\",i=ie[r],ie[r]=function(){o=arguments},n.always(function(){void 0===i?ce(ie).removeProp(r):ie[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Kt.push(r)),o&&v(i)&&i(o[0]),o=i=void 0}),\"script\"}),le.createHTMLDocument=((Jt=C.implementation.createHTMLDocument(\"\").body).innerHTML=\"<form></form><form></form>\",2===Jt.childNodes.length),ce.parseHTML=function(e,t,n){return\"string\"!=typeof e?[]:(\"boolean\"==typeof t&&(n=t,t=!1),t||(le.createHTMLDocument?((r=(t=C.implementation.createHTMLDocument(\"\")).createElement(\"base\")).href=C.location.href,t.head.appendChild(r)):t=C),o=!n&&[],(i=w.exec(e))?[t.createElement(i[1])]:(i=Ae([e],t,o),o&&o.length&&ce(o).remove(),ce.merge([],i.childNodes)));var r,i,o},ce.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(\" \");return-1<s&&(r=Tt(e.slice(s)),e=e.slice(0,s)),v(t)?(n=t,t=void 0):t&&\"object\"==typeof t&&(i=\"POST\"),0<a.length&&ce.ajax({url:e,type:i||\"GET\",dataType:\"html\",data:t}).done(function(e){o=arguments,a.html(r?ce(\"<div>\").append(ce.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ce.expr.pseudos.animated=function(t){return ce.grep(ce.timers,function(e){return t===e.elem}).length},ce.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=ce.css(e,\"position\"),c=ce(e),f={};\"static\"===l&&(e.style.position=\"relative\"),s=c.offset(),o=ce.css(e,\"top\"),u=ce.css(e,\"left\"),(\"absolute\"===l||\"fixed\"===l)&&-1<(o+u).indexOf(\"auto\")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),v(t)&&(t=t.call(e,n,ce.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),\"using\"in t?t.using.call(e,f):c.css(f)}},ce.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){ce.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if(\"fixed\"===ce.css(r,\"position\"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&\"static\"===ce.css(e,\"position\"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=ce(e).offset()).top+=ce.css(e,\"borderTopWidth\",!0),i.left+=ce.css(e,\"borderLeftWidth\",!0))}return{top:t.top-i.top-ce.css(r,\"marginTop\",!0),left:t.left-i.left-ce.css(r,\"marginLeft\",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&\"static\"===ce.css(e,\"position\"))e=e.offsetParent;return e||J})}}),ce.each({scrollLeft:\"pageXOffset\",scrollTop:\"pageYOffset\"},function(t,i){var o=\"pageYOffset\"===i;ce.fn[t]=function(e){return M(this,function(e,t,n){var r;if(y(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),ce.each([\"top\",\"left\"],function(e,n){ce.cssHooks[n]=Ye(le.pixelPosition,function(e,t){if(t)return t=Ge(e,n),_e.test(t)?ce(e).position()[n]+\"px\":t})}),ce.each({Height:\"height\",Width:\"width\"},function(a,s){ce.each({padding:\"inner\"+a,content:s,\"\":\"outer\"+a},function(r,o){ce.fn[o]=function(e,t){var n=arguments.length&&(r||\"boolean\"!=typeof e),i=r||(!0===e||!0===t?\"margin\":\"border\");return M(this,function(e,t,n){var r;return y(e)?0===o.indexOf(\"outer\")?e[\"inner\"+a]:e.document.documentElement[\"client\"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body[\"scroll\"+a],r[\"scroll\"+a],e.body[\"offset\"+a],r[\"offset\"+a],r[\"client\"+a])):void 0===n?ce.css(e,t,i):ce.style(e,t,n,i)},s,n?e:void 0,n)}})}),ce.each([\"ajaxStart\",\"ajaxStop\",\"ajaxComplete\",\"ajaxError\",\"ajaxSuccess\",\"ajaxSend\"],function(e,t){ce.fn[t]=function(e){return this.on(t,e)}}),ce.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,\"**\"):this.off(t,e||\"**\",n)},hover:function(e,t){return this.on(\"mouseenter\",e).on(\"mouseleave\",t||e)}}),ce.each(\"blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu\".split(\" \"),function(e,n){ce.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}});var en=/^[\\s\\uFEFF\\xA0]+|([^\\s\\uFEFF\\xA0])[\\s\\uFEFF\\xA0]+$/g;ce.proxy=function(e,t){var n,r,i;if(\"string\"==typeof t&&(n=e[t],t=e,e=n),v(e))return r=ae.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(ae.call(arguments)))}).guid=e.guid=e.guid||ce.guid++,i},ce.holdReady=function(e){e?ce.readyWait++:ce.ready(!0)},ce.isArray=Array.isArray,ce.parseJSON=JSON.parse,ce.nodeName=fe,ce.isFunction=v,ce.isWindow=y,ce.camelCase=F,ce.type=x,ce.now=Date.now,ce.isNumeric=function(e){var t=ce.type(e);return(\"number\"===t||\"string\"===t)&&!isNaN(e-parseFloat(e))},ce.trim=function(e){return null==e?\"\":(e+\"\").replace(en,\"$1\")},\"function\"==typeof define&&define.amd&&define(\"jquery\",[],function(){return ce});var tn=ie.jQuery,nn=ie.$;return ce.noConflict=function(e){return ie.$===ce&&(ie.$=nn),e&&ie.jQuery===ce&&(ie.jQuery=tn),ce},\"undefined\"==typeof e&&(ie.jQuery=ie.$=ce),ce});\n/*\n * jQuery throttle / debounce - v1.1 - 3/7/2010\n * http://benalman.com/projects/jquery-throttle-debounce-plugin/\n * \n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!==\"boolean\"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);\n/*!\n * imagesLoaded PACKAGED v4.1.4\n * JavaScript is all like \"You images are done yet or what?\"\n * MIT License\n */\n!function(e,t){\"function\"==typeof define&&define.amd?define(\"ev-emitter/ev-emitter\",t):\"object\"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}(\"undefined\"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return n.indexOf(t)==-1&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{},n=i[e]=i[e]||{};return n[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return n!=-1&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],o=0;o<i.length;o++){var r=i[o],s=n&&n[r];s&&(this.off(e,r),delete n[r]),r.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(e,t){\"use strict\";\"function\"==typeof define&&define.amd?define([\"ev-emitter/ev-emitter\"],function(i){return t(e,i)}):\"object\"==typeof module&&module.exports?module.exports=t(e,require(\"ev-emitter\")):e.imagesLoaded=t(e,e.EvEmitter)}(\"undefined\"!=typeof window?window:this,function(e,t){function i(e,t){for(var i in t)e[i]=t[i];return e}function n(e){if(Array.isArray(e))return e;var t=\"object\"==typeof e&&\"number\"==typeof e.length;return t?d.call(e):[e]}function o(e,t,r){if(!(this instanceof o))return new o(e,t,r);var s=e;return\"string\"==typeof e&&(s=document.querySelectorAll(e)),s?(this.elements=n(s),this.options=i({},this.options),\"function\"==typeof t?r=t:i(this.options,t),r&&this.on(\"always\",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(this.check.bind(this))):void a.error(\"Bad element for imagesLoaded \"+(s||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var h=e.jQuery,a=e.console,d=Array.prototype.slice;o.prototype=Object.create(t.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){\"IMG\"==e.nodeName&&this.addImage(e),this.options.background===!0&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&u[t]){for(var i=e.querySelectorAll(\"img\"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if(\"string\"==typeof this.options.background){var r=e.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var u={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\\((['\"])?(.*?)\\1\\)/gi,n=i.exec(t.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,i,n){setTimeout(function(){t.progress(e,i,n)})}var t=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once(\"progress\",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent(\"progress\",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log(\"progress: \"+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?\"fail\":\"done\";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent(\"always\",[this]),this.jqDeferred){var t=this.hasAnyBroken?\"reject\":\"resolve\";this.jqDeferred[t](this)}},r.prototype=Object.create(t.prototype),r.prototype.check=function(){var e=this.getIsImageComplete();return e?void this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"):(this.proxyImage=new Image,this.proxyImage.addEventListener(\"load\",this),this.proxyImage.addEventListener(\"error\",this),this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent(\"progress\",[this,this.img,t])},r.prototype.handleEvent=function(e){var t=\"on\"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,\"onload\"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,\"onerror\"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener(\"load\",this),this.proxyImage.removeEventListener(\"error\",this),this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener(\"load\",this),this.img.addEventListener(\"error\",this),this.img.src=this.url;var e=this.getIsImageComplete();e&&(this.confirm(0!==this.img.naturalWidth,\"naturalWidth\"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener(\"load\",this),this.img.removeEventListener(\"error\",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent(\"progress\",[this,this.element,t])},o.makeJQueryPlugin=function(t){t=t||e.jQuery,t&&(h=t,h.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});\n/*! lz-string.min.js v1.5.0 | (c) 2023 Pieroxy | MIT license */\nvar LZString=function(){var r=String.fromCharCode,o=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\",n=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$\",e={};function t(r,o){if(!e[r]){e[r]={};for(var n=0;n<r.length;n++)e[r][r.charAt(n)]=n}return e[r][o]}var i={compressToBase64:function(r){if(null==r)return\"\";var n=i._compress(r,6,function(r){return o.charAt(r)});switch(n.length%4){default:case 0:return n;case 1:return n+\"===\";case 2:return n+\"==\";case 3:return n+\"=\"}},decompressFromBase64:function(r){return null==r?\"\":\"\"==r?null:i._decompress(r.length,32,function(n){return t(o,r.charAt(n))})},compressToUTF16:function(o){return null==o?\"\":i._compress(o,15,function(o){return r(o+32)})+\" \"},decompressFromUTF16:function(r){return null==r?\"\":\"\"==r?null:i._decompress(r.length,16384,function(o){return r.charCodeAt(o)-32})},compressToUint8Array:function(r){for(var o=i.compress(r),n=new Uint8Array(2*o.length),e=0,t=o.length;e<t;e++){var s=o.charCodeAt(e);n[2*e]=s>>>8,n[2*e+1]=s%256}return n},decompressFromUint8Array:function(o){if(null==o)return i.decompress(o);for(var n=new Array(o.length/2),e=0,t=n.length;e<t;e++)n[e]=256*o[2*e]+o[2*e+1];var s=[];return n.forEach(function(o){s.push(r(o))}),i.decompress(s.join(\"\"))},compressToEncodedURIComponent:function(r){return null==r?\"\":i._compress(r,6,function(r){return n.charAt(r)})},decompressFromEncodedURIComponent:function(r){return null==r?\"\":\"\"==r?null:(r=r.replace(/ /g,\"+\"),i._decompress(r.length,32,function(o){return t(n,r.charAt(o))}))},compress:function(o){return i._compress(o,16,function(o){return r(o)})},_compress:function(r,o,n){if(null==r)return\"\";var e,t,i,s={},u={},a=\"\",p=\"\",c=\"\",l=2,f=3,h=2,d=[],m=0,v=0;for(i=0;i<r.length;i+=1)if(a=r.charAt(i),Object.prototype.hasOwnProperty.call(s,a)||(s[a]=f++,u[a]=!0),p=c+a,Object.prototype.hasOwnProperty.call(s,p))c=p;else{if(Object.prototype.hasOwnProperty.call(u,c)){if(c.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==o-1?(v=0,d.push(n(m)),m=0):v++;for(t=c.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;e<h;e++)m=m<<1|t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=c.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}0==--l&&(l=Math.pow(2,h),h++),delete u[c]}else for(t=s[c],e=0;e<h;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;0==--l&&(l=Math.pow(2,h),h++),s[p]=f++,c=String(a)}if(\"\"!==c){if(Object.prototype.hasOwnProperty.call(u,c)){if(c.charCodeAt(0)<256){for(e=0;e<h;e++)m<<=1,v==o-1?(v=0,d.push(n(m)),m=0):v++;for(t=c.charCodeAt(0),e=0;e<8;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}else{for(t=1,e=0;e<h;e++)m=m<<1|t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t=0;for(t=c.charCodeAt(0),e=0;e<16;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1}0==--l&&(l=Math.pow(2,h),h++),delete u[c]}else for(t=s[c],e=0;e<h;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;0==--l&&(l=Math.pow(2,h),h++)}for(t=2,e=0;e<h;e++)m=m<<1|1&t,v==o-1?(v=0,d.push(n(m)),m=0):v++,t>>=1;for(;;){if(m<<=1,v==o-1){d.push(n(m));break}v++}return d.join(\"\")},decompress:function(r){return null==r?\"\":\"\"==r?null:i._decompress(r.length,32768,function(o){return r.charCodeAt(o)})},_decompress:function(o,n,e){var t,i,s,u,a,p,c,l=[],f=4,h=4,d=3,m=\"\",v=[],g={val:e(0),position:n,index:1};for(t=0;t<3;t+=1)l[t]=t;for(s=0,a=Math.pow(2,2),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;switch(s){case 0:for(s=0,a=Math.pow(2,8),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;c=r(s);break;case 1:for(s=0,a=Math.pow(2,16),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;c=r(s);break;case 2:return\"\"}for(l[3]=c,i=c,v.push(c);;){if(g.index>o)return\"\";for(s=0,a=Math.pow(2,d),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;switch(c=s){case 0:for(s=0,a=Math.pow(2,8),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;l[h++]=r(s),c=h-1,f--;break;case 1:for(s=0,a=Math.pow(2,16),p=1;p!=a;)u=g.val&g.position,g.position>>=1,0==g.position&&(g.position=n,g.val=e(g.index++)),s|=(u>0?1:0)*p,p<<=1;l[h++]=r(s),c=h-1,f--;break;case 2:return v.join(\"\")}if(0==f&&(f=Math.pow(2,d),d++),l[c])m=l[c];else{if(c!==h)return null;m=i+i.charAt(0)}v.push(m),l[h++]=i+m.charAt(0),i=m,0==--f&&(f=Math.pow(2,d),d++)}}};return i}();\"function\"==typeof define&&define.amd?define(function(){return LZString}):\"undefined\"!=typeof module&&null!=module?module.exports=LZString:\"undefined\"!=typeof angular&&null!=angular&&angular.module(\"LZString\",[]).factory(\"LZString\",function(){return LZString});\n/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/dist/FileSaver.js */\n(function(a,b){if(\"function\"==typeof define&&define.amd)define([],b);else if(\"undefined\"!=typeof exports)b();else{b(),a.FileSaver={exports:{}}.exports}})(this,function(){\"use strict\";function b(a,b){return\"undefined\"==typeof b?b={autoBom:!1}:\"object\"!=typeof b&&(console.warn(\"Deprecated: Expected third argument to be a object\"),b={autoBom:!b}),b.autoBom&&/^\\s*(?:text\\/\\S*|application\\/xml|\\S*\\/\\S*\\+xml)\\s*;.*charset\\s*=\\s*utf-8/i.test(a.type)?new Blob([\"\\uFEFF\",a],{type:a.type}):a}function c(a,b,c){var d=new XMLHttpRequest;d.open(\"GET\",a),d.responseType=\"blob\",d.onload=function(){g(d.response,b,c)},d.onerror=function(){console.error(\"could not download file\")},d.send()}function d(a){var b=new XMLHttpRequest;b.open(\"HEAD\",a,!1);try{b.send()}catch(a){}return 200<=b.status&&299>=b.status}function e(a){try{a.dispatchEvent(new MouseEvent(\"click\"))}catch(c){var b=document.createEvent(\"MouseEvents\");b.initMouseEvent(\"click\",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),a.dispatchEvent(b)}}var f=\"object\"==typeof window&&window.window===window?window:\"object\"==typeof self&&self.self===self?self:\"object\"==typeof global&&global.global===global?global:void 0,a=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),g=f.saveAs||(\"object\"!=typeof window||window!==f?function(){}:\"download\"in HTMLAnchorElement.prototype&&!a?function(b,g,h){var i=f.URL||f.webkitURL,j=document.createElement(\"a\");g=g||b.name||\"download\",j.download=g,j.rel=\"noopener\",\"string\"==typeof b?(j.href=b,j.origin===location.origin?e(j):d(j.href)?c(b,g,h):e(j,j.target=\"_blank\")):(j.href=i.createObjectURL(b),setTimeout(function(){i.revokeObjectURL(j.href)},4E4),setTimeout(function(){e(j)},0))}:\"msSaveOrOpenBlob\"in navigator?function(f,g,h){if(g=g||f.name||\"download\",\"string\"!=typeof f)navigator.msSaveOrOpenBlob(b(f,h),g);else if(d(f))c(f,g,h);else{var i=document.createElement(\"a\");i.href=f,i.target=\"_blank\",setTimeout(function(){e(i)})}}:function(b,d,e,g){if(g=g||open(\"\",\"_blank\"),g&&(g.document.title=g.document.body.innerText=\"downloading...\"),\"string\"==typeof b)return c(b,d,e);var h=\"application/octet-stream\"===b.type,i=/constructor/i.test(f.HTMLElement)||f.safari,j=/CriOS\\/[\\d]+/.test(navigator.userAgent);if((j||h&&i||a)&&\"undefined\"!=typeof FileReader){var k=new FileReader;k.onloadend=function(){var a=k.result;a=j?a:a.replace(/^data:[^;]*;/,\"data:attachment/file;\"),g?g.location.href=a:location=a,g=null},k.readAsDataURL(b)}else{var l=f.URL||f.webkitURL,m=l.createObjectURL(b);g?g.location=m:location.href=m,g=null,setTimeout(function(){l.revokeObjectURL(m)},4E4)}});f.saveAs=g.saveAs=g,\"undefined\"!=typeof module&&(module.exports=g)});\n/*! seedrandom.js v3.0.5 | Copyright 2019 David Bau. | MIT license */\n!function(f,a,c){var s,l=256,p=\"random\",d=c.pow(l,6),g=c.pow(2,52),y=2*g,h=l-1;function n(n,t,r){function e(){for(var n=u.g(6),t=d,r=0;n<g;)n=(n+r)*l,t*=l,r=u.g(1);for(;y<=n;)n/=2,t/=2,r>>>=1;return(n+r)/t}var o=[],i=j(function n(t,r){var e,o=[],i=typeof t;if(r&&\"object\"==i)for(e in t)try{o.push(n(t[e],r-1))}catch(n){}return o.length?o:\"string\"==i?t:t+\"\\0\"}((t=1==t?{entropy:!0}:t||{}).entropy?[n,S(a)]:null==n?function(){try{var n;return s&&(n=s.randomBytes)?n=n(l):(n=new Uint8Array(l),(f.crypto||f.msCrypto).getRandomValues(n)),S(n)}catch(n){var t=f.navigator,r=t&&t.plugins;return[+new Date,f,r,f.screen,S(a)]}}():n,3),o),u=new m(o);return e.int32=function(){return 0|u.g(4)},e.quick=function(){return u.g(4)/4294967296},e.double=e,j(S(u.S),a),(t.pass||r||function(n,t,r,e){return e&&(e.S&&v(e,u),n.state=function(){return v(u,{})}),r?(c[p]=n,t):n})(e,i,\"global\"in t?t.global:this==c,t.state)}function m(n){var t,r=n.length,u=this,e=0,o=u.i=u.j=0,i=u.S=[];for(r||(n=[r++]);e<l;)i[e]=e++;for(e=0;e<l;e++)i[e]=i[o=h&o+n[e%r]+(t=i[e])],i[o]=t;(u.g=function(n){for(var t,r=0,e=u.i,o=u.j,i=u.S;n--;)t=i[e=h&e+1],r=r*l+i[h&(i[e]=i[o=h&o+t])+(i[o]=t)];return u.i=e,u.j=o,r})(l)}function v(n,t){return t.i=n.i,t.j=n.j,t.S=n.S.slice(),t}function j(n,t){for(var r,e=n+\"\",o=0;o<e.length;)t[h&o]=h&(r^=19*t[h&o])+e.charCodeAt(o++);return S(t)}function S(n){return String.fromCharCode.apply(0,n)}if(j(c.random(),a),\"object\"==typeof module&&module.exports){module.exports=n;try{s=require(\"crypto\")}catch(n){}}else\"function\"==typeof define&&define.amd?define(function(){return n}):c[\"seed\"+p]=n}(\"undefined\"!=typeof self?self:this,[],Math);\n/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */\n!function(){for(var methods=[\"assert\",\"clear\",\"count\",\"debug\",\"dir\",\"dirxml\",\"error\",\"exception\",\"group\",\"groupCollapsed\",\"groupEnd\",\"info\",\"log\",\"markTimeline\",\"profile\",\"profileEnd\",\"table\",\"time\",\"timeEnd\",\"timeline\",\"timelineEnd\",\"timeStamp\",\"trace\",\"warn\"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();\n}else{document.documentElement.setAttribute(\"data-init\", \"lacking\");}\n</script>\n<style id=\"style-normalize\" type=\"text/css\">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */\n\n/**\n * 1. Set default font family to sans-serif.\n * 2. Prevent iOS and IE text size adjust after device orientation change,\n *    without disabling user zoom.\n */\n\nhtml {\n  font-family: sans-serif; /* 1 */\n  -ms-text-size-adjust: 100%; /* 2 */\n  -webkit-text-size-adjust: 100%; /* 2 */\n}\n\n/**\n * Remove default margin.\n */\n\nbody {\n  margin: 0;\n}\n\n/* HTML5 display definitions\n   ========================================================================== */\n\n/**\n * Correct `block` display not defined for any HTML5 element in IE 8/9.\n * Correct `block` display not defined for `details` or `summary` in IE 10/11\n * and Firefox.\n * Correct `block` display not defined for `main` in IE 11.\n */\n\narticle,\naside,\ndetails,\nfigcaption,\nfigure,\nfooter,\nheader,\nhgroup,\nmain,\nmenu,\nnav,\nsection,\nsummary {\n  display: block;\n}\n\n/**\n * 1. Correct `inline-block` display not defined in IE 8/9.\n * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.\n */\n\naudio,\ncanvas,\nprogress,\nvideo {\n  display: inline-block; /* 1 */\n  vertical-align: baseline; /* 2 */\n}\n\n/**\n * Prevent modern browsers from displaying `audio` without controls.\n * Remove excess height in iOS 5 devices.\n */\n\naudio:not([controls]) {\n  display: none;\n  height: 0;\n}\n\n/**\n * Address `[hidden]` styling not present in IE 8/9/10.\n * Hide the `template` element in IE 8/9/10/11, Safari, and Firefox < 22.\n */\n\n[hidden],\ntemplate {\n  display: none;\n}\n\n/* Links\n   ========================================================================== */\n\n/**\n * Remove the gray background color from active links in IE 10.\n */\n\na {\n  background-color: transparent;\n}\n\n/**\n * Improve readability of focused elements when they are also in an\n * active/hover state.\n */\n\na:active,\na:hover {\n  outline: 0;\n}\n\n/* Text-level semantics\n   ========================================================================== */\n\n/**\n * Address styling not present in IE 8/9/10/11, Safari, and Chrome.\n */\n\nabbr[title] {\n  border-bottom: 1px dotted;\n}\n\n/**\n * Address style set to `bolder` in Firefox 4+, Safari, and Chrome.\n */\n\nb,\nstrong {\n  font-weight: bold;\n}\n\n/**\n * Address styling not present in Safari and Chrome.\n */\n\ndfn {\n  font-style: italic;\n}\n\n/**\n * Address variable `h1` font-size and margin within `section` and `article`\n * contexts in Firefox 4+, Safari, and Chrome.\n */\n\nh1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n/**\n * Address styling not present in IE 8/9.\n */\n\nmark {\n  background: #ff0;\n  color: #000;\n}\n\n/**\n * Address inconsistent and variable font size in all browsers.\n */\n\nsmall {\n  font-size: 80%;\n}\n\n/**\n * Prevent `sub` and `sup` affecting `line-height` in all browsers.\n */\n\nsub,\nsup {\n  font-size: 75%;\n  line-height: 0;\n  position: relative;\n  vertical-align: baseline;\n}\n\nsup {\n  top: -0.5em;\n}\n\nsub {\n  bottom: -0.25em;\n}\n\n/* Embedded content\n   ========================================================================== */\n\n/**\n * Remove border when inside `a` element in IE 8/9/10.\n */\n\nimg {\n  border: 0;\n}\n\n/**\n * Correct overflow not hidden in IE 9/10/11.\n */\n\nsvg:not(:root) {\n  overflow: hidden;\n}\n\n/* Grouping content\n   ========================================================================== */\n\n/**\n * Address margin not present in IE 8/9 and Safari.\n */\n\nfigure {\n  margin: 1em 40px;\n}\n\n/**\n * Address differences between Firefox and other browsers.\n */\n\nhr {\n  box-sizing: content-box;\n  height: 0;\n}\n\n/**\n * Contain overflow in all browsers.\n */\n\npre {\n  overflow: auto;\n}\n\n/**\n * Address odd `em`-unit font size rendering in all browsers.\n */\n\ncode,\nkbd,\npre,\nsamp {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n/* Forms\n   ========================================================================== */\n\n/**\n * Known limitation: by default, Chrome and Safari on OS X allow very limited\n * styling of `select`, unless a `border` property is set.\n */\n\n/**\n * 1. Correct color not being inherited.\n *    Known issue: affects color of disabled elements.\n * 2. Correct font properties not being inherited.\n * 3. Address margins set differently in Firefox 4+, Safari, and Chrome.\n */\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  color: inherit; /* 1 */\n  font: inherit; /* 2 */\n  margin: 0; /* 3 */\n}\n\n/**\n * Address `overflow` set to `hidden` in IE 8/9/10/11.\n */\n\nbutton {\n  overflow: visible;\n}\n\n/**\n * Address inconsistent `text-transform` inheritance for `button` and `select`.\n * All other form control elements do not inherit `text-transform` values.\n * Correct `button` style inheritance in Firefox, IE 8/9/10/11, and Opera.\n * Correct `select` style inheritance in Firefox.\n */\n\nbutton,\nselect {\n  text-transform: none;\n}\n\n/**\n * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`\n *    and `video` controls.\n * 2. Correct inability to style clickable `input` types in iOS.\n * 3. Improve usability and consistency of cursor style between image-type\n *    `input` and others.\n */\n\nbutton,\nhtml input[type=\"button\"], /* 1 */\ninput[type=\"reset\"],\ninput[type=\"submit\"] {\n  -webkit-appearance: button; /* 2 */\n  cursor: pointer; /* 3 */\n}\n\n/**\n * Re-set default cursor for disabled elements.\n */\n\nbutton[disabled],\nhtml input[disabled] {\n  cursor: default;\n}\n\n/**\n * Remove inner padding and border in Firefox 4+.\n */\n\nbutton::-moz-focus-inner,\ninput::-moz-focus-inner {\n  border: 0;\n  padding: 0;\n}\n\n/**\n * Address Firefox 4+ setting `line-height` on `input` using `!important` in\n * the UA stylesheet.\n */\n\ninput {\n  line-height: normal;\n}\n\n/**\n * It's recommended that you don't attempt to style these elements.\n * Firefox's implementation doesn't respect box-sizing, padding, or width.\n *\n * 1. Address box sizing set to `content-box` in IE 8/9/10.\n * 2. Remove excess padding in IE 8/9/10.\n */\n\ninput[type=\"checkbox\"],\ninput[type=\"radio\"] {\n  box-sizing: border-box; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Fix the cursor style for Chrome's increment/decrement buttons. For certain\n * `font-size` values of the `input`, it causes the cursor style of the\n * decrement button to change from `default` to `text`.\n */\n\ninput[type=\"number\"]::-webkit-inner-spin-button,\ninput[type=\"number\"]::-webkit-outer-spin-button {\n  height: auto;\n}\n\n/**\n * 1. Address `appearance` set to `searchfield` in Safari and Chrome.\n * 2. Address `box-sizing` set to `border-box` in Safari and Chrome.\n */\n\ninput[type=\"search\"] {\n  -webkit-appearance: textfield; /* 1 */\n  box-sizing: content-box; /* 2 */\n}\n\n/**\n * Remove inner padding and search cancel button in Safari and Chrome on OS X.\n * Safari (but not Chrome) clips the cancel button when the search input has\n * padding (and `textfield` appearance).\n */\n\ninput[type=\"search\"]::-webkit-search-cancel-button,\ninput[type=\"search\"]::-webkit-search-decoration {\n  -webkit-appearance: none;\n}\n\n/**\n * Define consistent border, margin, and padding.\n */\n\nfieldset {\n  border: 1px solid #c0c0c0;\n  margin: 0 2px;\n  padding: 0.35em 0.625em 0.75em;\n}\n\n/**\n * 1. Correct `color` not being inherited in IE 8/9/10/11.\n * 2. Remove padding so people aren't caught out if they zero out fieldsets.\n */\n\nlegend {\n  border: 0; /* 1 */\n  padding: 0; /* 2 */\n}\n\n/**\n * Remove default vertical scrollbar in IE 8/9/10/11.\n */\n\ntextarea {\n  overflow: auto;\n}\n\n/**\n * Don't inherit the `font-weight` (applied by a rule above).\n * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.\n */\n\noptgroup {\n  font-weight: bold;\n}\n\n/* Tables\n   ========================================================================== */\n\n/**\n * Remove most spacing between table cells.\n */\n\ntable {\n  border-collapse: collapse;\n  border-spacing: 0;\n}\n\ntd,\nth {\n  padding: 0;\n}\n</style>\n<style id=\"style-init-screen\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/init-screen.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n@-webkit-keyframes init-loading-spin {\n\t0%   { -webkit-transform: rotate(0deg); transform: rotate(0deg); }\n\t100% { -webkit-transform: rotate(360deg); transform: rotate(360deg); }\n}\n\n@-o-keyframes init-loading-spin {\n\t0%   { -o-transform: rotate(0deg); transform: rotate(0deg); }\n\t100% { -o-transform: rotate(360deg); transform: rotate(360deg); }\n}\n\n@keyframes init-loading-spin {\n\t0%   { -webkit-transform: rotate(0deg); -o-transform: rotate(0deg); transform: rotate(0deg); }\n\t100% { -webkit-transform: rotate(360deg); -o-transform: rotate(360deg); transform: rotate(360deg); }\n}\n#init-screen {\n\tdisplay: none;\n\tz-index: 500000;\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\theight: 100%;\n\twidth: 100%;\n\tfont: 28px/1 Helmet, Freesans, sans-serif;\n\tfont-weight: bold;\n\tcolor: #eee;\n\tbackground-color: #111;\n\ttext-align: center;\n}\n#init-screen > div {\n\tdisplay: none;\n\tposition: relative;\n\tmargin: 0 auto;\n\tmax-width: 1136px;\n\ttop: 25%;\n}\nhtml[data-init=\"no-js\"] #init-screen,\nhtml[data-init=\"lacking\"] #init-screen,\nhtml[data-init=\"loading\"] #init-screen {\n\tdisplay: block;\n}\nhtml[data-init=\"no-js\"] #init-no-js,\nhtml[data-init=\"lacking\"] #init-lacking {\n\tdisplay: block;\n\tpadding: 0 1em;\n}\nhtml[data-init=\"no-js\"] #init-no-js {\n\tcolor: red;\n}\nhtml[data-init=\"loading\"] #init-loading {\n\t-webkit-animation: init-loading-spin 2s linear infinite;\n\t     -o-animation: init-loading-spin 2s linear infinite;\n\t        animation: init-loading-spin 2s linear infinite;\n\tborder: 12px solid transparent;\n\tborder-bottom-color: #7f7f7f;\n\tborder-radius: 50%;\n\tborder-top-color: #7f7f7f;\n\tdisplay: block;\n\theight: 100px;\n\twidth: 100px;\n}\nhtml[data-init=\"loading\"] #init-loading > div {\n\ttext-indent: 16128px; /* 8K UHD horizontal ×2.1 */\n\toverflow: hidden;\n\twhite-space: nowrap;\n}\nhtml[data-init=\"loading\"] #ui-bar,\nhtml[data-init=\"loading\"] #story {\n\tdisplay: none !important;\n}\n</style>\n<style id=\"style-font-icons\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/font-icons.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n@font-face {\n\t/*\n\t\tsc-icons (2021-02-26)\n\n\t\t`sc-icons` is a subset of the Font Awesome Free (Solid; weight: 900) font v5.15.2 (http://fontawesome.com)\n\t\tand is licensed under the SIL OFL 1.1 (http://scripts.sil.org/OFL).\n\t*/\n\tfont-family: sc-icons;\n\tfont-display: block;\n\tsrc: url(\"data:application/octet-stream;base64,d09GRgABAAAAAFRoAAsAAAAAVBwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgD1IUnWNtYXAAAAFoAAACdAAAAnQzsxFSZ2FzcAAAA9wAAAAIAAAACAAAABBnbHlmAAAD5AAASzgAAEs4ynuL3WhlYWQAAE8cAAAANgAAADYc3WiNaGhlYQAAT1QAAAAkAAAAJAiCBP1obXR4AABPeAAAAfAAAAHwyjAFu2xvY2EAAFFoAAAA+gAAAPpXLER0bWF4cAAAUmQAAAAgAAAAIACEAIVuYW1lAABShAAAAcIAAAHCiTu08nBvc3QAAFRIAAAAIAAAACAAAwAAAAMDyQGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAARAAAAAAAAAAAAAAAAAAAAAAQAAA+CoDgP+AAIADgACAAAAAAQAAAAAAAAAAAAAAIAAAAAAAAwAAAAMAAAAcAAEAAwAAABwAAwABAAAAHAAEAlgAAACSAIAABgASAAEAIPAC8AXwDvAR8BPwFfAZ8CPwKPAu8E7wWvBe8GPwaPBq8G7wcfB48InwjfCT8JzwoPDC8MfwyfDQ8Nrw5/Dr8P7xDvEQ8SfxOvE+8ULxRPFG8UrxUvGG8YjxkfGr8d3x4PH48gXyRPKL8o3y6vLt8vHy+fMe813zgvQQ9Vr1b/V09cD2qfeM99n4Kv/9//8AAAAAACDwAvAE8AzwEPAT8BXwGfAj8CbwLvBI8FDwXvBg8GXwavBu8HDwd/CJ8I3wk/Cc8KDwwfDH8Mnw0PDX8Ofw6/D+8Q3xEPEn8TfxPvFB8UTxRvFK8VDxhfGI8ZHxq/Hd8eDx+PIE8kDyi/KN8ury7fLx8vnzHvNd84H0EPVa9W31dPXA9qn3jPfZ+Cn//f//AAH/4xACEAEP+w/6D/kP+A/1D+wP6g/lD8wPyw/ID8cPxg/FD8IPwQ+8D6wPqQ+kD5wPmQ95D3UPdA9uD2gPXA9ZD0cPOQ84DyIPEw8QDw4PDQ8MDwkPBA7SDtEOyQ6wDn8OfQ5mDlsOIQ3bDdoNfg18DXkNcg1ODRAM7QxgCxcLBQsBCrYJzgjsCKAIUQADAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAH//wAPAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAAAAAAAAAAAAAgAANzkBAAAAAAIAAP+OA/IDgAArAEcAACUWFA8BBiIvAS4BPQEOASMiJy4BJyY1NDc+ATc2MzIXHgEXFhUUBgczMhYXJTI3PgE3NjU0Jy4BJyYjIgcOAQcGFRQXHgEXFgPyDg45DigOxwcHNYNIVkxMcSAhISBxTExWVkxMcSAhLykhCRIH/nU1Ly5GFBQUFEYuLzU1Ly5GFBQUFEYuLwsOKA45Dg7HBxIJISkvISBxTExWVkxMcSAhISBxTExWSIM1BwcOFBRGLi81NS8uRhQUFBRGLi81NS8uRhQUAAAAAAEAEv/TA+4DNQAjAAABFhceAQcGBwEGIicBJicmNjc2NzY3NhYXFh8BNzY3PgEXFhcDnS8YGQUUFCr+fRM1Ev59KxMUBRkYLyoxMWUvMCYnJyYwL2UxMikDAyg2NnI3Nyz+cBMTAZAsNzdyNjYoIw8OCBYWJykpJxYWCA4PIwAAAQA8/4cERANcABgAAAE2MhcTBR4BDwETFgYnJQUGJjcTJyY2NyUCBxFQEYMBJCgYHNQyB0Ej/vv++yNBBzLUHBknASQDXCQk/vgrBksczv7dKC4SiooSLigBI84cSwYrAAAAAAEADwARA/EC7wAVAAAlASY0PwE2Mh8BATYyHwEWFAcBBiInAVz+sw8PSA8rD+AB4A8rD0gPD/2zDyoPEQFNDyoPSQ8P4AHgDw9JDyoP/bMPDwAAAAEAEgAyAq4CzgAjAAABFxYUDwEGIi8BBwYiLwEmND8BJyY0PwE2Mh8BNzYyHwEWFAcB5ckSEi0SNBPIyBM0Ei0SEsnJEhItEjQTyMgTNBItEhIBgMgTNBItEhLJyRISLRI0E8jIEzQSLRISyckSEi0SNBMAAwAA/44D8gOAACMAUABsAAABFRQGKwEVFAYrASImPQEjIiY9ATQ2OwE1NDY7ATIWHQEzMhYBBwYiLwEuAT0BDgEjIicuAScmNTQ3PgE3NjMyFx4BFxYVFAYHMzIWHwEWFAcBNCcuAScmIyIHDgEHBhUUFx4BFxYzMjc+ATc2AmAOCnAOCkAKDnAKDg4KcA4KQAoOcAoOAZI5DicOyAcHNYNIVkxMcSAhISBxTExWVkxMcSAhLykhCRIHxw4O/r4VFkkyMjg4MjFKFhUVFkkyMjg4MjFKFhUCAEAKDnAKDg4KcA4KQAoOcAoODgpwDv29OQ4OxwcSCSEpLyEgcUxMVlZMTHEgISEgcUxMVkiDNQcHxw4oDgIZODIxShYVFRZJMjI4ODIxShYVFRZJMjIAAAMAAP+OA/IDgAAPADwAWAAAARUUBiMhIiY9ATQ2MyEyFgEHBiIvAS4BPQEOASMiJy4BJyY1NDc+ATc2MzIXHgEXFhUUBgczMhYfARYUBwE0Jy4BJyYjIgcOAQcGFRQXHgEXFjMyNz4BNzYCYA4K/rAKDg4KAVAKDgGSOQ4nDsgHBzWDSFZMTHEgISEgcUxMVlZMTHEgIS8pIQkSB8cODv6+FRZJMjI4ODIxShYVFRZJMjI4ODIxShYVAgBACg4OCkAKDg79vTkODscHEgkhKS8hIHFMTFZWTExxICEhIHFMTFZIgzUHB8cOKA4CGTgyMUoWFRUWSTIyODgyMUoWFRUWSTIyAAAAAAIAEP+QA/ADgAA+AE4AAAEWFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzY3NhYfARYGBw4BFRQXHgEXFjMyNz4BNzY1NCYnLgE/AT4BFwMUBisBIiY1ETQ2OwEyFhUDIC8nJjYPDycnhlpaZ2ZbWocoJw8ONyYmMBEqCx8JBw8+ShoaWz49RkU9PVwbGkdBDwcJHwsqEdAcFEAUHBwUQBQcAxQiLCxnOjs+Z1pahycnJyeGWltmPzo6aCwsIgwJEzgQIwsujVNFPT1cGhsaGlw9PkdOjjALIxA4EwkM/lwUHBwUAeAUHBwUAAAAAgAm/5wD2gNkAFMAXwAAAR4BBw4BBw4BLwEOAQcVFAYHBiInLgE9AS4BJwcGJicuAScmNj8BJjQ3Jy4BNz4BNz4BHwE+ATc1NDY3PgEXHgEdAR4BFzc2FhceARcWBg8BFhQHBTI2NTQmIyIGFRQWA88HBgIRNyUGEQdVGz4hCgk0bzcICyE+GlYHEQUlOBECBgdWBwdWBwYCETglBREHVRs+IQsING83CAshPhtVBxEFJTgRAgYHVQYG/oZCXl5CQl5eAQkFDwk1YCgGAwUxFyQLYwgNAgwMAg0IYwskFzEFAwYoYDUJDwQyIkcjMQQQCDZfKAcCBDEXIwxiCQ0CCwEMAg0JYgwjFzEEAgYpXzYIDwUxI0YjWl5CQl5eQkJeAAAAAAIAAP/ABIADQAAjAFcAAAE+ATMyFhcBERQGIyciJjU4ATE1NCYrASIGHQEUBiMHIiY1ESUeARUUBg8BDgEjIiYnAS4BIyIGBwEOASMiJi8BLgE1NDY3AT4BMzIWHwE1NDY7ATIWFRECMQMIBAQIAwFxEw3gDRMTDYANExMN4A0TA7cEBQMCMwQJBgQIA/4pAwgEBAgD/ikDCAQGCQQzAgMFBAH6DCARESAMsw4KcAoOAlcDAwMD/tH+uA0TARIOvw0TEw2/DhIBEw0BSGEDCgYECAM+BAUDAwGDAwMDA/59AwMFBD4DCAUFCgMBoQoMDAqTkQoODgr+6wAAAAQAAP+ABAADgAAWAC0AOQBFAAABMzIWFREzMhYHAQYiJwEmNjsBETQ2MwEVFAYjISImPQE0NjMhFxYyPwEhMhYVBzQmIyIGFRQWMzI2NzQmIyIGFRQWMzI2AbCgFByvGxQS/s8LIAv+zxMVGrAcFAJQHBT8YBQcHBQBJWIfVB9iASUUHPgXERAYFxEQGIAXERAYFxEQGAOAHBT+sDET/s8LCwExEzEBUBQc/RDgFBwcFOAUHGIeHmIcFLAQGBcREBgXERAYFxEQGBcAAAIAAP+AA4ADgAAgACkAAAEyFhURFAYjISImNRE0NjsBNTQ3PgE3NjMyFx4BFxYdASM1NCYjIgYdAQMgKDg4KP1AKDg4KDAYGFI4Nz8/NzhSGBigVDw8VAHAOCj+gCg4OCgBgCg4kD83OFIYGBgYUjg3P5CQPFRUPJAAAAABAAAADgIAAvIAEQAAATYWFREUBi8BIyImNRE0NjsBAa4WPDsXsswUHBwUzALyFhgg/WAgGBayHBQBIBQcAAAAAgAAAAwDAALwABEAKgAAATYWFREUBi8BIyImNRE0NjsBBR4BFRQGBwYmJyY2Nz4BNTQmJy4BNz4BFwGuFzs7F7LMFBwcFMwBqCsxMSsRJgoJCxEUFhYUEQsJCiYRAvAWGCD9YCAYFrIcFAEgFBwmGFIwMFIYCQsREiYJCyUWFiULCSYSEQsJAAQAAP+oBIADWAARADoAWwB0AAABNhYVERQGLwEjIiY1ETQ2OwEBFhceARcWFRQHDgEHBgcGJicmNjc2Nz4BNzY1NCcuAScmJy4BNz4BFxMUBw4BBwYHBiYnJjY3PgE1NCYnLgE3PgEXFhceARcWFSUeARUUBgcGJicmNjc+ATU0JicuATc+ARcBrhc7OxeyzBQcHBTMAoU8Ly9CEhEREkIvLzwSJwoLCBExKCc2Dw4ODzYnKDERCAsLJxE/DAstHyApEiYKCggRPENDPBEICgsnECkgHy0LDP7kKzExKxEmCgkLERQWFhQRCwkKJhEC8hYYIP1gIBgWshwUASAUHAEYJzQ0ekRER0dERHo0NCcLCRARJwsgKytlODk7Ozk4ZSsrIAsnEREIC/4oMC0tUCMiGQwLDxEnCyZ7RkZ7JgsnERAJCxkiI1AtLTCaGFIwMFIYCQsREiYJCyUWFiULCSYSEQsJAAAAAAEAAP+AAwADgAAKAAAXETQ2MyEyFhURJQA4KAJAKDj+gIADoCg4OCj8YOAAAQCA/8ADAANAABkAABcRNDY7ATIWFREBNhYVERQGJwERFAYrASImgA4KYAoOAYcfSkof/nkOCmAKDigDUAoODgr+nwFqGiIp/QApIhoBaP6hCg4OAAAAAAEAAAAABAADAAAkAAA3ETQ2OwEyFhURATYWFREBNhYVERQGJwERFAYnAREUBisBIiY1AA4KUAoOAVcfSgFXH0pKH/6pSh/+qQ4KUAoOGALQCg4OCv7QATkaIin++AE5GiIp/YApIhoBNv77KSIaATb+0woODgoAAAIAFwAPBAAC8QALABcAABMmNDcBNhYVERQGJxMmNDcBNhYVERQGJxcXFwGAH0pKH4AXFwGAH0pKHwFPEzwTAUAaIin9gCkiGgFAEzwTAUAaIin9gCkiGgABAAD/jQNRA3MACwAAARYUBwEGJjURNDYXA1EvL/1AMGFmKwHTHG4c/mAcNzgDQD8tGQAAAgAA/8IDgANCAA8AHwAABSMiJjURNDY7ATIWFREUBiUUBisBIiY1ETQ2OwEyFhUBIMAoODgowCg4OAI4OCjAKDg4KMAoOD44KALAKDg4KP1AKDhgKDg4KALAKDg4KAAAAQAA/8ADgANAAA8AAAEyFhURFAYjISImNRE0NjMDICg4OCj9QCg4OCgDQDgo/UAoODgoAsAoOAACAAAADwPpAvEACwAXAAABFhQHAQYmNRE0NhcDFhQHAQYmNRE0NhcD6RcX/oAfSkofgBcX/oAfSkofAbETPBP+wBoiKQKAKSIa/sATPBP+wBoiKQKAKSIaAAAAAAEAAAAABAADAAAjAAABERQGKwEiJjURAQYmNREBBiY1ETQ2FwERNDYXARE0NjsBMhYEAA4KUAoO/qkfSv6pH0pKHwFXSh8BVw4KUAoOAuj9MAoODgoBMP7HGiIpAQj+xxoiKQKAKSIa/skBBikiGv7JAS4KDg4AAAEAgP/AAwADQAAZAAABERQGKwEiJjURAQYmNRE0NhcBETQ2OwEyFgMADgpgCg7+eR9KSh8Bhw4KYAoOAyj8sAoODgoBYf6WGiIpAwApIhr+mAFfCg4OAAACAAD/wAOAAyEADwAcAAAlFRQGIyEiJj0BNDYzITIWJSImNwE2MhcBFgYjIQOAJRv9ABslJRsDABsl/OA+MyoBYB1UHQFgKjM+/UCAgBslJRuAGyUlZXMuAYAfH/6ALnMAAAAAAQBF/9kCOwMnABUAABMBNjIfARYUBwkBFhQPAQYiJwEmNDdFAYUOKA4tDg7+zAE0Dg4tDigO/nsODgGiAYUODi4OJw/+y/7LDycOLg4OAYUOKA4AAQBF/9kCOwMnABUAAAkBBiIvASY0NwkBJjQ/ATYyFwEWFAcCO/57DigOLQ4OATT+zA4OLQ4oDgGFDg4BXv57Dg4uDicPATUBNQ8nDi4ODv57DigOAAAAAAIAEP+QA/ADcAAbAD8AAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYBNTQmKwE1NCYrASIGHQEjIgYdARQWOwEVFBY7ATI2PQEzMjYCAGdaWocnJycnh1paZ2daWocnJycnh1paAYcOCrgOCnAKDrgKDg4KuA4KcAoOuAoOA3AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyf92HAKDrgKDg4KuA4KcAoOuAoODgq4DgAAAAIAEP+QA/ADcAAbACsAAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYDITI2PQE0JiMhIgYdARQWAgBnWlqHJycnJ4daWmdnWlqHJycnJ4daWqECEAoODgr98AoODgNwJyeHWlpnZ1pahycnJyeHWlpnZ1pahycn/cAOCnAKDg4KcAoOAAACABD/kAPwA3AAGwBAAAABMhceARcWFRQHDgEHBiMiJy4BJyY1NDc+ATc2ASc3NjQvASYiDwEnJiIPAQYUHwEHBhQfARYyPwEXFjI/ATY0JwIAZ1pahycnJyeHWlpnZ1pahycnJyeHWloBWoODBwdPBxQHgoIHFAdPBweDgwcHTwcUB4KCBxQHTwcHA3AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyf9joKCBxQHTwcHg4MHB08HFAeCggcUB08HB4ODBwdPBxQHAAIAEP+QA/ADcAAbADEAAAEUBw4BBwYjIicuAScmNTQ3PgE3NjMyFx4BFxYJATY0LwEmIgcBJyYiDwEGFB8BFjI3A/AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyf91wFwCQkuCRsJ/tSMCRsJLgkJ0AoaCgGAZ1pahycnJyeHWlpnZ1pahycnJyeHWlr+kgFwChoKLQkJ/tSMCQktChoK0AkJAAAAAwAQ/5AD8ANwABsASQBVAAABFAcOAQcGIyInLgEnJjU0Nz4BNzYzMhceARcWJSIGBwYWHwEWNjc+ATMyFhUUBgcOAR0BFBY7ATI2PQE0Nz4BNzY1NCcuAScmIwMiBhUUFjMyNjU0JgPwJyeHWlpnZ1pahycnJyeHWlpnZ1pahycn/h1RbykFAwhFCBMGGy8pHzwiHyNKDgpwCg4aGj4aGhQVQiopKw0mNjYmJjY2AYBnWlqHJycnJ4daWmdnWlqHJycnJ4daWuVCPgcTBjUGAwgiJSQeFh0REzw+CAoODgoDFQ4PKCEgOiwlJTcPEP4QNiYmNjYmJjYAAAAAAwAQ/5AD8ANwABsAJwBGAAABMhceARcWFRQHDgEHBiMiJy4BJyY1NDc+ATc2FyIGFRQWMzI2NTQmEzU0JisBNTQmKwEiBh0BFBY7ARUjIgYdARQWOwEyNgIAZ1pahycnJyeHWlpnZ1pahycnJyeHWlpnIzExIyMxMU0OChgOCoAKDg4KGBgKDg4KsAoOA3AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyfcMSMjMTEjIzH+BDAKDsgKDg4KMAoOgA4KMAoODgAAAAADABD/kAPwA3AAGwArADsAAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYFJicuAQcGBwE2NzYmJyYnARYXHgE3NjcBBgcGFhcWFwIAZ1pahycnJyeHWlpnZ1pahycnJyeHWloBazE8PH4+PTUCASUQEQoaGzH9+DE8PH4+PTX9/yUQEQoaGzEDcCcnh1paZ2daWocnJycnh1paZ2daWocnJ+wxGxoKERAl/f81PT5+PDwx/fgxGxoKERAlAgE1PT5+PDwxAAEADv/ZA4ADJwAeAAAlBwYiJwEmNDcBNjIfARYUDwEhMhYdARQGIyEXFhQHAgMsDigO/nsODgGFDigOLA4P8QI/FBwcFP3B8Q8OBi0ODgGFDigOAYUODi0OKA7mHBRAFBzmDigOAAAAAQAA/9kDcgMnAB4AAAE3NjIXARYUBwEGIi8BJjQ/ASEiJj0BNDYzIScmNDcBfSwOKA4BhQ4O/nsOKA4sDg/x/cEUHBwUAj/xDw4C+i0ODv57DigO/nsODi0OKA7mHBRAFBzmDigOAAABABn/wANmAzIAHgAAEycmNDcBNjIXARYUDwEGIi8BERQGKwEiJjURBwYiJ0YtDg4BhQ4oDgGEDw8sDikO5RwUQBQc5g4oDgE9LA4oDgGFDg7+ew4nDi0OD/H9wRQcHBQCP/EPDgAAAAEAGf/OA2cDQAAeAAABFxYUBwEGIicBJjQ/ATYyHwERNDY7ATIWFRE3NjIXAzotDg7+ew4oDv57Dg4tDigO5hwUQBQc5g4oDgHDLA4oDv57Dg4BhQ4oDiwOD/ECPxQcHBT9wfEPDgAABAAA/8ADgANAABQAKQA+AFMAABM1NDY7ATIWHQEUBisBFRQGKwEiJgE0NjsBMhYdARQGKwEiJj0BIyImNQEyFh0BFAYrASImPQE0NjsBNTQ2MwEUBisBIiY9ATQ2OwEyFh0BMzIWFQAcFPgKDg4KqA4KUAoOAkAOCvgUHA4KUAoOqAoOASgKDhwU+AoODgqoDgr+KA4K+BQcDgpQCg6oCg4CGPgUHA4KUAoOqAoODgEaCg4cFPgKDg4KqA4K/igOCvgUHA4KUAoOqAoO/tgKDhwU+AoODgqoDgoAAAQAAP/AA4ADQAAUACkAPgBTAAABIyImPQE0NjsBMhYdATMyFh0BFAYlFAYrASImPQE0NjsBNTQ2OwEyFhURFAYrASImPQEjIiY9ATQ2OwEyFhUFFAYrASImPQE0NjsBMhYdARQGKwEDaPgUHA4KUAoOqAoODv3OHBT4Cg4OCqgOClAKDg4KUAoOqAoODgr4FBwBgA4KUAoOHBT4Cg4OCqgCABwU+AoODgqoDgpQCg4wFBwOClAKDqgKDg4K/LAKDg4KqA4KUAoOHBT4Cg4OCvgUHA4KUAoOAAEAAP/AA4ADQAAjAAABMhYdARQGIyERFAYrASImNREhIiY9ATQ2MyERNDY7ATIWFREDQBslJRv+4CUbQBsl/uAbJSUbASAlG0AbJQHgJRtAGyX+4BslJRsBICUbQBslASAbJSUb/uAAAQAAASADgAHgAA8AAAEyFh0BFAYjISImPQE0NjMDQBslJRv9ABslJRsB4CUbQBslJRtAGyUAAAADABD/kAPwA3AAGwAnADcAAAEUBw4BBwYjIicuAScmNTQ3PgE3NjMyFx4BFxYFIgYVFBYzMjY1NCYDEx4BOwEyNjcTNiYrASIGA/AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyf+ECY2NiYmNjZ9DgEOCWIJDgEOAQ4LfgsOAYBnWlqHJycnJ4daWmdnWlqHJycnJ4daWss2JiY2NiYmNgFL/vAKDQ0KARAKDw8AAwAAAAAEgAMAACgASQBlAAABHgEVFAYHBgcOAQcGIyInLgEnJicuATU0Njc2Nz4BNzYzMhceARcWFwE4ATEyNz4BNzY1MTQnLgEnJiMiBw4BBwYVFBceARcWMxE4ATEyFhUUBiMiJjU0NjceATMyNjU0Jic+ATMEeQMEBAMpOzuTVlVcXFVWkzs7KQMEBAMpOzuTVlVcXFVWkzs7Kf3HPDQ1ThYXFxZONTQ8PDQ1ThYXFxZONTQ8UHBwUE9wAwQLHRAoOAoJDBoNAZ0GDwgIDwZQQUFeGRoaGV5BQVAGDwgIDwZQQUFeGRoaGV5BQVD+wxcWTjU0PDw0NU4WFxcWTjU0PDw0NU4WFwHgcFBPcHBPDRoMCQo4KBAdCwQEAAAAAwAA/4AFAAOAAB8ATwB0AAAlMjY3Fw4BIyInLgEnJicuATU0Njc+ATcXFhceARcWMwUeARUUBg8BDgEjIiYnAS4BNTQ2PwE+ATMyFh8BPgEzMhceARcWFx4BFRQGBw4BByc+ATU4ATE0Jy4BJyYjMSIGBxc+ATU0Jic+ATMyFhUcARUUBgcCgA0aDWgmTihcVVaTOzspAwQEAw8mFNIEGBhNMjI5AnQFBwQDJwQOBwYKBPtnBQcEAycEDgcGCgT+QpVQXFVWkzs7KQMEBAMeUjKTDQ8XFk41NDw0XSWTAQIKCQ0bDU9vBgRgAwJQCgsaGV5BQVAGDwgIDwYeNxqiODAxSBQVdAUNBwYKBDMFBwQDA40FDQcGCgQzBQcEA8QjKBoZXkFBUAYPCAgPBjtnKnEbPSA8NDVOFhcjH3IFCgUQHQsEBG9OAQEBEB0OAAAAAwAN/4AEcwNQAAsAFwAnAAAlFgYjISImNwE2MhcDIgYVFBYzMjY1NCYDEx4BOwEyNjcTNiYrASIGBHMcODf8QDc4HAHgHG8bUyY2NiYmNjZ9DgEOCWIJDgEOAQ4LfgsOEDBgYDADQDAw/Ww2JiY2NiYmNgFL/vAKDQ0KARAKDw8AAAAAAQAZAIUDZwJ7ABUAAAkBFhQPAQYiJwkBBiIvASY0NwE2MhcB4gGFDg4uDicP/sv+yw8nDi4ODgGFDigOAnv+ew4oDi0ODgE0/swODi0OKA4BhQ4OAAAAAAEAGQCFA2cCewAVAAAlASY0PwE2MhcJATYyHwEWFAcBBiInAZ7+ew4OLg4nDwE1ATUPJw4uDg7+ew4oDoUBhQ4oDi0ODv7MATQODi0OKA7+ew4OAAEAPP+IAkADgAAPAAABEQUGJjcTJyY2NyUTPgEzAkD++yNBBzLUHBknASSDCCARA4D8kYkTLycBI84cSwYrAQgSEgAAAQAA/4kDAAOAAC0AAAEeARUUBiMhFRQGDwEGIi8BLgE9ASEiJjU0Nj8BIyImPQE0NjMhMhYdARQGKwECVEhkHBT+8AEBMAQUBDABAf7wFBxjSRhUFBwcFAIgFBwcFFQB0yF1TRQc0AIEAWAJCWABBALQHBRMdiHtHBRgFBwcFGAUHAAABAAA/4AEAAN1ABYAMAA8AEgAACUjIiY1ESMiJjcBNjIXARYGKwERFAYjJRUUBiMhIiY9ATQ2MyEVFBY7ATI2PQEhMhYHNCYjIgYVFBYzMjY3NCYjIgYVFBYzMjYCUKAUHK8bFBIBMQsgCwExExUbrxwUAbAcFPxgFBwcFAEQQi6gLkIBEBQc+BcREBgXERAYgBcREBgXERAYgBwUAVAxEwExCwv+zxMx/rAUHBDgFBwcFOAUHBAuQkIuEBzEEBgXERAYFxEQGBcREBgXAAAAAAEAAP+AA4ADgAAwAAABMhYVERQGIyEiJjURNDY7ATU0Nz4BNzYzMhceARcWHQEUBisBIiY9ATQmBw4BHQEhAyAoODgo/UAoODgoMBgXUzc3Pz84N1MYGBwUQBQcVTw8UwHwAYA4KP7AKDg4KAFAKDjNPzg4UxgZGBdTODc/IBQcHBQgPFUBAVU8zgAABAAAAAAEgAMAAA8AJAAwADwAAAEVFAYjISImPQE0NjMhMhYnITgBMSIGBxM+ATMhMhYXEy4BIzEHIgYVFBYzMjY1NCYjIgYVFBYzMjY1NCYEgDgo/EAoODgoA8AoOGD8QBEeD8IMKhkCGhkqDMIPHxBgGyUlGxslJdsbJSUbGyUlASDAKDg4KMAoODh4BgYBIRQXFxT+3wYGwCUbGyUlGxslJRsbJSUbGyUAAAIAFv+WA+oDagA+AH0AAAEWFxYUBwYHMAYxBwYHBiInJicmJyY0NzY/ATYWFx4BFxYGDwEOARcWMj8BNjQnLgEnLgE1JjY/AT4BFx4BFwEWFxYUBwYPAQYmJy4BJyY2PwE+AScmIg8BBhQXHgEXHgEVFgYPAQ4BJy4BJyYnJjQ3NjcwNjE3Njc2MhcWFwKNLRYWFhYsAYYtODh1ODgsLRYWFhYtSg8nAQEJCQMEBhsqAioqeCuGKioFCwUGBwELDSoIGAkLFQkBGi0WFhYWLUoPJwEBCQkDBAYbKgIqKngrhioqBQsFBgcBCw0qCBgJCxUJLRYWFhYsAYYtODh1ODgsAg0tODh0ODgsAYYtFhYWFi0sODh1ODgtSg8PFRs1GggSBxoqdysrKoYrdyoGCAMEDgcQIAwqCAIGCBEKARosODh1ODgtSg8PFRs1GggSBxoqdysrKoYrdyoGCAMEDgcQIAwqCAIGCBEKLTg4dDg4LAGGLRYWFhYtAAAAAQAA/8AFAANAADcAAAEWFx4BFxYVFAcOAQcGIyEiJy4BJyY1NDc+ATc2NzwBNTQ3PgE3NjMyFx4BFxYXPgEzMhYVFAYHBDMsJSY3DxAUFEYuLzX9IDw0NU4WFw4PMyMjKhkZVzo7QiwqKUcdHhQXNh5PcQcGAbsJFxdCKiouNS8uRhQUFxZONTQ8LysrRxobDwQIBEI7OlcZGQwLKh4dJA8RcU8SIxAAAwAA/8ADgANAABMAHwA0AAABHgEVERQGIyEiJjURNDYzITIWFwMyNjU0JiMiBhUUFhM0Ji8BLgEjISIGHQEUFjMhMjY9AQNkDQ84KP1AKDg4KAIYFCMN/DVLSzU1S0v1BAMHAwkF/jcKDg4KAdAKDgJ8DSMU/egoODgoAsAoOA8N/RxLNTVLSzU1SwJhBQkDBwMEDgrQCg4OCskAAwAA//gDgAMIAA8AHwAvAAATIiY9ATQ2MyEyFh0BFAYjASImPQE0NjMhMhYdARQGIwEiJj0BNDYzITIWHQEUBiMgDRMTDQNADRMTDfzADRMTDQNADRMTDfzADRMTDQNADRMTDQJ4Ew1QDRMTDVANE/7AEw1QDRMTDVANE/7AEw1QDRMTDVANEwAAAAAFAAD/gAQAA4AABwAPABcALQAxAAABLwE/AR8BBwUvAT8BHwEHAR8BDwEvATcTFhQHAQ4BIyImLwEmNDcBPgEzMhYXAzcnBwHAIEBAICBAQP7ANWtrNTVrawKLNWtrNTVra8ITE/0qCRgMDRcKqRMTAtYJGAwNFwp1rWatAsBAICBAQCAgwGs1NWtrNTX+lWs1NWtrNTUB7xM1E/0qCgkJCqkTNRMC1goJCQr+fK1mrQAAAAABACIAugJdAgAADAAAEyEyFgcBBiInASY2Mz8CAhsUE/7/DCEL/v4TFRsCADET/v4LCwECEzEAAAEAIgDAAl4CBgALAAAlISImNwE2MhcBFgYCQf3+GxUTAQILIgsBAhMVwDETAQILC/7+EzEAAAAAAQA6AGIBgAKeAAwAAAERFAYnASY0NwE2FhUBgDET/v4LCwECEzECgf3+GxUTAQILIgsBAhMVGwABAAAAYgFGAp4ADAAANxE0NhcBFhQHAQYmNQAxEwECCwv+/hMxfwICGxUT/v4LIgv+/hMVGwAAAAEAAP+AAnkDgAAZAAABMhYHAQ4BIyImNxMjIiY3Ez4BMyEyFgcDMwJQHBsO/qAGFwwXHQVc7RYcAkADGxIBIBgcBlXnAkAwGP2gCw0kFwGFIRUB4BIYJhb+/AAAAwAA/4ACwAOAABIANABKAAAXNSEVFAYPAQ4BKwEiJi8BLgE1AzQ3PgE3NjMyFx4BFxYVFAYHDgEHHAExITA0NS4BJy4BNSUyNjU0JiMiBw4BBwYVFBYzMjY1NDbAAUAGBSIJHBB8EBwJIgUGwBoaXkBATUlAQV8cHC4pGUEP/sAPQRkpLgFgDRMTDS4pKT0REhMNDRNeDU1NCRIIMw0QEA0zCBIJAi1GP0BhHR0bHGBAQElDdi8caTEBAQEBMWkcL3ZDoBMNDRMSET0pKS4NExMNQl4AAAAAAgAA/8ADgANAAA8AMwAAATIWFREUBiMhIiY1ETQ2MwE1NCYrATU0JisBIgYdASMiBh0BFBY7ARUUFjsBMjY9ATMyNgMgKDg4KP1AKDg4KAKADgq4DgpwCg64Cg4OCrgOCnAKDrgKDgNAOCj9QCg4OCgCwCg4/ghwCg64Cg4OCrgOCnAKDrgKDg4KuA4AAAAAAgAA/8AEAANAACAAQQAAATIWFREUBiMhIiY1ETQ3PgE3NjsBMhYdARQGKwEiBh0BITIWFREUBiMhIiY1ETQ3PgE3NjsBMhYdARQGKwEiBh0BA6AoODgo/wAoOBkZVzo7QhAUHBwUEDVL/mAoODgo/wAoOBkZVzo7QhAUHBwUEDVLAYA4KP8AKDg4KAHgQjs6VxkZHBRgFBxLNYA4KP8AKDg4KAHgQjs6VxkZHBRgFBxLNYAAAgAA/8AEAANAACAAQQAAATIWFREUBw4BBwYrASImPQE0NjsBMjY9ASMiJjURNDYzITIWFREUBw4BBwYrASImPQE0NjsBMjY9ASMiJjURNDYzA6AoOBkZVzo7QhAUHBwUEDVLoCg4OCj+wCg4GRlXOjtCEBQcHBQQNUugKDg4KANAOCj+IEI7OlcZGRwUYBQcSzWAOCgBACg4OCj+IEI7OlcZGRwUYBQcSzWAOCgBACg4AAAABwAA/4AEAAOAAAsAFwAjAC8AOwBHAFMAAAEUBiMiJjU0NjMyFgMyFhUUBiMiJjU0NgEyFhUUBiMiJjU0NgUUBiMiJjU0NjMyFhcyFhUUBiMiJjU0NiEyFhUUBiMiJjU0NgEyFhUUBiMiJjU0NgJgOCgoODgoKDhgKDg4KCg4OAHIKDg4KCg4OP1IOCgoODgoKDgaKDg4KCg4OAJ0KDg4KCg4OP3cKDg4KCg4OAMgKDg4KCg4OPz4OCgoODgoKDgBoDgoKDg4KCg4YCg4OCgoODjuOCgoODgoKDg4KCg4OCgoOAJMOCgoODgoKDgAAAAAAwAO/44D8gNyACUATABcAAAlFhQPAQYHBiInJicmJyY0NzY/ATYyHwEWFA8BBhQXFjI/ATYyFwMnJjQ/ATY3NjIXFhcWFxYUBwYPAQYiLwEmND8BNjQnJiIPAQYiJwEGIicBJjQ/ATYyFwEWFAcCYAcHWS04OHU4OCwtFhYWFi1ZBxQHTwcHWSoqKngqWQcUByJPBwdZLTg4dTg4LC0WFhYWLVkHFAdPBwdZKioqeCpZBxQHAdYOKA78jQ4OLQ4oDgNzDg5UBxQHWS0WFhYWLSw4OHU4OC1ZBwdPBxQHWSp4KioqWQcHAbpPBxQHWS0WFhYWLSw4OHU4OC1ZBwdPBxQHWSp4KioqWQcH/TEODgNzDigOLQ4O/I0OKA4AAAAAAgAQ/5AD8ANwABsAMQAABSInLgEnJjU0Nz4BNzYzMhceARcWFRQHDgEHBgkBFjI/ATY0LwE3NjQvASYiBwEGFBcCAGdaWocnJycnh1paZ2daWocnJycnh1pa/rUBDw4oDiIODsvLDg4iDigO/vEODnAnJ4daWmdnWlqHJycnJ4daWmdnWlqHJycBzv7xDg4iDigOy8sOKA4iDg7+8Q4oDgAAAAACABD/kAPwA3AAGwAxAAABMhceARcWFRQHDgEHBiMiJy4BJyY1NDc+ATc2CQEmIg8BBhQfAQcGFB8BFjI3ATY0JwIAZ1pahycnJyeHWlpnZ1pahycnJyeHWloBS/7xDigOIg4Oy8sODiIOKA4BDw4OA3AnJ4daWmdnWlqHJycnJ4daWmdnWlqHJyf+MgEPDg4iDigOy8sOKA4iDg4BDw4oDgAAAAIAEP+QA/ADcAAbADEAABM0Nz4BNzYzMhceARcWFRQHDgEHBiMiJy4BJyYJAQYUHwEWMj8BFxYyPwE2NCcBJiIHECcnh1paZ2daWocnJycnh1paZ2daWocnJwHO/vEODiIOKA7Lyw4oDiIODv7xDigOAYBnWlqHJycnJ4daWmdnWlqHJycnJ4daWgFL/vEOKA4iDg7Lyw4OIg4oDgEPDg4AAAAAAgAQ/5AD8ANwABsAMQAAARQHDgEHBiMiJy4BJyY1NDc+ATc2MzIXHgEXFgkBNjQvASYiDwEnJiIPAQYUFwEWMjcD8Ccnh1paZ2daWocnJycnh1paZ2daWocnJ/4yAQ8ODiIOKA7Lyw4oDiIODgEPDigOAYBnWlqHJycnJ4daWmdnWlqHJycnJ4daWv61AQ8OKA4iDg7Lyw4OIg4oDv7xDg4AAAACAAD/gAOAA4AAMAA+AAABMhYVERQGIyEiJjURNDY7ATU0Nz4BNzYzMhceARcWHQEUBisBIiY9ATQmBw4BHQEhATU0JiMiBh0BFBYzMjYDICg4OCj9QCg4OCgwGBdTNzc/Pzg3UxgYHBRAFBxVPDxTAfD+8C8hIS8vISEvAYA4KP7AKDg4KAFAKDjNPzg4UxgZGBdTODc/IBQcHBQgPFUBAVU8zv7QYCEvLyFgIS8vAAMAEADwA/ACEAALABcAIwAAARQGIyImNTQ2MzIWNzIWFRQGIyImNTQ2ITIWFRQGIyImNTQ2ApBUPDxUVDw8VNA8VFQ8PFRU/Xw8VFQ8PFRUAYA8VFQ8PFRUVFQ8PFRUPDxUVDw8VFQ8PFQAAAMAMP+QAVADcAALABcAIwAAEzIWFRQGIyImNTQ2JzQ2MzIWFRQGIyImETQ2MzIWFRQGIyImwDxUVDw8VFRUVDw8VFQ8PFRUPDxUVDw8VAIQVDw8VFQ8PFTQPFRUPDxUVP18PFRUPDxUVAAAAAIAEP+QA/ADcAAbACcAAAEyFx4BFxYVFAcOAQcGIyInLgEnJjU0Nz4BNzYBNjQnJSYGFREUFjcCAGdaWocnJycnh1paZ2daWocnJycnh1paAU4ZGf6gFzAwFwNwJyeHWlpnZ1pahycnJyeHWlpnZ1pahycn/eAOOA7WDRsc/mAcGw0AAAIAAP/AA4ADQAAPAB8AAAEyFhURFAYjISImNRE0NjMTITI2PQE0JiMhIgYdARQWAyAoODgo/UAoODgoWAIQCg4OCv3wCg4OA0A4KP1AKDg4KALAKDj98A4KcAoODgpwCg4AAAACAAD/wAOAA0AADwAlAAAFISImNRE0NjMhMhYVERQGJQE2NC8BJiIHAScmIg8BBhQfARYyNwMg/UAoODgoAsAoODj+PwFwCQkuCRsJ/tSMCRsJLgkJ0AoaCkA4KALAKDg4KP1AKDjEAXAJGwkuCQn+1IwJCS4JGwnQCQkAAgAA/8ADgANAAA8AGwAAAREUBiMhIiY1ETQ2MyEyFgEXFjI/ATYmIyEiBgOAOCj9QCg4OCgCwCg4/Tn2BxQH9gsMEP4UEAwC4P1AKDg4KALAKDg4/r/2Bwf2Cx4eAAAAAgAA/8ADgANAAA8AHAAANxE0NjMhMhYVERQGIyEiJgEnJiIPAQYWMyEyNicAOCgCwCg4OCj9QCg4Asf2BxQH9gsMEAHsEAwLIALAKDg4KP1AKDg4AUH2Bwf2Cx4eCwAAAgAA/8ADgANAAA8AHAAAEyEyFhURFAYjISImNRE0NgE3NjQvASYGFREUFjdgAsAoODgo/UAoODgBQfYHB/YLHh4LA0A4KP1AKDg4KALAKDj9OfYHFAf2CwwQ/hQQDAsAAwAT/5MD7QNtAAsAMwBPAAABMhYVFAYjIiY1NDYFFhQPARcWBi8BBwYiLwEHBiY/AScmND8BJyY2HwE3NjIfATc2Fg8BAzY3NjQnJicmJyYiBwYHBgcGFBcWFxYXFjI3NgIAT3FxT09xcQI8ExS9QwceFcleCisJX8kUHgdDvhMTvkMHHhTJXwoqCl/JFB4HQ3olExMTEyUlMC9iLzAlJRMTExMlJTAvYi8wAkBxT09xcU9PcaEKKgpfyRQeB0O+ExO+QwceFMlfCioKX8kUHgdDvhMTvkMHHhXI/s0lMC9iLzAlJRMTExMlJTAvYi8wJSUTExMTAAABADb/gAPEA4AALAAABSInLgEnJjU0Nz4BNzYzMhYXHgEHBgcOAQcGFRQXHgEXFjc2FgcGBw4BBwYjAjZqXV2LKCkpKItdXWoYLxcQBg8vJSY0Dg8oKIRWVl0QEgskLC1lODg8gCgpi11dampdXosoKAQFAyEIGyUmWjM0Nl5QUG0YGBEDHA0tIyMxDQ0AAAACAAD/kwQAA4AASgBZAAABDgErARUUBgcXFhQHBiIvAQ4BIxE0JisBIgYVESImJwcGIicmND8BLgE9ASMiJicmNjsBNScmNDc2Mh8BITc2MhcWFA8BFTMyFgcBMhceARcWFSE0Nz4BNzYEAAEmGm8ODXgTExI2Em4lXDQOCjAKDjRcJW4SNhITE3gNDm8aJgEBJhtwXRMTEjYSbgHKbhI2EhMTXXAbJgH+Ai4pKT0REv5AEhE9KSkBPhokICE9HHkSNhITE20eIgHoCg4OCv4YIh5tExMSNhJ5HD0hICQaGyd1XhI2EhMTbW0TExI2El51JxsCQhIRPSkpLi4pKT0REgAAAAIAAP/AA4ADQAAPABwAAAUhIiY1ETQ2MyEyFhURFAYBBwYUHwEWNjURNCYHAyD9QCg4OCgCwCg4OP6/9gcH9gseHgtAOCgCwCg4OCj9QCg4Asf2BxQH9gsMEAHsEAwLAAUAAABABQACwAAKABQAXgBoAIIAAAEXIzc+ATEzMBYXATIWFREUBiMhEQU1NCYrATU0JisBIgYdASMiBh0BFBY7AQ4BBy4BJy4BDwIOARceARcOAQcOAR8BHgE3PgE3HgEXFjY/ATYmJy4BJz4BNzMyNjUlNDYzIREhIiY1NwYWOwEyNj8BMxceATsBMjYnAy4BKwEiBgcBMBZMFgULAQoFA6AUHBwU/dACAA4KgA4KIAoOgAoODgrlCh4UChIHBhIIDw0JBAYJFQwMGg4JBQUQBRQIEyQQESMTCRMFEAUFCA0bDB8sChcKDvtgHBQCMP3QFBx2BA4NLQgNAhN4EwINCC4MDgRzAg0HQQgNAgGoS0sSMDASARgcFP3gFBwCgPAgCg4gCg4OCiAOCiAKDhUsFQoVCggEBQgIBRUIDRoNCRIJBRMIHAkFBQwZDQ0ZDAUFCRwIEwUIEwkiRyMOCsAUHP2AHBRwDBQKB0BABwoUDAFSBwkJBwABAED/wAOAA0AAKgAAARUUBisBERQGKwEiJjURIxEUBisBIiY9ASMiJy4BJyY1NDc+ATc2MyEyFgOAEw1gEw1ADRNAEw1ADRNAQjs6VxkZGRlXOjtCAeANEwMgQA0T/SANExMNAuD9IA0TEw3gGRlXOjtCQjs6VxkZEwAAAQAA/4ADgAOAADYAAAEyFhUUBiMiJjU4ATE0NjcnDgEjIiY1NDYzMhYXNy4BNTQ2MzIWFRQGIyImJwceARUUBgcXPgECwFBwcFBQcAIDzRk9IlBwcFAiPRnNAwJwUFBwcFAiPRnNAwICA80ZPQEAcFBQcHBQCxUKgBQWcFBQcBYUgAoVC1BwcFBQcBYUgAoVCwsVCoAUFgACAAD/gAOAA4AAHQAoAAABMhYdARQGIyEiJj0BNDY7ATc+ATsBOAExMhYfATMBAyEDDgEjISImJwNgDRMTDfzADRMTDfATBhYO5Q4XBhPw/QoqAwAqAzcm/hQmNwMDQBMNQA0TEw1ADRMlDA8PDCX8mgKm/VomNDQmAAAAAwAAAAAEgAMAAB0AOQBQAAABMhceARcWFRQHDgEHBiMhIicuAScmNTQ3PgE3NjMBFBceARcWMzI3PgE3NjU0Jy4BJyYjIgcOAQcGATI3PgE3NjU0Jy4BJyYrARYXFhQHBgcDAFBFRmkeHh4eaUZFUP6AUEVGaR4eHh5pRkVQ/wAUFEYuLzU1Ly5GFBQUFEYuLzU1Ly5GFBQCgDUvLkYUFBQURi4vNWIxGRgYGTEDAB4eaUZFUFBFRmkeHh4eaUZFUFBFRmkeHv6ANS8uRhQUFBRGLi81NS8uRhQUFBRGLi/+yxQURi4vNTUvLkYUFDdCQopCQjcAAAACAAAAAASAAwAAHQA5AAABMhceARcWFRQHDgEHBiMhIicuAScmNTQ3PgE3NjMBMjc+ATc2NTQnLgEnJiMiBw4BBwYVFBceARcWAwBPRkZpHh4eHmlGRVD+gE9GRmkeHh4eaUZFUAGANS8uRhQUFBRGLi81NS8uRhQUFBRGLi8DAB4eaUZFUE9GRmkeHh4eaUZFUE9GRmkeHv2AFBRGLi81NS8uRhQUFBRGLi81NS8uRhQUAAADAAAAQAUAAsAABwAhACUAAAEhESE1MzUjEzIWHQEzMhYVERQGKwEVFAYjISImNRE0NjMFESERBED8QAPAQEAgKDgQFBwcFBA4KPwAKDg4KAOg/MACQP6AgIABADgoIBwU/uAUHCAoODgoAcAoOMD/AAEAAAMAAABABQACwAAHACEAJQAAASERITUzNSMTMhYdATMyFhURFAYrARUUBiMhIiY1ETQ2MwURIREEQPxAA8BAQCAoOBAUHBwUEDgo/AAoODgoAuD9gAJA/oCAgAEAOCggHBT+4BQcICg4OCgBwCg4wP8AAQAAAwAAAEAFAALAAAcAIQAlAAABIREhNTM1IxMyFh0BMzIWFREUBisBFRQGIyEiJjURNDYzBREhEQRA/EADwEBAICg4EBQcHBQQOCj8ACg4OCgCIP5AAkD+gICAAQA4KCAcFP7gFBwgKDg4KAHAKDjA/wABAAADAAAAQAUAAsAABwAhACUAAAEhESE1MzUjEzIWHQEzMhYVERQGKwEVFAYjISImNRE0NjMFESERBED8QAPAQEAgKDgQFBwcFBA4KPwAKDg4KAFg/wACQP6AgIABADgoIBwU/uAUHCAoODgoAcAoOMD/AAEAAAIAAABABQACwAAHACEAAAEhESE1MzUjEzIWHQEzMhYVERQGKwEVFAYjISImNRE0NjMEQPxAA8BAQCAoOBAUHBwUEDgo/AAoODgoAkD+gICAAQA4KCAcFP7gFBwgKDg4KAHAKDgAAAAAAwAQ/5AD8ANwABsAKwA7AAABMhceARcWFRQHDgEHBiMiJy4BJyY1NDc+ATc2ExE0JisBIgYVERQWOwEyNjcRNCYrASIGFREUFjsBMjYCAGdaWocnJycnh1paZ2daWocnJycnh1paRxMNYA0TEw1gDRPgEw1gDRMTDWANEwNwJyeHWlpnZ1pahycnJyeHWlpnZ1pahycn/XABQA0TEw3+wA0TEw0BQA0TEw3+wA0TEwACABD/kAPwA3AAGwArAAABMhceARcWFRQHDgEHBiMiJy4BJyY1NDc+ATc2ARE0JiMhIgYVERQWMyEyNgIAZ1pahycnJyeHWlpnZ1pahycnJyeHWloBJxMN/sANExMNAUANEwNwJyeHWlpnZ1pahycnJyeHWlpnZ1pahycn/XABQA0TEw3+wA0TEwAAAAEAEP+QA/ADcABEAAABMhceARcWFRQHDgEHBiMiJy4BJyYnLgE/ATYyFx4BMzI3PgE3Njc2Jy4BJyYHDgEHFxYGIyEiJjURNDYfATY3PgE3NjMB/2daW4cnJycnh1paZzAtLlQmJiEIAQhPBxMHLnE+Rj0+WhoaAQEbG10+PkVAdC5TFxkg/vQUHDsXRyInJ1YvLzIDcCcnh1paZ2daWocnJwkJIRcYHgcUCE8HBigrGxpbPTxESD4+XBoaAQEuLFMXOxwUAQwgGRdHHxoZJAkKAAAABQAA/4ADgAOAAAkAFwAlADMAUQAAFxEhERQGIyEiJgERFBYzMjY1ETQmIyIGBxEUFjMyNjURNCYjIgYHERQWMzI2NRE0JiMiBgEyFh0BFAYjISImPQE0NjsBNz4BOwE4ATEyFh8BM0ADADgo/cAoOAIgEw0NExMNDRPAEw0NExMNDRPAEw0NExMNDRMCgA0TEw38wA0TEw3wEwYWDuUOFwYT8CACoP1gKDg4Aij+QA0TEw0BwA0TEw3+QA0TEw0BwA0TEw3+QA0TEw0BwA0TEwFTEw1ADRMTDUANEyUMDw8MJQAAAgAQ/5AD8ANwACsAWAAAAS4BIyIHDgEHBgcOASsBIiY3Njc+ATc2MzIXHgEXFhc3NhYVERQGIyEiJjcFITIWDwEeATMyNz4BNzY3PgE7ATIWBwYHDgEHBiMiJy4BJyYnBwYmNRE0NjMC5S53QDo1NVYfHw4CDQhzCw4CECwsgVJRWzIvL1cnJyJHFzscFP70IBkX/a4BDCAZF1Mud0A6NTVWHx8OAg0IcwsOAhAsLIFSUVsyLy9XJyciRxc7HBQCdSwvExNDLy44CAoRC1dJSmwfHwkKJBkZIEcXGSD+9BQcOxfyOxdTLC8TE0MvLjgIChELV0lKbB8fCQokGRkgRxcZIAEMFBwAAQAQ/5AD8ANwAEQAAAEyFx4BFxYXNzYWFREUBiMhIiY/AS4BJyYHDgEHBhcWFx4BFxYzMjY3NjIfARYGBwYHDgEHBiMiJy4BJyY1NDc+ATc2MwIBMi8vVicnIkcXOxwU/vQgGRdTLnRART4+XRsbAQEaGlo+PUY+cS4HEwdPCAEIISYmVC4tMGdaWocnJycnh1taZwNwCgkkGRofRxcZIP70FBw7F1MsLgEBGhpcPj5IRDw9WxobKygGB08IFAceGBchCQknJ4daWmdnWlqHJycAAAABAAD/wAOAA0AASAAAJRUUBiM4ATEjIiY/AScHFxYGKwEiJjU4ATE1NDYfATcnBwYmPQE0NjM4ATEzMhYPARc3JyY2OwEyFhU4ATEVFAYvAQcXNzYWFQOAHBTgIBkXSNbWSBcZIOAUHDsXSNfXSBc7HBTgIBkXSNbWSBcZIOAUHDsXSNfXSBc70OAUHDsXSNfXSBc7HBTgIBkXSNbXSRcZIOAUHDsXSNfXSBc7HBTgIBkXSNbXSRcZIAAAAAIAAP+ABAADgAAeADoAAAEyFhURFAYjISImNRE0NjMhMhYdARQGIyERITU0NjMTMhYVERQGLwEBDgEjIiYvAS4BNTQ2NwEnJjYzA2ANEzgo/UAoODgoAUANExMN/uACgBMNsBQcOxdH/hgGEgoKEQctBwcHBwHnRxcZIAEAEw3/ACg4OCgCwCg4Ew1ADRP9gOANEwKAHBT/ACAYFkf+GQcHBwctBxEKChIGAehHFzsAAgAA/8AFAANAADcATQAAARYXHgEXFhUUBw4BBwYjISInLgEnJjU0Nz4BNzY3PAE1NDc+ATc2MzIXHgEXFhc+ATMyFhUUBgcFNiYrATU0JisBIgYdASMiBh8BFjI3BDMsJSY3DxAUFEYuLzX9IDw0NU4WFw4PMyMjKhkZVzo7QiwqKUcdHhQXNh5PcQcG/vYQERWDEw1gDRODFREQ0goaCgG7CRcXQioqLjUvLkYUFBcWTjU0PC8rK0caGw8ECARCOzpXGRkMCyoeHSQPEXFPEiMQshAn4A0TEw3gJxDSCgoAAAAAAgAA/8AFAANAADcATgAAARYXHgEXFhUUBw4BBwYjISInLgEnJjU0Nz4BNzY3PAE1NDc+ATc2MzIXHgEXFhc+ATMyFhUUBgcFMjYvASYiDwEGFjsBFRQWOwEyNj0BMwQzLCUmNw8QFBRGLi81/SA8NDVOFhcODzMjIyoZGVc6O0IsKilHHR4UFzYeT3EHBv7gFREQ0goaCtIQERWDEw1gDRODAbsJFxdCKiouNS8uRhQUFxZONTQ8LysrRxobDwQIBEI7OlcZGQwLKh4dJA8RcU8SIxB7JxDSCgrSECfgDRMTDeAAAgAA/8AEAANAAA8ANAAAATIWFREUBiMhIiY1ETQ2MwEnNzY0LwEmIg8BJyYiDwEGFB8BBwYUHwEWMj8BFxYyPwE2NCcDoCg4OCj8wCg4OCgCmYaGBwdRBxUHhYUHFQdRBweGhgcHUQcVB4WFBxUHUQcHA0A4KP1AKDg4KALAKDj9u4WFBxUHUQcHhoYHB1EHFQeFhQcVB1EHB4aGBwdRBxUHAAACABMAAAUAAwAAFAA5AAABMhYVERQGIyEiJicBJjQ3AT4BMyEDJzc2NC8BJiIPAScmIg8BBhQfAQcGFB8BFjI/ARcWMj8BNjQnBIA1S0s1/RsaLxL+0xMTAS0RLxoC5ql8fAkJLgkbCXx8CRsJLgkJfX0JCS4JGwl8fAkbCS4JCQMASzX+ADVLExIBLhI2EgEtEhT+BHx8CRsJLgkJfX0JCS4JGwl8fAkbCS4JCXx8CQkuCRsJAAAAAwAA/4ADAAOAABEAJwAyAAABFBYzIREUBiMhIiY1ETQ2MyETNiYrATU0JisBIgYdASMiBh8BFjI3AR4BHQEhETMyFhcBwBwUARAcFP1gFBwcFAGQmQ8QFoITDUANE4IWEA/BChwKAVoHB/8ADAoRBwJwFBz9cBQcHBQDoBQc/UkPKKANExMNoCgPvwoKAqQHEQoMAQAHBwADAAD/gAR2A4AACgAaADYAAAEVIREzMhYfAR4BARYUDwEGJj0BIzUzNTQ2FwUUFjMhERQGIyEiJjURNDYzIREUFjMhESEiBhUDAP8ADAoRB8QHBwF2Cgq/ECeAgCcQ/ckTDQFgHBT9YBQcHBQBkBwUARD+oA0TAowMAQAHB8QHEf6CChwKwQ8QFoKAghYQD/kNE/7wFBwcFAOgFBz+8BQc/wATDQAAAAADAAD/gAQAA4AACQAUADcAABMzFSMiJj0BNDYBHgEdASERMzIWFwMUFjMhERQGIyEiJjURIRUUFj8BNjQvASYGHQEhETQ2MyERIODgDRMTA98HB/8ADAoRB24cFAEQHBT9YBQcAQAnEL8KCr8PKP8AHBQBkAFAgBMNQA0TAW4HEQoMAQAHB/7+FBz9cBQcHBQBEIIWEA/BChwKwQ8QFoICEBQc/vAAAAADAAD/gAMAA4AAEQAoADMAAAEUFjMhERQGIyEiJjURNDYzIRMyNi8BJiIPAQYWOwEVFBY7ATI2PQEzEx4BHQEhETMyFhcBwBwUARAcFP1gFBwcFAGQghYQD8EKHArBDxAWghMNQA0TgrAHB/8ADAoRBwJwFBz9cBQcHBQDoBQc/UAoD78KCr8PKKANExMNoAHuBxEKDAEABwcAAAACABP/gAQdA4AAIQAoAAABHgEPARMWBiMiJiclBQ4BIyImNxMnJjY3JRM+ATMyFhcTEzclJxEXAwP5Jxkc1DIFKRwHDwf++v76Bw8IHCgFMtQcGScBJYMIIBERIAmCMqX+6Xz5MAIpBksczv7dHywEA4qJBAQsHwEjzhxLBisBCBISEhL++P7foCn8/YWCARQAAAAAAgAAAA4D9wLyABEANQAAATYWFREUBi8BIyImNRE0NjsBBRcWFA8BBiIvAQcGIi8BJjQ/AScmND8BNjIfATc2Mh8BFhQHAa4XOzsXsswUHBwUzAKfXAkJLgoaCltbChoKLgkJXFwJCS4KGgpbWwoaCi4JCQLyFhgg/WAgGBayHBQBIBQcwFsKGgouCQlcXAkJLgoaCltbChoKLgkJXFwJCS4KGgoAAAAABAAJ/4kD9wN3ABYALABCAFgAAAEyFh0BFAYvAQcGIi8BJjQ/AScmNjsBNyImPQE0Nh8BNzYyHwEWFA8BFxYGIwMXFhQPAQYiLwEHBiY9ATQ2OwEyFgcBNhYdARQGKwEiJj8BJyY0PwE2Mh8BAZAUHDsXPscJGwkzCQnHQhcZIODgFBw7Fz7HCRsJMwkJx0IXGSAgxwkJMwkbCcc+FzscFOAgGRf9/Bc7HBTgIBkXQscJCTMJGwnHAUAcFOAgGRdCxwkJMwkbCcc+FzuAHBTgIBkXQscJCTMJGwnHPhc7/vDHCRsJMwkJx0IXGSDgFBw7FwIEFhgg4BQcOxc+xwkaCjMJCccAAAAABAAA/5YD9wOAABUANABAAEwAACUWFA8BBiIvAS4BNycjAzcFFRc2FhcnIgYHJyY2Nz4BFx4BDwEfATc2FhcWBgcOAQcnLgEjBwYWFwcGIicmNDcBAzI2NTQmIyIGFRQWA+oWFmkWPhbqIg4U1XzAgAEA1SpeI2kMGQykASgrOJJHDggKlReHlQobAxImNxQsGCceTSvPCAYM+CVqJiUlATHWFBwcFBQcHGkWPhZpFhbqI14q1QEAgMB81RQOImsDA6Q5bCs3JhIDGwqViBaVCggNR5M4Ex0LJx4gpCBAHfglJSZqJQEx/kUcFBQcHBQUHAAAAAMAAP+AA4ADgAAKACMAQQAAFwMhAw4BIyEiJicTBhY7ARUUFjsBMjY9ATMyNi8BLgEjIgYHATIWHQEUBiMhIiY9ATQ2OwE3PgE7ATgBMTIWHwEzaioDACoDNyb+FCY3A40PEBVzEw1ADRNzFREQsgULBwcLBQG3DRMTDfzADRMTDfATBhYO5Q4XBhPwJgKm/VomNDQmAWAQKuANExMN4CoQvAUFBQUBShMNQA0TEw1ADRMlDA8PDCUAAAAAAwAA/4ADgAOAAAkAIgBAAAAXESERFAYjISImEwYWOwEVFBY7ATI2PQEzMjYvAS4BIyIGBwEyFh0BFAYjISImPQE0NjsBNz4BOwE4ATEyFh8BM0ADADgo/cAoOLcPEBVzEw1ADRNzFREQsgULBwcLBQG3DRMTDfzADRMTDfATBhYO5Q4XBhPwIAKg/WAoODgBghAq4A0TEw3gKhC8BQUFBQFKEw1ADRMTDUANEyUMDw8MJQAAAQAAAAEAAII1aM1fDzz1AAsEAAAAAADcXxJIAAAAANxfEkgAAP+ABQADgAAAAAgAAgAAAAAAAAABAAADgP+AAAAFAAAAAAAFAAABAAAAAAAAAAAAAAAAAAAAfAQAAAAAAAAAAAAAAAAAAAAEAAAABAAAEgSAADwEAAAPAsAAEgQAAAAEAAAABAAAEAQAACYEgAAABAAAAAOAAAACAAAAAwAAAASAAAADAAAAA4AAgAQAAAAEAAAXA4AAAAOAAAADgAAABAAAAAQAAAADgACAA4AAAAKAAEUCgABFBAAAEAQAABAEAAAQBAAAEAQAABAEAAAQBAAAEAOAAA4DgAAAA4AAGQOAABkDgAAAA4AAAAOAAAADgAAABAAAEASAAAAFAAAABIAADQOAABkDgAAZBIAAPAMAAAAEAAAAA4AAAASAAAAEAAAWBQAAAAOAAAADgAAABAAAAAKAACICgAAiAYAAOgGAAAACgAAAAsAAAAOAAAAEAAAABAAAAAQAAAAEAAAOBAAAEAQAABAEAAAQBAAAEAOAAAAEAAAQAYAAMAQAABADgAAAA4AAAAOAAAADgAAAA4AAAAQAABMEAAA2BAAAAAOAAAAFAAAAA4AAQAOAAAADgAAABIAAAASAAAAFAAAABQAAAAUAAAAFAAAABQAAAAQAABAEAAAQBAAAEAOAAAAEAAAQBAAAEAOAAAAEAAAABQAAAAUAAAAEAAAABQAAEwMAAAAEgAAABAAAAAMAAAAEMAATBAAAAAQAAAkEAAAAA4AAAAOAAAAAAAAAAAoAFAAeAIoAygD8ASYBYAH4AnwC8gOEBAIEaASmBMYFCgW+BdQGAAY8BmgGggayBs4G/Ac4B2QHlgfAB+wIRgiKCO4JQAm+CiIKhgq6Cu4LIgtWC8QMMAxkDIAM1g1mDg4OUA58DqYOyA8KD3IPuBAOEMwRIBFuEbQSDhIqEkYSYhJ+EqwTGBNgE7oUFBSMFRwVbhXAFhIWZBa8FvIXKBdqF5wX2hgKGDoYahjmGS4ZsBngGpwa2hsmG2Qb4Bw6HHQcrhzoHSIdVh2uHfQeXh7QH1QfviAcIHQg5iFYIaoiBiJSIqYi+iNII5Ij5iRqJOQlQiWcAAAAAQAAAHwAgwAHAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAwAAAABAAAAAAACAAcAjQABAAAAAAADAAwARQABAAAAAAAEAAwAogABAAAAAAAFAAsAJAABAAAAAAAGAAwAaQABAAAAAAAKABoAxgADAAEECQABABgADAADAAEECQACAA4AlAADAAEECQADABgAUQADAAEECQAEABgArgADAAEECQAFABYALwADAAEECQAGABgAdQADAAEECQAKADQA4HNjLWljb25zLTkwMABzAGMALQBpAGMAbwBuAHMALQA5ADAAMFZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMHNjLWljb25zLTkwMABzAGMALQBpAGMAbwBuAHMALQA5ADAAMHNjLWljb25zLTkwMABzAGMALQBpAGMAbwBuAHMALQA5ADAAMFJlZ3VsYXIAUgBlAGcAdQBsAGEAcnNjLWljb25zLTkwMABzAGMALQBpAGMAbwBuAHMALQA5ADAAMEZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=\") format(\"woff\");\n}\n</style>\n<style id=\"style-font-emoji\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/font-emoji.css\n\n\tCopyright © 2023–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n@font-face {\n\t/*\n\t\tEmoji font-family to standardize appearance across platforms.\n\n\t\tSEE:\n\t\t\t* https://www.client9.com/css-color-emoji-stack/\n\t\t\t* https://nolanlawson.com/2022/04/08/the-struggle-of-using-native-emoji-on-the-web/\n\t*/\n\tfont-family: \"color-emoji\";\n\tsrc:\n\t\t/* Firefox (via Twitter) */\n\t\tlocal(\"Twemoji Mozilla\"),\n\t\t/* iOS and macOS */\n\t\tlocal(\"Apple Color Emoji\"),\n\t\t/* Windows ≥10 */\n\t\tlocal(\"Segoe UI Emoji\"),\n\t\t/* Windows ≤8 */\n\t\tlocal(\"Segoe UI Symbol\"),\n\t\t/* ChromeOS & Android */\n\t\tlocal(\"Noto Color Emoji\"),\n\t\t/* Adobe */\n\t\tlocal(\"EmojiOne Color\"),\n\t\t/* Android */\n\t\tlocal(\"Android Emoji\");\n}\n</style>\n<style id=\"style-core\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/core.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Story data styling. */\n#store-area,\ntw-storydata {\n\tdisplay: none !important;\n\tz-index: 0;\n}\n\n/* Scrollbar styles. */\n*::-webkit-scrollbar {\n\t/* background-color: #111; */\n\t/* For horizontal scrollbars. */\n\theight: 8px; /* Maybe: `0.5rem` */\n\t/* For vertical scrollbars. */\n\twidth: 8px; /* Maybe: `0.5rem` */\n}\n*::-webkit-scrollbar-corner,\n*::-webkit-scrollbar-track {\n\tbackground-color: #111;\n}\n*::-webkit-scrollbar-thumb {\n\tbackground-color: #333;\n\tborder: 1px solid #111;\n}\n* {\n\t/* -ms-overflow-style: auto; */\n\tscrollbar-color: #333 #111;\n\tscrollbar-width: thin;\n}\n\n/* Fullscreen styles. */\n*:-webkit-full-screen {\n\t/* Cause Blink/WebKit to behave like Gecko. */\n\theight: 100%;\n\twidth: 100%;\n}\n*:-ms-fullscreen {\n\t/* Cause Blink/WebKit to behave like Gecko. */\n\theight: 100%;\n\twidth: 100%;\n}\n*:fullscreen {\n\t/* Cause Blink/WebKit to behave like Gecko. */\n\theight: 100%;\n\twidth: 100%;\n}\nbody::-ms-backdrop {\n\t/* Prevent IE 11 from hiding the `body` element's background. */\n\tbackground: none;\n}\n\n/* Base styles. */\n*:focus {\n\toutline: thin dotted;\n}\n*:disabled {\n\tcursor: not-allowed !important;\n}\nhtml {\n\tfont-family:\n\t\t/* iOS & macOS Safari, macOS Firefox */\n\t\t-apple-system,\n\t\t/* macOS & Windows Chrome */\n\t\tsystem-ui,\n\t\t/* macOS Chrome */\n\t\tBlinkMacSystemFont,\n\t\t/* Windows ≥6 (Vista) */\n\t\t\"Segoe UI\",\n\t\t/* Android, Chrome OS */\n\t\tRoboto,\n\t\t/* KDE */\n\t\tOxygen-Sans,\n\t\t/* GNOME */\n\t\tCantarell,\n\t\t/* Ubuntu */\n\t\tUbuntu,\n\t\t/* macOS <10.11 */\n\t\t\"Helvetica Neue\",\n\t\t/* Older fallbacks */\n\t\tHelvetica,\n\t\tArial,\n\t\tsans-serif,\n\t\t/* Color Emoji */\n\t\tcolor-emoji;\n\n\t/*\n\t\tWe define the base font size and line height here as they affect the\n\t\tlayout of the core page elements—i.e., `#ui-bar`, `#ui-dialog`, and\n\t\t`#story`.\n\t*/\n\tfont-size: 16px;\n\tline-height: 1;\n}\nbody {\n\tcolor: #eee;\n\tbackground-color: #111;\n\toverflow: auto;\n}\na {\n\tcursor: pointer;\n\tcolor: #68d;\n\ttext-decoration: none;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n}\nhtml[data-outlines] a:focus,\na:hover {\n\tcolor: #8af;\n\ttext-decoration: underline;\n}\na.link-broken {\n\tcolor: #c22;\n}\nhtml[data-outlines] a.link-broken:focus,\na.link-broken:hover {\n\tcolor: #e44;\n}\na[disabled],\nspan.link-disabled {\n\tcolor: #aaa;\n\tcursor: not-allowed !important;\n\t/*\n\t\tNOTE: Do not use `pointer-events` here as it disables\n\t\tthe display of a cursor in some browsers.\n\n\t\tpointer-events: none;\n\t*/\n\ttext-decoration: none;\n}\na.link-internal {\n\t-webkit-touch-callout: none;\n}\narea {\n\tcursor: pointer;\n}\nbutton {\n\tcursor: pointer;\n\tcolor: #eee;\n\tbackground-color: #35a;\n\tborder: 1px solid #57c;\n\tline-height: normal;\n\tpadding: 0.4em;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\nhtml[data-outlines] button:focus,\nbutton:hover {\n\tbackground-color: #57c;\n\tborder-color: #79e;\n}\nbutton:disabled {\n\tbackground-color: #444;\n\tborder: 1px solid #666;\n}\ncode,\nkbd,\npre,\nsamp,\nvar {\n\tfont-family:\n\t\tSFMono-Regular,\n\t\tMenlo,\n\t\tMonaco,\n\t\tConsolas,\n\t\t\"Liberation Mono\",\n\t\t\"Lucida Console\",\n\t\t\"Courier New\",\n\t\tCourier,\n\t\t/* 2× to fix a bug in ancient browsers. */\n\t\tmonospace,\n\t\tmonospace;\n}\npre {\n\toverflow: auto;\n}\ninput,\nselect,\ntextarea {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tpadding: 0.4em;\n}\nselect {\n\tpadding: 0.34em 0.4em;\n}\ninput[type=\"text\"] {\n\tmin-width: 18em;\n}\ntextarea {\n\tmin-width: 30em;\n\tresize: vertical;\n}\ninput[type=\"checkbox\"],\ninput[type=\"file\"],\ninput[type=\"radio\"],\nselect {\n\tcursor: pointer;\n}\n/* BEGIN: input[type=\"range\"] */\ninput[type=\"range\"] {\n\t-webkit-appearance: none; /* stylelint-disable-line property-no-vendor-prefix */\n\tmin-height: 1.2em;\n}\ninput[type=\"range\"]:focus {\n\toutline: none;\n}\ninput[type=\"range\"]::-webkit-slider-runnable-track {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: 100%;\n}\ninput[type=\"range\"]::-webkit-slider-thumb {\n\t-webkit-appearance: none; /* stylelint-disable-line property-no-vendor-prefix */\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 18px;\n\t/*\n\t\tNOTE: Ideally, `margin-top` should be `0` for Edge (EdgeHTML)—ca. v17—but\n\t\treal Blink/WebKit-based browsers need it.  Since there's more of them and\n\t\tEdge (EdgeHTML) is co-opting the prefix, we cater to them.  Edge (EdgeHTML)\n\t\twill simply have to look ever so slightly off.  This will likely cease to\n\t\tbe an issue for Edge users when it switches from EdgeHTML to Blink anyway.\n\t*/\n\tmargin-top: -5px;\n\twidth: 33px;\n}\ninput[type=\"range\"]:focus::-webkit-slider-runnable-track {\n\tbackground: #222;\n}\ninput[type=\"range\"]::-moz-range-track {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: 100%;\n}\ninput[type=\"range\"]::-moz-range-thumb {\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 18px;\n\twidth: 33px;\n}\ninput[type=\"range\"]::-ms-track {\n\tbackground: transparent;\n\tborder-color: transparent;\n\tcolor: transparent;\n\tcursor: pointer;\n\theight: 10px;\n\twidth: calc(100% - 1px);\n}\ninput[type=\"range\"]::-ms-fill-lower {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n}\ninput[type=\"range\"]::-ms-fill-upper {\n\tbackground: #222;\n\tborder: 1px solid #444;\n\tborder-radius: 0;\n}\ninput[type=\"range\"]::-ms-thumb {\n\tbackground: #35a;\n\tborder: 1px solid #57c;\n\tborder-radius: 0;\n\tcursor: pointer;\n\theight: 16px;\n\twidth: 33px;\n}\n/* END: input[type=\"range\"] */\nhtml[data-outlines] input:focus,\ninput:hover,\nhtml[data-outlines] select:focus,\nselect:hover,\nhtml[data-outlines] textarea:focus,\ntextarea:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\ninput:disabled,\nselect:disabled,\ntextarea:disabled {\n\tcolor: #333;\n\tbackground-color: transparent;\n\tborder-color: #111;\n}\nhr {\n\tdisplay: block;\n\theight: 1px;\n\tborder: none;\n\tborder-top: 1px solid #eee;\n\tmargin: 1em 0;\n\tpadding: 0;\n}\naudio,\ncanvas,\nprogress,\nvideo {\n\tmax-width: 100%;\n\tvertical-align: middle;\n}\n\n/* Special no transition styling. */\n.no-transition {\n\t-webkit-transition: none !important;\n\t-o-transition: none !important;\n\ttransition: none !important;\n}\n\n.error-view {\n\tbackground-color: #511;\n\tborder-left: 0.5em solid #c22;\n\tdisplay: inline-block;\n\tmargin: 0.1em;\n\tmax-width: 100%;\n\tpadding: 0 0.25em;\n\tposition: relative;\n}\n.error-view > .error-toggle {\n\tbackground-color: transparent;\n\tborder: none;\n\tline-height: inherit;\n\tleft: 0;\n\tpadding: 0;\n\tposition: absolute;\n\ttop: 0;\n\twidth: 1.75em;\n}\nhtml[data-outlines] .error-view > .error-toggle:focus,\n.error-view > .error-toggle:hover {\n\t/*\n\t\tThis could also be achieved by simply adding `!important` to the base\n\t\t`background-color` property above.\n\t*/\n\tbackground-color: transparent;\n}\n.error-view > .error {\n\tdisplay: inline-block;\n\tmargin-left: 0.25em;\n}\n.error-view > .error-toggle + .error {\n\tmargin-left: 1.5em;\n}\n.error-view > .error-source[hidden] {\n\tdisplay: none;\n}\n.error-view > .error-source:not([hidden]) {\n\tbackground-color: rgba(0, 0, 0, 0.2);\n\tdisplay: block;\n\tmargin: 0 0 0.25em;\n\toverflow-x: auto;\n\tpadding: 0.25em;\n}\n\n.highlight,\n.marked {\n\tcolor: yellow;\n\tfont-weight: bold;\n\tfont-style: italic;\n}\n.nobr {\n\twhite-space: nowrap;\n}\n\n[data-icon]::before,\n[data-icon-before]::before,\n[data-icon-after]::after,\n.error-view > .error-toggle::before,\n.error-view > .error::before,\na.link-external::after {\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n[data-icon]::before {\n\tcontent: attr(data-icon);\n}\n[data-icon-before]::before {\n\tcontent: attr(data-icon-before);\n\tmargin-right: 0.35em;\n}\n[data-icon-after]::after {\n\tcontent: attr(data-icon-after);\n\tmargin-left: 0.35em;\n}\n.error-view > .error-toggle::before {\n\tcontent: \"\\f0da\";\n}\n.error-view > .error-toggle.enabled::before {\n\tcontent: \"\\f0d7\";\n}\n.error-view > .error::before {\n\tcontent: \"\\f071\";\n\tmargin-right: 0.35em;\n}\na.link-external::after {\n\tcontent: \"\\f35d\";\n\tmargin-left: 0.25em;\n}\n</style>\n<style id=\"style-core-display\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/core-display.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n#story {\n\tz-index: 10;\n\tmargin: 2.5em;\n}\n@media screen and (max-width: 1136px) {\n\t#story {\n\t\tmargin-right: 1.5em;\n\t}\n}\n#passages {\n\tmax-width: 54em;\n\tmargin: 0 auto;\n}\n</style>\n<style id=\"style-core-passage\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/core-passage.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Base styles. */\n.passage {\n\tline-height: 1.75;\n\ttext-align: left;\n\t-webkit-transition: opacity 400ms ease-in;\n\t-o-transition: opacity 400ms ease-in;\n\ttransition: opacity 400ms ease-in;\n}\n.passage-in {\n\topacity: 0;\n}\n.passage ul,\n.passage ol {\n\tmargin-left: 0.5em;\n\tpadding-left: 1.5em;\n}\n.passage table {\n\tmargin: 1em 0;\n\tborder-collapse: collapse;\n\tfont-size: 100%;\n}\n.passage tr,\n.passage th,\n.passage td,\n.passage caption {\n\tpadding: 3px;\n}\n\n/* Accessibility styles. */\n@media (prefers-reduced-motion: reduce) {\n\t.passage {\n\t\t-webkit-transition: opacity 0s;\n\t\t-o-transition: opacity 0s;\n\t\ttransition: opacity 0s;\n\t}\n}\n</style>\n<style id=\"style-core-macro\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/core-macro.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n@-webkit-keyframes cursor-blink {\n\t0% { opacity: 1; }\n\t50% { opacity: 0; }\n\t100% { opacity: 1; }\n}\n\n@-o-keyframes cursor-blink {\n\t0% { opacity: 1; }\n\t50% { opacity: 0; }\n\t100% { opacity: 1; }\n}\n\n@keyframes cursor-blink {\n\t0% { opacity: 1; }\n\t50% { opacity: 0; }\n\t100% { opacity: 1; }\n}\n\n.macro-linkappend-insert,\n.macro-linkprepend-insert,\n.macro-linkreplace-insert,\n.macro-append-insert,\n.macro-prepend-insert,\n.macro-replace-insert,\n.macro-repeat-insert,\n.macro-timed-insert {\n\t-webkit-transition: opacity 400ms ease-in;\n\t-o-transition: opacity 400ms ease-in;\n\ttransition: opacity 400ms ease-in;\n}\n.macro-linkappend-in,\n.macro-linkprepend-in,\n.macro-linkreplace-in,\n.macro-append-in,\n.macro-prepend-in,\n.macro-replace-in,\n.macro-repeat-in,\n.macro-timed-in {\n\topacity: 0;\n}\n\n.macro-type-cursor::after {\n\t-webkit-animation: cursor-blink 1s infinite;\n\t     -o-animation: cursor-blink 1s infinite;\n\t        animation: cursor-blink 1s infinite;\n\tcontent: \"\\2590\"; /* \"\\2588\" */\n\topacity: 1;\n}\n</style>\n<style id=\"style-ui-dialog\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-dialog.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Core styles patches. */\nhtml[data-dialog] body {\n\toverflow: hidden;\n}\n\n/* Base styles. */\n#ui-overlay {\n\tbackground-color: #000;\n\theight: 200%;\n\tleft: -50%;\n\topacity: 0;\n\tposition: fixed;\n\ttop: -50%;\n\t-webkit-transition: visibility 200ms step-end, opacity 200ms ease-in;\n\t-o-transition: visibility 200ms step-end, opacity 200ms ease-in;\n\ttransition: visibility 200ms step-end, opacity 200ms ease-in;\n\tvisibility: hidden;\n\twidth: 200%;\n\tz-index: 100000;\n}\n/* #ui-overlay:not(.open) {\n\ttransition: visibility 200ms step-end, opacity 200ms ease-in;\n} */\n#ui-overlay.open {\n\topacity: 0.8;\n\t/* transition: opacity 200ms ease-in; */\n\t-webkit-transition: visibility 0s;\n\t-o-transition: visibility 0s;\n\ttransition: visibility 0s;\n\tvisibility: visible;\n}\n/*\n\tWe do not animate the closing `#ui-dialog` for various reasons.  Chief\n\tamong them is so that the dialog isn't in the middle of its animation\n\twhen other page updates happen.\n\n\tIn particular, the restoration of `overflow` on `body` would cause the\n\tstill animating dialog to jump around a little if a scrollbar were to\n\tpop in.\n\n\tAny dialog action which performs a task which has its own animations—e.g.,\n\tpassage display—or causes the page to reload in addition to closing the\n\tdialog could cause display shenanigans.\n*/\n#ui-dialog {\n\tdisplay: none;\n\tmargin: 0;\n\tmax-width: 66em;\n\topacity: 0;\n\tpadding: 0;\n\tposition: fixed;\n\ttop: 50px;\n\tz-index: 100100;\n}\n#ui-dialog.open {\n\tdisplay: block;\n\topacity: 1;\n\t-webkit-transition: opacity 200ms ease-in;\n\t-o-transition: opacity 200ms ease-in;\n\ttransition: opacity 200ms ease-in;\n}\n#ui-dialog > * {\n\t-webkit-box-sizing: border-box;\n\t        box-sizing: border-box;\n}\n#ui-dialog-titlebar {\n\tbackground-color: #444;\n\tmin-height: 24px;\n\tposition: relative;\n}\n#ui-dialog-title {\n\tfont-size: 1.5em;\n\tmargin: 0;\n\tpadding: 0.2em 3.5em 0.2em 0.5em;\n\ttext-align: center;\n\ttext-transform: uppercase;\n}\n#ui-dialog-close {\n\tbackground-color: transparent;\n\tborder: 1px solid transparent;\n\tcursor: pointer;\n\tdisplay: block;\n\tfont-size: 120%;\n\theight: 92%;\n\tmargin: 0;\n\tpadding: 0;\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n\t-webkit-transition-duration: 200ms;\n\t     -o-transition-duration: 200ms;\n\t        transition-duration: 200ms;\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n\twhite-space: nowrap;\n\twidth: 3.6em;\n\n\t/* Font icon styles. */\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n#ui-dialog-close:hover {\n\tbackground-color: #b44;\n\tborder-color: #d66;\n}\n#ui-dialog-body {\n\tbackground-color: #111;\n\tborder: 1px solid #444;\n\theight: calc(100% - 2.1em); /* parent - title(2.1em) */\n\tline-height: 1.5;\n\tmin-width: 300px;\n\toverflow: auto;\n\tpadding: 1em;\n\ttext-align: left;\n}\n#ui-dialog-body > *:first-child {\n\tmargin-top: 0;\n}\n#ui-dialog-body hr {\n\tbackground-color: #444;\n}\n\n/* Button bar styles. */\n#ui-dialog-body ul.buttons {\n\tmargin: 0;\n\tpadding: 0;\n\tlist-style: none;\n}\n#ui-dialog-body ul.buttons li {\n\tdisplay: inline-block;\n\tmargin: 0;\n\tpadding: 0.4em 0.4em 0 0;\n}\n#ui-dialog-body ul.buttons > li + li > button {\n\tmargin-left: 1em;\n}\n\n/* Accessibility styles. */\n@media (prefers-reduced-motion: reduce) {\n\t#ui-overlay {\n\t\t-webkit-transition: opacity 0s;\n\t\t-o-transition: opacity 0s;\n\t\ttransition: opacity 0s;\n\t}\n\t#ui-overlay.open {\n\t\t-webkit-transition: opacity 0s;\n\t\t-o-transition: opacity 0s;\n\t\ttransition: opacity 0s;\n\t}\n\t#ui-dialog.open {\n\t\t-webkit-transition: opacity 0s;\n\t\t-o-transition: opacity 0s;\n\t\ttransition: opacity 0s;\n\t}\n}\n</style>\n<style id=\"style-ui-dialog-saves\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-dialog-saves.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Base styles. */\n#ui-dialog-body.saves {\n\t/*\n\t\tNOTE: Older versions of Webkit/Blink need `1px` bottom padding\n\t\tor they'll trigger the scroll bar for some odd reason.\n\t*/\n\tpadding: 0 0 1px;\n}\n#ui-dialog-body.saves > *:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.saves > h2 {\n\tbackground-color: #222;\n\tfont-size: inherit;\n\tmargin: 0;\n\tpadding: 0.1em 0 0.1em 0.4em;\n}\n#ui-dialog-body.saves table {\n\tborder-spacing: 0;\n\twidth: 100%;\n}\n#ui-dialog-body.saves tr:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.saves td {\n\tpadding: 0.33em;\n}\n#ui-dialog-body.saves td:first-child {\n\t/* min-width: 1.5em;\n\ttext-align: center; */\n\tdisplay: none !important;\n}\n#ui-dialog-body.saves td:nth-child(3) {\n\tline-height: 1.2;\n\twidth: 100%;\n}\n#ui-dialog-body.saves td:last-child {\n\ttext-align: right;\n}\n#ui-dialog-body.saves .empty {\n\tcolor: #999;\n\tspeak: none;\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n#ui-dialog-body.saves .details {\n\tfont-size: 75%;\n\tmargin-left: 0.25em;\n}\n#ui-dialog-body.saves #saves-list button {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\theight: 2.237em;\n\twidth: 2.237em;\n}\n#ui-dialog-body.saves #saves-list button:disabled {\n\tcolor: #444;\n\tborder-color: #444;\n}\n#ui-dialog-body.saves #saves-list button:not(:disabled):hover {\n\tbackground-color: #222;\n\tborder-color: #ddd;\n}\n#ui-dialog-body.saves #saves-list button.delete:not(:disabled),\n#ui-dialog-body.saves button[id=\"saves-clear\"]:not(:disabled) {\n\tbackground-color: #911;\n\tborder-color: #b33;\n}\n#ui-dialog-body.saves #saves-list button.delete:not(:disabled):hover,\n#ui-dialog-body.saves button[id=\"saves-clear\"]:not(:disabled):hover {\n\tbackground-color: #b33;\n\tborder-color: #d55;\n}\n#ui-dialog-body.saves #saves-list button.load:not(:disabled) {\n\tbackground-color: #161;\n\tborder-color: #383;\n}\n#ui-dialog-body.saves #saves-list button.load:not(:disabled):hover {\n\tbackground-color: #383;\n\tborder-color: #5a5;\n}\n#ui-dialog-body.saves .buttons li {\n\tpadding: 0.4em;\n}\n#ui-dialog-body.saves .buttons > li + li > button {\n\tmargin-left: 0.2em;\n}\n#ui-dialog-body.saves .buttons.slots > li:last-child {\n\t/*\n\t\tNOTE: Using `position:absolute;right:0;` here can produce poor\n\t\tresults, so we use `float:right;` instead.\n\t*/\n\tfloat: right;\n}\n\n/* Font icon styles. */\n#ui-dialog-body.saves #saves-list button::before,\n#ui-dialog-body.saves .buttons button::before {\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n#ui-dialog-body.saves .buttons button::before {\n\tmargin-right: 0.35em;\n}\n#ui-dialog-body.saves button.delete::before {\n\tcontent: \"\\f2ed\";\n}\n#ui-dialog-body.saves button.delete:disabled::before {\n\tcontent: \"\\f1f8\";\n}\n#ui-dialog-body.saves button.load::before {\n\tcontent: \"\\f04b\";\n}\n#ui-dialog-body.saves button.save::before {\n\tcontent: \"\\f0c7\";\n}\n#ui-dialog-body.saves button[id=\"saves-export\"]::before {\n\tcontent: \"\\f56e\";\n}\n#ui-dialog-body.saves button[id=\"saves-import\"]::before {\n\tcontent: \"\\f56f\";\n}\n#ui-dialog-body.saves button[id=\"saves-clear\"]::before {\n\tcontent: \"\\f2ed\";\n}\n#ui-dialog-body.saves button[id=\"saves-clear\"]:disabled::before {\n\tcontent: \"\\f1f8\";\n}\n#ui-dialog-body.saves button[id=\"saves-disk-save\"]::before {\n\t/* content: \"\\f019\"; */\n\tcontent: \"\\f56d\";\n}\n#ui-dialog-body.saves button[id=\"saves-disk-load\"]::before {\n\t/* content: \"\\f093\"; */\n\tcontent: \"\\f574\";\n}\n</style>\n<style id=\"style-ui-dialog-settings\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-dialog-settings.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Base styles. */\n#ui-dialog-body.settings [id|=\"setting-body\"] > div:first-child {\n\tdisplay: table;\n\twidth: 100%;\n}\n#ui-dialog-body.settings [id|=\"setting-label\"] {\n\tdisplay: table-cell;\n\tpadding: 0.4em 2em 0.4em 0;\n}\n#ui-dialog-body.settings [id|=\"setting-label\"] + div {\n\tdisplay: table-cell;\n\tmin-width: 8em;\n\ttext-align: right;\n\tvertical-align: middle;\n\twhite-space: nowrap;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"] {\n\tmargin: 1em 0;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"]:first-child {\n\tmargin-top: 0;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"]:not(:first-child) {\n\tborder-top: 1px solid #444;\n\tpadding-top: 1em;\n}\n#ui-dialog-body.settings div[id|=\"header-body\"] > * {\n\tmargin: 0;\n}\n#ui-dialog-body.settings h2[id|=\"header-heading\"] {\n\tfont-size: 1.375em;\n}\n#ui-dialog-body.settings p[id|=\"header-desc\"],\n#ui-dialog-body.settings p[id|=\"setting-desc\"] {\n\tfont-size: 87.5%;\n\tmargin: 0 0 0 0.5em;\n}\n#ui-dialog-body.settings div[id|=\"setting-body\"] + div[id|=\"setting-body\"] {\n\tmargin: 1em 0;\n}\n#ui-dialog-body.settings [id|=\"setting-control\"] {\n\twhite-space: nowrap;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"] {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tpadding: 0.4em;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"]:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled {\n\tbackground-color: #282;\n\tborder-color: #4a4;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled:hover {\n\tbackground-color: #4a4;\n\tborder-color: #6c6;\n}\n#ui-dialog-body.settings input[type=\"range\"][id|=\"setting-control\"] {\n\tmax-width: 35vw;\n}\n\n/* QUESTION: Is this both a valid selector and a necessary rule? */\n#ui-dialog-body.settings span[id|=\"setting-input\"] {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n\n/* Font icon styles. */\n#ui-dialog-body.settings button[id|=\"setting-control\"]::after,\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled::after {\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n\n\tmargin-left: 0.35em;\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"]::after {\n\tcontent: \"\\f204\";\n}\n#ui-dialog-body.settings button[id|=\"setting-control\"].enabled::after {\n\tcontent: \"\\f205\";\n}\n</style>\n<style id=\"style-ui-dialog-legacy\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-dialog-legacy.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* legacy */\n/* List-based dialog styles (primarily for the Jumpto & Share dialogs). */\n#ui-dialog-body.list {\n\tpadding: 0;\n}\n#ui-dialog-body.list ul {\n\tmargin: 0;\n\tpadding: 0;\n\tlist-style: none;\n\tborder: 1px solid transparent;\n}\n#ui-dialog-body.list li {\n\tmargin: 0;\n}\n#ui-dialog-body.list li:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#ui-dialog-body.list li a {\n\tdisplay: block;\n\tpadding: 0.25em 0.75em;\n\tborder: 1px solid transparent;\n\tcolor: #eee;\n\ttext-decoration: none;\n}\n#ui-dialog-body.list li a:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n#ui-dialog-body.list a {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n/* /legacy */\n</style>\n<style id=\"style-ui-bar\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-bar.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Core styles patches. */\n#story {\n\tmargin-left: 20em;\n\t-webkit-transition: margin-left 200ms ease-in;\n\t-o-transition: margin-left 200ms ease-in;\n\ttransition: margin-left 200ms ease-in;\n}\n#ui-bar.stowed ~ #story {\n\tmargin-left: 4.5em;\n}\n@media screen and (max-width: 1136px) {\n\t#story {\n\t\tmargin-left: 19em;\n\t}\n\t#ui-bar.stowed ~ #story {\n\t\tmargin-left: 3.5em;\n\t}\n}\n/*\n\tAt narrow viewport widths, set `#story{margin-left}` equal to the value\n\tof `#ui-bar.stowed~#story{margin-left}`, so that `#ui-bar` will side\n\tover top of `#story` when unstowed, rather than shoving it over.\n*/\n@media screen and (max-width: 768px) {\n\t#story {\n\t\tmargin-left: 3.5em;\n\t}\n}\n\n/* Base styles. */\n#ui-bar {\n\tbackground-color: #222;\n\tborder-right: 1px solid #444;\n\theight: 100%;\n\tleft: 0;\n\tmargin: 0;\n\tpadding: 0;\n\tposition: fixed;\n\ttext-align: center;\n\ttop: 0;\n\t-webkit-transition: left 200ms ease-in;\n\t-o-transition: left 200ms ease-in;\n\ttransition: left 200ms ease-in;\n\twidth: 17.5em;\n\tz-index: 50;\n}\n#ui-bar.stowed {\n\tleft: -15.5em;\n}\n#ui-bar-tray {\n\tposition: absolute;\n\ttop: 0.2em;\n\tleft: 0;\n\tright: 0;\n}\n#ui-bar-body {\n\theight: calc(100% - 2.5em);\n\tline-height: 1.5;\n\tmargin: 2.5em 0;\n\toverflow: auto;\n\tpadding: 0 1.5em;\n}\n#ui-bar.stowed #ui-bar-history,\n#ui-bar.stowed #ui-bar-body {\n\tvisibility: hidden;\n\t-webkit-transition: visibility 200ms step-end;\n\t-o-transition: visibility 200ms step-end;\n\ttransition: visibility 200ms step-end;\n}\n#ui-bar a {\n\ttext-decoration: none;\n}\n#ui-bar hr {\n\tborder-color: #444;\n}\n#ui-bar-tray button {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n}\n#ui-bar-tray button:hover {\n\tbackground-color: #444;\n\tborder-color: #eee;\n}\n#ui-bar-tray button:disabled {\n\tcolor: #444;\n\tbackground-color: transparent;\n\tborder-color: #444;\n}\nbutton#ui-bar-toggle {\n\tborder-right: none;\n\tposition: absolute;\n\tright: 0;\n\ttop: 0;\n}\n#ui-bar-history {\n\tmargin: 0 auto;\n}\n#ui-bar-history button:not(:first-child) {\n\tmargin-left: 1.2em;\n}\n#ui-bar-body > :not(:first-child) {\n\tmargin-top: 2em;\n}\n#story-title {\n\tmargin: 0;\n\tfont-size: 162.5%;\n}\n#story-author {\n\tmargin-top: 2em;\n\tfont-weight: bold;\n}\n#menu ul {\n\tmargin: 1em 0 0;\n\tpadding: 0;\n\tlist-style: none;\n\tborder: 1px solid #444;\n}\n#menu ul:empty {\n\tdisplay: none;\n}\n#menu li {\n\tmargin: 0;\n}\n#menu li:not(:first-child) {\n\tborder-top: 1px solid #444;\n}\n#menu li a {\n\tdisplay: block;\n\tpadding: 0.25em 0.75em;\n\tborder: 1px solid transparent;\n\tcolor: #eee;\n\ttext-transform: uppercase;\n}\n#menu li a:hover {\n\tbackground-color: #444;\n\tborder-color: #eee;\n}\n\n/* Stop text selection on certain UI elements. */\n#ui-bar-tray button,\n#menu a {\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n}\n\n/* Font icon styles. */\n#ui-bar-tray button::before,\n#menu-core li[id|=\"menu-item\"] a::before {\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n#ui-bar-tray button::before {\n\tdisplay: block;\n\tfont-size: 1.1em;\n\twidth: 1em;\n}\n#ui-bar-toggle::before {\n\tcontent: \"\\f053\";\n}\n#ui-bar.stowed #ui-bar-toggle::before {\n\tcontent: \"\\f054\";\n}\n#ui-bar-tray #history-backward::before {\n\tcontent: \"\\f060\";\n}\n#ui-bar-tray #history-jumpto::before {\n\tcontent: \"\\f0e7\";\n}\n#ui-bar-tray #history-forward::before {\n\tcontent: \"\\f061\";\n}\n#menu-item-continue a::before,\n#menu-item-saves a::before,\n#menu-item-settings a::before,\n#menu-item-restart a::before /* legacy */,\n#menu-item-share a::before /* /legacy */ {\n\tmargin-right: 0.35em;\n}\n#menu-item-continue a::before {\n\tcontent: \"\\f04b\";\n}\n#menu-item-saves a::before {\n\tcontent: \"\\f0c7\";\n}\n#menu-item-settings a::before {\n\tcontent: \"\\f013\";\n}\n#menu-item-restart a::before {\n\tcontent: \"\\f011\";\n}\n/* legacy */\n#menu-item-share a::before {\n\tcontent: \"\\f1e0\";\n}\n/* legacy */\n\n/* Accessibility styles. */\n@media (prefers-reduced-motion: reduce) {\n\t#story {\n\t\t-webkit-transition: margin-left 0s;\n\t\t-o-transition: margin-left 0s;\n\t\ttransition: margin-left 0s;\n\t}\n\t#ui-bar {\n\t\t-webkit-transition: left 0s;\n\t\t-o-transition: left 0s;\n\t\ttransition: left 0s;\n\t}\n}\n</style>\n<style id=\"style-ui-debug-bar\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-debug-bar.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Base styles. */\n#debug-bar {\n\tbackground-color: #222;\n\tborder-left: 1px solid #444;\n\tborder-top: 1px solid #444;\n\tbottom: 0;\n\tmargin: 0;\n\tmax-height: 95%;\n\tmax-width: 66em;\n\tmin-width: 300px;\n\tpadding: 0.5em;\n\tposition: fixed;\n\tright: 0;\n\tz-index: 99900;\n}\n#debug-bar > div:not([id]) + div {\n\tmargin-top: 0.5em;\n}\n#debug-bar > div > label {\n\tmargin-right: 0.5em;\n}\n#debug-bar > div > input[type=\"text\"] {\n\tmin-width: 8em;\n\twidth: 14em;\n}\n#debug-bar > div > select {\n\twidth: 22em;\n}\n\n#debug-bar-toggle {\n\tcolor: #eee;\n\tbackground-color: #222;\n\tborder: 1px solid #444;\n\theight: calc(100% + 1px);\n\tleft: calc(-2em - 1px);\n\tposition: absolute;\n\ttop: -1px;\n\twidth: 2em;\n}\n#debug-bar-toggle:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n\n#debug-bar-hint {\n\tbottom: 0.75em;\n\tfont-size: 4.5em;\n\topacity: 0.33;\n\tpointer-events: none;\n\tposition: fixed;\n\tright: 0.6em;\n\t-webkit-user-select: none;\n\t   -moz-user-select: none;\n\t    -ms-user-select: none;\n\t        user-select: none;\n\twhite-space: nowrap;\n}\n\n#debug-bar-watch {\n\tbackground-color: #222;\n\tborder-left: 1px solid #444;\n\tborder-top: 1px solid #444;\n\tbottom: calc(100% + 1px);\n\tfont-size: 0.9em;\n\tleft: -1px;\n\tmax-height: 280%; /* fallback for browsers without support for vh units */\n\tmax-height: calc(95vh - 100%);\n\tposition: absolute;\n\toverflow-x: hidden;\n\toverflow-y: scroll;\n\tright: 0;\n\tz-index: 99800;\n}\n#debug-bar-watch[hidden] {\n\tdisplay: none;\n}\n#debug-bar-watch div {\n\tcolor: #999;\n\tfont-style: italic;\n\tmargin: 1em auto;\n\ttext-align: center;\n}\n#debug-bar-watch table {\n\twidth: 100%;\n}\n#debug-bar-watch tr:nth-child(2n) {\n\tbackground-color: rgba(127, 127, 127, 0.15);\n}\n#debug-bar-watch td {\n\tpadding: 0.2em 0;\n}\n#debug-bar-watch td:first-child + td {\n\tpadding: 0.2em 0.3em 0.2em 0.1em;\n}\n#debug-bar-watch .watch-delete {\n\tbackground-color: transparent;\n\tborder: none;\n\tcolor: #c00;\n}\n#debug-bar-watch-all,\n#debug-bar-watch-clear {\n\tmargin-left: 0.5em;\n}\n#debug-bar-watch-toggle,\n#debug-bar-views-toggle {\n\tcolor: #eee;\n\tbackground-color: transparent;\n\tborder: 1px solid #444;\n\tmargin-right: 1em;\n\tpadding: 0.4em;\n}\n#debug-bar-watch-toggle:hover,\n#debug-bar-views-toggle:hover {\n\tbackground-color: #333;\n\tborder-color: #eee;\n}\n#debug-bar-watch:not([hidden]) ~ div #debug-bar-watch-toggle,\nhtml[data-debug-view] #debug-bar-views-toggle {\n\tbackground-color: #282;\n\tborder-color: #4a4;\n}\n#debug-bar-watch:not([hidden]) ~ div #debug-bar-watch-toggle:hover,\nhtml[data-debug-view] #debug-bar-views-toggle:hover {\n\tbackground-color: #4a4;\n\tborder-color: #6c6;\n}\n\n#debug-bar-toggle::before,\n#debug-bar-hint::after,\n#debug-bar-watch .watch-delete::before,\n#debug-bar-watch-add::before,\n#debug-bar-watch-all::before,\n#debug-bar-watch-clear::before,\n#debug-bar-watch-toggle::after,\n#debug-bar-views-toggle::after,\n#debug-bar-passage-play::before {\n\tfont-family: sc-icons !important;\n\t/* stylelint-disable-line font-family-no-missing-generic-family-keyword */\n\tfont-style: normal;\n\tfont-weight: normal;\n\tfont-variant: normal;\n\tline-height: 1;\n\tspeak: never;\n\ttext-rendering: auto;\n\ttext-transform: none;\n\t-webkit-font-smoothing: antialiased;\n\t-moz-osx-font-smoothing: grayscale;\n}\n#debug-bar-toggle::before {\n\tcontent: \"\\f188\";\n}\n#debug-bar-hint::after {\n\tcontent: \"\\f188\\202f\\f061\";\n}\n#debug-bar-watch .watch-delete::before {\n\tcontent: \"\\f00d\";\n}\n#debug-bar-watch-add::before {\n\tcontent: \"\\f067\";\n}\n#debug-bar-watch-all::before {\n\tcontent: \"\\f0d0\";\n}\n#debug-bar-watch-clear::before {\n\tcontent: \"\\f2ed\";\n}\n#debug-bar-watch-toggle::after,\n#debug-bar-views-toggle::after {\n\tcontent: \"\\f204\";\n\tmargin-left: 0.35em;\n}\n#debug-bar-watch:not([hidden]) ~ div #debug-bar-watch-toggle::after,\nhtml[data-debug-view] #debug-bar-views-toggle::after {\n\tcontent: \"\\f205\";\n\t/* margin-left: 0.35em; */\n}\n#debug-bar-passage-play::before {\n\tcontent: \"\\f04b\";\n}\n</style>\n<style id=\"style-ui-debug-views\" type=\"text/css\">/***********************************************************************************************************************\n\n\tcss/_mixins.css\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/***********************************************************************************************************************\n\n\tcss/ui-debug-views.css\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/* Debug view styles. */\nhtml[data-debug-view] .debug {\n\tpadding: 0.25em;\n\tbackground-color: #234; /* #541, #151 */\n}\nhtml[data-debug-view] .debug[title] {\n\tcursor: help;\n}\nhtml[data-debug-view] .debug.block {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n}\nhtml[data-debug-view] .debug.invalid {\n\ttext-decoration: line-through;\n}\nhtml[data-debug-view] .debug.hidden,\nhtml[data-debug-view] .debug.hidden .debug {\n\tbackground-color: #555;\n}\nhtml:not([data-debug-view]) .debug.hidden {\n\tdisplay: none;\n}\n\nhtml[data-debug-view] .debug[data-name][data-type]::before,\nhtml[data-debug-view] .debug[data-name][data-type].nonvoid::after {\n\tbackground-color: rgba(0, 0, 0, 0.25);\n\tfont-family: monospace, monospace;\n\twhite-space: pre;\n}\nhtml[data-debug-view] .debug[data-name][data-type]::before {\n\tcontent: attr(data-name);\n}\nhtml[data-debug-view] .debug[data-name][data-type|=\"macro\"]::before {\n\tcontent: \"<<\" attr(data-name) \">>\";\n}\nhtml[data-debug-view] .debug[data-name][data-type|=\"macro\"].nonvoid::after {\n\tcontent: \"<</\" attr(data-name) \">>\";\n}\nhtml[data-debug-view] .debug[data-name][data-type|=\"html\"]::before {\n\tcontent: \"<\" attr(data-name) \">\";\n}\nhtml[data-debug-view] .debug[data-name][data-type|=\"html\"].nonvoid::after {\n\tcontent: \"</\" attr(data-name) \">\";\n}\nhtml[data-debug-view] .debug[data-name][data-type]:not(:empty)::before {\n\tmargin-right: 0.25em;\n}\nhtml[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty)::after {\n\tmargin-left: 0.25em;\n}\nhtml[data-debug-view] .debug[data-name][data-type|=\"special\"],\nhtml[data-debug-view] .debug[data-name][data-type|=\"special\"]::before {\n\tdisplay: block;\n}\n</style>\n</head>\n<body>\n\t<div id=\"init-screen\">\n\t\t<div id=\"init-no-js\"><noscript>JavaScript must be enabled to play.</noscript></div>\n\t\t<div id=\"init-lacking\"><p>Browser lacks capabilities required to play.</p><p>Upgrade or switch to another browser.</p></div>\n\t\t<div id=\"init-loading\"><div>Loading&hellip;</div></div>\n\t</div>\n\t{{STORY_DATA}}\n\t<script id=\"script-sugarcube\" type=\"text/javascript\">\n\t/*! SugarCube JS */\n\tif(document.documentElement.getAttribute(\"data-init\")===\"loading\"){window.BUILD_TWINE1=false;\nwindow.BUILD_DEBUG=true;\n(function (window, document, jQuery, undefined) {\n\"use strict\";\n\n\"use strict\";\n\nvar _excluded = [\"bubbles\", \"cancelable\", \"composed\", \"detail\"],\n  _excluded2 = [\"bubbles\", \"cancelable\"],\n  _excluded3 = [\"state\"];\nfunction _toConsumableArray(r) { return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _iterableToArray(r) { if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r); }\nfunction _arrayWithoutHoles(r) { if (Array.isArray(r)) return _arrayLikeToArray(r); }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\nfunction _slicedToArray(r, e) { return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest(); }\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(r, a) { if (r) { if (\"string\" == typeof r) return _arrayLikeToArray(r, a); var t = {}.toString.call(r).slice(8, -1); return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0; } }\nfunction _arrayLikeToArray(r, a) { (null == a || a > r.length) && (a = r.length); for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e]; return n; }\nfunction _iterableToArrayLimit(r, l) { var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"]; if (null != t) { var e, n, i, u, a = [], f = !0, o = !1; try { if (i = (t = t.call(r)).next, 0 === l) { if (Object(t) !== t) return; f = !1; } else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0); } catch (r) { o = !0, n = r; } finally { try { if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return; } finally { if (o) throw n; } } return a; } }\nfunction _arrayWithHoles(r) { if (Array.isArray(r)) return r; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n/***********************************************************************************************************************\n\n\tlib/alert.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tTODO: This regular expression should be elsewhere.\n\n\tError prologs by engine/browser: (ca. 2018)\n\t\tChrome, Opera, & Vivaldi → `Uncaught \\w*Error: …`\n\t\tEdge & IE                → `…`\n\t\tFirefox                  → `Error: …`\n\t\tOpera (Presto)           → `Uncaught exception: \\w*(?:Error|Exception): …`\n\t\tSafari (ca. v5.1)        → `\\w*(?:Error|_ERR): …`\n*/\nvar errorPrologRegExp = /^(?:(?:uncaught\\s+(?:exception:\\s+)?)?\\w*(?:error|exception|_err):\\s+)+/i; // eslint-disable-line no-unused-vars, no-var\n\nvar Alert = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tError Functions.\n  *******************************************************************************/\n\n  function mesg(where, error, isFatal, isUncaught) {\n    var mesg = 'Error';\n    var nice = \"A\".concat(isFatal ? ' fatal' : 'n', \" error has occurred.\");\n    if (isFatal) {\n      nice += ' Aborting.';\n    } else {\n      nice += ' You may be able to continue, but some parts may not work properly.';\n    }\n    var isObject = error !== null && _typeof(error) === 'object';\n    var isExLike = isObject && 'message' in error;\n    var what = (isExLike ? String(error.message).replace(errorPrologRegExp, '') : String(error)).trim() || 'unknown error';\n    if (where != null) {\n      // lazy equality for null\n      mesg += \" [\".concat(where, \"]\");\n    }\n    mesg += \": \".concat(what, \".\");\n    if (isObject && 'stack' in error) {\n      mesg += \"\\n\\nStack Trace:\\n\".concat(error.stack);\n    }\n    if (mesg) {\n      nice += \"\\n\\n\".concat(mesg);\n    }\n\n    // Log a plain message.\n    if (!isUncaught) {\n      console[isFatal ? 'error' : 'warn'](mesg);\n    }\n\n    // Pop up a nice message.\n    window.alert(nice); // eslint-disable-line no-alert\n  }\n  function alertError(where, error) {\n    mesg(where, error);\n  }\n  function alertFatal(where, error) {\n    mesg(where, error, true);\n  }\n\n  /*******************************************************************************\n  \tError Event.\n  *******************************************************************************/\n\n  /*\n  \tSet up a global error handler for uncaught exceptions.\n  */\n  (function (origOnError) {\n    window.onerror = function (what, source, lineNum, colNum, error) {\n      // console.error(what, source, lineNum, colNum, error);\n\n      // Uncaught exceptions during play may be recoverable/ignorable.\n      if (document.readyState === 'complete') {\n        mesg(null, error != null ? error : what, false, true); // lazy equality for null\n      }\n\n      // Uncaught exceptions during startup should be fatal.\n      else {\n        mesg(null, error != null ? error : what, true, true); // lazy equality for null\n        window.onerror = origOnError;\n        if (typeof window.onerror === 'function') {\n          window.onerror.apply(this, arguments);\n        }\n      }\n    };\n  })(window.onerror);\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    error: {\n      value: alertError\n    },\n    fatal: {\n      value: alertFatal\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/patterns.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tTODO: Move all markup patterns into here.\n*/\n\n/* eslint-disable max-len */\nvar Patterns = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tPatterns.\n  *******************************************************************************/\n\n  /*\n  \tWhitespace patterns.\n  \t\tSpace class (equivalent to `\\s`):\n  \t\t[\\u0020\\f\\n\\r\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u2028\\u2029\\u202f\\u205f\\u3000\\ufeff]\n  \tSpace class, sans line terminators:\n  \t\t[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]\n  \tLine Terminator class:\n  \t\t[\\n\\r\\u2028\\u2029]\n  */\n  var space = function () {\n    /*\n    \tSome browsers still supported by SugarCube have faulty space classes (`\\s`).\n    \tWe check for that lossage here and, if necessary, build our own class from\n    \tthe component pieces.\n    */\n    var wsMap = new Map([[\" \", \"\\\\u0020\"], ['\\f', '\\\\f'], ['\\n', '\\\\n'], ['\\r', '\\\\r'], ['\\t', '\\\\t'], ['\\v', '\\\\v'], [\"\\xA0\", \"\\\\u00a0\"], [\"\\u1680\", \"\\\\u1680\"], [\"\\u180E\", \"\\\\u180e\"], [\"\\u2000\", \"\\\\u2000\"], [\"\\u2001\", \"\\\\u2001\"], [\"\\u2002\", \"\\\\u2002\"], [\"\\u2003\", \"\\\\u2003\"], [\"\\u2004\", \"\\\\u2004\"], [\"\\u2005\", \"\\\\u2005\"], [\"\\u2006\", \"\\\\u2006\"], [\"\\u2007\", \"\\\\u2007\"], [\"\\u2008\", \"\\\\u2008\"], [\"\\u2009\", \"\\\\u2009\"], [\"\\u200A\", \"\\\\u200a\"], [\"\\u2028\", \"\\\\u2028\"], [\"\\u2029\", \"\\\\u2029\"], [\"\\u202F\", \"\\\\u202f\"], [\"\\u205F\", \"\\\\u205f\"], [\"\\u3000\", \"\\\\u3000\"], [\"\\uFEFF\", \"\\\\ufeff\"]]);\n    var wsRe = /^\\s$/;\n    var missing = '';\n    wsMap.forEach(function (pat, char) {\n      if (!wsRe.test(char)) {\n        missing += pat;\n      }\n    });\n    return missing ? \"[\\\\s\".concat(missing, \"]\") : '\\\\s';\n  }();\n  var spaceNoTerminator = \"[\\\\u0020\\\\f\\\\t\\\\v\\\\u00a0\\\\u1680\\\\u180e\\\\u2000-\\\\u200a\\\\u202f\\\\u205f\\\\u3000\\\\ufeff]\";\n  var lineTerminator = \"[\\\\n\\\\r\\\\u2028\\\\u2029]\";\n  var notSpace = space === '\\\\s' ? '\\\\S' : space.replace(/^\\[/, '[^');\n\n  /*\n  \tCharacter patterns.\n  */\n  var anyChar = \"(?:.|\".concat(lineTerminator, \")\");\n\n  /*\n  \tLetter patterns.\n  \t\tFIXME:\n  \t\t1. The existing set, which is a TiddlyWiki holdover, should probably\n  \t\t   encompass a significantly greater range of BMP code points.\n  \t\t2. Should we include the surrogate pair code units (\\uD800-\\uDBFF &\n  \t\t   \\uDC00-\\uDFFF) to handle non-BMP code points?  Further, should we\n  \t\t   simply be checking for the code units themselves or checking for\n  \t\t   properly mated pairs?\n  */\n  var anyLetter = \"[0-9A-Z_a-z\\\\-\\\\u00c0-\\\\u00d6\\\\u00d8-\\\\u00f6\\\\u00f8-\\\\u00ff\\\\u0150\\\\u0170\\\\u0151\\\\u0171]\";\n  var anyLetterStrict = anyLetter.replace('\\\\-', ''); // anyLetter sans hyphen\n\n  /*\n  \tIdentifier patterns.\n  \t\tNOTE: Since JavaScript's RegExp syntax does not support Unicode character\n  \tclasses, the correct regular expression to match a valid identifier name,\n  \twithin the scope of our needs, would be on the order of approximately 5–6\n  \tor 11–16 KiB, depending on how the pattern was built.  That being the case,\n  \tfor the moment we restrict valid TwineScript identifiers to US-ASCII.\n  \t\tFIXME: Fix this to, at least, approximate the correct range.\n  */\n  var identifierFirstChar = '[$A-Z_a-z]';\n  var identifierNextChar = '[$0-9A-Z_a-z]';\n  var identifier = \"\".concat(identifierFirstChar).concat(identifierNextChar, \"*\");\n\n  // Variable patterns.\n  var variableSigil = '[$_]';\n  var variable = variableSigil + identifier;\n\n  // Macro name pattern.\n  var macroName = '[A-Za-z][\\\\w-]*|[=-]';\n\n  // Template name pattern.\n  var templateName = '[A-Za-z][\\\\w-]*';\n\n  // HTML tag name pattern.\n  var htmlTagName = function () {\n    /*\n    \tElement Name:\n    \t\t[A-Za-z] [0-9A-Za-z]*\n    \t\tCustom Element Name:\n    \t\t[a-z] (CENChar)* '-' (CENChar)*\n    \tCENChar:\n    \t\t\"-\" | \".\" | [0-9] | \"_\" | [a-z] | #xB7 | [#xC0-#xD6] | [#xD8-#xF6] | [#xF8-#x37D] | [#x37F-#x1FFF] | [#x200C-#x200D] | [#x203F-#x2040] | [#x2070-#x218F] | [#x2C00-#x2FEF] | [#x3001-#xD7FF] | [#xF900-#xFDCF] | [#xFDF0-#xFFFD] | [#x10000-#xEFFFF]\n    */\n    var cENChar = \"(?:[\\\\x2D.0-9A-Z_a-z\\\\xB7\\\\xC0-\\\\xD6\\\\xD8-\\\\xF6\\\\xF8-\\\\u037D\\\\u037F-\\\\u1FFF\\\\u200C\\\\u200D\\\\u203F\\\\u2040\\\\u2070-\\\\u218F\\\\u2C00-\\\\u2FEF\\\\u3001-\\\\uD7FF\\\\uF900-\\\\uFDCF\\\\uFDF0-\\\\uFFFD]|[\\\\uD800-\\\\uDB7F][\\\\uDC00-\\\\uDFFF])\";\n    return \"[A-Za-z](?:\".concat(cENChar, \"*-\").concat(cENChar, \"*|[0-9A-Za-z]*)\");\n  }();\n\n  // CSS ID or class sigil pattern.\n  var cssIdOrClassSigil = '[#.]';\n\n  // CSS image transclusion template pattern.\n  //\n  // NOTE: The alignment syntax isn't supported, but removing it might break uses\n  // of the template in the wild, so we leave it alone for now.\n  var cssImage = '\\\\[[<>]?[Ii][Mm][Gg]\\\\[(?:\\\\s|\\\\S)*?\\\\]\\\\]+';\n\n  // Inline CSS pattern.\n  var inlineCss = function () {\n    /* legacy */\n    var twStyle = \"(\".concat(anyLetter, \"+)\\\\(([^\\\\)\\\\|\\\\n]+)\\\\):\");\n    /* /legacy */\n    var cssStyle = \"\".concat(spaceNoTerminator, \"*(\").concat(anyLetter, \"+)\").concat(spaceNoTerminator, \"*:([^;\\\\|\\\\n]+);\");\n    var idOrClass = \"\".concat(spaceNoTerminator, \"*((?:\").concat(cssIdOrClassSigil).concat(anyLetter, \"+\").concat(spaceNoTerminator, \"*)+);\");\n\n    // [1,2] = style(value):\n    // [3,4] = style:value;\n    // [5]   = #id.className;\n    return \"\".concat(twStyle, \"|\").concat(cssStyle, \"|\").concat(idOrClass);\n  }();\n\n  // URL pattern.\n  var url = '(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\\\s\\'\"]+';\n  var externalUrl = url.replace(/\\|javascript|\\|data/g, '');\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.freeze(Object.assign(Object.create(null), {\n    space: space,\n    spaceNoTerminator: spaceNoTerminator,\n    lineTerminator: lineTerminator,\n    notSpace: notSpace,\n    anyChar: anyChar,\n    anyLetter: anyLetter,\n    anyLetterStrict: anyLetterStrict,\n    identifierFirstChar: identifierFirstChar,\n    identifierNextChar: identifierNextChar,\n    identifier: identifier,\n    variableSigil: variableSigil,\n    variable: variable,\n    macroName: macroName,\n    templateName: templateName,\n    htmlTagName: htmlTagName,\n    cssIdOrClassSigil: cssIdOrClassSigil,\n    cssImage: cssImage,\n    inlineCss: inlineCss,\n    url: url,\n    externalUrl: externalUrl\n  }));\n}();\n/* eslint-enable max-len */\n\n/***********************************************************************************************************************\n\n\textensions/ecmascript-polyfills.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns */\n\n/*\n\tECMAScript Polyfills.\n\n\tNOTE: The ES5 and ES6 polyfills come from the vendored `es5-shim.js` and `es6-shim.js` libraries.\n*/\n(function () {\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  /*\n  \tTrims whitespace from either the start or end of the given string.\n  */\n  var _trimString = function () {\n    // Whitespace regular expressions.\n    var startWSRe = new RegExp(\"^\".concat(Patterns.space).concat(Patterns.space, \"*\"));\n    var endWSRe = new RegExp(\"\".concat(Patterns.space).concat(Patterns.space, \"*$\"));\n    function trimString(str, where) {\n      var val = String(str);\n      if (!val) {\n        return val;\n      }\n      switch (where) {\n        case 'start':\n          return startWSRe.test(val) ? val.replace(startWSRe, '') : val;\n        case 'end':\n          return endWSRe.test(val) ? val.replace(endWSRe, '') : val;\n        default:\n          throw new Error(\"_trimString called with incorrect where parameter value: \\\"\".concat(where, \"\\\"\"));\n      }\n    }\n    return trimString;\n  }();\n\n  /*\n  \tGenerates a pad string based upon the given string and length.\n  */\n  function _createPadString(length, padding) {\n    var targetLength = Number.parseInt(length, 10) || 0;\n    if (targetLength < 1) {\n      return '';\n    }\n    var padString = typeof padding === 'undefined' ? '' : String(padding);\n    if (padString === '') {\n      padString = ' ';\n    }\n    while (padString.length < targetLength) {\n      var curPadLength = padString.length;\n      var remainingLength = targetLength - curPadLength;\n      padString += curPadLength > remainingLength ? padString.slice(0, remainingLength) : padString;\n    }\n    if (padString.length > targetLength) {\n      padString = padString.slice(0, targetLength);\n    }\n    return padString;\n  }\n\n  /*******************************************************************************\n  \tPolyfills.\n  *******************************************************************************/\n\n  /*\n  \t[ES2019] Returns a new array consisting of the source array with all sub-array elements\n  \tconcatenated into it recursively up to the given depth.\n  */\n  if (!Array.prototype.flat) {\n    Object.defineProperty(Array.prototype, 'flat', {\n      configurable: true,\n      writable: true,\n      value: function () {\n        function flat( /* depth */\n        ) {\n          if (this == null) {\n            // lazy equality for null\n            throw new TypeError('Array.prototype.flat called on null or undefined');\n          }\n          var depth = arguments.length === 0 ? 1 : Number(arguments[0]) || 0;\n          if (depth < 1) {\n            return Array.prototype.slice.call(this);\n          }\n          var push = Array.prototype.push;\n          return Array.prototype.reduce.call(this, function (acc, cur) {\n            if (cur instanceof Array) {\n              push.apply(acc, flat.call(cur, depth - 1));\n            } else {\n              acc.push(cur);\n            }\n            return acc;\n          }, []);\n        }\n        return flat;\n      }()\n    });\n  }\n\n  /*\n  \t[ES2019] Returns a new array consisting of the result of calling the given mapping function\n  \ton every element in the source array and then concatenating all sub-array elements into it\n  \trecursively up to a depth of `1`.  Identical to calling `<Array>.map(fn).flat()`.\n  */\n  if (!Array.prototype.flatMap) {\n    Object.defineProperty(Array.prototype, 'flatMap', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('Array.prototype.flatMap called on null or undefined');\n        }\n        return Array.prototype.map.apply(this, arguments).flat();\n      } /* callback [, thisArg] */\n    });\n  }\n\n  /*\n  \t[ES2016] Returns whether the given element was found within the array.\n  */\n  if (!Array.prototype.includes) {\n    Object.defineProperty(Array.prototype, 'includes', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('Array.prototype.includes called on null or undefined');\n        }\n        if (arguments.length === 0) {\n          return false;\n        }\n        var length = this.length >>> 0;\n        if (length === 0) {\n          return false;\n        }\n        var needle = arguments[0];\n        var i = Number(arguments[1]) || 0;\n        if (i < 0) {\n          i = Math.max(0, length + i);\n        }\n        for /* empty */\n        (; i < length; ++i) {\n          var value = this[i];\n          if (value === needle || value !== value && needle !== needle) {\n            return true;\n          }\n        }\n        return false;\n      } /* needle [, fromIndex] */\n    });\n  }\n\n  /*\n  \t[ES2017] Returns a new array consisting of the given object's own enumerable property/value\n  \tpairs as `[key, value]` arrays.\n  */\n  if (!Object.entries) {\n    Object.defineProperty(Object, 'entries', {\n      configurable: true,\n      writable: true,\n      value: function value(obj) {\n        if (_typeof(obj) !== 'object' || obj === null) {\n          throw new TypeError('Object.entries object parameter must be an object');\n        }\n        return Object.keys(obj).map(function (key) {\n          return [key, obj[key]];\n        });\n      }\n    });\n  }\n\n  /*\n  \t[ES2019] Returns a new generic object consisting of the given list's key/value pairs.\n  */\n  if (!Object.fromEntries) {\n    Object.defineProperty(Object, 'fromEntries', {\n      configurable: true,\n      writable: true,\n      value: function value(iter) {\n        return Array.from(iter).reduce(function (acc, pair) {\n          if (Object(pair) !== pair) {\n            throw new TypeError('Object.fromEntries iterable parameter must yield objects');\n          }\n          if (pair[0] in acc) {\n            Object.defineProperty(acc, pair[0], {\n              configurable: true,\n              enumerable: true,\n              writable: true,\n              value: pair[1]\n            });\n          } else {\n            acc[pair[0]] = pair[1]; // eslint-disable-line no-param-reassign\n          }\n          return acc;\n        }, {});\n      }\n    });\n  }\n\n  /*\n  \t[ES2017] Returns all own property descriptors of the given object.\n  */\n  if (!Object.getOwnPropertyDescriptors) {\n    Object.defineProperty(Object, 'getOwnPropertyDescriptors', {\n      configurable: true,\n      writable: true,\n      value: function value(obj) {\n        if (obj == null) {\n          // lazy equality for null\n          throw new TypeError('Object.getOwnPropertyDescriptors object parameter is null or undefined');\n        }\n        var O = Object(obj);\n        return Reflect.ownKeys(O).reduce(function (acc, key) {\n          var desc = Object.getOwnPropertyDescriptor(O, key);\n          if (typeof desc !== 'undefined') {\n            if (key in acc) {\n              Object.defineProperty(acc, key, {\n                configurable: true,\n                enumerable: true,\n                writable: true,\n                value: desc\n              });\n            } else {\n              acc[key] = desc; // eslint-disable-line no-param-reassign\n            }\n          }\n          return acc;\n        }, {});\n      }\n    });\n  }\n\n  /*\n  \t[ES2022] Returns whether the given object has an own property by the given name.\n  */\n  if (!Object.hasOwn) {\n    // Cache the `<Object>.hasOwnProperty()` method.\n    var _hasOwnProperty = Object.prototype.hasOwnProperty;\n    Object.defineProperty(Object, 'hasOwn', {\n      configurable: true,\n      writable: true,\n      value: function value(O, P) {\n        return _hasOwnProperty.call(Object(O), P);\n      }\n    });\n  }\n\n  /*\n  \t[ES2017] Returns a new array consisting of the given object's own enumerable property values.\n  */\n  if (!Object.values) {\n    Object.defineProperty(Object, 'values', {\n      configurable: true,\n      writable: true,\n      value: function value(obj) {\n        if (_typeof(obj) !== 'object' || obj === null) {\n          throw new TypeError('Object.values object parameter must be an object');\n        }\n        return Object.keys(obj).map(function (key) {\n          return obj[key];\n        });\n      }\n    });\n  }\n\n  /*\n  \t[ES2017] Returns a string based on concatenating the given padding, repeated as necessary,\n  \tto the start of the string so that the given length is reached.\n  \t\tNOTE: This pads based upon Unicode code units, rather than code points.\n  */\n  if (!String.prototype.padStart) {\n    Object.defineProperty(String.prototype, 'padStart', {\n      configurable: true,\n      writable: true,\n      value: function value(length, padding) {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.padStart called on null or undefined');\n        }\n        var baseString = String(this);\n        var baseLength = baseString.length;\n        var targetLength = Number.parseInt(length, 10);\n        if (targetLength <= baseLength) {\n          return baseString;\n        }\n        return _createPadString(targetLength - baseLength, padding) + baseString;\n      }\n    });\n  }\n\n  /*\n  \t[ES2017] Returns a string based on concatenating the given padding, repeated as necessary,\n  \tto the end of the string so that the given length is reached.\n  \t\tNOTE: This pads based upon Unicode code units, rather than code points.\n  */\n  if (!String.prototype.padEnd) {\n    Object.defineProperty(String.prototype, 'padEnd', {\n      configurable: true,\n      writable: true,\n      value: function value(length, padding) {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.padEnd called on null or undefined');\n        }\n        var baseString = String(this);\n        var baseLength = baseString.length;\n        var targetLength = Number.parseInt(length, 10);\n        if (targetLength <= baseLength) {\n          return baseString;\n        }\n        return baseString + _createPadString(targetLength - baseLength, padding);\n      }\n    });\n  }\n\n  /*\n  \t[ES2019] Returns a string with all whitespace removed from the start of the string.\n  */\n  if (!String.prototype.trimStart) {\n    Object.defineProperty(String.prototype, 'trimStart', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.trimStart called on null or undefined');\n        }\n        return _trimString(this, 'start');\n      }\n    });\n  }\n  if (!String.prototype.trimLeft) {\n    Object.defineProperty(String.prototype, 'trimLeft', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.trimLeft called on null or undefined');\n        }\n        return _trimString(this, 'start');\n      }\n    });\n  }\n\n  /*\n  \t[ES2019] Returns a string with all whitespace removed from the end of the string.\n  */\n  if (!String.prototype.trimEnd) {\n    Object.defineProperty(String.prototype, 'trimEnd', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.trimEnd called on null or undefined');\n        }\n        return _trimString(this, 'end');\n      }\n    });\n  }\n  if (!String.prototype.trimRight) {\n    Object.defineProperty(String.prototype, 'trimRight', {\n      configurable: true,\n      writable: true,\n      value: function value() {\n        if (this == null) {\n          // lazy equality for null\n          throw new TypeError('String.prototype.trimRight called on null or undefined');\n        }\n        return _trimString(this, 'end');\n      }\n    });\n  }\n})();\n\n/***********************************************************************************************************************\n\n\textensions/ecmascript-extensions.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Serial */\n\n/*\n\tECMAScript Extensions.\n*/\n(function () {\n  // Attempt to cache the native `Math.random`, in case it's replaced later.\n  var _nativeMathRandom = Math.random;\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a pseudo-random whole number (integer) within the given bounds.\n  */\n  function _random( /* [min ,] max */\n  ) {\n    var min;\n    var max;\n    switch (arguments.length) {\n      case 0:\n        throw new Error('_random called with insufficient parameters');\n      case 1:\n        min = 0;\n        max = arguments[0];\n        break;\n      default:\n        min = arguments[0];\n        max = arguments[1];\n        break;\n    }\n    if (min > max) {\n      var _ref = [max, min];\n      min = _ref[0];\n      max = _ref[1];\n    }\n    return Math.floor(_nativeMathRandom() * (max - min + 1)) + min;\n  }\n\n  /*\n  \tReturns a randomly selected index within the given length and bounds.\n  \tBounds may be negative.\n  */\n  function _randomIndex(length, boundsArgs) {\n    var min;\n    var max;\n    switch (boundsArgs.length) {\n      case 1:\n        min = 0;\n        max = length - 1;\n        break;\n      case 2:\n        min = 0;\n        max = Math.trunc(boundsArgs[1]);\n        break;\n      default:\n        min = Math.trunc(boundsArgs[1]);\n        max = Math.trunc(boundsArgs[2]);\n        break;\n    }\n    if (Number.isNaN(min)) {\n      min = 0;\n    } else if (!Number.isFinite(min) || min >= length) {\n      min = length - 1;\n    } else if (min < 0) {\n      min = length + min;\n      if (min < 0) {\n        min = 0;\n      }\n    }\n    if (Number.isNaN(max)) {\n      max = 0;\n    } else if (!Number.isFinite(max) || max >= length) {\n      max = length - 1;\n    } else if (max < 0) {\n      max = length + max;\n      if (max < 0) {\n        max = length - 1;\n      }\n    }\n    return _random(min, max);\n  }\n\n  /*\n  \tReturns an object (`{ char, start, end }`) containing the Unicode character at\n  \tposition `pos`, its starting position, and its ending position—surrogate pairs\n  \tare properly handled.  If `pos` is out-of-bounds, returns an object containing\n  \tthe empty string and start/end positions of `-1`.\n  \t\tThis function is necessary because JavaScript strings are sequences of UTF-16\n  \tcode units, so surrogate pairs are exposed and thus must be handled.  While the\n  \tES6/2015 standard does improve the situation somewhat, it does not alleviate\n  \tthe need for this function.\n  \t\tNOTE: Will throw exceptions on invalid surrogate pairs.\n  \t\tIDEA: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/charAt\n  */\n  function _getCodePointStartAndEnd(str, pos) {\n    var code = str.charCodeAt(pos);\n\n    // Given position was out-of-bounds.\n    if (Number.isNaN(code)) {\n      return {\n        char: '',\n        start: -1,\n        end: -1\n      };\n    }\n\n    // Code unit is not a UTF-16 surrogate.\n    if (code < 0xD800 || code > 0xDFFF) {\n      return {\n        char: str.charAt(pos),\n        start: pos,\n        end: pos\n      };\n    }\n\n    // Code unit is a high surrogate (D800–DBFF).\n    if (code >= 0xD800 && code <= 0xDBFF) {\n      var nextPos = pos + 1;\n\n      // End of string.\n      if (nextPos >= str.length) {\n        throw new Error('high surrogate without trailing low surrogate');\n      }\n      var nextCode = str.charCodeAt(nextPos);\n\n      // Next code unit is not a low surrogate (DC00–DFFF).\n      if (nextCode < 0xDC00 || nextCode > 0xDFFF) {\n        throw new Error('high surrogate without trailing low surrogate');\n      }\n      return {\n        char: str.charAt(pos) + str.charAt(nextPos),\n        start: pos,\n        end: nextPos\n      };\n    }\n\n    // Code unit is a low surrogate (DC00–DFFF) in the first position.\n    if (pos === 0) {\n      throw new Error('low surrogate without leading high surrogate');\n    }\n    var prevPos = pos - 1;\n    var prevCode = str.charCodeAt(prevPos);\n\n    // Previous code unit is not a high surrogate (D800–DBFF).\n    if (prevCode < 0xD800 || prevCode > 0xDBFF) {\n      throw new Error('low surrogate without leading high surrogate');\n    }\n    return {\n      char: str.charAt(prevPos) + str.charAt(pos),\n      start: prevPos,\n      end: pos\n    };\n  }\n\n  /*******************************************************************************\n  \t`Array` Extensions.\n  *******************************************************************************/\n\n  /*\n  \tConcatenates one or more unique elements to the end of the base array\n  \tand returns the result as a new array.  Elements which are arrays will\n  \tbe merged—i.e. their elements will be concatenated, rather than the\n  \tarray itself.\n  */\n  Object.defineProperty(Array.prototype, 'concatUnique', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.concatUnique called on null or undefined');\n      }\n      var result = Array.from(this);\n      if (arguments.length === 0) {\n        return result;\n      }\n      var items = Array.prototype.reduce.call(arguments, function (prev, cur) {\n        return prev.concat(cur);\n      }, []);\n      var addSize = items.length;\n      if (addSize === 0) {\n        return result;\n      }\n      var indexOf = Array.prototype.indexOf;\n      var push = Array.prototype.push;\n      for (var i = 0; i < addSize; ++i) {\n        var value = items[i];\n        if (indexOf.call(result, value) === -1) {\n          push.call(result, value);\n        }\n      }\n      return result;\n    } /* variadic */\n  });\n\n  /*\n  \tReturns the number of times the given element was found within the array.\n  */\n  Object.defineProperty(Array.prototype, 'count', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.count called on null or undefined');\n      }\n      var indexOf = Array.prototype.indexOf;\n      var needle = arguments[0];\n      var pos = Number(arguments[1]) || 0;\n      var count = 0;\n      while ((pos = indexOf.call(this, needle, pos)) !== -1) {\n        ++count;\n        ++pos;\n      }\n      return count;\n    } /* needle [, fromIndex ] */\n  });\n\n  /*\n  \tReturns the number elements within the array that pass the test\n  \timplemented by the given predicate function.\n  */\n  Object.defineProperty(Array.prototype, 'countWith', {\n    configurable: true,\n    writable: true,\n    value: function value(predicate, thisArg) {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.countWith called on null or undefined');\n      }\n      if (typeof predicate !== 'function') {\n        throw new Error('Array.prototype.countWith predicate parameter must be a function');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return 0;\n      }\n      var count = 0;\n      for (var i = 0; i < length; ++i) {\n        if (predicate.call(thisArg, this[i], i, this)) {\n          ++count;\n        }\n      }\n      return count;\n    }\n  });\n\n  /*\n  \tRemoves and returns all instances of the given elements from\n  \tthe array.\n  */\n  Object.defineProperty(Array.prototype, 'deleteAll', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.deleteAll called on null or undefined');\n      }\n      if (arguments.length === 0) {\n        return [];\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return [];\n      }\n      var needles = Array.prototype.concat.apply([], arguments);\n      var needlesLength = needles.length;\n      var indices = [];\n      for (var i = 0; i < length; ++i) {\n        var value = this[i];\n        for (var j = 0; j < needlesLength; ++j) {\n          var needle = needles[j];\n          if (value === needle || value !== value && needle !== needle) {\n            indices.push(i);\n            break;\n          }\n        }\n      }\n      var result = [];\n\n      // Copy the elements (in original order).\n      for (var _i = 0, iend = indices.length; _i < iend; ++_i) {\n        result[_i] = this[indices[_i]];\n      }\n      var splice = Array.prototype.splice;\n\n      // Delete the elements (in reverse order).\n      for (var _i2 = indices.length - 1; _i2 >= 0; --_i2) {\n        splice.call(this, indices[_i2], 1);\n      }\n      return result;\n    } /* needles */\n  });\n\n  /*\n  \tRemoves and returns all instances of the elements at the given\n  \tindices from the array.\n  */\n  Object.defineProperty(Array.prototype, 'deleteAt', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.deleteAt called on null or undefined');\n      }\n      if (arguments.length === 0) {\n        return [];\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return [];\n      }\n      var splice = Array.prototype.splice;\n      var cpyIndices = Array.from(new Set(\n      // Map negative indices to their positive counterparts,\n      // so the Set can properly filter out duplicates.\n      Array.from(arguments).map(function (x) {\n        return x < 0 ? Math.max(0, length + x) : x;\n      })).values());\n      var delIndices = Array.from(cpyIndices).sort(function (a, b) {\n        return b - a;\n      });\n      var result = [];\n\n      // Copy the elements (in originally specified order).\n      for (var i = 0, iend = cpyIndices.length; i < iend; ++i) {\n        result[i] = this[cpyIndices[i]];\n      }\n\n      // Delete the elements (in descending numeric order).\n      for (var _i3 = 0, _iend = delIndices.length; _i3 < _iend; ++_i3) {\n        splice.call(this, delIndices[_i3], 1);\n      }\n      return result;\n    } /* indices */\n  });\n\n  /*\n  \tRemoves and returns the first instance of all of the given elements\n  \tfrom the array.\n  \t\tTODO: (v3) This should be → `delete`.\n  */\n  Object.defineProperty(Array.prototype, 'deleteFirst', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.deleteFirst called on null or undefined');\n      }\n      if (arguments.length === 0) {\n        return;\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      var splice = Array.prototype.splice;\n      var needles = Array.prototype.concat.apply([], arguments);\n      var result = [];\n\n      // Find and remove the first instance of each needle.\n      for (var i = 0; i < length && needles.length > 0; ++i) {\n        var value = this[i];\n        for (var j = 0; j < needles.length; ++j) {\n          var needle = needles[j];\n          if (value === needle || value !== value && needle !== needle) {\n            result.push(value);\n            splice.call(this, i--, 1);\n            needles.splice(j--, 1);\n            break;\n          }\n        }\n      }\n      return result;\n    } /* needles */\n  });\n\n  /*\n  \tRemoves and returns the last instance of all of the given elements\n  \tfrom the array.\n  */\n  Object.defineProperty(Array.prototype, 'deleteLast', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.deleteLast called on null or undefined');\n      }\n      if (arguments.length === 0) {\n        return;\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      var splice = Array.prototype.splice;\n      var needles = Array.prototype.concat.apply([], arguments);\n      var result = [];\n\n      // Find and remove the last instance of each needle.\n      for (var i = length - 1; i >= 0 && needles.length > 0; --i) {\n        var value = this[i];\n        for (var j = 0; j < needles.length; ++j) {\n          var needle = needles[j];\n          if (value === needle || value !== value && needle !== needle) {\n            result.push(value);\n            splice.call(this, i++, 1);\n            needles.splice(j--, 1);\n            break;\n          }\n        }\n      }\n      return result;\n    } /* needles */\n  });\n\n  /*\n  \tRemoves and returns all of the elements that pass the test implemented\n  \tby the given predicate function from the array.\n  */\n  Object.defineProperty(Array.prototype, 'deleteWith', {\n    configurable: true,\n    writable: true,\n    value: function value(predicate, thisArg) {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.deleteWith called on null or undefined');\n      }\n      if (typeof predicate !== 'function') {\n        throw new Error('Array.prototype.deleteWith predicate parameter must be a function');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return [];\n      }\n      var splice = Array.prototype.splice;\n      var indices = [];\n      var result = [];\n\n      // Copy the elements (in original order).\n      for (var i = 0; i < length; ++i) {\n        if (predicate.call(thisArg, this[i], i, this)) {\n          result.push(this[i]);\n          indices.push(i);\n        }\n      }\n\n      // Delete the elements (in reverse order).\n      for (var _i4 = indices.length - 1; _i4 >= 0; --_i4) {\n        splice.call(this, indices[_i4], 1);\n      }\n      return result;\n    }\n  });\n\n  /*\n  \tReturns the first element from the array.\n  */\n  Object.defineProperty(Array.prototype, 'first', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.first called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      return this[0];\n    }\n  });\n\n  /*\n  \tReturns whether all of the given elements were found within the array.\n  */\n  Object.defineProperty(Array.prototype, 'includesAll', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.includesAll called on null or undefined');\n      }\n      if (arguments.length === 1) {\n        if (Array.isArray(arguments[0])) {\n          return Array.prototype.includesAll.apply(this, arguments[0]);\n        }\n        return Array.prototype.includes.apply(this, arguments);\n      }\n      for (var i = 0, iend = arguments.length; i < iend; ++i) {\n        if (!Array.prototype.some.call(this, function (val) {\n          return val === this.val || val !== val && this.val !== this.val;\n        }, {\n          val: arguments[i]\n        })) {\n          return false;\n        }\n      }\n      return true;\n    } /* needles */\n  });\n\n  /*\n  \tReturns whether any of the given elements were found within the array.\n  */\n  Object.defineProperty(Array.prototype, 'includesAny', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.includesAny called on null or undefined');\n      }\n      if (arguments.length === 1) {\n        if (Array.isArray(arguments[0])) {\n          return Array.prototype.includesAny.apply(this, arguments[0]);\n        }\n        return Array.prototype.includes.apply(this, arguments);\n      }\n      for (var i = 0, iend = arguments.length; i < iend; ++i) {\n        if (Array.prototype.some.call(this, function (val) {\n          return val === this.val || val !== val && this.val !== this.val;\n        }, {\n          val: arguments[i]\n        })) {\n          return true;\n        }\n      }\n      return false;\n    } /* needles */\n  });\n\n  /*\n  \tReturns the last element from the array.\n  */\n  Object.defineProperty(Array.prototype, 'last', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.last called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      return this[length - 1];\n    }\n  });\n\n  /*\n  \tRandomly removes an element from the base array and returns it.\n  \t[DEPRECATED] Optionally, from within the given bounds.\n  */\n  Object.defineProperty(Array.prototype, 'pluck', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.pluck called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      var index = arguments.length === 0 ? _random(0, length - 1) : _randomIndex(length, Array.from(arguments));\n      return Array.prototype.splice.call(this, index, 1)[0];\n    } /* DEPRECATED: [min ,] max */\n  });\n\n  /*\n  \tRandomly removes the given number of unique elements from the base array\n  \tand returns the removed elements as a new array.\n  */\n  Object.defineProperty(Array.prototype, 'pluckMany', {\n    configurable: true,\n    writable: true,\n    value: function value(wantSize) {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.pluckMany called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return [];\n      }\n      var want = Math.trunc(wantSize);\n      if (!Number.isInteger(want)) {\n        throw new Error('Array.prototype.pluckMany want parameter must be an integer');\n      }\n      if (want < 1) {\n        return [];\n      }\n      if (want > length) {\n        want = length;\n      }\n      var splice = Array.prototype.splice;\n      var result = [];\n      var max = length - 1;\n      do {\n        result.push(splice.call(this, _random(0, max--), 1)[0]);\n      } while (result.length < want);\n      return result;\n    }\n  });\n\n  /*\n  \tAppends one or more unique elements to the end of the base array and\n  \treturns its new length.\n  */\n  Object.defineProperty(Array.prototype, 'pushUnique', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.pushUnique called on null or undefined');\n      }\n      var addSize = arguments.length;\n      if (addSize === 0) {\n        return this.length >>> 0;\n      }\n      var indexOf = Array.prototype.indexOf;\n      var push = Array.prototype.push;\n      for (var i = 0; i < addSize; ++i) {\n        var value = arguments[i];\n        if (indexOf.call(this, value) === -1) {\n          push.call(this, value);\n        }\n      }\n      return this.length >>> 0;\n    } /* variadic */\n  });\n\n  /*\n  \tRandomly selects an element from the base array and returns it.\n  \t[DEPRECATED] Optionally, from within the given bounds.\n  */\n  Object.defineProperty(Array.prototype, 'random', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.random called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return;\n      }\n      var index = arguments.length === 0 ? _random(0, length - 1) : _randomIndex(length, Array.from(arguments));\n      return this[index];\n    } /* DEPRECATED: [min ,] max */\n  });\n\n  /*\n  \tRandomly selects the given number of unique elements from the base array\n  \tand returns the selected elements as a new array.\n  */\n  Object.defineProperty(Array.prototype, 'randomMany', {\n    configurable: true,\n    writable: true,\n    value: function value(wantSize) {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.randomMany called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return [];\n      }\n      var want = Math.trunc(wantSize);\n      if (!Number.isInteger(want)) {\n        throw new Error('Array.prototype.randomMany want parameter must be an integer');\n      }\n      if (want < 1) {\n        return [];\n      }\n      if (want > length) {\n        want = length;\n      }\n      var picked = new Map();\n      var result = [];\n      var max = length - 1;\n      do {\n        var i = void 0;\n        do {\n          i = _random(0, max);\n        } while (picked.has(i));\n        picked.set(i, true);\n        result.push(this[i]);\n      } while (result.length < want);\n      return result;\n    }\n  });\n\n  /*\n  \tRandomly shuffles the array and returns it.\n  */\n  Object.defineProperty(Array.prototype, 'shuffle', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.shuffle called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return this;\n      }\n      for (var i = length - 1; i > 0; --i) {\n        var j = Math.floor(_nativeMathRandom() * (i + 1));\n        if (i === j) {\n          continue;\n        }\n        var swap = this[i];\n        this[i] = this[j];\n        this[j] = swap;\n      }\n      return this;\n    }\n  });\n\n  /*\n  \tCreates a copy of the base array where all elements shuffled\n  \tand returns the new array.\n  */\n  Object.defineProperty(Array.prototype, 'toShuffled', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.toShuffled called on null or undefined');\n      }\n      return Array.from(this).shuffle();\n    }\n  });\n\n  /*\n  \tCreates a copy of the base array where all elements are made unique\n  \tand returns the new array.\n  */\n  Object.defineProperty(Array.prototype, 'toUnique', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.toUnique called on null or undefined');\n      }\n      return Array.from(new Set(this));\n    }\n  });\n\n  /*\n  \tPrepends one or more unique elements to the beginning of the base array\n  \tand returns its new length.\n  */\n  Object.defineProperty(Array.prototype, 'unshiftUnique', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.unshiftUnique called on null or undefined');\n      }\n      var addSize = arguments.length;\n      if (addSize === 0) {\n        return this.length >>> 0;\n      }\n      var indexOf = Array.prototype.indexOf;\n      var unshift = Array.prototype.unshift;\n      for (var i = 0; i < addSize; ++i) {\n        var value = arguments[i];\n        if (indexOf.call(this, value) === -1) {\n          unshift.call(this, value);\n        }\n      }\n      return this.length >>> 0;\n    } /* variadic */\n  });\n\n  /*******************************************************************************\n  \t`Function` Extensions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a bound function that supplies the given arguments to the base\n  \tfunction, followed by the arguments are supplied to the bound function,\n  \twhenever it is called.\n  */\n  Object.defineProperty(Function.prototype, 'partial', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Function.prototype.partial called on null or undefined');\n      }\n      var slice = Array.prototype.slice;\n      var fn = this;\n      var bound = slice.call(arguments, 0);\n      return function () {\n        var applied = [];\n        var argc = 0;\n        for (var i = 0; i < bound.length; ++i) {\n          applied.push(bound[i] === undefined ? arguments[argc++] : bound[i]);\n        }\n        return fn.apply(this, applied.concat(slice.call(arguments, argc)));\n      };\n    } /* variadic */\n  });\n\n  /*******************************************************************************\n  \t`Math` Extensions.\n  *******************************************************************************/\n\n  /*\n  \tReturns the given numerical clamped to the specified bounds.\n  */\n  Object.defineProperty(Math, 'clamp', {\n    configurable: true,\n    writable: true,\n    value: function value(num, min, max) {\n      if (arguments.length !== 3) {\n        throw new Error(\"Math.clamp called with an incorrect number of parameters (want: 3, received: \".concat(arguments.length, \")\"));\n      }\n      var value = Number(num);\n      var minVal = Number(min);\n      var maxVal = Number(max);\n      if (minVal > maxVal) {\n        var _ref2 = [maxVal, minVal];\n        minVal = _ref2[0];\n        maxVal = _ref2[1];\n      }\n      return Math.min(Math.max(value, minVal), maxVal);\n    }\n  });\n\n  /*******************************************************************************\n  \t`RegExp` Extensions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a copy of the given string with all RegExp metacharacters escaped.\n  */\n  if (!RegExp.escape) {\n    (function () {\n      var _regExpMetaCharsRe = /[\\\\^$*+?.()|[\\]{}]/g;\n      var _hasRegExpMetaCharsRe = new RegExp(_regExpMetaCharsRe.source); // to drop the global flag\n\n      Object.defineProperty(RegExp, 'escape', {\n        configurable: true,\n        writable: true,\n        value: function value(str) {\n          var val = String(str);\n          return val && _hasRegExpMetaCharsRe.test(val) ? val.replace(_regExpMetaCharsRe, '\\\\$&') : val;\n        }\n      });\n    })();\n  }\n\n  /*******************************************************************************\n  \t`String` Extensions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a formatted string, after replacing each format item in the given\n  \tformat string with the text equivalent of the corresponding argument's value.\n  */\n  (function () {\n    var _formatRegExp = /{(\\d+)(?:,([+-]?\\d+))?}/g;\n    var _hasFormatRegExp = new RegExp(_formatRegExp.source); // to drop the global flag\n\n    Object.defineProperty(String, 'format', {\n      configurable: true,\n      writable: true,\n      value: function value(format) {\n        function padString(str, align, pad) {\n          if (!align) {\n            return str;\n          }\n          var plen = Math.abs(align) - str.length;\n          if (plen < 1) {\n            return str;\n          }\n\n          // const padding = Array(plen + 1).join(pad);\n          var padding = String(pad).repeat(plen);\n          return align < 0 ? str + padding : padding + str;\n        }\n        if (arguments.length < 2) {\n          return arguments.length === 0 ? '' : format;\n        }\n        var args = arguments.length === 2 && Array.isArray(arguments[1]) ? Array.from(arguments[1]) : Array.prototype.slice.call(arguments, 1);\n        if (args.length === 0) {\n          return format;\n        }\n        if (!_hasFormatRegExp.test(format)) {\n          return format;\n        }\n\n        // Possibly required by some old buggy browsers.\n        _formatRegExp.lastIndex = 0;\n        return format.replace(_formatRegExp, function (match, index, align) {\n          var retval = args[index];\n          if (retval == null) {\n            // lazy equality for null\n            return '';\n          }\n          while (typeof retval === 'function') {\n            retval = retval();\n          }\n          switch (_typeof(retval)) {\n            case 'string':\n              /* no-op */break;\n            case 'object':\n              retval = JSON.stringify(retval);\n              break;\n            default:\n              retval = String(retval);\n              break;\n          }\n          return padString(retval, !align ? 0 : Number.parseInt(align, 10), ' ');\n        });\n      }\n    });\n  })();\n\n  /*\n  \tReturns the number of times the given substring was found within the string.\n  */\n  Object.defineProperty(String.prototype, 'count', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.count called on null or undefined');\n      }\n      var needle = String(arguments[0] || '');\n      if (needle === '') {\n        return 0;\n      }\n      var indexOf = String.prototype.indexOf;\n      var step = needle.length;\n      var pos = Number(arguments[1]) || 0;\n      var count = 0;\n      while ((pos = indexOf.call(this, needle, pos)) !== -1) {\n        ++count;\n        pos += step;\n      }\n      return count;\n    } /* needle [, fromIndex ] */\n  });\n\n  /*\n  \tReturns the first Unicode code point from the string.\n  */\n  Object.defineProperty(String.prototype, 'first', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.first called on null or undefined');\n      }\n\n      // Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n      var str = String(this);\n\n      // Get the first code point—may be one or two code units—and its end position.\n      var _getCodePointStartAnd = _getCodePointStartAndEnd(str, 0),\n        char = _getCodePointStartAnd.char;\n      return char;\n    }\n  });\n\n  /*\n  \tReturns the last Unicode code point from the string.\n  */\n  Object.defineProperty(String.prototype, 'last', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.last called on null or undefined');\n      }\n\n      // Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n      var str = String(this);\n\n      // Get the last code point—may be one or two code units—and its end position.\n      var _getCodePointStartAnd2 = _getCodePointStartAndEnd(str, str.length - 1),\n        char = _getCodePointStartAnd2.char;\n      return char;\n    }\n  });\n\n  /*\n  \tReturns a copy of the base string with `delCount` characters replaced with\n  \t`replacement`, starting at `startAt`.\n  */\n  Object.defineProperty(String.prototype, 'splice', {\n    configurable: true,\n    writable: true,\n    value: function value(startAt, delCount, replacement) {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.splice called on null or undefined');\n      }\n      var length = this.length >>> 0;\n      if (length === 0) {\n        return '';\n      }\n      var start = Number(startAt);\n      if (!Number.isSafeInteger(start)) {\n        start = 0;\n      } else if (start < 0) {\n        start += length;\n        if (start < 0) {\n          start = 0;\n        }\n      }\n      if (start > length) {\n        start = length;\n      }\n      var count = Number(delCount);\n      if (!Number.isSafeInteger(count) || count < 0) {\n        count = 0;\n      }\n      var res = this.slice(0, start);\n      if (typeof replacement !== 'undefined') {\n        res += replacement;\n      }\n      if (start + count < length) {\n        res += this.slice(start + count);\n      }\n      return res;\n    }\n  });\n\n  /*\n  \tReturns an array of strings, split from the string, or an empty array if the\n  \tstring is empty.\n  */\n  Object.defineProperty(String.prototype, 'splitOrEmpty', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.splitOrEmpty called on null or undefined');\n      }\n\n      // Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n      if (String(this) === '') {\n        return [];\n      }\n      return String.prototype.split.apply(this, arguments);\n    } /* [ separator [, limit ]] */\n  });\n\n  /*\n  \tReturns a copy of the base string with the first Unicode code point uppercased,\n  \taccording to any locale-specific rules.\n  */\n  Object.defineProperty(String.prototype, 'toLocaleUpperFirst', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.toLocaleUpperFirst called on null or undefined');\n      }\n\n      // Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n      var str = String(this);\n\n      // Get the first code point—may be one or two code units—and its end position.\n      var _getCodePointStartAnd3 = _getCodePointStartAndEnd(str, 0),\n        char = _getCodePointStartAnd3.char,\n        end = _getCodePointStartAnd3.end;\n      return end === -1 ? '' : char.toLocaleUpperCase() + str.slice(end + 1);\n    }\n  });\n\n  /*\n  \tReturns a copy of the base string with the first Unicode code point uppercased.\n  */\n  Object.defineProperty(String.prototype, 'toUpperFirst', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('String.prototype.toUpperFirst called on null or undefined');\n      }\n\n      // Required as `this` could be a `String` object or come from a `call()` or `apply()`.\n      var str = String(this);\n\n      // Get the first code point—may be one or two code units—and its end position.\n      var _getCodePointStartAnd4 = _getCodePointStartAndEnd(str, 0),\n        char = _getCodePointStartAnd4.char,\n        end = _getCodePointStartAnd4.end;\n      return end === -1 ? '' : char.toUpperCase() + str.slice(end + 1);\n    }\n  });\n\n  /*******************************************************************************\n  \tDeprecated Extensions.\n  *******************************************************************************/\n\n  /*\n  \t[DEPRECATED] Removes and returns all instances of the given elements from the array.\n  \t*/\n  Object.defineProperty(Array.prototype, 'delete', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      console.warn('[DEPRECATED] <Array>.delete() is deprecated.');\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Array.prototype.delete called on null or undefined');\n      }\n      return Array.prototype.deleteAll.apply(this, arguments);\n    } /* needles */\n  });\n\n  /*\n  \t[DEPRECATED] Allow users to easily wrap their code in the revive wrapper.\n  */\n  Object.defineProperty(JSON, 'reviveWrapper', {\n    configurable: true,\n    writable: true,\n    value: function value(code, data) {\n      console.warn('[DEPRECATED] JSON.reviveWrapper() is deprecated.');\n      if (typeof code !== 'string') {\n        throw new TypeError('JSON.reviveWrapper code parameter must be a string');\n      }\n      return Serial.createReviver(code, data);\n    }\n  });\n\n  /*\n  \t[DEPRECATED] Returns a decimal number eased from 0 to 1.\n  \t\tNOTE: The magnitude of the returned value decreases if num < 0.5 or increases if num > 0.5.\n  */\n  Object.defineProperty(Math, 'easeInOut', {\n    configurable: true,\n    writable: true,\n    value: function value(num) {\n      console.warn('[DEPRECATED] Math.easeInOut() is deprecated.');\n      return 1 - (Math.cos(Number(num) * Math.PI) + 1) / 2;\n    }\n  });\n\n  /*\n  \t[DEPRECATED] Returns the number clamped to the specified bounds.\n  */\n  Object.defineProperty(Number.prototype, 'clamp', {\n    configurable: true,\n    writable: true,\n    value: function value() {\n      console.warn('[DEPRECATED] <Number>.clamp() is deprecated.');\n      if (this == null) {\n        // lazy equality for null\n        throw new TypeError('Number.prototype.clamp called on null or undefined');\n      }\n      if (arguments.length !== 2) {\n        throw new Error(\"Number.prototype.clamp called with an incorrect number of parameters (want: 2, received: \".concat(arguments.length, \")\"));\n      }\n      return Math.clamp(this, arguments[0], arguments[1]);\n    } /* min, max */\n  });\n})();\n\n/***********************************************************************************************************************\n\n\textensions/jquery/aria-plugin.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global getActiveElement, triggerEvent */\n\n/*\n\tWAI-ARIA methods plugin.\n\n\t`<jQuery>.ariaClick([options,] handler)`\n\t    Makes the target element(s) WAI-ARIA compatible clickables.\n\n\t`<jQuery>.ariaDisabled(state)`\n\t    Changes the disabled state of the target WAI-ARIA-compatible clickable element(s).\n\n\t`<jQuery>.ariaIsDisabled()`\n\t    Checks the disabled status of the target WAI-ARIA-compatible clickable element(s).\n*/\n(function () {\n  /*\n  \tEvent handler & utility functions.\n  \t\tNOTE: Do not replace the anonymous functions herein with arrow functions.\n  */\n  function onKeypressFn(ev) {\n    // 13 is Enter/Return, 32 is Space.\n    if (ev.which === 13 || ev.which === 32) {\n      ev.preventDefault();\n\n      // To allow delegation, attempt to trigger the event on `document.activeElement`,\n      // if possible, elsewise on `this`.\n      triggerEvent('click', getActiveElement() || this);\n    }\n  }\n  function onClickFnWrapper(fn) {\n    return function () {\n      var $this = jQuery(this);\n\n      // Exit if the element is disabled.\n      //\n      // NOTE: This should only be necessary for elements which are not disableable\n      // per the HTML specification as disableable elements should be made inert\n      // automatically.\n      if ($this.ariaIsDisabled()) {\n        return;\n      }\n\n      // Toggle \"aria-pressed\" status, if the attribute exists.\n      if ($this.is('[aria-pressed]')) {\n        $this.attr('aria-pressed', $this.attr('aria-pressed') === 'true' ? 'false' : 'true');\n      }\n\n      // Call the true handler.\n      fn.apply(this, arguments);\n    };\n  }\n  function oneClickFnWrapper(fn) {\n    return onClickFnWrapper(function () {\n      // Remove both event handlers (keypress & click) and the other components.\n      jQuery(this).off('.aria-clickable').removeAttr('role tabindex aria-controls aria-pressed').filter('button').prop('disabled', true);\n\n      // Call the true handler.\n      fn.apply(this, arguments);\n    });\n  }\n  function disableTabindex(el) {\n    if (!el.hasAttribute('data-last-tabindex')) {\n      var tabindex = el.getAttribute('tabindex');\n      el.setAttribute('data-last-tabindex', tabindex !== null ? tabindex.trim() : '');\n    }\n    el.setAttribute('tabindex', -1);\n  }\n  function restoreTabindex(el) {\n    var lastTabindex = el.getAttribute('data-last-tabindex');\n    if (lastTabindex !== null) {\n      el.removeAttribute('data-last-tabindex');\n      if (lastTabindex === '') {\n        el.removeAttribute('tabindex');\n      } else {\n        el.setAttribute('tabindex', lastTabindex);\n      }\n    }\n  }\n  jQuery.fn.extend({\n    /*\n    \tExtend jQuery's chainable methods with an `ariaClick()` method.\n    */\n    ariaClick: function ariaClick(options, handler) {\n      // Bail out if there are no target element(s) or parameters.\n      if (this.length === 0 || arguments.length === 0) {\n        return this;\n      }\n      var opts = options;\n      var fn = handler;\n      if (fn == null) {\n        // lazy equality for null\n        fn = opts;\n        opts = undefined;\n      }\n      opts = jQuery.extend({\n        namespace: undefined,\n        one: false,\n        selector: undefined,\n        data: undefined,\n        role: undefined,\n        tabindex: 0,\n        // Default `0` to make elements focusable.\n        controls: undefined,\n        pressed: undefined,\n        label: undefined\n      }, opts);\n      if (typeof opts.namespace !== 'string') {\n        opts.namespace = '';\n      } else if (opts.namespace[0] !== '.') {\n        opts.namespace = \".\".concat(opts.namespace);\n      }\n      if (typeof opts.pressed === 'boolean') {\n        opts.pressed = opts.pressed ? 'true' : 'false';\n      }\n\n      // Set `type` to `button` to suppress \"submit\" semantics, for <button> elements.\n      this.filter('button').prop('type', 'button');\n\n      // Set `role`.\n      if (opts.role != null) {\n        // lazy equality for null\n        this.attr('role', opts.role);\n      }\n\n      // Elsewise, set `role` to default values based on elements.\n      else {\n        this\n        // Elements without an existing `role`.\n        .not('[role]')\n\n        // Elements that are `<a>` OR with `data-passage`.\n        .filter('a,[data-passage]').attr('role', 'link').end()\n\n        // Elements that are not `<a>` AND without `data-passage`.\n        // WARNING: Do not merge the separate `.not()` instances below.  It is correct as-is.\n        .not('a').not('[data-passage]').attr('role', 'button').end().end().end();\n      }\n\n      // Set `tabindex`.\n      this.attr('tabindex', opts.tabindex);\n\n      // Set `aria-controls`.\n      if (opts.controls != null) {\n        // lazy equality for null\n        this.attr('aria-controls', opts.controls);\n      }\n\n      // Set `aria-pressed`.\n      if (opts.pressed != null) {\n        // lazy equality for null\n        this.attr('aria-pressed', opts.pressed);\n      }\n\n      // Set `aria-label` and `title`.\n      if (opts.label != null) {\n        // lazy equality for null\n        this.attr({\n          'aria-label': opts.label,\n          title: opts.label\n        });\n      }\n\n      // Set the keypress handlers, for non-<button> elements.\n      // NOTE: For the single-use case, the click handler will also remove this handler.\n      this.not('button').on(\"keypress.aria-clickable\".concat(opts.namespace), opts.selector, onKeypressFn);\n\n      // Set the click handlers.\n      // NOTE: To ensure both handlers are properly removed, `one()` must not be used here.\n      this.on(\"click.aria-clickable\".concat(opts.namespace), opts.selector, opts.data, opts.one ? oneClickFnWrapper(fn) : onClickFnWrapper(fn));\n\n      // Return `this` for further chaining.\n      return this;\n    },\n    /*\n    \tExtend jQuery's chainable methods with an `ariaDisabled()` method.\n    */\n    ariaDisabled: function ariaDisabled(disable) {\n      // Bail out if there are no target element(s) or parameters.\n      if (this.length === 0 || arguments.length === 0) {\n        return this;\n      }\n\n      /*\n      \tNOTE: We use `<jQuery>.each()` callbacks to invoke the `<Element>.setAttribute()`\n      \tmethods in the following because the `<jQuery>.attr()` method does not allow you\n      \tto set a content attribute without a value, which is recommended for boolean\n      \tcontent attributes by the HTML specification.\n      */\n\n      var $nonDisableable = this.not('button,fieldset,input,menuitem,optgroup,option,select,textarea');\n      var $disableable = this.filter('button,fieldset,input,menuitem,optgroup,option,select,textarea');\n      if (disable) {\n        // Set boolean content attribute `disabled` to `'disabled'` and set non-boolean\n        // content attribute `aria-disabled` to `'true'`, for non-disableable elements.\n        $nonDisableable.each(function () {\n          this.setAttribute('disabled', 'disabled');\n          this.setAttribute('aria-disabled', 'true');\n          disableTabindex(this);\n        });\n\n        // Set IDL attribute `disabled` to `true` and set non-boolean content attribute\n        // `aria-disabled` to `'true'`, for disableable elements.\n        $disableable.each(function () {\n          this.disabled = true;\n          this.setAttribute('aria-disabled', 'true');\n          disableTabindex(this);\n        });\n      } else {\n        // Remove content attributes `disabled` and `aria-disabled`, for non-disableable elements.\n        $nonDisableable.each(function () {\n          this.removeAttribute('disabled');\n          this.removeAttribute('aria-disabled');\n          restoreTabindex(this);\n        });\n\n        // Set IDL attribute `disabled` to `false` and remove content attribute `aria-disabled`,\n        // for disableable elements.\n        $disableable.each(function () {\n          this.disabled = false;\n          this.removeAttribute('aria-disabled');\n          restoreTabindex(this);\n        });\n      }\n\n      // Return `this` for further chaining.\n      return this;\n    },\n    /*\n    \tExtend jQuery's chainable methods with an `ariaIsDisabled()` method.\n    */\n    ariaIsDisabled: function ariaIsDisabled() {\n      // Check content attribute `disabled`.\n      //\n      // NOTE: We simply check the `disabled` content attribute for all elements\n      // since we have to check it for non-disableable elements and it may also\n      // be used for disableable elements since their `disabled` IDL attribute\n      // is required to reflect the status of their `disabled` content attribute,\n      // and vice versa, by the HTML specification.\n      // return this.toArray().some(el => el.hasAttribute('disabled'));\n      return this.is('[disabled]');\n    }\n  });\n})();\n\n/***********************************************************************************************************************\n\n\textensions/jquery/miscellaneous-plugins.js\n\n\tCopyright © 2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tMiscellaneous methods plugin.\n\n\t`<jQuery>.getForbiddenInteractiveContentTagNames()`\n\tReturns an array of tag names of forbidden elements within the target element(s).\n*/\n(function () {\n  jQuery.fn.extend({\n    /*\n    \tExtend jQuery's chainable methods with a `getForbiddenInteractiveContentTagNames()` method.\n    */\n    getForbiddenInteractiveContentTagNames: function getForbiddenInteractiveContentTagNames() {\n      // Bail out if there are no target element(s).\n      if (this.length === 0) {\n        return [];\n      }\n      var forbidden = new Set();\n\n      // Populate the set with the forbidden tags contained within the targets.\n      this.find('a,button,fieldset,form,input,menuitem,optgroup,option,select,textarea').each(function (_, el) {\n        return forbidden.add(el.nodeName.toLowerCase());\n      });\n\n      // Return an array of the forbidden set.\n      return Array.from(forbidden);\n    }\n  });\n})();\n\n/***********************************************************************************************************************\n\n\textensions/jquery/wiki-plugin.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Story, Wikifier, errorPrologRegExp */\n\n/*\n\tWikifier methods plugin.\n\n\t`jQuery.wikiWithOptions(options, sources…)`\n\t    Wikifies the given content source(s), as directed by the given options.\n\n\t`jQuery.wiki(sources…)`\n\t    Wikifies the given content source(s).\n\n\t`<jQuery>.wikiWithOptions(options, sources…)`\n\t    Wikifies the given content source(s) and appends the result to the target\n\t    element(s), as directed by the given options.\n\n\t`<jQuery>.wiki(sources…)`\n\t    Wikifies the given content source(s) and appends the result to the target\n\t    element(s).\n*/\n(function () {\n  jQuery.extend({\n    /*\n    \tExtend jQuery's static methods with a `wikiWithOptions()` method.\n    */\n    wikiWithOptions: function wikiWithOptions(options) {\n      for (var _len = arguments.length, sources = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n        sources[_key - 1] = arguments[_key];\n      }\n      // Bail out, if there are no content sources.\n      if (sources.length === 0) {\n        return;\n      }\n\n      // Wikify the content sources into a fragment.\n      var frag = document.createDocumentFragment();\n      sources.forEach(function (content) {\n        return new Wikifier(frag, content, options);\n      });\n\n      // Gather the text of any error elements within the fragment…\n      var errors = Array.from(frag.querySelectorAll('.error')).map(function (errEl) {\n        return errEl.textContent.replace(errorPrologRegExp, '');\n      });\n\n      // …and throw an exception, if there were any errors.\n      if (errors.length > 0) {\n        throw new Error(errors.join('; '));\n      }\n    },\n    /*\n    \tExtend jQuery's static methods with a `wiki()` method.\n    */\n    wiki: function wiki() {\n      for (var _len2 = arguments.length, sources = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        sources[_key2] = arguments[_key2];\n      }\n      this.wikiWithOptions.apply(this, [undefined].concat(sources));\n    },\n    /*\n    \tExtend jQuery's static methods with a `wikiPassage()` method.\n    */\n    wikiPassage: function wikiPassage(name) {\n      this.wikiWithOptions(undefined, Story.get(name).processText());\n    }\n  });\n  jQuery.fn.extend({\n    /*\n    \tExtend jQuery's chainable methods with a `wikiWithOptions()` method.\n    */\n    wikiWithOptions: function wikiWithOptions(options) {\n      for (var _len3 = arguments.length, sources = new Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n        sources[_key3 - 1] = arguments[_key3];\n      }\n      // Bail out if there are no target element(s) or content sources.\n      if (this.length === 0 || sources.length === 0) {\n        return this;\n      }\n\n      // Wikify the content sources into a fragment.\n      var frag = document.createDocumentFragment();\n      sources.forEach(function (content) {\n        return new Wikifier(frag, content, options);\n      });\n\n      // Append the fragment to the target element(s).\n      this.append(frag);\n\n      // Return `this` for further chaining.\n      return this;\n    },\n    /*\n    \tExtend jQuery's chainable methods with a `wiki()` method.\n    */\n    wiki: function wiki() {\n      for (var _len4 = arguments.length, sources = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        sources[_key4] = arguments[_key4];\n      }\n      return this.wikiWithOptions.apply(this, [undefined].concat(sources));\n    },\n    /*\n    \tExtend jQuery's chainable methods with a `wikiPassage()` method.\n    */\n    wikiPassage: function wikiPassage(name) {\n      return this.wikiWithOptions(undefined, Story.get(name).processText());\n    }\n  });\n})();\n\n/***********************************************************************************************************************\n\n\tlib/browser.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\nvar Browser = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /* eslint-disable max-len */\n  var userAgent = navigator.userAgent.toLowerCase();\n  var winPhone = userAgent.includes('windows phone');\n  var isMobile = Object.freeze({\n    Android: !winPhone && userAgent.includes('android'),\n    BlackBerry: /blackberry|bb10/.test(userAgent),\n    iOS: !winPhone && /ip(?:hone|ad|od)/.test(userAgent),\n    Opera: !winPhone && (_typeof(window.operamini) === 'object' || userAgent.includes('opera mini')),\n    Windows: winPhone || /iemobile|wpdesktop/.test(userAgent),\n    any: function any() {\n      return isMobile.Android || isMobile.BlackBerry || isMobile.iOS || isMobile.Opera || isMobile.Windows;\n    }\n  });\n  var isGecko = !isMobile.Windows && !/khtml|trident|edge/.test(userAgent) && userAgent.includes('gecko');\n  var isIE = !userAgent.includes('opera') && /msie|trident/.test(userAgent);\n  var ieVersion = isIE ? function () {\n    var ver = /(?:msie\\s+|rv:)(\\d+\\.\\d)/.exec(userAgent);\n    return ver ? Number(ver[1]) : 0;\n  }() : null;\n\n  // opera <= 12: \"opera/9.80 (windows nt 6.1; wow64) presto/2.12.388 version/12.16\"\n  // opera >= 15: \"mozilla/5.0 (windows nt 6.1; wow64) applewebkit/537.36 (khtml, like gecko) chrome/28.0.1500.52 safari/537.36 opr/15.0.1147.130\"\n  var isOpera = userAgent.includes('opera') || userAgent.includes(' opr/');\n  var operaVersion = isOpera ? function () {\n    var re = new RegExp(\"\".concat(/khtml|chrome/.test(userAgent) ? 'opr' : 'version', \"\\\\/(\\\\d+\\\\.\\\\d+)\"));\n    var ver = re.exec(userAgent);\n    return ver ? Number(ver[1]) : 0;\n  }() : null;\n  var isVivaldi = userAgent.includes('vivaldi');\n  /* eslint-enable max-len */\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.freeze(Object.assign(Object.create(null), {\n    userAgent: userAgent,\n    isMobile: isMobile,\n    isGecko: isGecko,\n    isIE: isIE,\n    ieVersion: ieVersion,\n    isOpera: isOpera,\n    operaVersion: operaVersion,\n    isVivaldi: isVivaldi\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/has.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Browser */\n\nvar Has = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*\n  \tNOTE: The aggressive try/catch feature tests are necessitated by\n  \timplementation bugs in various browsers.\n  */\n\n  // Is the `HTMLAudioElement` API available?\n  var hasAudioElement = function () {\n    try {\n      return typeof document.createElement('audio').canPlayType === 'function';\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the `File` API available?\n  var hasFile = function () {\n    try {\n      return 'Blob' in window && 'File' in window && 'FileList' in window && 'FileReader' in window && (!Browser.isOpera || Browser.operaVersion >= 15);\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the `geolocation` API available?\n  var hasGeolocation = function () {\n    try {\n      return 'geolocation' in navigator && typeof navigator.geolocation.getCurrentPosition === 'function' && typeof navigator.geolocation.watchPosition === 'function';\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the `MutationObserver` API available?\n  var hasMutationObserver = function () {\n    try {\n      return 'MutationObserver' in window && typeof window.MutationObserver === 'function';\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the `performance` API available?\n  var hasPerformance = function () {\n    try {\n      return 'performance' in window && typeof window.performance.now === 'function';\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the platform a touch device?\n  var hasTouch = function () {\n    try {\n      return 'ontouchstart' in window || !!window.DocumentTouch && document instanceof window.DocumentTouch || !!navigator.maxTouchPoints || !!navigator.msMaxTouchPoints;\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  // Is the transition end event available and by what name?\n  var hasTransitionEndEvent = function () {\n    try {\n      var teMap = new Map([['transition', 'transitionend'], ['MSTransition', 'msTransitionEnd'], ['WebkitTransition', 'webkitTransitionEnd'], ['MozTransition', 'transitionend']]);\n      var teKeys = Array.from(teMap.keys());\n      var el = document.createElement('div');\n      for (var i = 0; i < teKeys.length; ++i) {\n        if (el.style[teKeys[i]] !== undefined) {\n          return teMap.get(teKeys[i]);\n        }\n      }\n    } catch (ex) {/* no-op */}\n    return false;\n  }();\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.freeze(Object.assign(Object.create(null), {\n    audio: hasAudioElement,\n    fileAPI: hasFile,\n    geolocation: hasGeolocation,\n    mutationObserver: hasMutationObserver,\n    performance: hasPerformance,\n    touch: hasTouch,\n    transitionEndEvent: hasTransitionEndEvent\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/fullscreen.js\n\n\tCopyright © 2018–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Browser */\n\nvar Fullscreen = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*\n  \tSEE:\n  \t\thttps://fullscreen.spec.whatwg.org\n  \t\thttps://developer.mozilla.org/en-US/docs/Web/API/Fullscreen_API\n  */\n\n  // Vendor properties object.\n  var vendor = function () {\n    try {\n      return Object.freeze([\n      // Specification.\n      {\n        isEnabled: 'fullscreenEnabled',\n        element: 'fullscreenElement',\n        requestFn: 'requestFullscreen',\n        exitFn: 'exitFullscreen',\n        changeEvent: 'fullscreenchange',\n        // prop: onfullscreenchange\n        errorEvent: 'fullscreenerror' // prop: onfullscreenerror\n      },\n      // `webkit` prefixed: old Blink, WebKit, & Edge.\n      {\n        isEnabled: 'webkitFullscreenEnabled',\n        element: 'webkitFullscreenElement',\n        requestFn: 'webkitRequestFullscreen',\n        exitFn: 'webkitExitFullscreen',\n        changeEvent: 'webkitfullscreenchange',\n        errorEvent: 'webkitfullscreenerror'\n      },\n      // `moz` prefixed: old Gecko, maybe Seamonkey.\n      {\n        isEnabled: 'mozFullScreenEnabled',\n        element: 'mozFullScreenElement',\n        requestFn: 'mozRequestFullScreen',\n        exitFn: 'mozCancelFullScreen',\n        changeEvent: 'mozfullscreenchange',\n        errorEvent: 'mozfullscreenerror'\n      },\n      // `ms` prefixed: IE 11.\n      {\n        isEnabled: 'msFullscreenEnabled',\n        element: 'msFullscreenElement',\n        requestFn: 'msRequestFullscreen',\n        exitFn: 'msExitFullscreen',\n        changeEvent: 'MSFullscreenChange',\n        errorEvent: 'MSFullscreenError'\n      }].find(function (vnd) {\n        return vnd.isEnabled in document;\n      }));\n    } catch (ex) {/* no-op */}\n    return undefined;\n  }();\n\n  /*******************************************************************************\n  \tFeature Detection Functions.\n  *******************************************************************************/\n\n  // Return whether the request and exit fullscreen methods return a `Promise`.\n  //\n  // NOTE: The initial result is cached for future calls.\n  var _returnsPromise = function () {\n    // Cache of whether the request and exit methods return a `Promise`.\n    var _hasPromise = null;\n    function _returnsPromise() {\n      if (_hasPromise !== null) {\n        return _hasPromise;\n      }\n      _hasPromise = false;\n      if (vendor) {\n        try {\n          var value = document.exitFullscreen();\n\n          // Silence \"Uncaught (in promise)\" console errors from Blink.\n          //\n          // NOTE: Swallowing errors is generally bad, but in this case we know there's\n          // going to be an error regardless, since we shouldn't be in fullscreen yet,\n          // and we don't actually care about the error, since we just want the return\n          // value, so we consign it to the bit bucket.\n          //\n          // NOTE: We don't ensure that the return value is not `undefined` here because\n          // having the attempted call to `<Promise>.catch()` on an `undefined` value throw\n          // is acceptable, since it will be caught and `false` eventually returned.\n          value.catch(function () {/* no-op */});\n          _hasPromise = value instanceof Promise;\n        } catch (ex) {/* no-op */}\n      }\n      return _hasPromise;\n    }\n    return _returnsPromise;\n  }();\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function _selectElement(requestedEl) {\n    var selectedEl = requestedEl || document.documentElement;\n\n    // Document element scrolling workaround for older browsers.\n    if (selectedEl === document.documentElement && (vendor.requestFn === 'msRequestFullscreen' // IE 11\n    || Browser.isOpera && Browser.operaVersion < 15 // Opera 12 (Presto)\n    )) {\n      selectedEl = document.body;\n    }\n    return selectedEl;\n  }\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  function getVendor() {\n    return vendor;\n  }\n  function getElement() {\n    return (vendor || null) && document[vendor.element];\n  }\n  function isEnabled() {\n    return Boolean(vendor && document[vendor.isEnabled]);\n  }\n  function isFullscreen() {\n    return Boolean(vendor && document[vendor.element]);\n  }\n  function requestFullscreen(options, requestedEl) {\n    if (!vendor) {\n      return Promise.reject(new Error('fullscreen not supported'));\n    }\n    var element = _selectElement(requestedEl);\n    if (typeof element[vendor.requestFn] !== 'function') {\n      return Promise.reject(new Error('fullscreen not supported'));\n    }\n    if (isFullscreen()) {\n      return Promise.resolve();\n    }\n    if (_returnsPromise()) {\n      return element[vendor.requestFn](options);\n    } else {\n      // eslint-disable-line no-else-return\n      var namespace = '.Fullscreen_requestFullscreen';\n      return new Promise(function (resolve, reject) {\n        var $element = jQuery(element);\n        $element.off(namespace).one(\"\".concat(vendor.errorEvent).concat(namespace, \" \").concat(vendor.changeEvent).concat(namespace), function (ev) {\n          $element.off(namespace);\n          if (ev.type === vendor.errorEvent) {\n            reject(new Error('unknown fullscreen request error'));\n          } else {\n            resolve();\n          }\n        });\n        element[vendor.requestFn](options);\n      });\n    }\n  }\n  function exitFullscreen() {\n    if (!vendor || typeof document[vendor.exitFn] !== 'function') {\n      return Promise.reject(new TypeError('fullscreen not supported'));\n    }\n    if (!isFullscreen()) {\n      return Promise.reject(new TypeError('fullscreen mode not active'));\n    }\n    if (_returnsPromise()) {\n      return document[vendor.exitFn]();\n    } else {\n      // eslint-disable-line no-else-return\n      var namespace = '.Fullscreen_exitFullscreen';\n      return new Promise(function (resolve, reject) {\n        var $document = jQuery(document);\n        $document.off(namespace).one(\"\".concat(vendor.errorEvent).concat(namespace, \" \").concat(vendor.changeEvent).concat(namespace), function (ev) {\n          $document.off(namespace);\n          if (ev.type === vendor.errorEvent) {\n            reject(new Error('unknown fullscreen exit error'));\n          } else {\n            resolve();\n          }\n        });\n        document[vendor.exitFn]();\n      });\n    }\n  }\n  function toggleFullscreen(options, requestedEl) {\n    return isFullscreen() ? exitFullscreen() : requestFullscreen(options, requestedEl);\n  }\n  function onChange(handlerFn, requestedEl) {\n    if (!vendor) {\n      return;\n    }\n    var element = _selectElement(requestedEl);\n    jQuery(element).on(vendor.changeEvent, handlerFn);\n  }\n  function offChange(handlerFn, requestedEl) {\n    if (!vendor) {\n      return;\n    }\n    var element = _selectElement(requestedEl);\n    if (handlerFn) {\n      jQuery(element).off(vendor.changeEvent, handlerFn);\n    } else {\n      jQuery(element).off(vendor.changeEvent);\n    }\n  }\n  function onError(handlerFn, requestedEl) {\n    if (!vendor) {\n      return;\n    }\n    var element = _selectElement(requestedEl);\n    jQuery(element).on(vendor.errorEvent, handlerFn);\n  }\n  function offError(handlerFn, requestedEl) {\n    if (!vendor) {\n      return;\n    }\n    var element = _selectElement(requestedEl);\n    if (handlerFn) {\n      jQuery(element).off(vendor.errorEvent, handlerFn);\n    } else {\n      jQuery(element).off(vendor.errorEvent);\n    }\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    vendor: {\n      get: getVendor\n    },\n    element: {\n      get: getElement\n    },\n    isEnabled: {\n      value: isEnabled\n    },\n    isFullscreen: {\n      value: isFullscreen\n    },\n    request: {\n      value: requestFullscreen\n    },\n    exit: {\n      value: exitFullscreen\n    },\n    toggle: {\n      value: toggleFullscreen\n    },\n    onChange: {\n      value: onChange\n    },\n    offChange: {\n      value: offChange\n    },\n    onError: {\n      value: onError\n    },\n    offError: {\n      value: offError\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/outliner.js\n\n\tCopyright © 2015–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tOutliner API static object.\n*/\nvar Outliner = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Cache of the outline patching `<style>` element.\n  var styleEl = null;\n\n  // Last event seen.\n  var lastEvent;\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  function outlinerInit() {\n    if (styleEl) {\n      return;\n    }\n\n    // Generate the `<style>` element.\n    styleEl = document.createElement('style');\n\n    // Append the element to the document head.\n    jQuery(styleEl).attr({\n      id: 'style-outliner',\n      type: 'text/css'\n    }).appendTo(document.head);\n\n    // Attach the event handler to manipulate the outlines.\n    jQuery(document).on('mousedown.style-outliner keydown.style-outliner', function (ev) {\n      if (ev.type !== lastEvent) {\n        lastEvent = ev.type;\n        if (ev.type === 'keydown') {\n          outlinerShow();\n        } else {\n          outlinerHide();\n        }\n      }\n    });\n\n    // Initially hide outlines.\n    lastEvent = 'mousedown';\n    outlinerHide();\n  }\n  function outlinerHide() {\n    document.documentElement.removeAttribute('data-outlines');\n\n    // For IE ≤ 10.\n    if (styleEl.styleSheet) {\n      styleEl.styleSheet.cssText = '*:focus{outline:none;}';\n    }\n\n    // For all other browsers.\n    else {\n      styleEl.textContent = '*:focus{outline:none;}';\n    }\n  }\n  function outlinerShow() {\n    document.documentElement.setAttribute('data-outlines', '');\n\n    // For IE ≤ 10.\n    if (styleEl.styleSheet) {\n      styleEl.styleSheet.cssText = '';\n    }\n\n    // For all other browsers.\n    else {\n      styleEl.textContent = '';\n    }\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    init: {\n      value: outlinerInit\n    },\n    hide: {\n      value: outlinerHide\n    },\n    show: {\n      value: outlinerShow\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/serial.js\n\n\tCopyright © 2018–2021 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tSerial API static object.\n*/\nvar Serial = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Supported type collection.\n  var supportedTypes = Object.freeze([{\n    id: 'Date',\n    get reference() {\n      return Date.prototype;\n    },\n    method: function method() {\n      return ['(revive:date)', this.toISOString()];\n    }\n  }, {\n    // TODO: Deprecate this!\n    id: 'Function',\n    get reference() {\n      return Function.prototype;\n    },\n    method: function method() {\n      // The enclosing parenthesis here are necessary to force the function expression code\n      // string, returned by `this.toString()`, to be evaluated as an expression during\n      // revival.  Without them, the function expression, which may be nameless, will be\n      // evaluated as a function definition—which will throw a syntax error exception, since\n      // function definitions must have a name.\n      return ['(revive:)', [\"(\".concat(this.toString(), \")\")]];\n    }\n  }, {\n    id: 'Map',\n    get reference() {\n      return Map.prototype;\n    },\n    method: function method() {\n      return ['(revive:map)', Array.from(this)];\n    }\n  }, {\n    id: 'RegExp',\n    get reference() {\n      return RegExp.prototype;\n    },\n    method: function method() {\n      return ['(revive:)', [this.toString()]];\n    }\n  }, {\n    id: 'Set',\n    get reference() {\n      return Set.prototype;\n    },\n    method: function method() {\n      return ['(revive:set)', Array.from(this)];\n    }\n  }]);\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  // Allow users to easily prepare their class code for revival.\n  function createReviver(code, data) {\n    if (typeof code !== 'string') {\n      throw new TypeError('Serial.createReviver code parameter must be a string');\n    }\n    return ['(revive:)', [code, data]];\n  }\n  function parse(text, reviver) {\n    return JSON.parse(text, function (key, val) {\n      var value = val;\n\n      // Attempt to revive wrapped values.\n      if (value instanceof Array && value.length === 2) {\n        switch (value[0]) {\n          case '(revive:set)':\n            value = new Set(value[1]);\n            break;\n          case '(revive:map)':\n            value = new Map(value[1]);\n            break;\n          case '(revive:date)':\n            value = new Date(value[1]);\n            break;\n          case '(revive:eval)': /* legacy */\n          case '(revive:)':\n            {\n              try {\n                var $ReviveData$ = value[1][1]; // eslint-disable-line no-unused-vars\n                value = eval(value[1][0]); // eslint-disable-line no-eval\n              } catch (ex) {/* no-op; though, perhaps we should handle this somehow */}\n              break;\n            }\n        }\n      }\n\n      // Call the custom reviver, if specified.\n      if (typeof reviver === 'function') {\n        try {\n          value = reviver(key, value);\n        } catch (ex) {/* no-op; though, perhaps we should handle this somehow */}\n      }\n      return value;\n    });\n  }\n  function stringify(value, replacer, space) {\n    var origMethodCache = new Map();\n\n    // Attach our `toJSON` methods to the supported types, caching existent\n    // methods for later restoration.\n    supportedTypes.forEach(function (_ref3) {\n      var id = _ref3.id,\n        reference = _ref3.reference,\n        method = _ref3.method;\n      if (Object.hasOwn(reference, 'toJSON')) {\n        origMethodCache.set(id, reference.toJSON);\n      }\n      Object.defineProperty(reference, 'toJSON', {\n        configurable: true,\n        writable: true,\n        value: method\n      });\n    });\n    var notation = JSON.stringify(value, function (key, val) {\n      var value = val;\n\n      // Call the custom replacer, if specified.\n      if (typeof replacer === 'function') {\n        try {\n          value = replacer(key, value);\n        } catch (ex) {/* no-op; though, perhaps we should handle this somehow */}\n      }\n\n      // Handle supported primitive values unsupported by JSON.\n      switch (value) {\n        case undefined:\n          value = ['(revive:)', ['undefined']];\n          break;\n        case Infinity:\n          value = ['(revive:)', ['Infinity']];\n          break;\n      }\n      return value;\n    }, space);\n\n    // Restore supported types to their original state.\n    supportedTypes.forEach(function (_ref4) {\n      var id = _ref4.id,\n        reference = _ref4.reference;\n      if (origMethodCache.has(id)) {\n        Object.defineProperty(reference, 'toJSON', {\n          configurable: true,\n          writable: true,\n          value: origMethodCache.get(id)\n        });\n        origMethodCache.delete(id);\n      } else {\n        delete reference.toJSON; // eslint-disable-line no-param-reassign\n      }\n    });\n    return notation;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    createReviver: {\n      value: createReviver\n    },\n    parse: {\n      value: parse\n    },\n    stringify: {\n      value: stringify\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/visibility.js\n\n\tCopyright © 2018–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\nvar Visibility = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*\n  \tThere are two versions of the Page Visibility API: First Edition and, the current,\n  \tSecond Edition (i.e. \"Level 2\").  First Edition is mentioned here only because some\n  \tolder browsers implement it, rather than the current specification.\n  \t\tSEE:\n  \t\tSecond Edition : https://www.w3.org/TR/page-visibility/\n  \t\tFirst Edition  : https://www.w3.org/TR/2013/REC-page-visibility-20130514/\n  \t\tNOTE: Generally, all supported browsers change the visibility state when either switching tabs\n  \twithin the browser or minimizing the browser window.  Exceptions are noted below:\n  \t\t* IE 9 doesn't support either version of the Page Visibility API.\n  \t\t* Opera 12 (Presto) doesn't change the visibility state when the browser is minimized.\n  */\n\n  // Vendor properties object.\n  var vendor = function () {\n    try {\n      return Object.freeze([\n      // Specification.\n      {\n        hiddenProperty: 'hidden',\n        // boolean; historical in 2nd edition\n        stateProperty: 'visibilityState',\n        // string, values: 'hidden', 'visible'; 1st edition had more values\n        changeEvent: 'visibilitychange'\n      },\n      // `webkit` prefixed: old Blink & WebKit.\n      {\n        hiddenProperty: 'webkitHidden',\n        stateProperty: 'webkitVisibilityState',\n        changeEvent: 'webkitvisibilitychange'\n      },\n      // `moz` prefixed: old Gecko, maybe Seamonkey.\n      {\n        hiddenProperty: 'mozHidden',\n        stateProperty: 'mozVisibilityState',\n        changeEvent: 'mozvisibilitychange'\n      },\n      // `ms` prefixed: IE 10.\n      {\n        hiddenProperty: 'msHidden',\n        stateProperty: 'msVisibilityState',\n        changeEvent: 'msvisibilitychange'\n      }].find(function (vnd) {\n        return vnd.hiddenProperty in document;\n      }));\n    } catch (ex) {/* no-op */}\n    return undefined;\n  }();\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  function getVendor() {\n    return vendor;\n  }\n  function getVisibility() {\n    return vendor && document[vendor.stateProperty] || 'visible';\n  }\n  function isEnabled() {\n    return Boolean(vendor);\n  }\n  function isHidden() {\n    // return Boolean(vendor && document[vendor.stateProperty] === 'hidden');\n    return Boolean(vendor && document[vendor.hiddenProperty]); // NOTE: Historical, but probably better for 1st edition.\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Functions.\n    vendor: {\n      get: getVendor\n    },\n    state: {\n      get: getVisibility\n    },\n    isEnabled: {\n      value: isEnabled\n    },\n    isHidden: {\n      value: isHidden\n    },\n    // Properties.\n    hiddenProperty: {\n      value: vendor && vendor.hiddenProperty\n    },\n    stateProperty: {\n      value: vendor && vendor.stateProperty\n    },\n    changeEvent: {\n      value: vendor && vendor.changeEvent\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tutil/appenderror.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global L10n */\n\n/*\n\tAppends an error view to the given DOM element or fragment and logs a message to the console.\n*/\nfunction appendError(output, message, source) {\n  // eslint-disable-line no-unused-vars\n  var $wrapper = jQuery(document.createElement('div'));\n  var $toggle = jQuery(document.createElement('button'));\n  var $source = jQuery(document.createElement('pre'));\n  var mesg = \"\".concat(L10n.get('errorViewTitle'), \": \").concat(message || 'unknown error');\n  $toggle.addClass('error-toggle').ariaClick({\n    label: L10n.get('errorViewLabelToggle')\n  }, function () {\n    if ($toggle.hasClass('enabled')) {\n      $toggle.removeClass('enabled');\n      $source.attr({\n        'aria-hidden': true,\n        hidden: 'hidden'\n      });\n    } else {\n      $toggle.addClass('enabled');\n      $source.removeAttr('aria-hidden hidden');\n    }\n  }).appendTo($wrapper);\n  jQuery(document.createElement('span')).addClass('error').text(mesg).appendTo($wrapper);\n  jQuery(document.createElement('code')).text(source).appendTo($source);\n  $source.addClass('error-source').attr({\n    'aria-hidden': true,\n    hidden: 'hidden'\n  }).appendTo($wrapper);\n  $wrapper.addClass('error-view').appendTo(output);\n  console.warn(\"\".concat(mesg, \"\\n\\t\").concat(source.replace(/\\n/g, '\\n\\t')));\n  return false;\n}\n\n/* legacy */\nvar throwError = appendError; // eslint-disable-line no-unused-vars, no-var\n/* /legacy */\n\n/***********************************************************************************************************************\n\n\tutil/charandposat.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns an object containing the Unicode character, which may consist of one\n\tor two UTF-16 code points, at the given position within the given string and\n\tits starting/ending positions.  If the position is out-of-bounds, returns an\n\tobject containing the empty string and both positions set to `-1`.\n*/\nfunction charAndPosAt(string, position) {\n  // eslint-disable-line no-unused-vars\n  var str = String(string);\n  var pos = Math.trunc(position);\n  var code = str.charCodeAt(pos);\n\n  // Given position was out-of-bounds.\n  if (Number.isNaN(code)) {\n    return {\n      char: '',\n      start: -1,\n      end: -1\n    };\n  }\n  var retval = {\n    char: str.charAt(pos),\n    start: pos,\n    end: pos\n  };\n\n  // Code unit is not a UTF-16 surrogate.\n  if (code < 0xD800 || code > 0xDFFF) {\n    return retval;\n  }\n\n  // Code unit is a high surrogate (D800–DBFF).\n  if (code >= 0xD800 && code <= 0xDBFF) {\n    var nextPos = pos + 1;\n\n    // End of string.\n    if (nextPos >= str.length) {\n      return retval;\n    }\n    var nextCode = str.charCodeAt(nextPos);\n\n    // Next code unit is not a low surrogate (DC00–DFFF).\n    if (nextCode < 0xDC00 || nextCode > 0xDFFF) {\n      return retval;\n    }\n    retval.char = retval.char + str.charAt(nextPos);\n    retval.end = nextPos;\n    return retval;\n  }\n\n  // Code unit is a low surrogate (DC00–DFFF) in the first position.\n  if (pos === 0) {\n    return retval;\n  }\n  var prevPos = pos - 1;\n  var prevCode = str.charCodeAt(prevPos);\n\n  // Previous code unit is not a high surrogate (D800–DBFF).\n  if (prevCode < 0xD800 || prevCode > 0xDBFF) {\n    return retval;\n  }\n  retval.char = str.charAt(prevPos) + retval.char;\n  retval.start = prevPos;\n  return retval;\n}\n\n/***********************************************************************************************************************\n\n\tutil/clone.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global getTypeOf */\n\n/*\n\tReturns a deep copy of the given value.\n\n\tSupports: arrays, booleans, dates, functions, generic objects, maps,\n\tnumbers, null, regexps, sets, strings, symbols, and undefined.  Throws\n\tan error for any other value.\n\n\tWARNING: Referential relationships between objects are not maintained—i.e.,\n\tafter cloning multiple references to an object will refer to seperate yet\n\tequivalent objects, as each reference receives its own clone of the original.\n\n\tWARNING: Generic objects have only their own enumerable properties copied.\n\tNon-enumerable properties and property descriptors—e.g., getters/setters\n\tand configuration metadata—are not duplicated and likely will never be.\n\n\tWARNING: Functions are returned as-is as behavior is immutable.  Neither\n\texpando properties nor scope are copied—the former is a choice and the\n\tlatter is impossible.\n*/\nfunction clone(O) {\n  // eslint-disable-line no-unused-vars\n  // Immediately return primitives and functions.\n  if (_typeof(O) !== 'object' || O === null) {\n    return O;\n  }\n\n  // Immediately defer to objects' native `clone` method.\n  if (typeof O.clone === 'function') {\n    return O.clone(true);\n  }\n\n  // Handle instances of supported object types and generic objects.\n  //\n  // NOTE: Each non-generic object that we support must be explicitly\n  // handled below.\n\n  var copy;\n\n  // Initialize copies of `Array` objects.\n  if (O instanceof Array) {\n    copy = new Array(O.length);\n  }\n\n  // Copy `Date` objects.\n  else if (O instanceof Date) {\n    copy = new Date(O.getTime());\n  }\n\n  // Copy `Map` objects.\n  else if (O instanceof Map) {\n    copy = new Map();\n    O.forEach(function (val, key) {\n      return copy.set(clone(key), clone(val));\n    });\n  }\n\n  // Copy `RegExp` objects.\n  else if (O instanceof RegExp) {\n    copy = new RegExp(O);\n  }\n\n  // Copy `Set` objects.\n  else if (O instanceof Set) {\n    copy = new Set();\n    O.forEach(function (val) {\n      return copy.add(clone(val));\n    });\n  } else {\n    var type = getTypeOf(O);\n\n    // Initialize copies of generic objects.\n    if (type === 'Object') {\n      // We try to ensure that the returned copy has the same prototype as\n      // the original, but this may produce less than satisfactory results\n      // on non-generics.\n      copy = Object.create(Object.getPrototypeOf(O));\n    }\n\n    // Unsupported type, so get out the hot irons.\n    else {\n      throw new TypeError(\"attempted to clone unsupported type: \".concat(type));\n    }\n  }\n\n  // Duplicate the original's own enumerable properties, including expando\n  // properties.\n  //\n  // WARNING: This preserves neither symbol properties nor ES5 property\n  // attributes.  Neither does the delta coding nor the serialization code,\n  // however, so it's not really an issue at the moment.\n  Object.keys(O).forEach(function (P) {\n    return copy[P] = clone(O[P]);\n  });\n  return copy;\n}\n\n/***********************************************************************************************************************\n\n\tutil/convertbreaks.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns */\n\n/*\n\tWithin the given node tree, gathers sequences of top-level text nodes and\n\tinline elements that are separated by two <br> elements, wraps them within\n\t<p> elements, and removes the <br> elements.\n\n\tTODO: Update the list of default block-level elements (below) as necessary.\n\tLast checked: Apr 2020.\n*/\nvar convertBreaks = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var isNotSpaceRE = new RegExp(Patterns.notSpace);\n  function isParagraphEmpty(para) {\n    if (!para.hasChildNodes()) {\n      return true;\n    }\n    var nodes = para.childNodes;\n    var length = nodes.length;\n    for (var i = 0; i < length; ++i) {\n      var node = nodes[i];\n      switch (node.nodeType) {\n        case Node.TEXT_NODE:\n          {\n            if (isNotSpaceRE.test(node.nodeValue)) {\n              return false;\n            }\n            break;\n          }\n        case Node.COMMENT_NODE:\n          break;\n        default:\n          return false;\n      }\n    }\n    return true;\n  }\n  function convertBreaks(source) {\n    var output = document.createDocumentFragment();\n    var para = document.createElement('p');\n    var node;\n    while ((node = source.firstChild) !== null) {\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        var tagName = node.nodeName.toUpperCase();\n        switch (tagName) {\n          case 'BR':\n            {\n              if (node.nextSibling !== null && node.nextSibling.nodeType === Node.ELEMENT_NODE && node.nextSibling.nodeName.toUpperCase() === 'BR') {\n                source.removeChild(node.nextSibling);\n                source.removeChild(node);\n                if (!isParagraphEmpty(para)) {\n                  output.appendChild(para);\n                }\n                para = document.createElement('p');\n                continue;\n              } else if (isParagraphEmpty(para)) {\n                source.removeChild(node);\n                continue;\n              }\n              break;\n            }\n\n          // Default block-level elements.\n          case 'ADDRESS':\n          case 'ARTICLE':\n          case 'ASIDE':\n          case 'BLOCKQUOTE':\n          case 'CENTER':\n          case 'DIV':\n          case 'DL':\n          case 'FIGURE':\n          case 'FOOTER':\n          case 'FORM':\n          case 'H1':\n          case 'H2':\n          case 'H3':\n          case 'H4':\n          case 'H5':\n          case 'H6':\n          case 'HEADER':\n          case 'HR':\n          case 'MAIN':\n          case 'NAV':\n          case 'OL':\n          case 'P':\n          case 'PRE':\n          case 'SECTION':\n          case 'TABLE':\n          case 'UL':\n            {\n              if (!isParagraphEmpty(para)) {\n                output.appendChild(para);\n                para = document.createElement('p');\n              }\n              output.appendChild(node);\n              continue;\n            }\n        }\n      }\n      para.appendChild(node);\n    }\n    if (!isParagraphEmpty(para)) {\n      output.appendChild(para);\n    }\n    source.appendChild(output);\n  }\n  return convertBreaks;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/createfilename.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns a sanitized version of the given string that should be safe for use\n\tas a filename under both Windows and Unix-based/-like operating systems.\n*/\nvar createFilename = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // The range of illegal characters consists of: C0 controls, double quote,\n  // number, dollar, percent, ampersand, single quote, asterisk, plus, comma,\n  // forward slash, colon, semi-colon, less-than, equals, greater-than, question,\n  // backslash, caret, backquote/grave, pipe/vertical line, delete, C1 controls.\n  var illegalCharsRE = /[\\x00-\\x1f\"#$%&'*+,/:;<=>?\\\\^`|\\x7f-\\x9f]+/g; // eslint-disable-line no-control-regex\n\n  function createFilename(str) {\n    return String(str).trim().replace(illegalCharsRE, '');\n  }\n  return createFilename;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/createslug.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns a sanitized version of the given string that should be safe for use\n\tas a DOM ID or class name.\n*/\nvar createSlug = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // The range of illegal characters consists of: C0 controls, space, exclamation,\n  // double quote, number, dollar, percent, ampersand, single quote, left paren,\n  // right paren, asterisk, plus, comma, hyphen, period, forward slash, colon,\n  // semi-colon, less-than, equals, greater-than, question, at, left bracket,\n  // backslash, right bracket, caret, backquote/grave, left brace, pipe/vertical\n  // line, right brace, tilde, delete, C1 controls.\n  var illegalCharsRE = /[\\x00-\\x20!-/:-@[-^`{-\\x9f]+/g; // eslint-disable-line no-control-regex\n\n  /* legacy */\n  // Matches the empty string or one comprised solely of hyphens.\n  var isInvalidSlugRE = /^-*$/;\n  /* /legacy */\n\n  // Special cases for story and temporary variables.\n  var storySigilRE = /^\\$/;\n  var tempSigilRE = /^_/;\n  function createSlug(str) {\n    var base = String(str).trim();\n\n    /* legacy */\n    var legacy = base.replace(/[^\\w\\s\\u2013\\u2014-]+/g, '').replace(/[_\\s\\u2013\\u2014-]+/g, '-').toLocaleLowerCase();\n    if (!isInvalidSlugRE.test(legacy)) {\n      return legacy;\n    }\n    /* /legacy */\n\n    return base.replace(storySigilRE, '').replace(tempSigilRE, '-').replace(illegalCharsRE, '');\n  }\n  return createSlug;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/cssproptodomprop.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the DOM property name represented by the given CSS property name.\n*/\nfunction cssPropToDOMProp(cssName) {\n  // eslint-disable-line no-unused-vars\n  if (!cssName.includes('-')) {\n    switch (cssName) {\n      case 'bgcolor':\n        return 'backgroundColor';\n      case 'float':\n        return 'cssFloat';\n      default:\n        return cssName;\n    }\n  }\n\n  // Strip the leading hyphen from the `-ms-` vendor prefix, so it stays lowercased.\n  var normalized = cssName.slice(0, 4) === '-ms-' ? cssName.slice(1) : cssName;\n  return normalized.split('-').map(function (part, i) {\n    return i === 0 ? part : part.toUpperFirst();\n  }).join('');\n}\n\n/***********************************************************************************************************************\n\n\tutil/csstimetoms.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the number of miliseconds represented by the given CSS time string.\n*/\nvar cssTimeToMS = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var cssTimeRE = /^([+-]?(?:\\d*\\.)?\\d+)([Mm]?[Ss])$/;\n  function cssTimeToMS(cssTime) {\n    var match = cssTimeRE.exec(String(cssTime));\n    if (match === null) {\n      throw new SyntaxError(\"invalid time value syntax: \\\"\".concat(cssTime, \"\\\"\"));\n    }\n    var msec = Number(match[1]);\n    if (match[2].length === 1) {\n      msec *= 1000;\n    }\n    if (Number.isNaN(msec) || !Number.isFinite(msec)) {\n      throw new RangeError(\"invalid time value: \\\"\".concat(cssTime, \"\\\"\"));\n    }\n    return msec;\n  }\n  return cssTimeToMS;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/decodeentities.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global enumFrom */\n\n/*\n\tReturns a decoded version of the given entity encoded string.\n\n\tNOTE: The extended replacement set here, in contrast to `encodeEntities()`,\n\tis required due to observed stupidity from various sources.\n*/\nvar decodeEntities = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var escapedHtmlRE = /&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi;\n  var hasEscapedHtmlRE = new RegExp(escapedHtmlRE.source, 'i'); // to drop the global flag\n  var escapedHtmlTable = enumFrom({\n    '&amp;': '&',\n    // ampersand (HTML character entity, XML predefined entity)\n    '&#38;': '&',\n    // ampersand (decimal numeric character reference)\n    '&#x26;': '&',\n    // ampersand (hexadecimal numeric character reference)\n    '&lt;': '<',\n    // less-than (HTML character entity, XML predefined entity)\n    '&#60;': '<',\n    // less-than (decimal numeric character reference)\n    '&#x3c;': '<',\n    // less-than (hexadecimal numeric character reference)\n    '&gt;': '>',\n    // greater-than (HTML character entity, XML predefined entity)\n    '&#62;': '>',\n    // greater-than (decimal numeric character reference)\n    '&#x3e;': '>',\n    // greater-than (hexadecimal numeric character reference)\n    '&quot;': '\"',\n    // double quote (HTML character entity, XML predefined entity)\n    '&#34;': '\"',\n    // double quote (decimal numeric character reference)\n    '&#x22;': '\"',\n    // double quote (hexadecimal numeric character reference)\n    '&apos;': \"'\",\n    // apostrophe (XML predefined entity)\n    '&#39;': \"'\",\n    // apostrophe (decimal numeric character reference)\n    '&#x27;': \"'\",\n    // apostrophe (hexadecimal numeric character reference)\n    '&#96;': '`',\n    // backquote (decimal numeric character reference)\n    '&#x60;': '`' // backquote (hexadecimal numeric character reference)\n  });\n  function decodeEntities(str) {\n    if (str == null) {\n      // lazy equality for null\n      return '';\n    }\n    var val = String(str);\n    return val && hasEscapedHtmlRE.test(val) ? val.replace(escapedHtmlRE, function (entity) {\n      return escapedHtmlTable[entity.toLowerCase()];\n    }) : val;\n  }\n  return decodeEntities;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/encodeentities.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global enumFrom */\n\n/*\n\tReturns an entity encoded version of the given string.\n\n\tNOTE: Only escapes the five primary special characters and the backquote.\n*/\nvar encodeEntities = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var htmlCharsRE = /[&<>\"'`]/g;\n  var hasHtmlCharsRE = new RegExp(htmlCharsRE.source); // to drop the global flag\n  var htmlCharsTable = enumFrom({\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#39;',\n    '`': '&#96;'\n  });\n  function encodeEntities(str) {\n    if (str == null) {\n      // lazy equality for null\n      return '';\n    }\n    var val = String(str);\n    return val && hasHtmlCharsRE.test(val) ? val.replace(htmlCharsRE, function (ch) {\n      return htmlCharsTable[ch];\n    }) : val;\n  }\n  return encodeEntities;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/encodemarkup.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global enumFrom */\n\n/*\n\tReturns an entity encoded version of the given string.\n\n\tNOTE: Escapes the five primary HTML special characters, the backquote,\n\tand SugarCube markup metacharacters.\n*/\nvar encodeMarkup = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var markupCharsRE = /[!\"#$&'*\\-/<=>?@[\\\\\\]^_`{|}~]/g;\n  var hasMarkupCharsRE = new RegExp(markupCharsRE.source); // to drop the global flag\n  var markupCharsTable = enumFrom({\n    '!': '&#33;',\n    '\"': '&quot;',\n    '#': '&#35;',\n    '$': '&#36;',\n    // eslint-disable-line quote-props\n    '&': '&amp;',\n    \"'\": '&#39;',\n    '*': '&#42;',\n    '-': '&#45;',\n    '/': '&#47;',\n    '<': '&lt;',\n    '=': '&#61;',\n    '>': '&gt;',\n    '?': '&#63;',\n    '@': '&#64;',\n    '[': '&#91;',\n    '\\\\': '&#92;',\n    ']': '&#93;',\n    '^': '&#94;',\n    '_': '&#95;',\n    // eslint-disable-line quote-props\n    '`': '&#96;',\n    '{': '&#123;',\n    '|': '&#124;',\n    '}': '&#125;',\n    '~': '&#126;'\n  });\n  function encodeMarkup(str) {\n    if (str == null) {\n      // lazy equality for null\n      return '';\n    }\n    var val = String(str);\n    return val && hasMarkupCharsRE.test(val) ? val.replace(markupCharsRE, function (ch) {\n      return markupCharsTable[ch];\n    }) : val;\n  }\n  return encodeMarkup;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/enquote.js\n\n\tCopyright © 2023–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the given string quoted by double or single quotes, as appropriate.\n\tPreexisting unescaped quotes of same type are escaped.\n*/\nvar enquote = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Unescaped double and single quote regular expressions.\n  //\n  // NOTE: Being unable to use negative lookbehind assertions sucks.\n  var unescapedDQuoteRE = /(^|[^\\\\])(\")/g;\n  var unescapedSQuoteRE = /(^|[^\\\\])(')/g;\n\n  // Quotes strings,\n  function enquote(string) {\n    var dqCount = 0;\n    var sqCount = 0;\n    for (var i = 0; i < string.length; ++i) {\n      switch (string[i]) {\n        case '\\\\':\n          ++i;\n          break;\n        case '\"':\n          ++dqCount;\n          break;\n        case \"'\":\n          ++sqCount;\n          break;\n      }\n    }\n    if (dqCount === 0) {\n      return \"\\\"\".concat(string, \"\\\"\");\n    } else if (sqCount === 0) {\n      return \"'\".concat(string, \"'\");\n    }\n    var quote = dqCount <= sqCount ? '\"' : \"'\";\n    return \"\".concat(quote).concat(string.replace(quote === '\"' ? unescapedDQuoteRE : unescapedSQuoteRE, '$1\\\\$2')).concat(quote);\n  }\n  return enquote;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/enumfrom.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns a pseudo-enumeration object created from the given Array, Map, Set,\n\tor generic object.\n*/\nfunction enumFrom(O) {\n  // eslint-disable-line no-unused-vars\n  var pEnum = Object.create(null);\n  if (O instanceof Array) {\n    O.forEach(function (val, i) {\n      return pEnum[String(val)] = i;\n    });\n  } else if (O instanceof Set) {\n    // NOTE: Use `<Array>.forEach()` here rather than `<Set>.forEach()`\n    // as the latter does not provide the indices we require.\n    Array.from(O).forEach(function (val, i) {\n      return pEnum[String(val)] = i;\n    });\n  } else if (O instanceof Map) {\n    O.forEach(function (val, key) {\n      return pEnum[String(key)] = val;\n    });\n  } else if (O !== null && _typeof(O) === 'object' && Object.getPrototypeOf(O) === Object.prototype) {\n    Object.assign(pEnum, O);\n  } else {\n    throw new TypeError('enumFrom object parameter must be an Array, Map, Set, or generic object');\n  }\n  return Object.freeze(Object.defineProperties(pEnum, {\n    nameFrom: {\n      value: function value(needle) {\n        var entry = Object.entries(this).find(function (entry) {\n          return entry[1] === needle;\n        });\n        return entry ? entry[0] : undefined;\n      }\n    }\n  }));\n}\n\n/***********************************************************************************************************************\n\n\tutil/exceptionfrom.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns a new exception based on the given exception.\n\n\tNOTE: Most useful for making native ECMAScript `…Error` instance copies\n\tof host exception instances—e.g., `DOMException` → `Error`.\n*/\nvar exceptionFrom = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var extraProps = Object.freeze([\n  // Baseline `DOMException` properties.\n  'code',\n  // Firefox `DOMException` extension properties.\n  'data', 'result',\n  // Common `…Error` extension properties.\n  'stack',\n  // Firefox `…Error` extension properties.\n  'columnNumber', 'fileName', 'lineNumber',\n  // Microsoft `…Error` properties.\n  'description', 'number']);\n  function exceptionFrom(original, exceptionType, override) {\n    if (original === null || _typeof(original) !== 'object') {\n      throw new Error('exceptionFrom original parameter must be an object');\n    }\n    if (typeof exceptionType !== 'function') {\n      throw new Error('exceptionFrom exceptionType parameter must be an error type constructor');\n    }\n    var overrideType = _typeof(override);\n    if (overrideType !== 'undefined' && overrideType !== 'string' && overrideType !== 'object') {\n      throw new Error('exceptionFrom override parameter must be an object or string');\n    }\n\n    // Gather property values for copying.\n    var propValues = new Map();\n    extraProps.forEach(function (name) {\n      if (typeof original[name] !== 'undefined') {\n        propValues.set(name, original[name]);\n      }\n    });\n    if (overrideType === 'string') {\n      propValues.set('message', override);\n    } else if (overrideType === 'object' && override !== null) {\n      Object.getOwnPropertyNames(override).forEach(function (name) {\n        if (typeof override[name] !== 'undefined') {\n          propValues.set(name, override[name]);\n        }\n      });\n    }\n\n    // Create the new exception and copy the property values to it.\n    var ex = new exceptionType(propValues.get('message')); // eslint-disable-line new-cap\n    propValues.delete('message');\n    propValues.forEach(function (value, name) {\n      if (typeof ex[name] === 'undefined') {\n        Object.defineProperty(ex, name, {\n          value: value,\n          configurable: true,\n          writable: true\n        });\n      } else {\n        ex[name] = value;\n      }\n    });\n    return ex;\n  }\n  return exceptionFrom;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/getactiveelement.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns `document.activeElement` or `null`.\n*/\nfunction getActiveElement() {\n  // eslint-disable-line no-unused-vars\n  // IE9 contains a bug where trying to access the active element of an iframe's\n  // parent document—i.e., `window.parent.document.activeElement`—will throw an\n  // exception, so we must allow for an exception to be thrown.\n  //\n  // We could simply return `undefined` here, but since the API's default behavior\n  // should be to return `document.body` or, when there is no selection, `null`,\n  // we choose to return `null` in all non-element cases—i.e., whether it returns\n  // `null` or throws an exception.  Just a bit of normalization.\n  try {\n    return document.activeElement || null;\n  } catch (ex) {\n    return null;\n  }\n}\n\n/***********************************************************************************************************************\n\n\tutil/geterrormessage.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the value of the `message` property of the given value, if an\n\tobject with such a property, or the value itself.\n*/\nfunction getErrorMessage(O) {\n  // eslint-disable-line no-unused-vars\n  if (O == null) {\n    // lazy equality for null\n    return 'unknown error';\n  }\n  return _typeof(O) === 'object' && 'message' in O ? O.message : String(O);\n}\n\n/***********************************************************************************************************************\n\n\tutil/gettostringtag.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the value of the `@@toStringTag` internal property of the given object.\n\n\tNOTE: In ≤ES5, returns the value of the `[[Class]]` internal slot.\n*/\nvar getToStringTag = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Cache built-in object method.\n  var toString = Object.prototype.toString;\n  var slice = String.prototype.slice;\n\n  // If the browser is using the `Map()` and `Set()` polyfills, then return a\n  // version of `getToStringTag()` that contains special cases for them, since\n  // they do not have a `[[Class]]` internal slot and the `@@toStringTag`\n  // internal property is unavailable to them.\n  if (toString.call(new Map()) === '[object Object]') {\n    return function getToStringTag(O) {\n      // Special cases for the `Map` and `Set` polyfills.\n      //\n      // NOTE: We don't special case the `WeakMap` and `WeakSet` polyfills\n      // here since they're (a) unlikely to be used and (b) broken anyway.\n      if (O instanceof Map) {\n        return 'Map';\n      }\n      if (O instanceof Set) {\n        return 'Set';\n      }\n      return slice.call(toString.call(O), 8, -1);\n    };\n  }\n\n  // Elsewise, return the regular `getToStringTag()` function.\n  return function getToStringTag(O) {\n    return slice.call(toString.call(O), 8, -1);\n  };\n}();\n\n/***********************************************************************************************************************\n\n\tutil/gettypeof.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the value `'null'` for `null`, the value yielded by `typeof` for\n\tprimitives and functions, or the `@@toStringTag` internal property for objects.\n\n\tExamples:\n\t\tgetTypeOf(42n)            → 'bigint'\n\t\tgetTypeOf(true)           → 'boolean'\n\t\tgetTypeOf(function () {}) → 'function'\n\t\tgetTypeOf(42)             → 'number'\n\t\tgetTypeOf(null)           → 'null'\n\t\tgetTypeOf(\"fnord\")        → 'string'\n\t\tgetTypeOf(Symbol(\"ZETA\")) → 'symbol'\n\t\tgetTypeOf(undefined)      → 'undefined'\n\t\tgetTypeOf(['a', 'b'])     → 'Array'\n\t\tgetTypeOf({ a : 'b' })    → 'Object'\n\t\tgetTypeOf(new Date())     → 'Date'\n\t\tgetTypeOf(new Map())      → 'Map'\n\t\tgetTypeOf(new Set())      → 'Set'\n\t\tEtc.\n*/\nvar getTypeOf = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Cache built-in object method.\n  var toString = Object.prototype.toString;\n  var slice = String.prototype.slice;\n  function getTypeOf(O) {\n    // Special case for `null`, since `typeof` is a buggy piece of shit.\n    if (O === null) {\n      return 'null';\n    }\n    var baseType = _typeof(O);\n    return baseType === 'object' ? slice.call(toString.call(O), 8, -1) : baseType;\n  }\n  return getTypeOf;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/hasmediaquery.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns whether the given media query matches.\n*/\nvar hasMediaQuery = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // If the browser does not support `matchMedia()`, then return\n  // a version of `hasMediaQuery()` that simply returns `false`.\n  if (typeof window.matchMedia !== 'function') {\n    return function utilHasMediaQuery() {\n      return false;\n    };\n  }\n\n  // Elsewise, return the regular `hasMediaQuery()` function.\n  return function hasMediaQuery(mediaQuery) {\n    return window.matchMedia(mediaQuery).matches;\n  };\n}();\n\n/***********************************************************************************************************************\n\n\tutil/isexternallink.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns, Story */\n\n/*\n\tReturns whether the given link source is external (probably).\n*/\nvar isExternalLink = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var externalUrlRE = new RegExp(\"^\".concat(Patterns.externalUrl), 'gim');\n  var fingerprintRE = /[/\\\\?]/;\n  function isExternalLink(link) {\n    return !Story.has(link) && (externalUrlRE.test(link) || fingerprintRE.test(link));\n  }\n  return isExternalLink;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/mstocsstime.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global getTypeOf */\n\n/*\n\tReturns the CSS time string represented by the given number of milliseconds.\n*/\nfunction msToCSSTime(msec) {\n  // eslint-disable-line no-unused-vars\n  if (typeof msec !== 'number' || Number.isNaN(msec) || !Number.isFinite(msec)) {\n    var what;\n    switch (_typeof(msec)) {\n      case 'string':\n        what = \"\\\"\".concat(msec, \"\\\"\");\n        break;\n      case 'number':\n        what = String(msec);\n        break;\n      default:\n        what = getTypeOf(msec);\n        break;\n    }\n    throw new TypeError(\"invalid milliseconds value: \".concat(what));\n  }\n  return \"\".concat(msec, \"ms\");\n}\n\n/***********************************************************************************************************************\n\n\tutil/now.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Has */\n\n/*\n\tReturns the number of milliseconds elapsed since a reference epoch.\n\n\tNOTE: If the `Performance` API is available, then the epoch will be approximately the\n\tdocument creation time.  Elsewise, it will be the ECMAScript epoch (1 January 1970 UTC).\n*/\nvar now = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Use the `Performance` API, if available, failing over to `Date`.  The\n  // `Performance` API is preferred for its monotonic clock, which is not\n  // subject to the vagaries of timezone changes and leap periods.\n  var clock = Has.performance ? performance : Date;\n  function now() {\n    return clock.now();\n  }\n  return now;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/onuseractivation.js\n\n\tCopyright © 2022–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tAttempts to execute the given callback upon user activation triggering events\n\tusing the given namespace.\n\n\tNOTE: The callback must return a `Promise`.\n*/\nvar onUserActivation = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*\n  \tActivation triggering input events.\n  \t\tSEE: HTML Living Standard § 6.4 Tracking user activation\n  \t\t* https://html.spec.whatwg.org/#tracking-user-activation\n  \t\tSEE ALSO:\n  \t\t* https://github.com/whatwg/html/issues/7341\n  \t\t* https://github.com/whatwg/html/issues/3849\n  \t\t* https://github.com/whatwg/html/issues/1903\n  \t\t* https://docs.google.com/spreadsheets/d/1DGXjhQ6D3yZXIePOMo0dsd2agz0t5W7rYH1NwJ-QGJo/edit#gid=0\n  */\n  var uaEvents = Object.freeze(['keydown', 'mousedown', 'pointerdown', 'pointerup', 'touchend']);\n  function onUserActivation(namespace, callback) {\n    // Due to the complexity of identifying valid activation triggering\n    // `keydown` events, we simply invoke the callback each time any of\n    // the events fires until it stops rejecting with `NotAllowedError`.\n    jQuery(document).off(namespace).on(uaEvents.map(function (name) {\n      return \"\".concat(name).concat(namespace);\n    }).join(' '), function (ev) {\n      callback(ev).then(function () {\n        return jQuery(document).off(namespace);\n      }, function (ex) {\n        // Bail out if the rejection is not `NotAllowedError`.\n        if (ex.name !== 'NotAllowedError') {\n          jQuery(document).off(namespace);\n          throw ex;\n        }\n      });\n    });\n  }\n  return onUserActivation;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/parseurl.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns an immutable object containing the component properties parsed from the given URL.\n*/\nfunction parseURL(url) {\n  // eslint-disable-line no-unused-vars\n  var parser = document.createElement('a');\n  var searchParams = Object.create(null);\n\n  // Let the `<a>` element parse the URL.\n  parser.href = url;\n\n  // Populate the `searchParams` object with the query string attributes.\n  if (parser.search) {\n    parser.search.replace(/^\\?/, '').splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach(function (query) {\n      var _query$split = query.split('='),\n        _query$split2 = _slicedToArray(_query$split, 2),\n        key = _query$split2[0],\n        value = _query$split2[1];\n      if (Object.hasOwn(searchParams, key)) {\n        searchParams[key].push(value);\n      } else {\n        searchParams[key] = [value];\n      }\n    });\n  }\n\n  // WARNING: Caveats by browser.\n  //\n  // Edge (EdgeHTML) and Internet Explorer do not support authentication\n  // information within a URL at all and will throw a security exception\n  // on *any* property access if it's included.\n  //\n  // Internet Explorer does not include the leading forward slash on\n  // `pathname` when required.\n  //\n  // Opera (Presto) strips the authentication information from `href`\n  // and does not supply `username` or `password`.\n  //\n  // Safari (ca. v5.1.x) does not supply `username` or `password` and\n  // peforms URI decoding on `pathname`.\n\n  // Patch for IE not including the leading slash on `pathname` when required.\n  var pathname = parser.host && parser.pathname[0] !== '/' ? \"/\".concat(parser.pathname) : parser.pathname;\n  return Object.freeze(Object.assign(Object.create(null), {\n    // The full URL that was originally parsed.\n    href: parser.href,\n    // The request protocol, lowercased.\n    protocol: parser.protocol,\n    // // The full authentication information.\n    // auth : el.username || el.password // eslint-disable-line no-nested-ternary\n    // \t? `${el.username}:${el.password}`\n    // \t: typeof el.username === 'string' ? '' : undefined,\n    //\n    // // The username portion of the auth info.\n    // username : el.username,\n    //\n    // // The password portion of the auth info.\n    // password : el.password,\n\n    // The full host information, including port number, lowercased.\n    host: parser.host,\n    // The hostname portion of the host info, lowercased.\n    hostname: parser.hostname,\n    // The port number portion of the host info.\n    port: parser.port,\n    // The full path information, including query info.\n    path: \"\".concat(pathname).concat(parser.search),\n    // The pathname portion of the path info.\n    pathname: pathname,\n    // The query string portion of the path info, including the leading question mark.\n    search: parser.search,\n    // The attributes portion of the query string, parsed into an object.\n    searchParams: Object.freeze(searchParams),\n    // The fragment string, including the leading hash/pound sign.\n    hash: parser.hash\n  }));\n}\n\n/***********************************************************************************************************************\n\n\tutil/samevaluezero.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns whether the given values pass a SameValueZero comparison.\n\n\tSEE: https://tc39.es/ecma262/#sec-samevaluezero\n*/\nfunction sameValueZero(a, b) {\n  // eslint-disable-line no-unused-vars\n  return a === b || a !== a && b !== b;\n}\n\n/***********************************************************************************************************************\n\n\tutil/scrubeventkey.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns a sanitized version of the given `KeyboardEvent.key` value from\n\tprevious incarnations of the specification that should better reflect the\n\tcurrent incarnation.\n*/\nvar scrubEventKey = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var separatorKey;\n  var decimalKey;\n\n  // Attempt to determine the player's 'Separator' and 'Decimal' key values\n  // based on their current locale.\n  if (typeof Intl !== 'undefined' && typeof Intl.NumberFormat === 'function') {\n    // NOTE: The current expression's use of the digit classes (`\\d`, `\\D`) does not\n    // handle all number forms.  Switching to Unicode property escapes for numbers\n    // (`/p{N}`, `/P{N}`) would resolve this, but requires the expression to be in a\n    // Unicode-aware mode—e.g., using the `u` flag.\n    var match = new Intl.NumberFormat().format(111111.5).match(/(\\D*)\\d+(\\D*)\\d$/);\n    if (match) {\n      separatorKey = match[1];\n      decimalKey = match[2];\n    }\n  }\n\n  // Failover to US-centric values, if using `Intl.NumberFormat` failed.\n  if (!separatorKey && !decimalKey) {\n    separatorKey = ',';\n    decimalKey = '.';\n  }\n\n  // Maps older `KeyboardEvent.key` values to more current/correct ones.\n  function scrubEventKey(key) {\n    switch (key) {\n      // case 'OS':                 return 'Meta'; // Unreliable.\n      case 'Scroll':\n        return 'ScrollLock';\n      case 'Spacebar':\n        return '\\x20';\n      case 'Left':\n        return 'ArrowLeft';\n      case 'Right':\n        return 'ArrowRight';\n      case 'Up':\n        return 'ArrowUp';\n      case 'Down':\n        return 'ArrowDown';\n      case 'Del':\n        return 'Delete';\n      case 'Crsel':\n        return 'CrSel';\n      case 'Exsel':\n        return 'ExSel';\n      case 'Esc':\n        return 'Escape';\n      case 'Apps':\n        return 'ContextMenu';\n      case 'Nonconvert':\n        return 'NonConvert';\n      case 'MediaNextTrack':\n        return 'MediaTrackNext';\n      case 'MediaPreviousTrack':\n        return 'MediaTrackPrevious';\n      case 'VolumeUp':\n        return 'AudioVolumeUp';\n      case 'VolumeDown':\n        return 'AudioVolumeDown';\n      case 'VolumeMute':\n        return 'AudioVolumeMute';\n      case 'Zoom':\n        return 'ZoomToggle';\n      case 'SelectMedia': /* see below */\n      case 'MediaSelect':\n        return 'LaunchMediaPlayer';\n      case 'Add':\n        return '+';\n      case 'Divide':\n        return '/';\n      case 'Multiply':\n        return '*';\n      case 'Subtract':\n        return '-';\n      case 'Decimal':\n        return decimalKey;\n      case 'Separator':\n        return separatorKey;\n    }\n    return key;\n  }\n  return scrubEventKey;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/setdisplaytitle.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, State, Wikifier, getTypeOf */\n\n/*\n\tSets the display title.\n*/\nvar setDisplayTitle = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  function getTextContent(source) {\n    var copy = source.cloneNode(true);\n    var frag = document.createDocumentFragment();\n    var node;\n    while ((node = copy.firstChild) !== null) {\n      // Insert spaces before various elements.\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        switch (node.nodeName.toUpperCase()) {\n          case 'BR':\n          case 'DIV':\n          case 'P':\n            frag.appendChild(document.createTextNode(' '));\n            break;\n        }\n      }\n      frag.appendChild(node);\n    }\n    return frag.textContent;\n  }\n  function setDisplayTitle(title, isPlainText) {\n    if (typeof title !== 'string') {\n      throw new TypeError(\"title parameter must be a string (received: \".concat(getTypeOf(title), \")\"));\n    }\n    var render;\n    var text;\n    if (isPlainText) {\n      render = title.trim();\n      text = render;\n    } else {\n      render = document.createDocumentFragment();\n      new Wikifier(render, title, {\n        noCleanup: true\n      });\n      text = getTextContent(render).trim();\n    }\n\n    // document.title = text;\n    document.title = Config.passages.displayTitles && State.passage !== '' && State.passage !== Config.passages.start ? \"\".concat(State.passage, \" | \").concat(text) : text;\n    jQuery('#story-title').empty().append(render);\n  }\n  return setDisplayTitle;\n}();\n\n/***********************************************************************************************************************\n\n\tutil/setpageelement.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Story, Wikifier */\n\n/*\n\tWikifies a passage into a DOM element corresponding to the given ID and\n\treturns the element.\n*/\nfunction setPageElement(idOrElement, titles, defaultText) {\n  // eslint-disable-line no-unused-vars\n  var el = _typeof(idOrElement) === 'object' ? idOrElement : document.getElementById(idOrElement);\n  if (el == null) {\n    // lazy equality for null\n    return null;\n  }\n  var ids = titles instanceof Array ? titles : [titles];\n  jQuery(el).empty();\n  for (var i = 0; i < ids.length; ++i) {\n    if (Story.has(ids[i])) {\n      new Wikifier(el, Story.get(ids[i]).processText().trim());\n      return el;\n    }\n  }\n  if (defaultText != null) {\n    // lazy equality for null\n    var text = String(defaultText).trim();\n    if (text !== '') {\n      new Wikifier(el, text);\n    }\n  }\n  return el;\n}\n\n/***********************************************************************************************************************\n\n\tutil/stringfrom.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tReturns the simple string representation of the given value or, if there is\n\tnone, a square bracketed representation.\n*/\nfunction stringFrom(value) {\n  // eslint-disable-line no-unused-vars\n  switch (_typeof(value)) {\n    case 'function':\n      return '[function]';\n    case 'number':\n      {\n        if (Number.isNaN(value)) {\n          return '[number NaN]';\n        }\n        break;\n      }\n    case 'object':\n      {\n        if (value === null) {\n          return '[null]';\n        } else if (value instanceof Array) {\n          return value.map(function (val) {\n            return stringFrom(val);\n          }).join(', ');\n        } else if (value instanceof Set) {\n          return Array.from(value).map(function (val) {\n            return stringFrom(val);\n          }).join(', ');\n        } else if (value instanceof Map) {\n          var result = Array.from(value).map(function (_ref5) {\n            var _ref6 = _slicedToArray(_ref5, 2),\n              key = _ref6[0],\n              val = _ref6[1];\n            return \"\".concat(stringFrom(key), \" \\u2192 \").concat(stringFrom(val));\n          });\n          return \"{\\u202F\".concat(result.join(', '), \"\\u202F}\");\n        } else if (value instanceof Date) {\n          return value.toLocaleString();\n        } else if (value instanceof Element) {\n          if (value === document.documentElement || value === document.head || value === document.body) {\n            throw new Error('illegal operation; attempting to convert the <html>, <head>, or <body> tags to string is not allowed');\n          }\n          return value.outerHTML;\n        } else if (value instanceof Node) {\n          return value.textContent;\n        }\n\n        // Defer to `.[@@toPrimitive]('string')` or `.toString()`.\n        break;\n      }\n    case 'symbol':\n      {\n        var desc = typeof value.description !== 'undefined' ? \" \\\"\".concat(value.description, \"\\\"\") : '';\n        return \"[symbol\".concat(desc, \"]\");\n      }\n    case 'undefined':\n      return '[undefined]';\n  }\n  return String(value);\n}\n\n/***********************************************************************************************************************\n\n\tutil/triggerevent.js\n\n\tCopyright © 2022–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\n/*\n\tTriggers an event with the given name and options on the given element.\n\n\tNOTE: Intended to replace SugarCube's use of jQuery's event triggering methods\n\tas they treat synthetic events suboptimally when compared to standard events.\n\n\tOptions object properties:\n\t\t// Whether the event bubbles (default: true).\n\t\tbubbles?: boolean\n\t\t// Whether the event is cancelable (default: true).\n\t\tcancelable?: boolean\n\t\t// Whether the event triggers listeners outside of a shadow root (default: false).\n\t\tcomposed?: boolean\n\t\t// Custom data sent with the event (default: none).\n\t\tdetail?: any\n*/\nvar triggerEvent = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var createEvent = function () {\n    try {\n      // Test if the `CustomEvent` API is supported.\n      new CustomEvent('click', {\n        bubbles: true\n      });\n\n      // If the `CustomEvent` API is supported, then return a version of\n      // the `createEvent()` function that uses it.\n      return function createEvent(name, options) {\n        var _Object$assign = Object.assign({\n            bubbles: true,\n            cancelable: true,\n            composed: false\n          }, options),\n          bubbles = _Object$assign.bubbles,\n          cancelable = _Object$assign.cancelable,\n          composed = _Object$assign.composed,\n          detail = _Object$assign.detail,\n          custom = _objectWithoutProperties(_Object$assign, _excluded);\n        var event = new CustomEvent(name, {\n          bubbles: bubbles,\n          cancelable: cancelable,\n          composed: composed,\n          detail: detail\n        });\n\n        // Copy all custom options properties to the event object.\n        for (var i = 0, keys = Object.keys(custom); i < keys.length; ++i) {\n          var key = keys[i];\n          if (typeof custom[key] !== 'undefined') {\n            event[key] = options[key];\n          }\n        }\n        return event;\n      };\n    } catch (ex) {\n      // function getEventInterface(iname) {\n      // \t// SEE: https://dom.spec.whatwg.org/#dom-document-createevent\n      // \tswitch (iname) {\n      // \t\tcase \"beforeunloadevent\":\n      // \t\t\treturn 'BeforeUnloadEvent';\n      // \t\tcase \"compositionevent\":\n      // \t\t\treturn 'CompositionEvent';\n      // \t\tcase \"customevent\":\n      // \t\t\treturn 'CustomEvent';\n      // \t\tcase \"devicemotionevent\":\n      // \t\t\treturn 'DeviceMotionEvent';\n      // \t\tcase \"deviceorientationevent\":\n      // \t\t\treturn 'DeviceOrientationEvent';\n      // \t\tcase \"dragevent\":\n      // \t\t\treturn 'DragEvent';\n      // \t\tcase \"focusevent\":\n      // \t\t\treturn 'FocusEvent';\n      // \t\tcase \"hashchangeevent\":\n      // \t\t\treturn 'HashChangeEvent';\n      // \t\tcase \"keyboardevent\":\n      // \t\t\treturn 'KeyboardEvent';\n      // \t\tcase \"messageevent\":\n      // \t\t\treturn 'MessageEvent';\n      // \t\tcase \"mouseevent\":\n      // \t\t\treturn 'MouseEvent';\n      // \t\tcase \"storageevent\":\n      // \t\t\treturn 'StorageEvent';\n      // \t\tcase \"textevent\":\n      // \t\t\treturn 'CompositionEvent';\n      // \t\tcase \"touchevent\":\n      // \t\t\treturn 'TouchEvent';\n      // \t\tcase \"uievent\":\n      // \t\t\treturn 'UIEvent';\n      //\n      // \t\tdefault:\n      // \t\t\treturn 'Event';\n      // \t}\n      // }\n\n      // Elsewise, return a version of the `createEvent()` function that\n      // uses the older, deprecated `document.createEvent()` API.\n      //\n      // NOTE: This version does not support the newer `composed` property\n      // for use with shadow DOMs because the browsers that require this\n      // do not support shadow DOMs.\n      return function createEvent(name, options) {\n        var _Object$assign2 = Object.assign({\n            bubbles: true,\n            cancelable: true\n          }, options),\n          bubbles = _Object$assign2.bubbles,\n          cancelable = _Object$assign2.cancelable,\n          custom = _objectWithoutProperties(_Object$assign2, _excluded2);\n        var event = document.createEvent('Event');\n\n        // Copy all custom options properties to the event object.\n        for (var i = 0, keys = Object.keys(custom); i < keys.length; ++i) {\n          var key = keys[i];\n          if (typeof custom[key] !== 'undefined') {\n            event[key] = options[key];\n          }\n        }\n        event.initEvent(name, bubbles, cancelable);\n        return event;\n      };\n    }\n  }();\n  function triggerEvent(name, targets, options) {\n    var event = createEvent(name, options);\n    var elems = [];\n\n    // No target was specified, default to `document`.\n    if (!targets) {\n      elems.push(document);\n    }\n\n    // An element collection of some kind.\n    else if (targets instanceof jQuery || targets instanceof NodeList || targets instanceof Array) {\n      for (var i = 0; i < targets.length; ++i) {\n        elems.push(targets[i]);\n      }\n    }\n\n    // Anything else.\n    else {\n      elems.push(targets);\n    }\n\n    // Dispatch the event to all of the targets, in order.\n    for (var _i5 = 0; _i5 < elems.length; ++_i5) {\n      elems[_i5].dispatchEvent(event);\n    }\n  }\n  return triggerEvent;\n}();\n\n/***********************************************************************************************************************\n\n\tstorage/simplestore.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\nvar SimpleStore = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // In-order list of database adapters.\n  var _adapters = [];\n\n  // The initialized adapter.\n  var _initialized = null;\n\n  /*******************************************************************************\n  \tSimpleStore Functions.\n  *******************************************************************************/\n\n  function create(storageId, persistent) {\n    if (_initialized) {\n      return _initialized.create(storageId, persistent);\n    }\n\n    // Return the first adapter which successfully initializes, elsewise throw an exception.\n    for (var i = 0; i < _adapters.length; ++i) {\n      if (_adapters[i].init(storageId, persistent)) {\n        _initialized = _adapters[i];\n        return _initialized.create(storageId, persistent);\n      }\n    }\n    throw new Error('No valid storage adapters found');\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Adapters List.\n    //\n    // QUESTION: Should this be a getter, rather than being exported directly?\n    adapters: {\n      value: _adapters\n    },\n    // Core Functions.\n    create: {\n      value: create\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tstorage/adapters/webstorage.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Serial, SimpleStore, exceptionFrom */\n\nSimpleStore.adapters.push(function () {\n  // Adapter readiness state.\n  var _ok = false;\n\n  /*******************************************************************************\n  \tWebStorageAdapter Class.\n  *******************************************************************************/\n  var WebStorageAdapter = /*#__PURE__*/function () {\n    function WebStorageAdapter(storageId, persistent) {\n      _classCallCheck(this, WebStorageAdapter);\n      var prefix = \"\".concat(storageId, \".\");\n      var engine = null;\n      var name = null;\n      if (persistent) {\n        engine = window.localStorage;\n        name = 'localStorage';\n      } else {\n        engine = window.sessionStorage;\n        name = 'sessionStorage';\n      }\n      Object.defineProperties(this, {\n        _engine: {\n          value: engine\n        },\n        _prefix: {\n          value: prefix\n        },\n        _prefixRe: {\n          value: new RegExp(\"^\".concat(RegExp.escape(prefix)))\n        },\n        name: {\n          value: name\n        },\n        id: {\n          value: storageId\n        },\n        persistent: {\n          value: Boolean(persistent)\n        }\n      });\n    }\n    return _createClass(WebStorageAdapter, [{\n      key: \"size\",\n      get: function get() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.size : Number]\"));\n        }\n\n        // WARNING: Do not return `this._engine.length` here as that will return the\n        // length of the entire store, rather than just our prefixed keys.\n        return this.keys().length;\n      }\n    }, {\n      key: \"keys\",\n      value: function keys() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.keys() : String Array]\"));\n        }\n        var keys = [];\n        for (var i = 0; i < this._engine.length; ++i) {\n          var key = this._engine.key(i);\n          if (this._prefixRe.test(key)) {\n            keys.push(key.replace(this._prefixRe, ''));\n          }\n        }\n        return keys;\n      }\n    }, {\n      key: \"has\",\n      value: function has(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.has(key: \\\"\").concat(key, \"\\\") : Boolean]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return false;\n        }\n\n        // NOTE: Do not call `this._engine.getItem()` and check its value here as we\n        // do not need to be making copies of values.\n        return Object.hasOwn(this._engine, this._prefix + key);\n      }\n    }, {\n      key: \"get\",\n      value: function get(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.get(key: \\\"\").concat(key, \"\\\") : Any]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return null;\n        }\n        var value = this._engine.getItem(this._prefix + key);\n\n        // QUESTION: Has `<Storage>.getItem()` ever returned any value other than\n        // `null` for non-existent keys?  I seem to recall a browser bug where\n        // `undefined` was returned, but I can't find any details about it now.\n        return value == null ? null : WebStorageAdapter._deserialize(value); // lazy equality for null\n      }\n    }, {\n      key: \"set\",\n      value: function set(key, value) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.set(key: \\\"\").concat(key, \"\\\", value: \\u2026) : Boolean]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return false;\n        }\n        try {\n          this._engine.setItem(this._prefix + key, WebStorageAdapter._serialize(value));\n        } catch (ex) {\n          // If the exception is a quota exceeded error, massage it into something\n          // a bit nicer for the player.\n          if (isQuotaDOMException(ex)) {\n            throw exceptionFrom(ex, Error, {\n              cause: {\n                origin: ex\n              },\n              message: \"\".concat(this.name, \" quota exceeded\")\n            });\n          }\n\n          // Elsewise, simply rethrow the exception.\n          throw ex;\n        }\n        return true;\n      }\n    }, {\n      key: \"delete\",\n      value: function _delete(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.delete(key: \\\"\").concat(key, \"\\\") : Boolean]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return false;\n        }\n        this._engine.removeItem(this._prefix + key);\n        return true;\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.clear() : Boolean]\"));\n        }\n\n        // WARNING: Do not call `this._engine.clear()` here as that will remove all\n        // keys within the entire store, rather than just our prefixed keys.\n\n        var keys = this.keys();\n        for (var i = 0, length = keys.length; i < length; ++i) {\n          if (BUILD_DEBUG) {\n            console.log('\\tdeleting key:', keys[i]);\n          }\n          this.delete(keys[i]);\n        }\n        return true;\n      }\n    }], [{\n      key: \"_serialize\",\n      value: function _serialize(obj) {\n        return LZString.compressToUTF16(Serial.stringify(obj));\n      }\n    }, {\n      key: \"_deserialize\",\n      value: function _deserialize(str) {\n        return Serial.parse(LZString.decompressFromUTF16(str));\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tAdapter Utility Functions.\n  *******************************************************************************/\n  function create(storageId, persistent) {\n    if (!_ok) {\n      throw new Error('adapter not initialized');\n    }\n    return new WebStorageAdapter(storageId, persistent);\n  }\n  function init() {\n    // Web Storage feature test.\n    function hasWebStorage(storeId) {\n      var store;\n      try {\n        store = window[storeId];\n        var val = \"_sc_\".concat(String(Date.now()));\n        store.setItem(val, val);\n        var result = store.getItem(val) === val;\n        store.removeItem(val);\n        return result;\n      } catch (ex) {\n        // Attempt to ensure that the exception was due to feature failure rather\n        // than simply a quota error, which is possible due to browser stupidity.\n        return store && store.length !== 0 && isQuotaDOMException(ex);\n      }\n    }\n\n    // Just to be safe, we feature test for both `localStorage` and `sessionStorage`,\n    // as you never know what browser implementation bugs you're going to run into.\n    _ok = hasWebStorage('localStorage') && hasWebStorage('sessionStorage');\n    return _ok;\n  }\n  var isQuotaErrorRE = /quota.?(?:exceeded|reached)/i;\n  function isQuotaDOMException(ex) {\n    return ex instanceof DOMException && (\n    // The `.code` property is non-standard and not supported by all browsers,\n    // but for legacy support test it first anyway.\n    //\n    // Legacy codes: `22` (non-Firefox) and `1014` (Firefox).\n    ex.code === 22 || ex.code === 1014\n\n    // If the `.code` test failed, resort to pattern matching the `.name` and\n    // `.message` properties—the latter being required only by Opera (Presto).\n    //\n    // NOTE: The current standards compliant name is `\"QuotaExceededError\"`.\n    // Legacy names: `\"QUOTA_EXCEEDED_ERR\"` (non-Firefox) and `\"NS_ERROR_DOM_QUOTA_REACHED\"` (Firefox).\n    || isQuotaErrorRE.test(ex.name) || isQuotaErrorRE.test(ex.message));\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    init: {\n      value: init\n    },\n    create: {\n      value: create\n    }\n  }));\n}());\n\n/***********************************************************************************************************************\n\n\tstorage/adapters/cookie.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Serial, SimpleStore, exceptionFrom */\n\nSimpleStore.adapters.push(function () {\n  // Expiry constants.\n  var _MAX_EXPIRY = 'Tue, 19 Jan 2038 03:14:07 GMT'; // (new Date((Math.pow(2, 31) - 1) * 1000)).toUTCString()\n  var _MIN_EXPIRY = 'Thu, 01 Jan 1970 00:00:00 GMT'; // (new Date(0)).toUTCString()\n\n  // Adapter readiness state.\n  var _ok = false;\n\n  /*******************************************************************************\n  \tCookieAdapter Class.\n  *******************************************************************************/\n  var CookieAdapter = /*#__PURE__*/function () {\n    function CookieAdapter(storageId, persistent) {\n      _classCallCheck(this, CookieAdapter);\n      var prefix = \"\".concat(storageId).concat(persistent ? '!' : '*', \".\");\n      Object.defineProperties(this, {\n        _prefix: {\n          value: prefix\n        },\n        _prefixRe: {\n          value: new RegExp(\"^\".concat(RegExp.escape(prefix)))\n        },\n        name: {\n          value: 'cookie'\n        },\n        id: {\n          value: storageId\n        },\n        persistent: {\n          value: Boolean(persistent)\n        }\n      });\n    }\n    return _createClass(CookieAdapter, [{\n      key: \"size\",\n      get: function get() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.size : Number]\"));\n        }\n        return this.keys().length;\n      }\n    }, {\n      key: \"keys\",\n      value: function keys() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.keys() : String Array]\"));\n        }\n        if (document.cookie === '') {\n          return [];\n        }\n        var cookies = document.cookie.split(/;\\s*/);\n        var keys = [];\n        for (var i = 0; i < cookies.length; ++i) {\n          var kvPair = cookies[i].split('=');\n          var key = decodeURIComponent(kvPair[0]);\n          if (this._prefixRe.test(key)) {\n            // NOTE: All stored values are serialized and an empty string will\n            // always serialize to a non-empty string.  Therefore, receiving an\n            // empty string here denotes a deleted value rather than a serialized\n            // empty string, so we omit such pairs.\n            var value = decodeURIComponent(kvPair[1]);\n            if (value !== '') {\n              keys.push(key.replace(this._prefixRe, ''));\n            }\n          }\n        }\n        return keys;\n      }\n    }, {\n      key: \"has\",\n      value: function has(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.has(key: \\\"\").concat(key, \"\\\") : Boolean]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return false;\n        }\n        return CookieAdapter._getCookie(this._prefix + key) !== null;\n      }\n    }, {\n      key: \"get\",\n      value: function get(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.get(key: \\\"\").concat(key, \"\\\") : Any]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return null;\n        }\n        var value = CookieAdapter._getCookie(this._prefix + key);\n        return value === null ? null : CookieAdapter._deserialize(value);\n      }\n    }, {\n      key: \"set\",\n      value: function set(key, value) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.set(key: \\\"\").concat(key, \"\\\", value: \\u2026) : Boolean]\"));\n        }\n        if (typeof key !== 'string' || !key) {\n          return false;\n        }\n        try {\n          CookieAdapter._setCookie(this._prefix + key, CookieAdapter._serialize(value),\n          // An undefined expiry denotes a session cookie.\n          this.persistent ? _MAX_EXPIRY : undefined);\n          if (!this.has(key)) {\n            throw new Error('unknown validation error during set');\n          }\n        } catch (ex) {\n          // Massage the cookie exception into something a bit nicer for the player.\n          throw exceptionFrom(ex, Error, {\n            cause: {\n              origin: ex\n            },\n            message: \"cookie error: \".concat(ex.message)\n          });\n        }\n        return true;\n      }\n    }, {\n      key: \"delete\",\n      value: function _delete(key) {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.delete(key: \\\"\").concat(key, \"\\\") : Boolean]\"));\n        }\n\n        /*\n        \tAttempting to delete a cookie implies setting it, so we test for its existence\n        \tbeforehand, to avoid creating it in the event that it does not already exist.\n        */\n        if (typeof key !== 'string' || !key || !this.has(key)) {\n          return false;\n        }\n        try {\n          CookieAdapter._setCookie(this._prefix + key,\n          // Use `undefined` as the value.\n          undefined,\n          // Use the epoch as the expiry.\n          _MIN_EXPIRY);\n          if (this.has(key)) {\n            throw new Error('unknown validation error during delete');\n          }\n        } catch (ex) {\n          // Massage the cookie exception into something a bit nicer for the player.\n          throw exceptionFrom(ex, Error, {\n            cause: {\n              origin: ex\n            },\n            message: \"cookie error: \".concat(ex.message)\n          });\n        }\n        return true;\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        if (BUILD_DEBUG) {\n          console.log(\"[<SimpleStore:\".concat(this.name, \">.clear() : Boolean]\"));\n        }\n        var keys = this.keys();\n        for (var i = 0, length = keys.length; i < length; ++i) {\n          if (BUILD_DEBUG) {\n            console.log('\\tdeleting key:', keys[i]);\n          }\n          this.delete(keys[i]);\n        }\n        return true;\n      }\n    }], [{\n      key: \"_getCookie\",\n      value: function _getCookie(prefixedKey) {\n        if (!prefixedKey || document.cookie === '') {\n          return null;\n        }\n        var cookies = document.cookie.split(/;\\s*/);\n        for (var i = 0; i < cookies.length; ++i) {\n          var kvPair = cookies[i].split('=');\n          var key = decodeURIComponent(kvPair[0]);\n          if (prefixedKey === key) {\n            var value = decodeURIComponent(kvPair[1]);\n\n            // NOTE: All stored values are serialized and an empty string will\n            // always serialize to a non-empty string.  Therefore, receiving an\n            // empty string here denotes a deleted value rather than a serialized\n            // empty string, so we return `null` for such pairs.\n            return value || null;\n          }\n        }\n        return null;\n      }\n    }, {\n      key: \"_setCookie\",\n      value: function _setCookie(prefixedKey, value, expiry) {\n        if (!prefixedKey) {\n          return;\n        }\n        var payload = \"\".concat(encodeURIComponent(prefixedKey), \"=\");\n        if (value != null) {\n          // lazy equality for null\n          payload += encodeURIComponent(value);\n        }\n        if (expiry != null) {\n          // lazy equality for null\n          payload += \"; expires=\".concat(expiry);\n        }\n        payload += '; path=/';\n        document.cookie = payload;\n      }\n    }, {\n      key: \"_serialize\",\n      value: function _serialize(obj) {\n        return LZString.compressToBase64(Serial.stringify(obj));\n      }\n    }, {\n      key: \"_deserialize\",\n      value: function _deserialize(str) {\n        return Serial.parse(LZString.decompressFromBase64(str));\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tAdapter Utility Functions.\n  *******************************************************************************/\n  function create(storageId, persistent) {\n    if (!_ok) {\n      throw new Error('adapter not initialized');\n    }\n    return new CookieAdapter(storageId, persistent);\n  }\n  function init(\n  // Only used for stores updates.\n  storageId) {\n    // Cookie feature test.\n    try {\n      var tid = \"_sc_\".concat(String(Date.now()));\n\n      // We only test a session cookie as that should suffice.\n      CookieAdapter._setCookie(tid, CookieAdapter._serialize(tid), undefined);\n      _ok = CookieAdapter._deserialize(CookieAdapter._getCookie(tid)) === tid;\n      CookieAdapter._setCookie(tid, undefined, _MIN_EXPIRY);\n    } catch (ex) {\n      _ok = false;\n    }\n\n    /* legacy */\n    // Attempt to update the cookie stores, if necessary.  This should happen only during initialization.\n    if (_ok) {\n      _updateCookieStores(storageId);\n    }\n    /* /legacy */\n\n    return _ok;\n  }\n\n  /* legacy */\n  // Updates old non-segmented cookie stores into segmented stores.\n  function _updateCookieStores(storageId) {\n    if (document.cookie === '') {\n      return;\n    }\n    var oldPrefix = \"\".concat(storageId, \".\");\n    var oldPrefixRe = new RegExp(\"^\".concat(RegExp.escape(oldPrefix)));\n    var persistPrefix = \"\".concat(storageId, \"!.\");\n    var sessionPrefix = \"\".concat(storageId, \"*.\");\n    var sessionTestRe = /\\.(?:state|rcWarn)$/;\n    var cookies = document.cookie.split(/;\\s*/);\n    var _loop = function _loop() {\n      var kvPair = cookies[i].split('=');\n      var key = decodeURIComponent(kvPair[0]);\n      if (oldPrefixRe.test(key)) {\n        // NOTE: All stored values are serialized and an empty string will always\n        // serialize to a non-empty string.  Therefore, receiving an empty string\n        // here denotes a deleted value rather than a serialized empty string, so\n        // we skip processing of such pairs.\n        var value = decodeURIComponent(kvPair[1]);\n        if (value !== '') {\n          var persist = !sessionTestRe.test(key);\n\n          // Delete the old k/v pair.\n          CookieAdapter._setCookie(key, undefined, _MIN_EXPIRY);\n\n          // Set the new k/v pair.\n          CookieAdapter._setCookie(key.replace(oldPrefixRe, function () {\n            return persist ? persistPrefix : sessionPrefix;\n          }), value, persist ? _MAX_EXPIRY : undefined);\n        }\n      }\n    };\n    for (var i = 0; i < cookies.length; ++i) {\n      _loop();\n    }\n  }\n  /* /legacy */\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    init: {\n      value: init\n    },\n    create: {\n      value: create\n    }\n  }));\n}());\n\n/***********************************************************************************************************************\n\n\tlib/debugview.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global triggerEvent */\n\n/*\n\tTODO: Make this use jQuery throughout.\n*/\nvar DebugView = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tDebugView Class.\n  *******************************************************************************/\n  var DebugView = /*#__PURE__*/function () {\n    function DebugView(parent, type, name, title) {\n      _classCallCheck(this, DebugView);\n      Object.defineProperties(this, {\n        parent: {\n          value: parent\n        },\n        view: {\n          value: document.createElement('span')\n        },\n        break: {\n          value: document.createElement('wbr')\n        }\n      });\n\n      // Set up the wrapper (`<span>`) element.\n      jQuery(this.view).attr({\n        title: title,\n        'aria-label': title,\n        'data-type': type != null ? type : '',\n        // lazy equality for null\n        'data-name': name != null ? name : '' // lazy equality for null\n      }).addClass('debug');\n\n      // Set up the word break (`<wbr>`) element.\n      jQuery(this.break).addClass('debug hidden');\n\n      // Add the wrapper (`<span>`) and word break (`<wbr>`) elements to the `parent` element.\n      this.parent.appendChild(this.view);\n      this.parent.appendChild(this.break);\n    }\n    return _createClass(DebugView, [{\n      key: \"output\",\n      get: function get() {\n        return this.view;\n      }\n    }, {\n      key: \"type\",\n      get: function get() {\n        return this.view.getAttribute('data-type');\n      },\n      set: function set(type) {\n        this.view.setAttribute('data-type', type != null ? type : ''); // lazy equality for null\n      }\n    }, {\n      key: \"name\",\n      get: function get() {\n        return this.view.getAttribute('data-name');\n      },\n      set: function set(name) {\n        this.view.setAttribute('data-name', name != null ? name : ''); // lazy equality for null\n      }\n    }, {\n      key: \"title\",\n      get: function get() {\n        return this.view.title;\n      },\n      set: function set(title) {\n        this.view.title = title;\n      }\n    }, {\n      key: \"append\",\n      value: function append(el) {\n        jQuery(this.view).append(el);\n        return this;\n      }\n    }, {\n      key: \"modes\",\n      value: function modes(options) {\n        if (options == null) {\n          // lazy equality for null\n          var current = {};\n          this.view.className.splitOrEmpty(/\\s+/).forEach(function (name) {\n            if (name !== 'debug') {\n              current[name] = true;\n            }\n          });\n          return current;\n        } else if (_typeof(options) === 'object') {\n          Object.keys(options).forEach(function (name) {\n            this[options[name] ? 'addClass' : 'removeClass'](name);\n          }, jQuery(this.view));\n          return this;\n        }\n        throw new Error('DebugView.prototype.modes options parameter must be an object or null/undefined');\n      }\n    }, {\n      key: \"remove\",\n      value: function remove() {\n        var $view = jQuery(this.view);\n        if (this.view.hasChildNodes()) {\n          $view.contents().appendTo(this.parent);\n        }\n        $view.remove();\n        jQuery(this.break).remove();\n      }\n    }], [{\n      key: \"isEnabled\",\n      value: function isEnabled() {\n        return jQuery(document.documentElement).attr('data-debug-view') === 'enabled';\n      }\n    }, {\n      key: \"enable\",\n      value: function enable() {\n        jQuery(document.documentElement).attr('data-debug-view', 'enabled');\n        triggerEvent(':debugviewupdate');\n      }\n    }, {\n      key: \"disable\",\n      value: function disable() {\n        jQuery(document.documentElement).removeAttr('data-debug-view');\n        triggerEvent(':debugviewupdate');\n      }\n    }, {\n      key: \"toggle\",\n      value: function toggle() {\n        if (DebugView.isEnabled()) {\n          DebugView.disable();\n        } else {\n          DebugView.enable();\n        }\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n  return DebugView;\n}();\n\n/***********************************************************************************************************************\n\n\tlib/nodetyper.js\n\n\tCopyright © 2020–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global charAndPosAt, getTypeOf */\n\nvar NodeTyper = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tNodeTyper Class.\n  *******************************************************************************/\n  var NodeTyper = /*#__PURE__*/function () {\n    function NodeTyper(config) {\n      _classCallCheck(this, NodeTyper);\n      if (_typeof(config) !== 'object' || config === null) {\n        throw new Error(\"config parameter must be an object (received: \".concat(getTypeOf(config), \")\"));\n      }\n      if (!Object.hasOwn(config, 'targetNode') || !(config.targetNode instanceof Node)) {\n        throw new Error('config parameter object \"targetNode\" property must be a node');\n      }\n      Object.defineProperties(this, {\n        node: {\n          value: config.targetNode\n        },\n        childNodes: {\n          value: []\n        },\n        nodeValue: {\n          writable: true,\n          value: ''\n        },\n        appendTo: {\n          writable: true,\n          value: config.parentNode || null\n        },\n        classNames: {\n          writable: true,\n          value: config.classNames || null\n        },\n        finished: {\n          writable: true,\n          value: false\n        }\n      });\n      var node = this.node;\n      if (node.nodeValue) {\n        this.nodeValue = node.nodeValue;\n        node.nodeValue = '';\n      }\n      var childNode;\n      while ((childNode = node.firstChild) !== null) {\n        this.childNodes.push(new NodeTyper({\n          targetNode: childNode,\n          parentNode: node,\n          classNames: this.classNames\n        }));\n        node.removeChild(childNode);\n      }\n    }\n    return _createClass(NodeTyper, [{\n      key: \"finish\",\n      value: function finish() {\n        while (this.type(true)) /* no-op */;\n        return false;\n      }\n    }, {\n      key: \"type\",\n      value: function type(flush) {\n        if (this.finished) {\n          return false;\n        }\n        if (this.appendTo) {\n          this.appendTo.appendChild(this.node);\n          this.appendTo = null;\n\n          // Immediately finish typing this node if….\n          if (\n          // …it's neither a element or text node.\n          this.node.nodeType !== Node.ELEMENT_NODE && this.node.nodeType !== Node.TEXT_NODE\n\n          // …or the computed value of its parent node's `display` property is `'none'`.\n          || jQuery(this.node.parentNode).css('display') === 'none') {\n            return this.finish();\n          }\n          if (this.node.parentNode && this.classNames) {\n            jQuery(this.node.parentNode).addClass(this.classNames);\n          }\n        }\n        if (this.nodeValue) {\n          if (flush) {\n            // Concatenate here in case we've already done some processing.\n            this.node.nodeValue += this.nodeValue;\n            this.nodeValue = '';\n          } else {\n            // Use `charAndPosAt()` here to properly handle Unicode code points\n            // that are comprised of surrogate pairs.\n            var _charAndPosAt = charAndPosAt(this.nodeValue, 0),\n              char = _charAndPosAt.char,\n              start = _charAndPosAt.start,\n              end = _charAndPosAt.end;\n            this.node.nodeValue += char;\n            this.nodeValue = this.nodeValue.slice(1 + end - start);\n          }\n          return true;\n        }\n        if (this.classNames) {\n          jQuery(this.node.parentNode).removeClass(this.classNames);\n          this.classNames = null;\n        }\n        var childNodes = this.childNodes;\n        while (childNodes.length > 0) {\n          if (childNodes[0].type()) {\n            return true;\n          }\n          childNodes.shift();\n        }\n        this.finished = true;\n        return false;\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n  return NodeTyper;\n}();\n\n/***********************************************************************************************************************\n\n\tlib/stylewrapper.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns, Story, Wikifier */\n\nvar StyleWrapper = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var _imageMarkupRe = new RegExp(Patterns.cssImage, 'g');\n  var _hasImageMarkupRe = new RegExp(Patterns.cssImage);\n\n  /*******************************************************************************\n  \tStyleWrapper Class.\n  *******************************************************************************/\n  var StyleWrapper = /*#__PURE__*/function () {\n    function StyleWrapper(style) {\n      _classCallCheck(this, StyleWrapper);\n      if (style == null) {\n        // lazy equality for null\n        throw new TypeError('StyleWrapper style parameter must be an HTMLStyleElement object');\n      }\n      Object.defineProperties(this, {\n        style: {\n          value: style\n        }\n      });\n    }\n    return _createClass(StyleWrapper, [{\n      key: \"isEmpty\",\n      value: function isEmpty() {\n        // This should work in all supported browsers.\n        return this.style.cssRules.length === 0;\n      }\n    }, {\n      key: \"set\",\n      value: function set(rawCss) {\n        this.clear();\n        this.add(rawCss);\n      }\n    }, {\n      key: \"add\",\n      value: function add(rawCss) {\n        var css = rawCss;\n\n        // Check for wiki image transclusion.\n        if (_hasImageMarkupRe.test(css)) {\n          /*\n          \tThe JavaScript specifications, since at least ES3, say that `<String>.replace()`\n          \tshould reset a global-flagged regular expression's `lastIndex` property to `0`\n          \tupon invocation.  Buggy browser versions exist, however, which do not reset\n          \t`lastIndex`, so we should do so manually to support those browsers.\n          \t\tNOTE: I do not think this is actually necessary, since `_imageMarkupRe` is\n          \tscoped to this module—meaning users should not be able to access it.  That\n          \tbeing the case, and since we search to exhaustion which should also cause\n          \t`lastIndex` to be reset, there should never be an instance where we invoke\n          \t`css.replace()` and `_imageMarkupRe.lastIndex` is not already `0`.  Still,\n          \tconsidering the other bug, better safe than sorry.\n          */\n          _imageMarkupRe.lastIndex = 0;\n          css = css.replace(_imageMarkupRe, function (wikiImage) {\n            var markup = Wikifier.helpers.parseSquareBracketedMarkup({\n              source: wikiImage,\n              matchStart: 0\n            });\n            if (Object.hasOwn(markup, 'error') || markup.pos < wikiImage.length) {\n              return wikiImage;\n            }\n            var source = markup.source;\n\n            // Handle image passage transclusion.\n            if (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n              var passage = Story.get(source);\n              if (passage.tags.includes('Twine.image')) {\n                source = passage.text.trim();\n              }\n            }\n\n            /*\n            \tThe source may be URI- or Base64-encoded, so we cannot use `encodeURIComponent()`\n            \there.  Instead, we simply encode any double quotes, since the URI will be\n            \tdelimited by them.\n            */\n            return \"url(\\\"\".concat(source.replace(/\"/g, '%22'), \"\\\")\");\n          });\n        }\n\n        // For IE ≤ 10.\n        if (this.style.styleSheet) {\n          this.style.styleSheet.cssText += css;\n        }\n\n        // For all other browsers (incl. IE ≥ 11).\n        else {\n          this.style.appendChild(document.createTextNode(css));\n        }\n      }\n    }, {\n      key: \"clear\",\n      value: function clear() {\n        // For IE ≤10.\n        if (this.style.styleSheet) {\n          this.style.styleSheet.cssText = '';\n        }\n\n        // For all other browsers (incl. IE ≥11).\n        else {\n          jQuery(this.style).empty();\n        }\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n  return StyleWrapper;\n}();\n\n/***********************************************************************************************************************\n\n\tlib/diff.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global clone, enumFrom */\n\nvar Diff = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Diff operations object.\n  var Op = enumFrom({\n    Delete: 0,\n    SpliceArray: 1,\n    Copy: 2,\n    /* legacy */\n    CopyDate: 3\n    /* /legacy */\n  });\n\n  /*******************************************************************************\n  \tDiff Functions.\n  *******************************************************************************/\n\n  // Returns whether the given value is a finite number or a numeric string\n  // that yields a finite number when parsed.\n  function isNumeric(O) {\n    var num;\n    switch (_typeof(O)) {\n      case 'number':\n        num = O;\n        break;\n      case 'string':\n        num = Number(O);\n        break;\n      default:\n        return false;\n    }\n    return !Number.isNaN(num) && Number.isFinite(num);\n  }\n\n  // Returns a delta object generated from comparing the `a` and `b` objects.\n  function diff(a, b) /* delta object */{\n    var toString = Object.prototype.toString;\n    var aIsArray = a instanceof Array;\n    var delta = Object.create(null);\n    var keys = [].concat(_toConsumableArray(Object.keys(a)), _toConsumableArray(Object.keys(b))).sort().filter(function (val, i, arr) {\n      return i === 0 || arr[i - 1] !== val;\n    });\n    var aOpKey;\n\n    // Array operation predicate.\n    var isAOpKey = function isAOpKey(key) {\n      return key === aOpKey;\n    };\n\n    /* eslint-disable max-depth */\n    for (var i = 0, klen = keys.length; i < klen; ++i) {\n      var key = keys[i];\n      var aVal = a[key];\n      var bVal = b[key];\n\n      // Key exists in `a`.\n      if (Object.hasOwn(a, key)) {\n        // Key exists in both.\n        if (Object.hasOwn(b, key)) {\n          // Values are exactly the same, so do nothing.\n          if (aVal === bVal) {\n            continue;\n          }\n\n          // Values are of the same basic type.\n          if (_typeof(aVal) === _typeof(bVal)) {\n            // Values are functions.\n            if (typeof aVal === 'function') {\n              /* delta[key] = [Op.Copy, bVal]; */\n              if (aVal.toString() !== bVal.toString()) {\n                delta[key] = [Op.Copy, bVal];\n              }\n            }\n\n            // Values are primitives.\n            else if (_typeof(aVal) !== 'object' || aVal === null) {\n              delta[key] = [Op.Copy, bVal];\n            }\n\n            // Values are objects.\n            else {\n              var aValType = toString.call(aVal);\n              var bValType = toString.call(bVal);\n\n              // Values are objects of the same reported type.\n              if (aValType === bValType) {\n                // Supported natives and generic objects.\n                if (aVal instanceof Date) {\n                  if (aVal.getTime() !== bVal.getTime()) {\n                    delta[key] = [Op.Copy, clone(bVal)];\n                  }\n                } else if (aVal instanceof Map) {\n                  delta[key] = [Op.Copy, clone(bVal)];\n                } else if (aVal instanceof RegExp) {\n                  if (aVal.toString() !== bVal.toString()) {\n                    delta[key] = [Op.Copy, clone(bVal)];\n                  }\n                } else if (aVal instanceof Set) {\n                  delta[key] = [Op.Copy, clone(bVal)];\n                } else if (aVal instanceof Array || aValType === '[object Object]') {\n                  var subDelta = diff(aVal, bVal);\n                  if (subDelta !== null) {\n                    delta[key] = subDelta;\n                  }\n                }\n\n                // Unknown non-generic objects (custom or unsupported natives).\n                else {\n                  // We cannot know how to process these objects,\n                  // so we simply accept them as-is.\n                  delta[key] = [Op.Copy, clone(bVal)];\n                }\n              }\n\n              // Values are objects of different reported types.\n              else {\n                delta[key] = [Op.Copy, clone(bVal)];\n              }\n            }\n          }\n\n          // Values are of different types.\n          else {\n            delta[key] = [Op.Copy, _typeof(bVal) !== 'object' || bVal === null ? bVal : clone(bVal)];\n          }\n        }\n\n        // Key exists only in `a`.\n        else {\n          if (aIsArray && isNumeric(key)) {\n            var index = Number(key);\n            if (!aOpKey) {\n              aOpKey = '';\n              do {\n                aOpKey += '~';\n              } while (keys.some(isAOpKey));\n              delta[aOpKey] = [Op.SpliceArray, index, index];\n            }\n            if (index < delta[aOpKey][1]) {\n              delta[aOpKey][1] = index;\n            }\n            if (index > delta[aOpKey][2]) {\n              delta[aOpKey][2] = index;\n            }\n          } else {\n            delta[key] = Op.Delete;\n          }\n        }\n      }\n\n      // Key exists only in `b`.\n      else {\n        delta[key] = [Op.Copy, _typeof(bVal) !== 'object' || bVal === null ? bVal : clone(bVal)];\n      }\n    }\n    /* eslint-enable max-depth */\n\n    return Object.keys(delta).length > 0 ? delta : null;\n  }\n\n  // Returns the object resulting from updating the `orig` object with the\n  // `delta` object.\n  function patch(orig, delta) /* patched object */{\n    var keys = delta ? Object.keys(delta) : [];\n    var patched = clone(orig);\n    for (var i = 0, klen = keys.length; i < klen; ++i) {\n      var key = keys[i];\n      var value = delta[key];\n      if (value === Op.Delete) {\n        delete patched[key];\n      } else if (value instanceof Array) {\n        switch (value[0]) {\n          case Op.SpliceArray:\n            patched.splice(value[1], value[2] - value[1] + 1);\n            break;\n          case Op.Copy:\n            patched[key] = clone(value[1]);\n            break;\n\n          /* legacy */\n          case Op.CopyDate:\n            patched[key] = new Date(value[1]);\n            break;\n          /* /legacy */\n        }\n      } else {\n        patched[key] = patch(patched[key], value);\n      }\n    }\n    return patched;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    Op: {\n      value: Op\n    },\n    diff: {\n      value: diff\n    },\n    patch: {\n      value: patch\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tl10n/l10n.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global l10nStrings */\n\nvar L10n = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Maximum replacement depth.\n  var MAX_DEPTH = 50;\n\n  // Replacement regular expressions.\n  var replaceRE = /\\{\\w+\\}/g;\n  var hasReplaceRE = new RegExp(replaceRE.source); // to drop the global flag\n\n  /*******************************************************************************\n  \tLocalization Functions.\n  *******************************************************************************/\n\n  function init() {\n    /* currently no-op */\n  }\n\n  /*******************************************************************************\n  \tLocalized String Functions.\n  *******************************************************************************/\n\n  function get(ids, overrides) {\n    if (!ids) {\n      return '';\n    }\n    var id = (Array.isArray(ids) ? ids : [ids]).find(function (id) {\n      return Object.hasOwn(l10nStrings, id);\n    });\n    if (!id) {\n      return '';\n    }\n    var value = l10nStrings[id];\n    var i = 0;\n    while (hasReplaceRE.test(value)) {\n      if (++i > MAX_DEPTH) {\n        throw new Error('L10n.get exceeded maximum replacement depth, probable infinite loop');\n      }\n\n      // Possibly required by some old buggy browsers.\n      replaceRE.lastIndex = 0;\n      value = value.replace(replaceRE, function (replacement) {\n        var rid = replacement.slice(1, -1);\n        if (overrides && Object.hasOwn(overrides, rid)) {\n          return overrides[rid];\n        } else if (Object.hasOwn(l10nStrings, rid)) {\n          return l10nStrings[rid];\n        }\n      });\n    }\n    return value;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Localization Functions.\n    init: {\n      value: init\n    },\n    // Localized String Functions.\n    get: {\n      value: get\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tl10n/strings.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* eslint-disable max-len */\n\n/*\n\tATTENTION TRANSLATORS\n\n\tPlease use the `locale/l10n-template.js` file, from the root of the repository,\n\tas the template for your translation rather than this file.\n\n\tSEE: https://github.com/tmedwards/sugarcube-2/tree/develop/locale\n*/\nvar l10nStrings = {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tGeneral.\n  *******************************************************************************/\n\n  textAbort: 'Abort',\n  textAborting: 'Aborting',\n  textCancel: 'Cancel',\n  textClear: 'Clear',\n  textClose: 'Close',\n  textDelete: 'Delete',\n  textExport: 'Export',\n  // In lowercase, if possible.\n  textIdentity: 'game',\n  textImport: 'Import',\n  textLoad: 'Load',\n  textOff: 'Off',\n  textOk: 'OK',\n  textOn: 'On',\n  textSave: 'Save',\n  // (noun) chance to act (in a game), moment, period\n  textTurn: 'Turn',\n  /*******************************************************************************\n  \tErrors.\n  *******************************************************************************/\n\n  // NOTE: `passage` is supplied locally.\n  errorNonexistentPassage: 'the passage \"{passage}\" does not exist',\n  /*******************************************************************************\n  \tWarnings.\n  *******************************************************************************/\n\n  warningNoStorage: 'All usable storage APIs are missing. Possible causes are a disabled third-party cookie setting, which also affects Web Storage, or a private browsing mode.',\n  warningNoWebStorage: 'The Web Storage API is missing, so this {textIdentity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.',\n  warningDegraded: 'Some capabilities required to support this {textIdentity} are missing, so it is running in a degraded mode. You may be able to continue, however, some parts may not work properly.',\n  warningNoSaves: 'Some capabilities required to support saves are missing, so saves have been disabled for this session.',\n  /*******************************************************************************\n  \tAPI: Save.\n  *******************************************************************************/\n\n  saveErrorDisallowed: 'Saving is currently disallowed.',\n  saveErrorDecodeFail: 'unable to decode save, likely due to corruption',\n  saveErrorDiskLoadFail: 'failed to load save file from disk',\n  saveErrorIdMismatch: 'save is from the wrong {textIdentity}',\n  saveErrorInvalidData: 'save is missing required data, likely due to corruption',\n  saveErrorLoadTooEarly: 'cannot load save this early',\n  saveErrorNonexistent: 'save does not exist',\n  /*******************************************************************************\n  \tBase UI.\n  *******************************************************************************/\n\n  uiBarLabelToggle: 'Toggle the UI bar',\n  uiBarLabelBackward: 'Go backward within the {textIdentity} history',\n  uiBarLabelForward: 'Go forward within the {textIdentity} history',\n  // [DEPRECATED]\n  uiBarLabelJumpto: 'Jump to a specific point within the {textIdentity} history',\n  /*******************************************************************************\n  \tDialog: Alert.\n  *******************************************************************************/\n\n  alertTitle: 'Alert',\n  /*******************************************************************************\n  \tDialog: Restart.\n  *******************************************************************************/\n\n  restartTitle: 'Restart',\n  restartMesgPrompt: 'All unsaved progress will be lost. Are you sure that you want to restart?',\n  /*******************************************************************************\n  \tDialog: Saves.\n  *******************************************************************************/\n\n  continueTitle: 'Continue',\n  savesTitle: 'Saves',\n  savesHeaderBrowser: 'In Browser',\n  savesHeaderDisk: 'On Disk',\n  savesLabelBrowserClear: 'Clear all browser saves',\n  savesLabelBrowserExport: 'Export browser saves to bundle',\n  savesLabelBrowserImport: 'Import browser saves from bundle',\n  savesLabelDiskLoad: 'Load from disk',\n  savesLabelDiskSave: 'Save to disk',\n  savesTextBrowserAuto: 'Auto',\n  savesTextBrowserSlot: 'Slot',\n  savesTextNoDate: 'unknown date',\n  /*******************************************************************************\n  \tDialog: Settings.\n  *******************************************************************************/\n\n  settingsTitle: 'Settings',\n  settingsTextReset: 'Reset to Defaults',\n  /*******************************************************************************\n  \tDebugging: Error Views.\n  *******************************************************************************/\n\n  errorViewTitle: 'Error',\n  errorViewLabelToggle: 'Toggle the error view',\n  /*******************************************************************************\n  \tDebugging: Debug bar.\n  *******************************************************************************/\n\n  debugBarLabelToggle: 'Toggle the debug bar',\n  debugBarLabelViewsToggle: 'Toggle the debug views',\n  debugBarLabelWatchAdd: 'Add a new watch',\n  debugBarLabelWatchAll: 'Watch all',\n  debugBarLabelWatchClear: 'Clear all watches',\n  debugBarLabelWatchDelete: 'Delete this watch',\n  debugBarLabelWatchPlaceholder: 'variable name',\n  debugBarLabelPassagePlaceholder: 'passage name',\n  debugBarLabelPassagePlay: 'Play passage',\n  debugBarLabelWatchToggle: 'Toggle the watch panel',\n  debugBarMesgNoWatches: 'No watches set',\n  debugBarTextAdd: 'Add',\n  debugBarTextPassage: 'Passage',\n  debugBarTextViews: 'Views',\n  debugBarTextWatch: 'Watch',\n  /*******************************************************************************\n  \tMacros.\n  *******************************************************************************/\n\n  // (verb) rewind, revert\n  macroBackText: 'Back',\n  // (verb) go/send back\n  macroReturnText: 'Return',\n  /*******************************************************************************\n  \t[DEPRECATED] Dialog: Autoload.\n  *******************************************************************************/\n\n  autoloadTitle: 'Autoload',\n  autoloadMesgPrompt: 'An autosave exists. Load it now or go to the start?',\n  autoloadTextCancel: 'Go to start',\n  autoloadTextOk: 'Load autosave',\n  /*******************************************************************************\n  \t[DEPRECATED] Dialog: Jump To.\n  *******************************************************************************/\n\n  jumptoTitle: 'Jump To',\n  jumptoMesgUnavailable: \"No jump points currently available\\u2026\",\n  /*******************************************************************************\n  \t[DEPRECATED] Dialog: Share.\n  *******************************************************************************/\n\n  shareTitle: 'Share'\n};\n\n/***********************************************************************************************************************\n\n\tconfig.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Save, State, Story, getTypeOf */\n\nvar Config = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // General settings.\n  var _addVisitedLinkClass = false;\n  var _cleanupWikifierOutput = false;\n  var _debug = false;\n  var _enableOptionalDebugging = false;\n  var _loadDelay = 0;\n\n  // Audio settings.\n  var _audioPauseOnFadeToZero = true;\n  var _audioPreloadMetadata = true;\n\n  // State history settings.\n  var _historyControls = true;\n  var _historyMaxStates = 40;\n\n  // Macros settings.\n  var _macrosMaxLoopIterations = 1000;\n  var _macrosTypeSkipKey = '\\x20'; // Space\n  var _macrosTypeVisitedPassages = true;\n\n  // Navigation settings.\n  var _navigationOverride;\n\n  // Passages settings.\n  var _passagesDisplayTitles = false;\n  var _passagesNobr = false;\n  var _passagesStart; // Set by `Story.init()`\n  var _passagesOnProcess;\n  var _passagesTransitionOut;\n\n  // Saves settings.\n  var _savesDescriptions;\n  var _savesId; // NOTE: Initially set by `Story.init()`.\n  var _savesIsAllowed;\n  var _savesMaxAuto = 0;\n  var _savesMaxSlot = 8;\n  var _savesMetadata;\n  var _savesVersion;\n  /* legacy */\n  var _savesAutoload; // [DEPRECATED]\n  /* /legacy */\n\n  // UI settings.\n  var _uiStowBarInitially = 800;\n  var _uiUpdateStoryElements = true;\n\n  /*******************************************************************************\n  \tError Constants.\n  *******************************************************************************/\n\n  var errMacrosIfAssignmentErrorDeprecated = '[DEPRECATED] Config.macros.ifAssignmentError has been deprecated, see Config.enableOptionalDebugging instead';\n  var errPassagesDescriptionsDeprecated = '[DEPRECATED] Config.passages.descriptions has been deprecated, see Config.saves.descriptions instead';\n  var errSavesAutoloadDeprecated = '[DEPRECATED] Config.saves.autoload has been deprecated, see the Save.browser.continue API instead';\n  var _baseSavesAutosaveDeprecated = '[DEPRECATED] Config.saves.autosave has been deprecated';\n  var errSavesOnLoadDeprecated = '[DEPRECATED] Config.saves.onLoad has been deprecated, see the Save.onLoad API instead';\n  var errSavesOnSaveDeprecated = '[DEPRECATED] Config.saves.onSave has been deprecated, see the Save.onSave API instead';\n  var errSavesSlotsDeprecated = '[DEPRECATED] Config.saves.slots has been deprecated, see Config.saves.maxSlotSaves instead';\n  var errSavesTryDiskOnMobileDeprecated = '[DEPRECATED] Config.saves.tryDiskOnMobile has been deprecated';\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.freeze({\n    /*\n    \tGeneral settings.\n    */\n    get addVisitedLinkClass() {\n      return _addVisitedLinkClass;\n    },\n    set addVisitedLinkClass(value) {\n      _addVisitedLinkClass = Boolean(value);\n    },\n    get cleanupWikifierOutput() {\n      return _cleanupWikifierOutput;\n    },\n    set cleanupWikifierOutput(value) {\n      _cleanupWikifierOutput = Boolean(value);\n    },\n    get debug() {\n      return _debug;\n    },\n    set debug(value) {\n      _debug = Boolean(value);\n    },\n    get enableOptionalDebugging() {\n      return _enableOptionalDebugging;\n    },\n    set enableOptionalDebugging(value) {\n      _enableOptionalDebugging = Boolean(value);\n    },\n    get loadDelay() {\n      return _loadDelay;\n    },\n    set loadDelay(value) {\n      if (!Number.isSafeInteger(value) || value < 0) {\n        throw new RangeError('Config.loadDelay must be a non-negative integer');\n      }\n      _loadDelay = value;\n    },\n    /*\n    \tAudio settings.\n    */\n    audio: Object.freeze({\n      get pauseOnFadeToZero() {\n        return _audioPauseOnFadeToZero;\n      },\n      set pauseOnFadeToZero(value) {\n        _audioPauseOnFadeToZero = Boolean(value);\n      },\n      get preloadMetadata() {\n        return _audioPreloadMetadata;\n      },\n      set preloadMetadata(value) {\n        _audioPreloadMetadata = Boolean(value);\n      }\n    }),\n    /*\n    \tState history settings.\n    */\n    history: Object.freeze({\n      // TODO: (v3) This should be under UI settings → `Config.ui.historyControls`.\n      get controls() {\n        return _historyControls;\n      },\n      set controls(value) {\n        var controls = Boolean(value);\n        if (_historyMaxStates === 1 && controls) {\n          throw new Error('Config.history.controls must be false when Config.history.maxStates is 1');\n        }\n        _historyControls = controls;\n      },\n      get maxStates() {\n        return _historyMaxStates;\n      },\n      set maxStates(value) {\n        if (!Number.isSafeInteger(value) || value < 1) {\n          throw new RangeError('Config.history.maxStates must be a positive integer');\n        }\n        _historyMaxStates = value;\n\n        // Force `Config.history.controls` to `false`, when limited to `1` moment.\n        if (_historyControls && value === 1) {\n          _historyControls = false;\n        }\n      }\n    }),\n    /*\n    \tMacros settings.\n    */\n    macros: Object.freeze({\n      get maxLoopIterations() {\n        return _macrosMaxLoopIterations;\n      },\n      set maxLoopIterations(value) {\n        if (!Number.isSafeInteger(value) || value < 1) {\n          throw new RangeError('Config.macros.maxLoopIterations must be a positive integer');\n        }\n        _macrosMaxLoopIterations = value;\n      },\n      get typeSkipKey() {\n        return _macrosTypeSkipKey;\n      },\n      set typeSkipKey(value) {\n        _macrosTypeSkipKey = String(value);\n      },\n      get typeVisitedPassages() {\n        return _macrosTypeVisitedPassages;\n      },\n      set typeVisitedPassages(value) {\n        _macrosTypeVisitedPassages = Boolean(value);\n      },\n      /* legacy */\n      // Die if the deprecated macros if assignment error getter is accessed.\n      get ifAssignmentError() {\n        throw new Error(errMacrosIfAssignmentErrorDeprecated);\n      },\n      // Warn if the deprecated macros if assignment error setter is assigned to,\n      // while also setting `Config.enableOptionalDebugging` for compatibilities sake.\n      set ifAssignmentError(value) {\n        console.warn(errMacrosIfAssignmentErrorDeprecated);\n        Config.enableOptionalDebugging = value;\n      }\n      /* /legacy */\n    }),\n    /*\n    \tNavigation settings.\n    */\n    navigation: Object.freeze({\n      get override() {\n        return _navigationOverride;\n      },\n      set override(value) {\n        if (!(value == null || value instanceof Function)) {\n          // lazy equality for null\n          throw new TypeError(\"Config.navigation.override must be a function or null/undefined (received: \".concat(getTypeOf(value), \")\"));\n        }\n        _navigationOverride = value;\n      }\n    }),\n    /*\n    \tPassages settings.\n    */\n    passages: Object.freeze({\n      // TODO: (v3) This should be under Navigation settings → `Config.navigation.updateTitle`.\n      get displayTitles() {\n        return _passagesDisplayTitles;\n      },\n      set displayTitles(value) {\n        _passagesDisplayTitles = Boolean(value);\n      },\n      get nobr() {\n        return _passagesNobr;\n      },\n      set nobr(value) {\n        _passagesNobr = Boolean(value);\n      },\n      get onProcess() {\n        return _passagesOnProcess;\n      },\n      set onProcess(value) {\n        if (value != null) {\n          // lazy equality for null\n          var valueType = getTypeOf(value);\n          if (valueType !== 'function') {\n            throw new TypeError(\"Config.passages.onProcess must be a function or null/undefined (received: \".concat(valueType, \")\"));\n          }\n        }\n        _passagesOnProcess = value;\n      },\n      // TODO: (v3) This should be under Navigation settings → `Config.navigation.(start|startingPassage)`.\n      get start() {\n        return _passagesStart;\n      },\n      set start(value) {\n        if (value != null) {\n          // lazy equality for null\n          var valueType = getTypeOf(value);\n          if (valueType !== 'string') {\n            throw new TypeError(\"Config.passages.start must be a string or null/undefined (received: \".concat(valueType, \")\"));\n          }\n        }\n        _passagesStart = value;\n      },\n      // TODO: (v3) This should be under Navigation settings → `Config.navigation.transitionOut`.\n      get transitionOut() {\n        return _passagesTransitionOut;\n      },\n      set transitionOut(value) {\n        if (value != null) {\n          // lazy equality for null\n          var valueType = getTypeOf(value);\n          if (valueType !== 'string' && (valueType !== 'number' || !Number.isSafeInteger(value) || value < 0)) {\n            throw new TypeError(\"Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: \".concat(valueType, \")\"));\n          }\n        }\n        _passagesTransitionOut = value;\n      },\n      /* legacy */\n      // Die if the deprecated passages descriptions getter is accessed.\n      get descriptions() {\n        throw new Error(errPassagesDescriptionsDeprecated);\n      },\n      // Warn if deprecated passages descriptions setter is assigned to,\n      // then pass the value to the `Config.saves.descriptions` for\n      // compatibilities sake.\n      set descriptions(value) {\n        console.warn(errPassagesDescriptionsDeprecated);\n        switch (_typeof(value)) {\n          case 'boolean':\n            {\n              if (value && !Config.saves.descriptions) {\n                Config.saves.descriptions = function () {\n                  return State.passage;\n                };\n              }\n              break;\n            }\n          case 'function':\n            {\n              if (!Config.saves.descriptions) {\n                Config.saves.descriptions = value;\n              }\n              break;\n            }\n          case 'undefined':\n          case 'object':\n            {\n              if (value && !Config.saves.descriptions) {\n                var dict = value;\n                Config.saves.descriptions = function () {\n                  return Object.hasOwn(dict, State.passage) && dict[State.passage];\n                };\n              }\n              break;\n            }\n          default:\n            throw new TypeError(\"Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: \".concat(getTypeOf(value), \")\"));\n        }\n      }\n      /* /legacy */\n    }),\n    /*\n    \tSaves settings.\n    */\n    saves: Object.freeze({\n      get descriptions() {\n        return _savesDescriptions;\n      },\n      set descriptions(value) {\n        if (!(value == null || value instanceof Function)) {\n          // lazy equality for null\n          throw new TypeError(\"Config.saves.descriptions must be a function or null/undefined (received: \".concat(getTypeOf(value), \")\"));\n        }\n        _savesDescriptions = value;\n      },\n      get id() {\n        return _savesId;\n      },\n      set id(value) {\n        if (typeof value !== 'string' || value === '') {\n          throw new TypeError(\"Config.saves.id must be a non-empty string (received: \".concat(getTypeOf(value), \")\"));\n        }\n        _savesId = value;\n      },\n      get isAllowed() {\n        return _savesIsAllowed;\n      },\n      set isAllowed(value) {\n        if (!(value == null || value instanceof Function)) {\n          // lazy equality for null\n          throw new TypeError(\"Config.saves.isAllowed must be a function or null/undefined (received: \".concat(getTypeOf(value), \")\"));\n        }\n        _savesIsAllowed = value;\n      },\n      get maxAutoSaves() {\n        return _savesMaxAuto;\n      },\n      set maxAutoSaves(value) {\n        if (!Number.isInteger(value)) {\n          throw new TypeError('Config.saves.maxAutoSaves must be an integer');\n        } else if (value < 0 || value > Save.MAX_INDEX + 1) {\n          throw new RangeError(\"Config.saves.maxAutoSaves out of bounds (range: 0\\u2013\".concat(Save.MAX_INDEX + 1, \"; received: \").concat(value, \")\"));\n        }\n        _savesMaxAuto = value;\n      },\n      get maxSlotSaves() {\n        return _savesMaxSlot;\n      },\n      set maxSlotSaves(value) {\n        if (!Number.isInteger(value)) {\n          throw new TypeError('Config.saves.maxSlotSaves must be an integer');\n        } else if (value < 0 || value > Save.MAX_INDEX + 1) {\n          throw new RangeError(\"Config.saves.maxSlotSaves out of bounds (range: 0\\u2013\".concat(Save.MAX_INDEX + 1, \"; received: \").concat(value, \")\"));\n        }\n        _savesMaxSlot = value;\n      },\n      get metadata() {\n        return _savesMetadata;\n      },\n      set metadata(value) {\n        if (!(value == null || value instanceof Function)) {\n          // lazy equality for null\n          throw new TypeError(\"Config.saves.metadata must be a function or null/undefined (received: \".concat(getTypeOf(value), \")\"));\n        }\n        _savesMetadata = value;\n      },\n      get version() {\n        return _savesVersion;\n      },\n      set version(value) {\n        _savesVersion = value;\n      },\n      /* legacy */\n      get _internal_autoload_() {\n        // eslint-disable-line camelcase\n        return _savesAutoload;\n      },\n      // Warn if the deprecated autoload getter is accessed.\n      get autoload() {\n        console.warn(errSavesAutoloadDeprecated);\n        return _savesAutoload;\n      },\n      // Warn if the deprecated autoload setter is assigned to.\n      set autoload(value) {\n        console.warn(errSavesAutoloadDeprecated);\n        if (value != null) {\n          // lazy equality for null\n          var valueType = getTypeOf(value);\n          if (valueType !== 'boolean' && (valueType !== 'string' || value !== 'prompt') && valueType !== 'function') {\n            throw new TypeError(\"Config.saves.autoload must be a boolean, string ('prompt'), function, or null/undefined (received: \".concat(valueType, \")\"));\n          }\n        }\n        _savesAutoload = value;\n      },\n      // Die if the deprecated saves autosave getter is accessed.\n      get autosave() {\n        throw new Error(\"\".concat(_baseSavesAutosaveDeprecated, \", see Config.saves.maxAutoSaves and Config.saves.isAllowed instead\"));\n      },\n      // Die or warn if the deprecated saves autosave setter is assigned to,\n      // while also setting `Config.saves.maxAutoSaves` and, possibly,\n      // `Config.saves.isAllowed` for compatibilities sake.\n      set autosave(value) {\n        switch (_typeof(value)) {\n          case 'boolean':\n            console.warn(\"\".concat(_baseSavesAutosaveDeprecated, \", for boolean usage see Config.saves.maxAutoSaves instead\"));\n            break;\n          case 'function':\n            {\n              console.warn(\"\".concat(_baseSavesAutosaveDeprecated, \", for function usage see Config.saves.isAllowed instead\"));\n              if (!Config.saves.isAllowed) {\n                var callback = value;\n                Config.saves.isAllowed = function (saveType) {\n                  // Allow all other types while testing auto saves.\n                  return saveType !== Save.Type.Auto || callback(saveType);\n                };\n              }\n              break;\n            }\n          default:\n            {\n              console.warn(\"\".concat(_baseSavesAutosaveDeprecated, \", for tag usage see Config.saves.isAllowed instead\"));\n              if (!(value instanceof Array) || value.length === 0 || value.some(function (tag) {\n                return typeof tag !== 'string';\n              })) {\n                var valueType = getTypeOf(value);\n                throw new TypeError(\"Config.saves.autosave must be a boolean, Array<string>, function, or null/undefined (received: \".concat(valueType).concat(valueType === 'Array' ? '<any>' : '', \")\"));\n              }\n              if (!Config.saves.isAllowed) {\n                var userTags = value;\n                Config.saves.isAllowed = function (saveType) {\n                  // Allow all other types while testing auto saves.\n                  return saveType !== Save.Type.Auto || userTags.includesAny(Story.get(State.passage).tags);\n                };\n              }\n              break;\n            }\n        }\n        if (Config.saves.maxAutoSaves === 0) {\n          Config.saves.maxAutoSaves = 1;\n        }\n      },\n      // Die if the deprecated saves onLoad handler getter is accessed.\n      get onLoad() {\n        throw new Error(errSavesOnLoadDeprecated);\n      },\n      // Warn if the deprecated saves onLoad handler setter is assigned to, then\n      // pass the handler to the `Save.onLoad` API for compatibilities sake.\n      set onLoad(value) {\n        console.warn(errSavesOnLoadDeprecated);\n        Save.onLoad.add(value);\n      },\n      // Die if the deprecated saves onSave handler getter is accessed.\n      get onSave() {\n        throw new Error(errSavesOnSaveDeprecated);\n      },\n      // Warn if the deprecated saves onSave handler setter is assigned to, then\n      // pass the handler to the `Save.onSave` API for compatibilities sake.\n      set onSave(value) {\n        console.warn(errSavesOnSaveDeprecated);\n        Save.onSave.add(value);\n      },\n      // Die if the deprecated saves slots getter is accessed.\n      get slots() {\n        throw new Error(errSavesSlotsDeprecated);\n      },\n      // Warn if the deprecated saves slots setter is assigned to, then pass\n      // the value to the `Config.saves.maxSlotSaves` for compatibilities\n      // sake.\n      set slots(value) {\n        console.warn(errSavesSlotsDeprecated);\n        Config.saves.maxSlotSaves = value;\n      },\n      // Warn if the deprecated saves tryDiskOnMobile getter is accessed, then\n      // return `true`.\n      get tryDiskOnMobile() {\n        console.warn(errSavesTryDiskOnMobileDeprecated);\n        return true;\n      },\n      // Warn if the deprecated saves tryDiskOnMobile setter is assigned to.\n      set tryDiskOnMobile(value) {\n        console.warn(errSavesTryDiskOnMobileDeprecated);\n      }\n      /* /legacy */\n    }),\n    /*\n    \tUI settings.\n    */\n    ui: Object.freeze({\n      get stowBarInitially() {\n        return _uiStowBarInitially;\n      },\n      set stowBarInitially(value) {\n        var valueType = getTypeOf(value);\n        if (valueType !== 'boolean' && (valueType !== 'number' || !Number.isSafeInteger(value) || value < 0)) {\n          throw new TypeError(\"Config.ui.stowBarInitially must be a boolean or non-negative integer (received: \".concat(valueType, \")\"));\n        }\n        _uiStowBarInitially = value;\n      },\n      get updateStoryElements() {\n        return _uiUpdateStoryElements;\n      },\n      set updateStoryElements(value) {\n        _uiUpdateStoryElements = Boolean(value);\n      }\n    })\n  });\n}();\n\n/***********************************************************************************************************************\n\n\taudio/simpleaudio.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Has, LoadScreen, Story, Visibility, clone, onUserActivation, parseURL, triggerEvent */\n\nvar SimpleAudio = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Special group IDs.\n  var _specialIds = Object.freeze([':not', ':all', ':looped', ':muted', ':paused', ':playing', ':stopped']);\n\n  // Format specifier regular expression.\n  var _formatSpecRe = /^([\\w-]+)\\s*\\|\\s*(\\S.*)$/; // e.g. 'mp3|https://audiohost.tld/id'\n\n  // ID verification regular expressions.\n  var _badIdRe = /[:\\s]/;\n\n  // Tracks collection.\n  var _tracks = new Map();\n\n  // Groups collection.\n  var _groups = new Map();\n\n  // Playlists collection.\n  var _lists = new Map();\n\n  // Subscriber collection.\n  var _subscribers = new Map();\n\n  // Master playback rate.\n  var _masterRate = 1;\n\n  // Master playback volume.\n  var _masterVolume = 1;\n\n  // Master mute state.\n  var _masterMute = false;\n\n  // Master mute on tab/window visibility state.\n  var _masterMuteOnHidden = false;\n\n  /*******************************************************************************\n  \tFeature Detection Functions.\n  *******************************************************************************/\n\n  // Return whether the `<HTMLAudioElement>.play()` method returns a `Promise`.\n  //\n  // NOTE: The initial result is cached for future calls.\n  var _playReturnsPromise = function () {\n    // Cache of whether `<HTMLAudioElement>.play()` returns a `Promise`.\n    var _hasPromise = null;\n    function _playReturnsPromise() {\n      if (_hasPromise !== null) {\n        return _hasPromise;\n      }\n      _hasPromise = false;\n      if (Has.audio) {\n        try {\n          var audio = document.createElement('audio');\n\n          // NOTE (ca. Jan 01, 2020): Firefox will still log an \"Autoplay is only allowed\n          // when […] media is muted.\" message to the console when attempting the test\n          // below, even though the audio has been muted.  Stay classy, Firefox.\n          //\n          // QUESTION (ca. Jan 01, 2020): Keep this?  It's only here to appease Firefox,\n          // but doesn't seem to work as Firefox seems to ignore mute in violation of the\n          // `HTMLAudioElement` specification—willfully or simply a bug, I can't say.\n          audio.muted = true;\n          var value = audio.play();\n\n          // Silence \"Uncaught (in promise)\" console errors from Blink.\n          //\n          // NOTE: Swallowing errors is generally bad, but in this case we know there's\n          // going to be an error regardless, since there's no source, and we don't actually\n          // care about the error, since we just want the return value, so we consign it\n          // to the bit bucket.\n          //\n          // NOTE: We don't ensure that the return value is not `undefined` here because\n          // having the attempted call to `<Promise>.catch()` on an `undefined` value throw\n          // is acceptable, since it will be caught and `false` eventually returned.\n          value.catch(function () {/* no-op */});\n          _hasPromise = value instanceof Promise;\n        } catch (ex) {/* no-op */}\n      }\n      return _hasPromise;\n    }\n    return _playReturnsPromise;\n  }();\n\n  /*******************************************************************************\n  \tAudioTrack Class.\n  *******************************************************************************/\n  var AudioTrack = /*#__PURE__*/function () {\n    function AudioTrack(obj) {\n      _classCallCheck(this, AudioTrack);\n      // Process the given array of sources or AudioTrack object.\n      if (obj instanceof Array) {\n        this._create(obj);\n      } else if (obj instanceof AudioTrack) {\n        this._copy(obj);\n      } else {\n        throw new Error('sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance');\n      }\n    }\n    return _createClass(AudioTrack, [{\n      key: \"_create\",\n      value: function _create(sourceList) {\n        var dataUriRe = /^data:\\s*audio\\/(?:x-)?([^;,]+)\\s*[;,]/i;\n        var extRe = /\\.([^./\\\\]+)$/;\n        var formats = AudioTrack.formats;\n        var usedSources = [];\n        /*\n        \tHTMLAudioElement: DOM factory method vs. constructor\n        \t\tUse of the DOM factory method, `document.createElement('audio')`, should be\n        \tpreferred over use of the constructor, `new Audio()`.  The reason being that\n        \tobjects created by the latter are, erroneously, treated differently, often\n        \tunfavorably, by certain browser engines—e.g. within some versions of the iOS\n        \tbrowser core.\n        \t\tNotably, the only difference between the two, per the specification, is that\n        \tobjects created via the constructor should have their `preload` property\n        \tautomatically set to 'auto'.  Thus, there's no technical reason to prefer\n        \tusage of the constructor, even discounting buggy browser implementations.\n        */\n        var audio = document.createElement('audio');\n\n        // Initially set the `preload` attribute to `'none'`.\n        audio.preload = 'none';\n\n        // Process the array of sources, adding any valid sources to the `usedSources`\n        // array and to the audio element as source elements.\n        sourceList.forEach(function (src) {\n          var srcUri = null;\n          switch (_typeof(src)) {\n            case 'string':\n              {\n                var match;\n                if (src.slice(0, 5) === 'data:') {\n                  match = dataUriRe.exec(src);\n                  if (match === null) {\n                    throw new Error('source data URI missing media type');\n                  }\n                } else {\n                  match = extRe.exec(parseURL(src).pathname);\n                  if (match === null) {\n                    throw new Error('source URL missing file extension');\n                  }\n                }\n                if (formats[match[1]]) {\n                  srcUri = src;\n                }\n                break;\n              }\n            case 'object':\n              {\n                if (src === null) {\n                  throw new Error('source object cannot be null');\n                } else if (!Object.hasOwn(src, 'src')) {\n                  throw new Error('source object missing required \"src\" property');\n                } else if (!Object.hasOwn(src, 'format')) {\n                  throw new Error('source object missing required \"format\" property');\n                }\n                if (formats[src.format]) {\n                  srcUri = src.src;\n                }\n                break;\n              }\n            default:\n              throw new Error(\"invalid source value (type: \".concat(_typeof(src), \")\"));\n          }\n          if (srcUri !== null) {\n            var source = document.createElement('source');\n            source.src = srcUri;\n            audio.appendChild(source);\n            usedSources.push(srcUri);\n          }\n        });\n        if (audio.hasChildNodes()) {\n          // Set the `preload` attribute to `'metadata'`, unless preloading has been disabled.\n          if (Config.audio.preloadMetadata) {\n            audio.preload = 'metadata';\n          }\n        }\n        this._finalize(audio, usedSources, clone(sourceList));\n      }\n    }, {\n      key: \"_copy\",\n      value: function _copy(obj) {\n        this._finalize(obj.audio.cloneNode(true),\n        // deep clone of the audio element & its children\n        clone(obj.sources), clone(obj.originals));\n      }\n    }, {\n      key: \"_finalize\",\n      value: function _finalize(audio, sources, originals) {\n        var _this = this;\n        // Set up our own properties.\n        Object.defineProperties(this, {\n          audio: {\n            configurable: true,\n            value: audio\n          },\n          sources: {\n            value: Object.freeze(sources)\n          },\n          originals: {\n            value: Object.freeze(originals)\n          },\n          _error: {\n            writable: true,\n            value: false\n          },\n          _faderId: {\n            writable: true,\n            value: null\n          },\n          _mute: {\n            writable: true,\n            value: false\n          },\n          _rate: {\n            writable: true,\n            value: 1\n          },\n          _volume: {\n            writable: true,\n            value: 1\n          }\n        });\n\n        // Set up event handlers on the audio and source elements.\n        jQuery(this.audio)\n        /*\n        \tUpon receiving a `loadstart` event on the audio element, set `_error` to\n        \t`false`.\n        */.on('loadstart.AudioTrack', function () {\n          return _this._error = false;\n        })\n        /*\n        \tUpon receiving an `error` event on the audio element, set `_error` to\n        \t`true`.\n        \t\tCaveats by browser:\n        \t\tEdge violates the specification by triggering `error` events from source\n        \t\telements on their parent media element, rather than the source element.\n        \t\tTo enable error handling in all browsers, we set the error handler on the\n        \t\taudio element and have the final source element forward its `error` event.\n        \t\t\tIE does not trigger, at least some, `error` events from source elements at\n        \t\tall, not on the source element or its parent media element.  AFAIK, nothing\n        \t\tcan be done about this lossage.\n        */.on('error.AudioTrack', function () {\n          return _this._error = true;\n        })\n        /*\n        \tUpon receiving an `error` event on the final source element (if any), trigger\n        \tan `error` event on the audio element—that being necessary because the source\n        \t`error` event does not bubble.\n        */.find('source:last-of-type').on('error.AudioTrack', function () {\n          return _this._trigger('error');\n        });\n\n        // Subscribe to command messages.\n        subscribe(this, function (mesg) {\n          if (!_this.audio) {\n            unsubscribe(_this);\n            return;\n          }\n          switch (mesg) {\n            case 'loadwithscreen':\n              {\n                if (_this.hasSource()) {\n                  var lockId = LoadScreen.lock();\n                  _this.off('.AudioTrack_loadwithscreen').one('canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen',\n                  // NOTE: Do not use an arrow function here.\n                  function () {\n                    jQuery(this).off('.AudioTrack_loadwithscreen');\n                    LoadScreen.unlock(lockId);\n                  }).load();\n                }\n                break;\n              }\n            case 'load':\n              _this.load();\n              break;\n            case 'mute':\n              _this._updateAudioMute();\n              break;\n            case 'rate':\n              _this._updateAudioRate();\n              break;\n            case 'stop':\n              _this.stop();\n              break;\n            case 'volume':\n              _this._updateAudioVolume();\n              break;\n            case 'unload':\n              _this.unload();\n              break;\n          }\n        });\n\n        // Synchronize with the current master audio settings.\n        this._updateAudioMute();\n        this._updateAudioRate();\n        this._updateAudioVolume();\n      }\n    }, {\n      key: \"_trigger\",\n      value: function _trigger(eventName) {\n        // We do not want these events to bubble.\n        triggerEvent(eventName, this.audio, {\n          bubbles: false\n        });\n      }\n    }, {\n      key: \"_destroy\",\n      value: function _destroy() {\n        /*\n        \tStrictly speaking, self-destruction is not necessary as this object will,\n        \teventually, be garbage collected.  That said, since the audio element contains\n        \tdata buffers for the selected audio source, which may be quite large, manually\n        \tpurging them as soon as we know that they're no longer needed is not a bad idea.\n        */\n        unsubscribe(this);\n        if (!this.audio) {\n          return;\n        }\n        jQuery(this.audio).off();\n        this.unload();\n        this._error = true;\n\n        // Delete the audio element property.\n        delete this.audio;\n      }\n    }, {\n      key: \"clone\",\n      value: function clone() {\n        return new AudioTrack(this);\n      }\n    }, {\n      key: \"load\",\n      value: function load() {\n        var _this2 = this;\n        this.fadeStop();\n        this.audio.pause();\n        if (!this.audio.hasChildNodes()) {\n          if (this.sources.length === 0) {\n            return;\n          }\n          this.sources.forEach(function (srcUri) {\n            var source = document.createElement('source');\n            source.src = srcUri;\n            _this2.audio.appendChild(source);\n          });\n        }\n        if (this.audio.preload !== 'auto') {\n          this.audio.preload = 'auto';\n        }\n        if (!this.isLoading()) {\n          this.audio.load();\n        }\n      }\n    }, {\n      key: \"unload\",\n      value: function unload() {\n        this.fadeStop();\n        this.stop();\n        var audio = this.audio;\n        audio.preload = 'none';\n\n        // Remove all source elements.\n        while (audio.hasChildNodes()) {\n          audio.removeChild(audio.firstChild);\n        }\n\n        // Force the audio element to drop any existing data buffers.\n        audio.load();\n      }\n    }, {\n      key: \"play\",\n      value: function play() {\n        var _this3 = this;\n        if (!this.hasSource()) {\n          return Promise.reject(new Error('none of the candidate sources were acceptable'));\n        }\n        if (this.isUnloaded()) {\n          return Promise.reject(new Error('no sources are loaded'));\n        }\n        if (this.isFailed()) {\n          return Promise.reject(new Error('failed to load any of the sources'));\n        }\n        if (this.audio.preload !== 'auto') {\n          this.audio.preload = 'auto';\n        }\n        var namespace = '.AudioTrack_play';\n        return _playReturnsPromise() ? this.audio.play() : new Promise(function (resolve, reject) {\n          if (_this3.isPlaying()) {\n            resolve();\n          } else {\n            jQuery(_this3.audio).off(namespace).one(\"error\".concat(namespace, \" playing\").concat(namespace, \" timeupdate\").concat(namespace), function (ev) {\n              jQuery(_this3.audio).off(namespace);\n              if (ev.type === 'error') {\n                reject(new Error('unknown audio play error'));\n              } else {\n                resolve();\n              }\n            });\n            _this3.audio.play();\n          }\n        });\n      }\n    }, {\n      key: \"playWhenAllowed\",\n      value: function playWhenAllowed() {\n        var _this4 = this;\n        return this.play().catch(function (ex) {\n          // Bail out if the rejection is not `NotAllowedError`.\n          if (ex.name !== 'NotAllowedError') {\n            throw ex;\n          }\n\n          // Attempt to play the track upon user interaction.\n          onUserActivation('.AudioTrack_playWhenAllowed', function () {\n            return _this4.audio.play();\n          });\n        });\n      }\n    }, {\n      key: \"pause\",\n      value: function pause() {\n        this.audio.pause();\n      }\n    }, {\n      key: \"stop\",\n      value: function stop() {\n        this.audio.pause();\n        this.time(0);\n        this._trigger(':stopped');\n      }\n    }, {\n      key: \"fade\",\n      value: function fade(duration, toVol, fromVol) {\n        var _this5 = this;\n        if (typeof duration !== 'number') {\n          throw new TypeError('duration parameter must be a number');\n        }\n        if (typeof toVol !== 'number') {\n          throw new TypeError('toVolume parameter must be a number');\n        }\n        if (fromVol != null && typeof fromVol !== 'number') {\n          // lazy equality for null\n          throw new TypeError('fromVolume parameter must be a number');\n        }\n        if (!this.hasSource()) {\n          return Promise.reject(new Error('none of the candidate sources were acceptable'));\n        }\n        if (this.isUnloaded()) {\n          return Promise.reject(new Error('no sources are loaded'));\n        }\n        if (this.isFailed()) {\n          return Promise.reject(new Error('failed to load any of the sources'));\n        }\n        this.fadeStop();\n        var from = Math.clamp(fromVol == null ? this.volume() : fromVol, 0, 1); // lazy equality for null\n        var to = Math.clamp(toVol, 0, 1);\n        if (from === to) {\n          return;\n        }\n        this.volume(from);\n\n        /*\n        \tWe listen for the `timeupdate` event here, rather than `playing`, because\n        \tvarious browsers (notably, mobile browsers) are poor at firing media events\n        \tin a timely fashion, so we use `timeupdate` to ensure that we don't start\n        \tthe fade until the track is actually progressing.\n        */\n        jQuery(this.audio).off('timeupdate.AudioTrack_fade').one('timeupdate.AudioTrack_fade', function () {\n          var min;\n          var max;\n\n          // Fade in.\n          if (from < to) {\n            min = from;\n            max = to;\n          }\n          // Fade out.\n          else {\n            min = to;\n            max = from;\n          }\n          var time = Math.max(duration, 1);\n          var interval = 25; // in milliseconds\n          var delta = (to - from) / (time / (interval / 1000));\n          _this5._trigger(':fading');\n          _this5._faderId = setInterval(function () {\n            if (!_this5.isPlaying()) {\n              /*\n              \tWhile it may seem like a good idea to also set the track volume\n              \tto the `to` value here, we should not do so.  We cannot know why\n              \tthe track is no longer playing, nor if the volume has been modified\n              \tin the interim, so doing so now may clobber an end-user set volume.\n              */\n              _this5.fadeStop();\n              return;\n            }\n            _this5.volume(Math.clamp(_this5.volume() + delta, min, max));\n            if (Config.audio.pauseOnFadeToZero && _this5.volume() === 0) {\n              _this5.pause();\n            }\n            if (_this5.volume() === to) {\n              _this5.fadeStop();\n              _this5._trigger(':faded');\n            }\n          }, interval);\n        });\n        return this.play();\n      }\n    }, {\n      key: \"fadeIn\",\n      value: function fadeIn(duration, fromVol) {\n        return this.fade(duration, 1, fromVol);\n      }\n    }, {\n      key: \"fadeOut\",\n      value: function fadeOut(duration, fromVol) {\n        return this.fade(duration, 0, fromVol);\n      }\n    }, {\n      key: \"fadeStop\",\n      value: function fadeStop() {\n        if (this._faderId !== null) {\n          clearInterval(this._faderId);\n          this._faderId = null;\n        }\n      }\n    }, {\n      key: \"loop\",\n      value: function loop(_loop2) {\n        if (_loop2 == null) {\n          // lazy equality for null\n          return this.audio.loop;\n        }\n        this.audio.loop = !!_loop2;\n        return this;\n      }\n    }, {\n      key: \"mute\",\n      value: function mute(_mute) {\n        if (_mute == null) {\n          // lazy equality for null\n          return this._mute;\n        }\n        this._mute = !!_mute;\n        this._updateAudioMute();\n        return this;\n      }\n    }, {\n      key: \"_updateAudioMute\",\n      value: function _updateAudioMute() {\n        this.audio.muted = this._mute || _masterMute;\n      }\n    }, {\n      key: \"rate\",\n      value: function rate(_rate) {\n        if (_rate == null) {\n          // lazy equality for null\n          return this._rate;\n        }\n        if (typeof _rate !== 'number') {\n          throw new TypeError('rate parameter must be a number');\n        }\n\n        /*\n        \tClamp the playback rate to sane values—some browsers also do this to varying degrees.\n        \t\tNOTE (ca. Aug 2016): The specification allows negative values for reverse playback,\n        \thowever, most browsers either completely ignore negative values or clamp them to\n        \tsome positive value.  In some (notably, IE & Edge), setting a negative playback\n        \trate breaks the associated controls, if displayed.\n        */\n        /*\n        this._rate = rate < 0\n        \t? Math.clamp(rate, -0.2, -5) // clamp to 5× slower & faster, backward\n        \t: Math.clamp(rate, 0.2, 5);  // clamp to 5× slower & faster, forward\n        */\n        this._rate = Math.clamp(_rate, 0.2, 5); // clamp to 5× slower & faster\n        this._updateAudioRate();\n        return this;\n      }\n    }, {\n      key: \"_updateAudioRate\",\n      value: function _updateAudioRate() {\n        /*\n        const rate = this._rate * _masterRate;\n        this.audio.playbackRate = rate < 0\n        \t? Math.clamp(rate, -0.2, -5) // clamp to 5× slower & faster, backward\n        \t: Math.clamp(rate, 0.2, 5);  // clamp to 5× slower & faster, forward\n        */\n        this.audio.playbackRate = Math.clamp(this._rate * _masterRate, 0.2, 5); // clamp to 5× slower & faster\n      }\n    }, {\n      key: \"time\",\n      value: function time(_time) {\n        var _this6 = this;\n        if (_time == null) {\n          // lazy equality for null\n          return this.audio.currentTime;\n        }\n        if (typeof _time !== 'number') {\n          throw new TypeError('time parameter must be a number');\n        }\n\n        /*\n        \tNOTE (historic): If we try to modify the audio clip's `.currentTime` property\n        \tbefore its metadata has been loaded, it will throw an `InvalidStateError`\n        \t(since it doesn't know its duration, allowing `.currentTime` to be set would\n        \tbe undefined behavior), so in case an exception is thrown we provide a fallback\n        \tusing the `loadedmetadata` event.\n        \t\tNOTE (ca. 2016): This workaround should no longer be necessary in most browsers.\n        \tThat said, it will still be required for some time to service legacy browsers.\n        \t\tNOTE (ca. Dec 09, 2018): Firefox will still log an `InvalidStateError` to the\n        \tconsole when attempting to modify the clip's `.currentTime` property before its\n        \tmetadata has been loaded, even though it handles the situation properly—by waiting\n        \tfor the metadata, as all browsers do now.  To prevent this spurious logging, we\n        \tmust now manually check for the existence of the metadata and always failover to\n        \tan event regardless of if the browser needs it or not—because I don't want to\n        \tintroduce a browser check here.  Stay classy, Firefox.\n        */\n        if (this.hasMetadata()) {\n          this.audio.currentTime = _time;\n        } else {\n          jQuery(this.audio).off('loadedmetadata.AudioTrack_time').one('loadedmetadata.AudioTrack_time', function () {\n            return _this6.audio.currentTime = _time;\n          });\n        }\n        return this;\n      }\n    }, {\n      key: \"volume\",\n      value: function volume(_volume) {\n        if (_volume == null) {\n          // lazy equality for null\n          return this._volume;\n        }\n        if (typeof _volume !== 'number') {\n          throw new TypeError('volume parameter must be a number');\n        }\n        this._volume = Math.clamp(_volume, 0, 1); // clamp to 0 (silent) & 1 (full loudness)\n        this._updateAudioVolume();\n        return this;\n      }\n    }, {\n      key: \"_updateAudioVolume\",\n      value: function _updateAudioVolume() {\n        this.audio.volume = Math.clamp(this._volume * _masterVolume, 0, 1);\n      }\n    }, {\n      key: \"duration\",\n      value: function duration() {\n        // NOTE: May return a double (normally), Infinity (for streams), or NaN (without metadata).\n        return this.audio.duration;\n      }\n    }, {\n      key: \"remaining\",\n      value: function remaining() {\n        // NOTE: May return a double (normally), Infinity (for streams), or NaN (without metadata).\n        return this.audio.duration - this.audio.currentTime;\n      }\n    }, {\n      key: \"isFailed\",\n      value: function isFailed() {\n        return this._error;\n      }\n    }, {\n      key: \"isLoading\",\n      value: function isLoading() {\n        return this.audio.networkState === HTMLMediaElement.NETWORK_LOADING;\n      }\n    }, {\n      key: \"isUnloaded\",\n      value: function isUnloaded() {\n        return !this.audio.hasChildNodes();\n      }\n    }, {\n      key: \"isUnavailable\",\n      value: function isUnavailable() {\n        return !this.hasSource() || this.isUnloaded() || this.isFailed();\n      }\n    }, {\n      key: \"isPlaying\",\n      value: function isPlaying() {\n        // NOTE: The `this.hasSomeData()` check is probably no longer necessary.\n        return !this.audio.paused && this.hasSomeData();\n      }\n    }, {\n      key: \"isPaused\",\n      value: function isPaused() {\n        /*\n        \tIf the selected audio resource is a stream, `currentTime` may return a non-zero\n        \tvalue even at the earliest available position within the stream as the browser\n        \tmay have dropped the earliest chunks of buffered data or the stream may have a\n        \ttimeline which does not start at zero.\n        \t\tIn an attempt to guard against these possiblities, as best as we can, we test\n        \t`duration` against `Infinity` first, which should yield true for actual streams.\n        */\n        return this.audio.paused && (this.audio.duration === Infinity || this.audio.currentTime > 0) && !this.audio.ended;\n      }\n    }, {\n      key: \"isStopped\",\n      value: function isStopped() {\n        return this.audio.paused && this.audio.currentTime === 0;\n      }\n    }, {\n      key: \"isEnded\",\n      value: function isEnded() {\n        return this.audio.ended;\n      }\n    }, {\n      key: \"isFading\",\n      value: function isFading() {\n        return this._faderId !== null;\n      }\n    }, {\n      key: \"isSeeking\",\n      value: function isSeeking() {\n        return this.audio.seeking;\n      }\n    }, {\n      key: \"hasSource\",\n      value: function hasSource() {\n        return this.sources.length > 0;\n      }\n    }, {\n      key: \"hasNoData\",\n      value: function hasNoData() {\n        return this.audio.readyState === HTMLMediaElement.HAVE_NOTHING;\n      }\n    }, {\n      key: \"hasMetadata\",\n      value: function hasMetadata() {\n        return this.audio.readyState >= HTMLMediaElement.HAVE_METADATA;\n      }\n    }, {\n      key: \"hasSomeData\",\n      value: function hasSomeData() {\n        return this.audio.readyState >= HTMLMediaElement.HAVE_CURRENT_DATA;\n      }\n    }, {\n      key: \"hasData\",\n      value: function hasData() {\n        return this.audio.readyState === HTMLMediaElement.HAVE_ENOUGH_DATA;\n      }\n    }, {\n      key: \"on\",\n      value: function on() {\n        for (var _len5 = arguments.length, args = new Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n          args[_key5] = arguments[_key5];\n        }\n        jQuery.fn.on.apply(jQuery(this.audio), args);\n        return this;\n      }\n    }, {\n      key: \"one\",\n      value: function one() {\n        for (var _len6 = arguments.length, args = new Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n          args[_key6] = arguments[_key6];\n        }\n        jQuery.fn.one.apply(jQuery(this.audio), args);\n        return this;\n      }\n    }, {\n      key: \"off\",\n      value: function off() {\n        for (var _len7 = arguments.length, args = new Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n          args[_key7] = arguments[_key7];\n        }\n        jQuery.fn.off.apply(jQuery(this.audio), args);\n        return this;\n      }\n    }]);\n  }(); // Attach the static data members.\n  Object.defineProperties(AudioTrack, {\n    /*\n    \tCache of supported (common) audio formats.\n    \t\tNOTE: Caveats by browser/engine:\n    \t\tOpera ≤12 (Presto) will return a false-negative if the codecs value is quoted\n    \t\twith single quotes, requiring the use of either double quotes or no quotes.\n    \t\t\tSome versions of Blink-based browsers (e.g. Chrome, Opera ≥15) will return a\n    \t\tfalse-negative for WAVE audio if the preferred MIME-type of 'audio/wave' is\n    \t\tspecified, requiring the addition of 'audio/wav' for them.\n    */\n    formats: {\n      value: function () {\n        var audio = document.createElement('audio');\n        var types = new Map();\n        function canPlay(mimeType) {\n          if (!types.has(mimeType)) {\n            // Some early implementations return 'no' instead of the empty string.\n            types.set(mimeType, audio.canPlayType(mimeType).replace(/^no$/i, '') !== '');\n          }\n          return types.get(mimeType);\n        }\n        return Object.assign(Object.create(null), {\n          // AAC — MPEG-2 AAC audio; specific profiles vary, but commonly \"AAC-LC\".\n          aac: canPlay('audio/aac'),\n          // CAF — Codecs vary.\n          caf: canPlay('audio/x-caf') || canPlay('audio/caf'),\n          // FLAC.\n          flac: canPlay('audio/x-flac') || canPlay('audio/flac'),\n          // MP3 — MPEG-1/-2 Layer-III audio.\n          mp3: canPlay('audio/mpeg; codecs=\"mp3\"') || canPlay('audio/mpeg') || canPlay('audio/mp3') || canPlay('audio/mpa'),\n          mpeg: canPlay('audio/mpeg'),\n          // MP4 — Codecs vary, but commonly \"mp4a.40.2\" (a.k.a. \"AAC-LC\").\n          m4a: canPlay('audio/x-m4a') || canPlay('audio/m4a') || canPlay('audio/aac'),\n          mp4: canPlay('audio/x-mp4') || canPlay('audio/mp4') || canPlay('audio/aac'),\n          // OGG — Codecs vary, but commonly \"vorbis\" and, more recently, \"opus\".\n          ogg: canPlay('audio/ogg'),\n          oga: canPlay('audio/ogg'),\n          // OPUS — Opus audio in an Ogg container.\n          opus: canPlay('audio/ogg; codecs=\"opus\"') || canPlay('audio/opus'),\n          // WAVE — Codecs vary, but commonly \"1\" (1 is the FourCC for PCM/LPCM).\n          wav: canPlay('audio/wave; codecs=\"1\"') || canPlay('audio/wav; codecs=\"1\"') || canPlay('audio/wave') || canPlay('audio/wav'),\n          wave: canPlay('audio/wave; codecs=\"1\"') || canPlay('audio/wav; codecs=\"1\"') || canPlay('audio/wave') || canPlay('audio/wav'),\n          // WEBM — Codecs vary, but commonly \"vorbis\" and, more recently, \"opus\".\n          weba: canPlay('audio/webm'),\n          webm: canPlay('audio/webm')\n        });\n      }()\n    }\n  });\n\n  /*******************************************************************************\n  \tAudioList Class.\n  *******************************************************************************/\n  var AudioList = /*#__PURE__*/function () {\n    function AudioList(obj) {\n      _classCallCheck(this, AudioList);\n      // Process the given array of track objects or AudioList object.\n      if (obj instanceof Array) {\n        this._create(obj);\n      } else if (obj instanceof AudioList) {\n        this._copy(obj);\n        // this._create(obj.tracks);\n      } else {\n        throw new Error('tracks parameter must be either an array, of track objects, or an AudioTrack instance');\n      }\n    }\n    return _createClass(AudioList, [{\n      key: \"_create\",\n      value: function _create(trackList) {\n        var _this7 = this;\n        // Map the array of tracks to playlist track objects.\n        this._finalize(trackList.map(function (trackObj) {\n          if (_typeof(trackObj) !== 'object') {\n            // lazy equality for null\n            throw new Error('tracks parameter array members must be objects');\n          }\n          var own;\n          var rate;\n          var track;\n          var volume;\n          if (trackObj instanceof AudioTrack) {\n            own = true;\n            rate = trackObj.rate();\n            track = trackObj.clone();\n            volume = trackObj.volume();\n          } else {\n            if (!Object.hasOwn(trackObj, 'track')) {\n              throw new Error('track object missing required \"track\" property');\n            } else if (!(trackObj.track instanceof AudioTrack)) {\n              throw new Error('track object\\'s \"track\" property must be an AudioTrack object');\n            }\n            // else if (!Object.hasOwn(trackObj, 'volume')) {\n            // \tthrow new Error('track object missing required \"volume\" property');\n            // }\n\n            own = Object.hasOwn(trackObj, 'own') && trackObj.own;\n            rate = Object.hasOwn(trackObj, 'rate') ? trackObj.rate : trackObj.track.rate();\n            track = trackObj.track;\n            volume = Object.hasOwn(trackObj, 'volume') ? trackObj.volume : trackObj.track.volume();\n          }\n          track.stop();\n          track.loop(false);\n          track.mute(false);\n          track.rate(rate);\n          track.volume(volume);\n          track.on('ended.AudioList', function () {\n            return _this7._onEnd();\n          });\n          return {\n            own: own,\n            track: track,\n            volume: volume,\n            rate: rate\n          };\n        }));\n      }\n    }, {\n      key: \"_copy\",\n      value: function _copy(obj) {\n        this._finalize(clone(obj.tracks));\n      }\n    }, {\n      key: \"_finalize\",\n      value: function _finalize(tracks) {\n        // Set up our own properties.\n        Object.defineProperties(this, {\n          tracks: {\n            configurable: true,\n            value: Object.freeze(tracks)\n          },\n          queue: {\n            configurable: true,\n            value: []\n          },\n          current: {\n            writable: true,\n            value: null\n          },\n          _rate: {\n            writable: true,\n            value: 1\n          },\n          _volume: {\n            writable: true,\n            value: 1\n          },\n          _mute: {\n            writable: true,\n            value: false\n          },\n          _loop: {\n            writable: true,\n            value: false\n          },\n          _shuffle: {\n            writable: true,\n            value: false\n          }\n        });\n      }\n    }, {\n      key: \"_destroy\",\n      value: function _destroy() {\n        /*\n        \tStrictly speaking, self-destruction is not necessary as this object will,\n        \teventually, be garbage collected.\n        */\n        // Stop playback.\n        this.stop();\n\n        // Destroy all owned tracks.\n        this.tracks.filter(function (trackObj) {\n          return trackObj.own;\n        }).forEach(function (trackObj) {\n          return trackObj.track._destroy();\n        });\n\n        // Delete the reference-type properties.\n        delete this.tracks;\n        delete this.queue;\n      }\n    }, {\n      key: \"load\",\n      value: function load() {\n        this.tracks.forEach(function (trackObj) {\n          return trackObj.track.load();\n        });\n      }\n    }, {\n      key: \"unload\",\n      value: function unload() {\n        this.stop();\n        this.tracks.forEach(function (trackObj) {\n          return trackObj.track.unload();\n        });\n      }\n    }, {\n      key: \"play\",\n      value: function play() {\n        if (this.current === null || this.current.track.isUnavailable() || this.current.track.isEnded()) {\n          if (this.queue.length === 0) {\n            this._fillQueue();\n          }\n          if (!this._next()) {\n            return Promise.reject(new Error('no tracks were available'));\n          }\n        }\n        return this.current.track.play();\n      }\n    }, {\n      key: \"playWhenAllowed\",\n      value: function playWhenAllowed() {\n        var _this8 = this;\n        return this.play().catch(function (ex) {\n          // Bail out if the rejection is not `NotAllowedError`.\n          if (ex.name !== 'NotAllowedError') {\n            throw ex;\n          }\n\n          // Attempt to play the track upon user interaction.\n          onUserActivation('.AudioList_playWhenAllowed', function () {\n            return _this8.play();\n          });\n        });\n      }\n    }, {\n      key: \"pause\",\n      value: function pause() {\n        if (this.current !== null) {\n          this.current.track.pause();\n        }\n      }\n    }, {\n      key: \"stop\",\n      value: function stop() {\n        if (this.current !== null) {\n          this.current.track.stop();\n          this.current = null;\n        }\n        this._drainQueue();\n      }\n    }, {\n      key: \"skip\",\n      value: function skip() {\n        if (this._next()) {\n          this.current.track.play();\n        } else if (this._loop) {\n          this.play();\n        }\n      }\n    }, {\n      key: \"fade\",\n      value: function fade(duration, toVol, fromVol) {\n        if (typeof duration !== 'number') {\n          throw new TypeError('duration parameter must be a number');\n        }\n        if (typeof toVol !== 'number') {\n          throw new TypeError('toVolume parameter must be a number');\n        }\n        if (fromVol != null && typeof fromVol !== 'number') {\n          // lazy equality for null\n          throw new TypeError('fromVolume parameter must be a number');\n        }\n        if (this.queue.length === 0) {\n          this._fillQueue();\n        }\n        if (this.current === null || this.current.track.isUnavailable() || this.current.track.isEnded()) {\n          if (!this._next()) {\n            return;\n          }\n        }\n        var adjToVol = Math.clamp(toVol, 0, 1) * this.current.volume;\n        var adjFromVol;\n        if (fromVol != null) {\n          // lazy equality for null\n          adjFromVol = Math.clamp(fromVol, 0, 1) * this.current.volume;\n        }\n        this._volume = toVol; // NOTE: Kludgey, but necessary.\n\n        return this.current.track.fade(duration, adjToVol, adjFromVol);\n      }\n    }, {\n      key: \"fadeIn\",\n      value: function fadeIn(duration, fromVol) {\n        return this.fade(duration, 1, fromVol);\n      }\n    }, {\n      key: \"fadeOut\",\n      value: function fadeOut(duration, fromVol) {\n        return this.fade(duration, 0, fromVol);\n      }\n    }, {\n      key: \"fadeStop\",\n      value: function fadeStop() {\n        if (this.current !== null) {\n          this.current.track.fadeStop();\n        }\n      }\n    }, {\n      key: \"loop\",\n      value: function loop(_loop3) {\n        if (_loop3 == null) {\n          // lazy equality for null\n          return this._loop;\n        }\n        this._loop = !!_loop3;\n        return this;\n      }\n    }, {\n      key: \"mute\",\n      value: function mute(_mute2) {\n        if (_mute2 == null) {\n          // lazy equality for null\n          return this._mute;\n        }\n        this._mute = !!_mute2;\n        if (this.current !== null) {\n          this.current.track.mute(this._mute);\n        }\n        return this;\n      }\n    }, {\n      key: \"rate\",\n      value: function rate(_rate2) {\n        if (_rate2 == null) {\n          // lazy equality for null\n          return this._rate;\n        }\n        if (typeof _rate2 !== 'number') {\n          throw new TypeError('rate parameter must be a number');\n        }\n        this._rate = Math.clamp(_rate2, 0.2, 5); // clamp to 5× slower & faster\n\n        if (this.current !== null) {\n          this.current.track.rate(this._rate * this.current.rate);\n        }\n        return this;\n      }\n    }, {\n      key: \"shuffle\",\n      value: function shuffle(_shuffle) {\n        var _this9 = this;\n        if (_shuffle == null) {\n          // lazy equality for null\n          return this._shuffle;\n        }\n        this._shuffle = !!_shuffle;\n        if (this.queue.length > 0) {\n          this._fillQueue();\n\n          // Try not to immediately replay the last track when not shuffling.\n          if (!this._shuffle && this.current !== null && this.queue.length > 1) {\n            var firstIndex = this.queue.findIndex(function (trackObj) {\n              return trackObj === _this9.current;\n            });\n            if (firstIndex !== -1) {\n              var _this$queue;\n              (_this$queue = this.queue).push.apply(_this$queue, _toConsumableArray(this.queue.splice(0, firstIndex + 1)));\n            }\n          }\n        }\n        return this;\n      }\n    }, {\n      key: \"volume\",\n      value: function volume(_volume2) {\n        if (_volume2 == null) {\n          // lazy equality for null\n          return this._volume;\n        }\n        if (typeof _volume2 !== 'number') {\n          throw new TypeError('volume parameter must be a number');\n        }\n        this._volume = Math.clamp(_volume2, 0, 1); // clamp to 0 (silent) & 1 (full loudness)\n\n        if (this.current !== null) {\n          this.current.track.volume(this._volume * this.current.volume);\n        }\n        return this;\n      }\n    }, {\n      key: \"duration\",\n      value: function duration() {\n        if (arguments.length > 0) {\n          throw new Error('duration takes no parameters');\n        }\n\n        // NOTE: May return a double (normally), Infinity (for streams), or NaN (without metadata).\n        return this.tracks.map(function (trackObj) {\n          return trackObj.track.duration();\n        }).reduce(function (prev, cur) {\n          return prev + cur;\n        }, 0);\n      }\n    }, {\n      key: \"remaining\",\n      value: function remaining() {\n        if (arguments.length > 0) {\n          throw new Error('remaining takes no parameters');\n        }\n\n        // NOTE: May return a double (normally), Infinity (for streams), or NaN (without metadata).\n        var remainingTime = this.queue.map(function (trackObj) {\n          return trackObj.track.duration();\n        }).reduce(function (prev, cur) {\n          return prev + cur;\n        }, 0);\n        if (this.current !== null) {\n          remainingTime += this.current.track.remaining();\n        }\n        return remainingTime;\n      }\n    }, {\n      key: \"time\",\n      value: function time() {\n        if (arguments.length > 0) {\n          throw new Error('time takes no parameters');\n        }\n        return this.duration() - this.remaining();\n      }\n    }, {\n      key: \"isPlaying\",\n      value: function isPlaying() {\n        return this.current !== null && this.current.track.isPlaying();\n      }\n    }, {\n      key: \"isPaused\",\n      value: function isPaused() {\n        return this.current === null || this.current.track.isPaused();\n      }\n    }, {\n      key: \"isStopped\",\n      value: function isStopped() {\n        return this.queue.length === 0 && this.current === null;\n      }\n    }, {\n      key: \"isEnded\",\n      value: function isEnded() {\n        return this.queue.length === 0 && (this.current === null || this.current.track.isEnded());\n      }\n    }, {\n      key: \"isFading\",\n      value: function isFading() {\n        return this.current !== null && this.current.track.isFading();\n      }\n    }, {\n      key: \"_next\",\n      value: function _next() {\n        if (this.current !== null) {\n          this.current.track.stop();\n          this.current = null;\n        }\n        var nextTrack;\n        while (nextTrack = this.queue.shift()) {\n          if (!nextTrack.track.isUnavailable()) {\n            this.current = nextTrack;\n            break;\n          }\n        }\n        if (this.current === null) {\n          return false;\n        }\n        this.current.track.mute(this._mute);\n        this.current.track.rate(this._rate * this.current.rate);\n        this.current.track.volume(this._volume * this.current.volume);\n\n        // Attempt to protect against the `loop` state being reenabled\n        // outside of the playlist.  Mostly for unowned tracks.\n        //\n        // TODO: Should we reapply the `ended` event handler too?\n        this.current.track.loop(false);\n        return true;\n      }\n    }, {\n      key: \"_onEnd\",\n      value: function _onEnd() {\n        if (this.queue.length === 0) {\n          if (!this._loop) {\n            return;\n          }\n          this._fillQueue();\n        }\n        if (!this._next()) {\n          return;\n        }\n        this.current.track.play();\n      }\n    }, {\n      key: \"_drainQueue\",\n      value: function _drainQueue() {\n        this.queue.splice(0);\n      }\n    }, {\n      key: \"_fillQueue\",\n      value: function _fillQueue() {\n        var _this$queue2;\n        this._drainQueue();\n        (_this$queue2 = this.queue).push.apply(_this$queue2, _toConsumableArray(this.tracks.filter(function (trackObj) {\n          return !trackObj.track.isUnavailable();\n        })));\n        if (this.queue.length === 0) {\n          return;\n        }\n        if (this._shuffle) {\n          this.queue.shuffle();\n\n          // Try not to immediately replay the last track when shuffling.\n          if (this.queue.length > 1 && this.queue[0] === this.current) {\n            this.queue.push(this.queue.shift());\n          }\n        }\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tAudioRunner Class.\n  *******************************************************************************/\n  var AudioRunner = /*#__PURE__*/function () {\n    function AudioRunner(list) {\n      _classCallCheck(this, AudioRunner);\n      if (!(list instanceof Set || list instanceof AudioRunner)) {\n        throw new TypeError('list parameter must be a Set or a AudioRunner instance');\n      }\n\n      // Set up our own properties.\n      Object.defineProperties(this, {\n        trackIds: {\n          value: new Set(list instanceof AudioRunner ? list.trackIds : list)\n        }\n      });\n    }\n    return _createClass(AudioRunner, [{\n      key: \"load\",\n      value: function load() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.load);\n      }\n    }, {\n      key: \"unload\",\n      value: function unload() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.unload);\n      }\n    }, {\n      key: \"play\",\n      value: function play() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.play);\n      }\n    }, {\n      key: \"playWhenAllowed\",\n      value: function playWhenAllowed() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.playWhenAllowed);\n      }\n    }, {\n      key: \"pause\",\n      value: function pause() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.pause);\n      }\n    }, {\n      key: \"stop\",\n      value: function stop() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.stop);\n      }\n    }, {\n      key: \"fade\",\n      value: function fade(duration, toVol, fromVol) {\n        if (duration == null || toVol == null) {\n          // lazy equality for null\n          throw new Error('fade requires parameters');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.fade, duration, toVol, fromVol);\n      }\n    }, {\n      key: \"fadeIn\",\n      value: function fadeIn(duration, fromVol) {\n        if (duration == null) {\n          // lazy equality for null\n          throw new Error('fadeIn requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.fadeIn, duration, fromVol);\n      }\n    }, {\n      key: \"fadeOut\",\n      value: function fadeOut(duration, fromVol) {\n        if (duration == null) {\n          // lazy equality for null\n          throw new Error('fadeOut requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.fadeOut, duration, fromVol);\n      }\n    }, {\n      key: \"fadeStop\",\n      value: function fadeStop() {\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.fadeStop);\n      }\n    }, {\n      key: \"loop\",\n      value: function loop(_loop4) {\n        if (_loop4 == null) {\n          // lazy equality for null\n          throw new Error('loop requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.loop, _loop4);\n        return this;\n      }\n    }, {\n      key: \"mute\",\n      value: function mute(_mute3) {\n        if (_mute3 == null) {\n          // lazy equality for null\n          throw new Error('mute requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.mute, _mute3);\n        return this;\n      }\n    }, {\n      key: \"rate\",\n      value: function rate(_rate3) {\n        if (_rate3 == null) {\n          // lazy equality for null\n          throw new Error('rate requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.rate, _rate3);\n        return this;\n      }\n    }, {\n      key: \"time\",\n      value: function time(_time2) {\n        if (_time2 == null) {\n          // lazy equality for null\n          throw new Error('time requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.time, _time2);\n        return this;\n      }\n    }, {\n      key: \"volume\",\n      value: function volume(_volume3) {\n        if (_volume3 == null) {\n          // lazy equality for null\n          throw new Error('volume requires a parameter');\n        }\n        AudioRunner._run(this.trackIds, AudioTrack.prototype.volume, _volume3);\n        return this;\n      }\n    }, {\n      key: \"on\",\n      value: function on() {\n        for (var _len8 = arguments.length, args = new Array(_len8), _key8 = 0; _key8 < _len8; _key8++) {\n          args[_key8] = arguments[_key8];\n        }\n        AudioRunner._run.apply(AudioRunner, [this.trackIds, AudioTrack.prototype.on].concat(args));\n        return this;\n      }\n    }, {\n      key: \"one\",\n      value: function one() {\n        for (var _len9 = arguments.length, args = new Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n          args[_key9] = arguments[_key9];\n        }\n        AudioRunner._run.apply(AudioRunner, [this.trackIds, AudioTrack.prototype.one].concat(args));\n        return this;\n      }\n    }, {\n      key: \"off\",\n      value: function off() {\n        for (var _len10 = arguments.length, args = new Array(_len10), _key10 = 0; _key10 < _len10; _key10++) {\n          args[_key10] = arguments[_key10];\n        }\n        AudioRunner._run.apply(AudioRunner, [this.trackIds, AudioTrack.prototype.off].concat(args));\n        return this;\n      }\n    }], [{\n      key: \"_run\",\n      value: function _run(ids, fn) {\n        for (var _len11 = arguments.length, args = new Array(_len11 > 2 ? _len11 - 2 : 0), _key11 = 2; _key11 < _len11; _key11++) {\n          args[_key11 - 2] = arguments[_key11];\n        }\n        ids.forEach(function (id) {\n          var track = _tracks.get(id);\n          if (track) {\n            fn.apply(track, args);\n          }\n        });\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tTrack Functions.\n  *******************************************************************************/\n  /*\n  \tSimpleAudio.tracks.add(trackId, sources…);\n  \t\tE.g.\n  \t\tSimpleAudio.tracks.add(\n  \t\t\t'over_the_top',\n  \t\t\t'https://audiohost.tld/id/over_the_top.mp3',\n  \t\t\t'https://audiohost.tld/id/over_the_top.ogg'\n  \t\t);\n  */\n  function trackAdd( /* trackId , sources… */\n  ) {\n    if (arguments.length < 2) {\n      var errors = [];\n      if (arguments.length < 1) {\n        errors.push('track ID');\n      }\n      if (arguments.length < 2) {\n        errors.push('sources');\n      }\n      throw new Error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n    var id = String(arguments[0]).trim();\n    var what = \"track ID \\\"\".concat(id, \"\\\"\");\n    if (_badIdRe.test(id)) {\n      throw new Error(\"invalid \".concat(what, \": track IDs must not contain colons or whitespace\"));\n    }\n    var sources = Array.isArray(arguments[1]) ? Array.from(arguments[1]) : Array.from(arguments).slice(1);\n    var track;\n    try {\n      track = _newTrack(sources);\n    } catch (ex) {\n      throw new Error(\"\".concat(what, \": error during track initialization: \").concat(ex.message));\n    }\n\n    // If in Test Mode and no supported sources were specified, throw an error.\n    if (Config.debug && !track.hasSource()) {\n      throw new Error(\"\".concat(what, \": no supported audio sources found\"));\n    }\n\n    // If a track by the given ID already exists, destroy it.\n    if (_tracks.has(id)) {\n      _tracks.get(id)._destroy();\n    }\n\n    // Add the track to the cache.\n    _tracks.set(id, track);\n  }\n  function trackDelete(id) {\n    if (_tracks.has(id)) {\n      _tracks.get(id)._destroy();\n    }\n\n    // TODO: Should this also remove references to the track from groups and playlists?\n\n    return _tracks.delete(id);\n  }\n  function trackClear() {\n    _tracks.forEach(function (track) {\n      return track._destroy();\n    });\n    _tracks.clear();\n  }\n  function trackHas(id) {\n    return _tracks.has(id);\n  }\n  function trackGet(id) {\n    return _tracks.get(id) || null;\n  }\n\n  /*******************************************************************************\n  \tGroup Functions.\n  *******************************************************************************/\n\n  /*\n  \tSimpleAudio.groups.add(groupId, trackIds…);\n  \t\tE.g.\n  \t\tSimpleAudio.groups.add(':ui', 'beep', 'boop', 'boing');\n  */\n  function groupAdd( /* groupId , trackIds… */\n  ) {\n    if (arguments.length < 2) {\n      var errors = [];\n      if (arguments.length < 1) {\n        errors.push('group ID');\n      }\n      if (arguments.length < 2) {\n        errors.push('track IDs');\n      }\n      throw new Error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n    var id = String(arguments[0]).trim();\n    var what = \"group ID \\\"\".concat(id, \"\\\"\");\n    if (!id.startsWith(':') || _badIdRe.test(id.slice(1))) {\n      throw new Error(\"invalid \".concat(what, \": group IDs must start with a colon and must not contain colons or whitespace\"));\n    }\n    if (_specialIds.includes(id)) {\n      throw new Error(\"cannot clobber special \".concat(what));\n    }\n    var trackIds = Array.isArray(arguments[1]) ? Array.from(arguments[1]) : Array.from(arguments).slice(1);\n    var group;\n    try {\n      group = new Set(trackIds.map(function (trackId) {\n        if (!_tracks.has(trackId)) {\n          throw new Error(\"track \\\"\".concat(trackId, \"\\\" does not exist\"));\n        }\n        return trackId;\n      }));\n    } catch (ex) {\n      throw new Error(\"\".concat(what, \": error during group initialization: \").concat(ex.message));\n    }\n\n    // Add the group to the cache.\n    _groups.set(id, Object.freeze(Array.from(group)));\n  }\n  function groupDelete(id) {\n    return _groups.delete(id);\n  }\n  function groupClear() {\n    _groups.clear();\n  }\n  function groupHas(id) {\n    return _groups.has(id);\n  }\n  function groupGet(id) {\n    return _groups.get(id) || null;\n  }\n\n  /*******************************************************************************\n  \tPlaylist Functions.\n  *******************************************************************************/\n\n  /*\n  \tSimpleAudio.lists.add(listId, sources…);\n  \t\tWhere `sources` may be either a track ID or descriptor (object).\n  \t\tTrack descriptors are either { id, [own], [rate], [volume] } or { sources, [rate], [volume] }.\n  \t\tNOTE: Rate properties are currently unsupported due to poor browser support.\n  \t\tE.g.\n  \t\tSimpleAudio.lists.add(\n  \t\t\t'bgm',\n  \t\t\t'over_the_top',\n  \t\t\t{\n  \t\t\t\tid     : 'heavens_a_lie',\n  \t\t\t\tvolume : 0.5,\n  \t\t\t\town    : true\n  \t\t\t},\n  \t\t\t{\n  \t\t\t\tsources : [\n  \t\t\t\t\t'https://audiohost.tld/id/swamped.mp3',\n  \t\t\t\t\t'https://audiohost.tld/id/swamped.ogg'\n  \t\t\t\t],\n  \t\t\t\tvolume  : 0.75\n  \t\t\t}\n  \t\t);\n  */\n  function listAdd( /* listId , sources… */\n  ) {\n    if (arguments.length < 2) {\n      var errors = [];\n      if (arguments.length < 1) {\n        errors.push('list ID');\n      }\n      if (arguments.length < 2) {\n        errors.push('track IDs');\n      }\n      throw new Error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n    var id = String(arguments[0]).trim();\n    var what = \"list ID \\\"\".concat(id, \"\\\"\");\n    if (_badIdRe.test(id)) {\n      return this.error(\"invalid \".concat(what, \": list IDs must not contain colons or whitespace\"));\n    }\n    var descriptors = Array.isArray(arguments[1]) ? Array.from(arguments[1]) : Array.from(arguments).slice(1);\n    var list;\n    try {\n      list = new AudioList(descriptors.map(function (desc) {\n        if (desc === null) {\n          throw new Error('track descriptor must be a string or object (type: null)');\n        }\n        switch (_typeof(desc)) {\n          case 'string':\n            // Simply a track ID, so convert it into an object.\n            desc = {\n              id: desc\n            }; // eslint-disable-line no-param-reassign\n            break;\n          case 'object':\n            if (!Object.hasOwn(desc, 'id') && !Object.hasOwn(desc, 'sources')) {\n              throw new Error('track descriptor must contain one of either an \"id\" or a \"sources\" property');\n            } else if (Object.hasOwn(desc, 'id') && Object.hasOwn(desc, 'sources')) {\n              throw new Error('track descriptor must contain either an \"id\" or a \"sources\" property, not both');\n            }\n            break;\n          default:\n            throw new Error(\"track descriptor must be a string or object (type: \".concat(_typeof(desc), \")\"));\n        }\n        var own;\n        // let rate;\n        var track;\n        var volume;\n        if (Object.hasOwn(desc, 'id')) {\n          if (typeof desc.id !== 'string') {\n            throw new Error('\"id\" property must be a string');\n          }\n          if (!_tracks.has(desc.id)) {\n            throw new Error(\"track \\\"\".concat(desc.id, \"\\\" does not exist\"));\n          }\n          track = _tracks.get(desc.id);\n        } else if (Object.hasOwn(desc, 'sources')) {\n          if (!Array.isArray(desc.sources) || desc.sources.length === 0) {\n            throw new Error('\"sources\" property must be a non-empty array');\n          }\n          if (Object.hasOwn(desc, 'own')) {\n            throw new Error('\"own\" property is not allowed with the \"sources\" property');\n          }\n          try {\n            track = _newTrack(desc.sources);\n            own = true;\n          } catch (ex) {\n            throw new Error(\"error during track initialization: \".concat(ex.message));\n          }\n\n          // If in Test Mode and no supported sources were specified, return an error.\n          if (Config.debug && !track.hasSource()) {\n            throw new Error('no supported audio sources found');\n          }\n        }\n        if (Object.hasOwn(desc, 'own')) {\n          if (typeof desc.own !== 'boolean') {\n            throw new Error('\"own\" property must be a boolean');\n          }\n          own = desc.own;\n          if (own) {\n            track = track.clone();\n          }\n        }\n\n        // if (Object.hasOwn(desc, 'rate')) {\n        // \tif (\n        // \t\ttypeof desc.rate !== 'number'\n        // \t\t|| Number.isNaN(desc.rate)\n        // \t\t|| !Number.isFinite(desc.rate)\n        // \t) {\n        // \t\tthrow new Error('\"rate\" property must be a finite number');\n        // \t}\n        //\n        // \trate = desc.rate;\n        // }\n\n        if (Object.hasOwn(desc, 'volume')) {\n          if (typeof desc.volume !== 'number' || Number.isNaN(desc.volume) || !Number.isFinite(desc.volume) || desc.volume < 0) {\n            throw new Error('\"volume\" property must be a non-negative finite number');\n          }\n          volume = desc.volume;\n        }\n        return {\n          own: own != null ? own : false,\n          // lazy equality for null,\n          // rate   : rate != null ? rate : track.rate(), // lazy equality for null,\n          track: track,\n          volume: volume != null ? volume : track.volume() // lazy equality for null\n        };\n      }));\n    } catch (ex) {\n      throw new Error(\"\".concat(what, \": error during playlist initialization: \").concat(ex.message));\n    }\n\n    // If a playlist by the given ID already exists, destroy it.\n    if (_lists.has(id)) {\n      _lists.get(id)._destroy();\n    }\n\n    // Add the playlist to the cache.\n    _lists.set(id, list);\n  }\n  function listDelete(id) {\n    if (_lists.has(id)) {\n      _lists.get(id)._destroy();\n    }\n    return _lists.delete(id);\n  }\n  function listClear() {\n    _lists.forEach(function (list) {\n      return list._destroy();\n    });\n    _lists.clear();\n  }\n  function listHas(id) {\n    return _lists.has(id);\n  }\n  function listGet(id) {\n    return _lists.get(id) || null;\n  }\n\n  /*******************************************************************************\n  \tRunner Functions.\n  *******************************************************************************/\n\n  var _runnerParseSelector = function () {\n    var notWsRe = /\\S/g;\n    var parenRe = /[()]/g;\n    function processNegation(str, startPos) {\n      var match;\n      notWsRe.lastIndex = startPos;\n      match = notWsRe.exec(str);\n      if (match === null || match[0] !== '(') {\n        throw new Error('invalid \":not()\" syntax: missing parenthesis');\n      }\n      parenRe.lastIndex = notWsRe.lastIndex;\n      var start = notWsRe.lastIndex;\n      var result = {\n        str: '',\n        nextMatch: -1\n      };\n      var depth = 1;\n      while ((match = parenRe.exec(str)) !== null) {\n        if (match[0] === '(') {\n          ++depth;\n        } else {\n          --depth;\n        }\n        if (depth < 1) {\n          result.nextMatch = parenRe.lastIndex;\n          result.str = str.slice(start, result.nextMatch - 1);\n          break;\n        }\n      }\n      return result;\n    }\n    function parseSelector(idArg) {\n      var ids = [];\n      var idRe = /:?[^\\s:()]+/g;\n      var match;\n      while ((match = idRe.exec(idArg)) !== null) {\n        var id = match[0];\n\n        // Group negation.\n        if (id === ':not') {\n          if (ids.length === 0) {\n            throw new Error('invalid negation: no group ID preceded \":not()\"');\n          }\n          var parent = ids[ids.length - 1];\n          if (!parent.id.startsWith(':')) {\n            throw new Error(\"invalid negation of track \\\"\".concat(parent.id, \"\\\": only groups may be negated with \\\":not()\\\"\"));\n          }\n          var negation = processNegation(idArg, idRe.lastIndex);\n          if (negation.nextMatch === -1) {\n            throw new Error('unknown error parsing \":not()\"');\n          }\n          idRe.lastIndex = negation.nextMatch;\n          parent.not = parseSelector(negation.str);\n        }\n\n        // Group or track ID.\n        else {\n          ids.push({\n            id: id\n          });\n        }\n      }\n      return ids;\n    }\n    return parseSelector;\n  }();\n\n  /*\n  \tSimpleAudio.select(selector).…;\n  \t\tE.g.\n  \t\tSimpleAudio.select(':ui').…\n  \t\tSimpleAudio.select(':ui:not(boop)').…\n  \t\tSimpleAudio.select('boop beep').…\n  \t\tSimpleAudio.select(':ui :sfx').…\n  \t\tSimpleAudio.select(':ui:not(boop) :sfx overthetop').…\n  */\n  function runnerGet( /* selector */\n  ) {\n    if (arguments.length === 0) {\n      throw new Error('no track selector specified');\n    }\n    var selector = String(arguments[0]).trim();\n    var trackIds = new Set();\n    try {\n      var renderIds = function renderIds(idObj) {\n        var id = idObj.id;\n        var ids;\n        switch (id) {\n          case ':all':\n            ids = allIds;\n            break;\n          case ':looped':\n            ids = allIds.filter(function (id) {\n              return _tracks.get(id).loop();\n            });\n            break;\n          case ':muted':\n            ids = allIds.filter(function (id) {\n              return _tracks.get(id).mute();\n            });\n            break;\n          case ':paused':\n            ids = allIds.filter(function (id) {\n              return _tracks.get(id).isPaused();\n            });\n            break;\n          case ':playing':\n            ids = allIds.filter(function (id) {\n              return _tracks.get(id).isPlaying();\n            });\n            break;\n          case ':stopped':\n            ids = allIds.filter(function (id) {\n              return _tracks.get(id).isStopped();\n            });\n            break;\n          default:\n            {\n              if (id.startsWith(':')) {\n                var group = _groups.get(id);\n                if (!group) {\n                  throw new Error(\"group \\\"\".concat(id, \"\\\" does not exist\"));\n                }\n                ids = group;\n              } else {\n                ids = [id];\n              }\n              break;\n            }\n        }\n        if (Object.hasOwn(idObj, 'not')) {\n          var negated = idObj.not.map(function (idObj) {\n            return renderIds(idObj);\n          }).flat(Infinity);\n          ids = ids.filter(function (id) {\n            return !negated.includes(id);\n          });\n        }\n        return ids;\n      };\n      var allIds = Array.from(_tracks.keys());\n      _runnerParseSelector(selector).forEach(function (idObj) {\n        return renderIds(idObj).forEach(function (id) {\n          if (!_tracks.has(id)) {\n            throw new Error(\"track \\\"\".concat(id, \"\\\" does not exist\"));\n          }\n          trackIds.add(id);\n        });\n      });\n    } catch (ex) {\n      throw new Error(\"error during runner initialization: \".concat(ex.message));\n    }\n    return new AudioRunner(trackIds);\n  }\n\n  /*******************************************************************************\n  \tMaster Audio Functions.\n  *******************************************************************************/\n\n  function masterLoad() {\n    publish('load');\n  }\n  function masterLoadWithScreen() {\n    publish('loadwithscreen');\n  }\n  function masterMute(mute) {\n    if (mute == null) {\n      // lazy equality for null\n      return _masterMute;\n    }\n    _masterMute = !!mute;\n    publish('mute', _masterMute);\n  }\n  function masterMuteOnHidden(mute) {\n    // NOTE: Some older browsers—notably: IE 9—do not support the Page Visibility API.\n    if (!Visibility.isEnabled()) {\n      return false;\n    }\n    if (mute == null) {\n      // lazy equality for null\n      return _masterMuteOnHidden;\n    }\n    _masterMuteOnHidden = !!mute;\n    var namespace = '.SimpleAudio_masterMuteOnHidden';\n    if (_masterMuteOnHidden) {\n      var visibilityChange = \"\".concat(Visibility.changeEvent).concat(namespace);\n      jQuery(document).off(namespace).on(visibilityChange, function () {\n        return masterMute(Visibility.isHidden());\n      });\n\n      // Only change the mute state initially if hidden.\n      if (Visibility.isHidden()) {\n        masterMute(true);\n      }\n    } else {\n      jQuery(document).off(namespace);\n    }\n  }\n  function masterRate(rate) {\n    if (rate == null) {\n      // lazy equality for null\n      return _masterRate;\n    }\n    if (typeof rate !== 'number' || Number.isNaN(rate) || !Number.isFinite(rate)) {\n      throw new Error('rate must be a finite number');\n    }\n    _masterRate = Math.clamp(rate, 0.2, 5); // clamp to 5× slower & faster\n    publish('rate', _masterRate);\n  }\n  function masterStop() {\n    publish('stop');\n  }\n  function masterUnload() {\n    publish('unload');\n  }\n  function masterVolume(volume) {\n    if (volume == null) {\n      // lazy equality for null\n      return _masterVolume;\n    }\n    if (typeof volume !== 'number' || Number.isNaN(volume) || !Number.isFinite(volume)) {\n      throw new Error('volume must be a finite number');\n    }\n    _masterVolume = Math.clamp(volume, 0, 1); // clamp to 0 (silent) & 1 (full loudness)\n    publish('volume', _masterVolume);\n  }\n\n  /*******************************************************************************\n  \tSubscription Functions.\n  *******************************************************************************/\n\n  function subscribe(id, callback) {\n    if (typeof callback !== 'function') {\n      throw new Error('callback parameter must be a function');\n    }\n    _subscribers.set(id, callback);\n  }\n  function unsubscribe(id) {\n    _subscribers.delete(id);\n  }\n  function publish(mesg, data) {\n    _subscribers.forEach(function (fn) {\n      return fn(mesg, data);\n    });\n  }\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function _newTrack(sources) {\n    return new AudioTrack(sources.map(function (source) {\n      // Handle audio passages.\n      if (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n        var passage = Story.get(source);\n        if (passage.tags.includes('Twine.audio')) {\n          return passage.text.trim();\n        }\n      }\n\n      // Handle URIs—possibly prefixed with a format specifier.\n      var match = _formatSpecRe.exec(source);\n      return match === null ? source : {\n        format: match[1],\n        src: match[2]\n      };\n    }));\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Track Functions.\n    tracks: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: trackAdd\n        },\n        delete: {\n          value: trackDelete\n        },\n        clear: {\n          value: trackClear\n        },\n        has: {\n          value: trackHas\n        },\n        get: {\n          value: trackGet\n        }\n      }))\n    },\n    // Group Functions.\n    groups: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: groupAdd\n        },\n        delete: {\n          value: groupDelete\n        },\n        clear: {\n          value: groupClear\n        },\n        has: {\n          value: groupHas\n        },\n        get: {\n          value: groupGet\n        }\n      }))\n    },\n    // Playlist Functions.\n    lists: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: listAdd\n        },\n        delete: {\n          value: listDelete\n        },\n        clear: {\n          value: listClear\n        },\n        has: {\n          value: listHas\n        },\n        get: {\n          value: listGet\n        }\n      }))\n    },\n    // Runner Functions.\n    select: {\n      value: runnerGet\n    },\n    // Master Audio Functions.\n    load: {\n      value: masterLoad\n    },\n    loadWithScreen: {\n      value: masterLoadWithScreen\n    },\n    mute: {\n      value: masterMute\n    },\n    muteOnHidden: {\n      value: masterMuteOnHidden\n    },\n    rate: {\n      value: masterRate\n    },\n    stop: {\n      value: masterStop\n    },\n    unload: {\n      value: masterUnload\n    },\n    volume: {\n      value: masterVolume\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tstate.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Diff, Scripting, clone, session, storage, triggerEvent */\n\nvar State = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // History moment stack.\n  var _history = [];\n\n  // Currently active/played moment.\n  var _active = momentCreate();\n\n  // Currently active/played moment index.\n  var _activeIndex = -1;\n\n  // Titles of all moments which have expired (i.e. fallen off the bottom of the stack).\n  var _expired = [];\n\n  // (optional) Seedable PRNG object.\n  var _prng = null;\n\n  // Temporary variables object.\n  var _temporary = Object.create(null);\n\n  /*******************************************************************************\n  \tState Functions.\n  *******************************************************************************/\n\n  /*\n  \tResets the story state.\n  */\n  function stateReset() {\n    if (BUILD_DEBUG) {\n      console.log('[State/stateReset()]');\n    }\n\n    // Delete the active session.\n    session.delete('state');\n\n    // Reset the properties.\n    _history = [];\n    _active = momentCreate();\n    _activeIndex = -1;\n    _expired = [];\n    _prng = _prng === null ? null : prngCreate(_prng.seed);\n\n    // Reset the temporary variables.\n    tempVariablesClear();\n  }\n\n  /*\n  \tRestores the story state from the active session.\n  */\n  function stateRestore() {\n    if (BUILD_DEBUG) {\n      console.log('[State/stateRestore()]');\n    }\n\n    // Retrieve the active session.\n    var state = session.get('state');\n    if (BUILD_DEBUG) {\n      console.log('\\tsession state:', state);\n    }\n    if (state == null) {\n      // lazy equality for null\n      return false;\n    }\n\n    // Restore the active session.\n    stateUnmarshal(state);\n    return true;\n  }\n\n  /*\n  \tReturns the current story state marshaled into a serializable object.\n  */\n  function stateMarshal(noDelta) {\n    // Gather the properties.\n    var state = {\n      index: _activeIndex\n    };\n    if (noDelta) {\n      state.history = clone(_history);\n    } else {\n      state.delta = historyDeltaEncode(_history);\n    }\n    if (_expired.length > 0) {\n      state.expired = Array.from(_expired);\n    }\n    if (_prng !== null) {\n      state.seed = _prng.seed;\n    }\n    return state;\n  }\n\n  /*\n  \tRestores the story state from a marshaled story state serialization object.\n  */\n  function stateUnmarshal(state, noDelta) {\n    if (state == null) {\n      // lazy equality for null\n      throw new Error('state object is null or undefined');\n    }\n    if (!Object.hasOwn(state, noDelta ? 'history' : 'delta') || state[noDelta ? 'history' : 'delta'].length === 0) {\n      throw new Error('state object has no history or history is empty');\n    }\n    if (!Object.hasOwn(state, 'index')) {\n      throw new Error('state object has no index');\n    }\n    if (_prng !== null && !Object.hasOwn(state, 'seed')) {\n      throw new Error('state object has no seed, but PRNG is enabled');\n    }\n    if (_prng === null && Object.hasOwn(state, 'seed')) {\n      throw new Error('state object has seed, but PRNG is disabled');\n    }\n\n    // Restore the properties.\n    _history = noDelta ? clone(state.history) : historyDeltaDecode(state.delta);\n    _activeIndex = state.index;\n    _expired = Object.hasOwn(state, 'expired') ? Array.from(state.expired) : [];\n    if (Object.hasOwn(state, 'seed')) {\n      // Only the PRNG's seed should be restored here as `momentActivate()`\n      // will handle fully restoring the PRNG to its proper state.\n      _prng.seed = state.seed;\n    }\n\n    // Activate the current moment (do this only after all properties have been restored).\n    momentActivate(_activeIndex);\n  }\n\n  /*\n  \tReturns the current story state marshaled into a save-compatible serializable object.\n  */\n  function stateMarshalForSave() {\n    return stateMarshal(true);\n  }\n\n  /*\n  \tRestores the story state from a marshaled save-compatible story state serialization object.\n  */\n  function stateUnmarshalForSave(state) {\n    return stateUnmarshal(state, true);\n  }\n\n  /*\n  \tReturns the titles of expired moments.\n  */\n  function stateExpired() {\n    return _expired;\n  }\n\n  /*\n  \tReturns the total number of played moments (expired + in-play history moments).\n  */\n  function stateTurns() {\n    return _expired.length + historyLength();\n  }\n\n  /*\n  \tReturns the passage titles of all played moments (expired + in-play history moments).\n  */\n  function stateTitles() {\n    return _expired.concat(_history.slice(0, historyLength()).map(function (moment) {\n      return moment.title;\n    }));\n  }\n\n  /*\n  \tReturns whether a passage with the given title has been played (expired + in-play history moments).\n  */\n  function stateHasPlayed(title) {\n    if (title == null || title === '') {\n      // lazy equality for null\n      return false;\n    }\n    if (_expired.includes(title)) {\n      return true;\n    } else if (_history.slice(0, historyLength()).some(function (moment) {\n      return moment.title === title;\n    })) {\n      return true;\n    }\n    return false;\n  }\n\n  /*******************************************************************************\n  \tMoment Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a new moment object created from the given passage title and variables object.\n  */\n  function momentCreate(title, variables) {\n    return {\n      title: title == null ? '' : String(title),\n      // lazy equality for null\n      variables: variables == null ? {} : clone(variables) // lazy equality for null\n    };\n  }\n\n  /*\n  \tReturns the active (present) moment.\n  */\n  function momentActive() {\n    return _active;\n  }\n\n  /*\n  \tReturns the index within the history of the active (present) moment.\n  */\n  function momentActiveIndex() {\n    return _activeIndex;\n  }\n\n  /*\n  \tReturns the title from the active (present) moment.\n  */\n  function momentActiveTitle() {\n    return _active.title;\n  }\n\n  /*\n  \tReturns the variables from the active (present) moment.\n  */\n  function momentActiveVariables() {\n    return _active.variables;\n  }\n\n  /*\n  \tReturns the active (present) moment after setting it to either the given moment object\n  \tor the moment object at the given history index.  Additionally, updates the active session\n  \tand triggers a history update event.\n  */\n  function momentActivate(moment) {\n    if (moment == null) {\n      // lazy equality for null\n      throw new Error('moment activation attempted with null or undefined');\n    }\n\n    // Set the active moment.\n    switch (_typeof(moment)) {\n      case 'object':\n        _active = clone(moment);\n        break;\n      case 'number':\n        {\n          if (historyIsEmpty()) {\n            throw new Error('moment activation attempted with index on empty history');\n          }\n          if (moment < 0 || moment >= historySize()) {\n            throw new RangeError(\"moment activation attempted with out-of-bounds index; need [0, \".concat(historySize() - 1, \"], got \").concat(moment));\n          }\n          _active = clone(_history[moment]);\n          break;\n        }\n      default:\n        throw new TypeError(\"moment activation attempted with a \\\"\".concat(_typeof(moment), \"\\\"; must be an object or valid history stack index\"));\n    }\n\n    // Restore the seedable PRNG.\n    //\n    // NOTE: We cannot simply set `_prng.pull` to `_active.pull` as that would\n    // not properly mutate the PRNG's internal state.\n    if (_prng !== null) {\n      _prng = prngUnmarshal({\n        seed: _prng.seed,\n        pull: _active.pull\n      });\n    }\n\n    // Update the active session.\n    session.set('state', stateMarshal());\n\n    // Trigger a global `:historyupdate` event.\n    //\n    // NOTE: We do this here because setting a new active moment is a core component\n    // of, virtually, all history updates.\n    triggerEvent(':historyupdate');\n    return _active;\n  }\n\n  /*******************************************************************************\n  \tHistory Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns the moment history.\n  */\n  function historyGet() {\n    return _history;\n  }\n\n  /*\n  \tReturns the number of active history moments (past only).\n  */\n  function historyLength() {\n    return _activeIndex + 1;\n  }\n\n  /*\n  \tReturns the total number of history moments (past + future).\n  */\n  function historySize() {\n    return _history.length;\n  }\n\n  /*\n  \tReturns whether the history is empty.\n  */\n  function historyIsEmpty() {\n    return _history.length === 0;\n  }\n\n  /*\n  \tReturns the current (pre-play version of the active) moment within the history.\n  */\n  function historyCurrent() {\n    return _history.length > 0 ? _history[_activeIndex] : null;\n  }\n\n  /*\n  \tReturns the topmost (most recent) moment within the history.\n  */\n  function historyTop() {\n    return _history.length > 0 ? _history[_history.length - 1] : null;\n  }\n\n  /*\n  \tReturns the bottommost (least recent) moment within the history.\n  */\n  function historyBottom() {\n    return _history.length > 0 ? _history[0] : null;\n  }\n\n  /*\n  \tReturns the moment at the given index within the history.\n  */\n  function historyIndex(index) {\n    if (historyIsEmpty() || index < 0 || index > _activeIndex) {\n      return null;\n    }\n    return _history[index];\n  }\n\n  /*\n  \tReturns the moment at the given offset from the active moment within the history.\n  */\n  function historyPeek(offset) {\n    if (historyIsEmpty()) {\n      return null;\n    }\n    var lengthOffset = 1 + (offset ? Math.abs(offset) : 0);\n    if (lengthOffset > historyLength()) {\n      return null;\n    }\n    return _history[historyLength() - lengthOffset];\n  }\n\n  /*\n  \tReturns whether a moment with the given title exists within the history.\n  */\n  function historyHas(title) {\n    if (historyIsEmpty() || title == null || title === '') {\n      // lazy equality for null\n      return false;\n    }\n    for (var i = _activeIndex; i >= 0; --i) {\n      if (_history[i].title === title) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /*\n  \tCreates a new moment and pushes it onto the history, discarding future moments if necessary.\n  */\n  function historyCreate(title) {\n    if (BUILD_DEBUG) {\n      console.log(\"[State/historyCreate(title: \\\"\".concat(title, \"\\\")]\"));\n    }\n\n    // TODO: It might be good to have some assertions about the passage title here.\n\n    // If we're not at the top of the stack, discard the future moments.\n    if (historyLength() < historySize()) {\n      if (BUILD_DEBUG) {\n        console.log(\"\\tnon-top push; discarding \".concat(historySize() - historyLength(), \" future moments\"));\n      }\n      _history.splice(historyLength(), historySize() - historyLength());\n    }\n\n    // Push the new moment onto the history stack.\n    _history.push(momentCreate(title, _active.variables));\n    if (_prng) {\n      historyTop().pull = _prng.pull;\n    }\n\n    // Truncate the history, if necessary, by discarding moments from the bottom.\n    while (historySize() > Config.history.maxStates) {\n      _expired.push(_history.shift().title);\n    }\n\n    // Activate the new top moment.\n    _activeIndex = historySize() - 1;\n    momentActivate(_activeIndex);\n    return historyLength();\n  }\n\n  /*\n  \tActivate the moment at the given index within the history.\n  */\n  function historyGoTo(index) {\n    if (BUILD_DEBUG) {\n      console.log(\"[State/historyGoTo(index: \".concat(index, \")]\"));\n    }\n    if (index == null /* lazy equality for null */ || index < 0 || index >= historySize() || index === _activeIndex) {\n      return false;\n    }\n    _activeIndex = index;\n    momentActivate(_activeIndex);\n    return true;\n  }\n\n  /*\n  \tActivate the moment at the given offset from the active moment within the history.\n  */\n  function historyGo(offset) {\n    if (BUILD_DEBUG) {\n      console.log(\"[State/historyGo(offset: \".concat(offset, \")]\"));\n    }\n    if (offset == null || offset === 0) {\n      // lazy equality for null\n      return false;\n    }\n    return historyGoTo(_activeIndex + offset);\n  }\n\n  /*\n  \tReturns the delta encoded form of the given history array.\n  */\n  function historyDeltaEncode(historyArr) {\n    if (!Array.isArray(historyArr)) {\n      return null;\n    }\n    if (historyArr.length === 0) {\n      return [];\n    }\n\n    // NOTE: The `clone()` call here is likely unnecessary within the current codebase.\n    // const delta = [clone(historyArr[0])];\n    var delta = [historyArr[0]];\n    for (var i = 1, iend = historyArr.length; i < iend; ++i) {\n      delta.push(Diff.diff(historyArr[i - 1], historyArr[i]));\n    }\n    return delta;\n  }\n\n  /*\n  \tReturns a history array from the given delta encoded history array.\n  */\n  function historyDeltaDecode(delta) {\n    if (!Array.isArray(delta)) {\n      return null;\n    }\n    if (delta.length === 0) {\n      return [];\n    }\n    var historyArr = [clone(delta[0])];\n    for (var i = 1, iend = delta.length; i < iend; ++i) {\n      historyArr.push(Diff.patch(historyArr[i - 1], delta[i]));\n    }\n    return historyArr;\n  }\n\n  /*******************************************************************************\n  \tPRNG Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a new PRNG wrapper object.\n  */\n  function prngCreate(seedBase, mixEntropy) {\n    return new Math.seedrandom(seedBase, {\n      // eslint-disable-line new-cap\n      entropy: Boolean(mixEntropy),\n      pass: function pass(prng, seed) {\n        return Object.create(null, {\n          prng: {\n            value: prng\n          },\n          seed: {\n            writable: true,\n            value: seed\n          },\n          pull: {\n            writable: true,\n            value: 0\n          },\n          random: {\n            value: function value() {\n              ++this.pull;\n              return this.prng();\n            }\n          }\n        });\n      }\n    });\n  }\n\n  /*\n  \tInitializes the PRNG for use.\n  */\n  function prngInit(seedBase, mixEntropy) {\n    if (BUILD_DEBUG) {\n      console.log(\"[State/prngInit(seedBase: \".concat(seedBase, \", mixEntropy: \").concat(Boolean(mixEntropy), \")]\"));\n    }\n    if (!historyIsEmpty()) {\n      var what;\n\n      // for Twine 1\n      if (BUILD_TWINE1) {\n        what = 'a script-tagged passage';\n      }\n      // for Twine 2\n      else {\n        what = 'the story JavaScript section';\n      }\n      throw new Error(\"State.prng.init must be called during initialization, within either \".concat(what, \" or the StoryInit special passage\"));\n    }\n    _prng = prngCreate(seedBase, Boolean(mixEntropy));\n    _active.pull = _prng.pull;\n  }\n\n  /*\n  \tRestores the PRNG state from a marshaled PRNG state serialization object.\n  */\n  function prngUnmarshal(state) {\n    // Create a new PRNG using the original seed.\n    var prng = prngCreate(state.seed);\n\n    // Pull from the PRNG until it reaches the pull count of the original.\n    for (var i = state.pull; i > 0; --i) {\n      prng.random();\n    }\n\n    // Return the PRNG now that the original state has been fully duplicated.\n    return prng;\n  }\n\n  /*\n  \tReturns whether the PRNG is enabled.\n  */\n  function prngIsEnabled() {\n    return _prng !== null;\n  }\n\n  /*\n  \tReturns the current pull count of the PRNG or, if the PRNG is not enabled,\n  \t`NaN`.\n  */\n  function prngPull() {\n    return _prng !== null ? _prng.pull : NaN;\n  }\n\n  /*\n  \tReturns the seed of the PRNG or, if the PRNG is not enabled, `null`.\n  */\n  function prngSeed() {\n    return _prng !== null ? _prng.seed : null;\n  }\n\n  /*\n  \tReturns a pseudo-random floating-point number from the PRNG or, if the\n  \tPRNG is not enabled, `Math.random()`.\n  */\n  function prngRandom() {\n    if (BUILD_DEBUG) {\n      console.log('[State/prngRandom()]');\n    }\n    return _prng !== null ? _prng.random() : Math.random();\n  }\n\n  /*******************************************************************************\n  \tTemporary Variables Functions.\n  *******************************************************************************/\n\n  /*\n  \tClear the temporary variables.\n  */\n  function tempVariablesClear() {\n    if (BUILD_DEBUG) {\n      console.log('[State/tempVariablesClear()]');\n    }\n    _temporary = Object.create(null);\n  }\n\n  /*\n  \tReturns the current temporary variables.\n  */\n  function tempVariables() {\n    return _temporary;\n  }\n\n  /*******************************************************************************\n  \tVariable Chain Parsing Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns the value of the given story/temporary variable.\n  */\n  function variableGet(varExpression) {\n    try {\n      return Scripting.evalTwineScript(varExpression);\n    } catch (ex) {/* no-op */}\n  }\n\n  /*\n  \tSets the value of the given story/temporary variable.\n  */\n  function variableSet(varExpression, value) {\n    try {\n      Scripting.evalTwineScript(\"\".concat(varExpression, \" = SCRIPT$DATA$\"), null, value);\n      return true;\n    } catch (ex) {/* no-op */}\n    return false;\n  }\n\n  /*******************************************************************************\n  \tStory Metadata Functions.\n  *******************************************************************************/\n\n  var _METADATA_STORE = 'metadata';\n  function metadataClear() {\n    storage.delete(_METADATA_STORE);\n  }\n  function metadataDelete(key) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"State.metadata.delete key parameter must be a string (received: \".concat(_typeof(key), \")\"));\n    }\n    var store = storage.get(_METADATA_STORE);\n    if (store && Object.hasOwn(store, key)) {\n      if (Object.keys(store).length === 1) {\n        storage.delete(_METADATA_STORE);\n      } else {\n        delete store[key];\n        storage.set(_METADATA_STORE, store);\n      }\n    }\n  }\n  function metadataEntries() {\n    var store = storage.get(_METADATA_STORE);\n    return store && Object.entries(store);\n  }\n  function metadataGet(key) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"State.metadata.get key parameter must be a string (received: \".concat(_typeof(key), \")\"));\n    }\n    var store = storage.get(_METADATA_STORE);\n    return store && Object.hasOwn(store, key) ? store[key] : undefined;\n  }\n  function metadataHas(key) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"State.metadata.has key parameter must be a string (received: \".concat(_typeof(key), \")\"));\n    }\n    var store = storage.get(_METADATA_STORE);\n    return store && Object.hasOwn(store, key);\n  }\n  function metadataKeys() {\n    var store = storage.get(_METADATA_STORE);\n    return store && Object.keys(store);\n  }\n  function metadataSet(key, value) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"State.metadata.set key parameter must be a string (received: \".concat(_typeof(key), \")\"));\n    }\n    if (typeof value === 'undefined') {\n      metadataDelete(key);\n    } else {\n      var store = storage.get(_METADATA_STORE) || {};\n      store[key] = value;\n      storage.set(_METADATA_STORE, store);\n    }\n  }\n  function metadataSize() {\n    var store = storage.get(_METADATA_STORE);\n    return store ? Object.keys(store).length : 0;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // State Functions.\n    reset: {\n      value: stateReset\n    },\n    restore: {\n      value: stateRestore\n    },\n    marshalForSave: {\n      value: stateMarshalForSave\n    },\n    unmarshalForSave: {\n      value: stateUnmarshalForSave\n    },\n    expired: {\n      get: stateExpired\n    },\n    turns: {\n      get: stateTurns\n    },\n    passages: {\n      get: stateTitles\n    },\n    hasPlayed: {\n      value: stateHasPlayed\n    },\n    // Moment Functions.\n    active: {\n      get: momentActive\n    },\n    activeIndex: {\n      get: momentActiveIndex\n    },\n    passage: {\n      get: momentActiveTitle\n    },\n    // shortcut for `State.active.title`\n    variables: {\n      get: momentActiveVariables\n    },\n    // shortcut for `State.active.variables`\n\n    // History Functions.\n    history: {\n      get: historyGet\n    },\n    length: {\n      get: historyLength\n    },\n    size: {\n      get: historySize\n    },\n    isEmpty: {\n      value: historyIsEmpty\n    },\n    current: {\n      get: historyCurrent\n    },\n    top: {\n      get: historyTop\n    },\n    bottom: {\n      get: historyBottom\n    },\n    index: {\n      value: historyIndex\n    },\n    peek: {\n      value: historyPeek\n    },\n    has: {\n      value: historyHas\n    },\n    create: {\n      value: historyCreate\n    },\n    goTo: {\n      value: historyGoTo\n    },\n    go: {\n      value: historyGo\n    },\n    deltaEncode: {\n      value: historyDeltaEncode\n    },\n    deltaDecode: {\n      value: historyDeltaDecode\n    },\n    // PRNG Functions.\n    prng: {\n      value: Object.preventExtensions(Object.create(null, {\n        init: {\n          value: prngInit\n        },\n        isEnabled: {\n          value: prngIsEnabled\n        },\n        pull: {\n          get: prngPull\n        },\n        seed: {\n          get: prngSeed\n        }\n      }))\n    },\n    random: {\n      value: prngRandom\n    },\n    // Temporary Variables Functions.\n    clearTemporary: {\n      value: tempVariablesClear\n    },\n    temporary: {\n      get: tempVariables\n    },\n    // Variable Chain Parsing Functions.\n    getVar: {\n      value: variableGet\n    },\n    setVar: {\n      value: variableSet\n    },\n    // Story Metadata Functions.\n    metadata: {\n      value: Object.preventExtensions(Object.create(null, {\n        clear: {\n          value: metadataClear\n        },\n        delete: {\n          value: metadataDelete\n        },\n        entries: {\n          value: metadataEntries\n        },\n        get: {\n          value: metadataGet\n        },\n        has: {\n          value: metadataHas\n        },\n        keys: {\n          value: metadataKeys\n        },\n        set: {\n          value: metadataSet\n        },\n        size: {\n          get: metadataSize\n        }\n      }))\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tmarkup/scripting.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Engine, Patterns, State, Story, enumFrom, getTypeOf, now, parseURL, stringFrom */\n\nvar Scripting = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /* eslint-disable no-unused-vars */\n\n  /*******************************************************************************\n  \tDeprecated Legacy Functions.\n  *******************************************************************************/\n\n  /*\n  \t[DEPRECATED] Returns the simple string representation of the passed value or,\n  \tif there is none, the passed default value.\n  \t\tNOTE: Unused, included only for compatibility.\n  */\n  function toStringOrDefault(value /* , defValue */) {\n    console.warn('[DEPRECATED] toStringOrDefault() is deprecated.');\n    return stringFrom(value);\n  }\n\n  /*******************************************************************************\n  \tUser Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns a random value from its given arguments.\n  */\n  function either( /* variadic */\n  ) {\n    if (arguments.length === 0) {\n      return;\n    }\n    return Array.prototype.concat.apply([], arguments).random();\n  }\n\n  /*\n  \tRemoves the given key, and its value, from the story metadata store.\n  */\n  function forget(key) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"forget key parameter must be a string (received: \".concat(getTypeOf(key), \")\"));\n    }\n    State.metadata.delete(key);\n  }\n\n  /*\n  \tReturns whether a passage with the given title exists within the story\n  \thistory.  If multiple passage titles are given, returns the logical-AND\n  \taggregate of the set.\n  */\n  function hasVisited( /* variadic */\n  ) {\n    if (arguments.length === 0) {\n      throw new Error('hasVisited called with insufficient parameters');\n    }\n    if (State.isEmpty()) {\n      return false;\n    }\n    var needles = Array.prototype.concat.apply([], arguments);\n    var played = State.passages;\n    for (var i = 0; i < needles.length; ++i) {\n      if (!played.includes(needles[i])) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /*\n  \tReturns the number of turns that have passed since the last instance of the given passage\n  \toccurred within the story history or `-1` if it does not exist.  If multiple passages are\n  \tgiven, returns the lowest count (which can be `-1`).\n  */\n  function lastVisited( /* variadic */\n  ) {\n    if (arguments.length === 0) {\n      throw new Error('lastVisited called with insufficient parameters');\n    }\n    if (State.isEmpty()) {\n      return -1;\n    }\n    var needles = Array.prototype.concat.apply([], arguments);\n    var played = State.passages;\n    var uBound = played.length - 1;\n    var turns = State.turns;\n    for (var i = 0; i < needles.length && turns > -1; ++i) {\n      var lastIndex = played.lastIndexOf(needles[i]);\n      turns = Math.min(turns, lastIndex === -1 ? -1 : uBound - lastIndex);\n    }\n    return turns;\n  }\n\n  /*\n  \tSets the given key/value pair within the story metadata store.\n  */\n  function memorize(key, value) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"memorize key parameter must be a string (received: \".concat(getTypeOf(key), \")\"));\n    }\n    State.metadata.set(key, value);\n  }\n\n  /*\n  \tReturns the title of the current passage.\n  */\n  function passage() {\n    return State.passage;\n  }\n\n  /*\n  \tReturns the title of a previous passage, either the most recent one whose title does not\n  \tmatch that of the active passage or the one at the optional offset, or an empty string,\n  \tif there is no such passage.\n  */\n  function previous( /* legacy: offset */\n  ) {\n    var passages = State.passages;\n\n    /* legacy: behavior with an offset */\n    if (arguments.length > 0) {\n      var offset = Number(arguments[0]);\n      if (!Number.isSafeInteger(offset) || offset < 1) {\n        throw new RangeError('previous offset parameter must be a positive integer greater than zero');\n      }\n      return passages.length > offset ? passages[passages.length - 1 - offset] : '';\n    }\n    /* /legacy */\n\n    for (var i = passages.length - 2; i >= 0; --i) {\n      if (passages[i] !== State.passage) {\n        return passages[i];\n      }\n    }\n    return '';\n  }\n\n  /*\n  \tReturns a pseudo-random whole number (integer) within the range of the given bounds.\n  */\n  function random( /* [min ,] max */\n  ) {\n    var min;\n    var max;\n    switch (arguments.length) {\n      case 0:\n        throw new Error('random called with insufficient parameters');\n      case 1:\n        min = 0;\n        max = Math.trunc(arguments[0]);\n        break;\n      default:\n        min = Math.trunc(arguments[0]);\n        max = Math.trunc(arguments[1]);\n        break;\n    }\n    if (!Number.isInteger(min)) {\n      throw new TypeError('random min parameter must be an integer');\n    }\n    if (!Number.isInteger(max)) {\n      throw new TypeError('random max parameter must be an integer');\n    }\n    if (min > max) {\n      var _ref7 = [max, min];\n      min = _ref7[0];\n      max = _ref7[1];\n    }\n    return Math.floor(State.random() * (max - min + 1)) + min;\n  }\n\n  /*\n  \tReturns a pseudo-random real number (floating-point) within the range of the given bounds.\n  \t\tNOTE: Unlike with its sibling function `random()`, the `max` parameter\n  \tis exclusive, not inclusive—i.e. the range goes to, but does not include,\n  \tthe given value.\n  */\n  function randomFloat( /* [min ,] max */\n  ) {\n    var min;\n    var max;\n    switch (arguments.length) {\n      case 0:\n        throw new Error('randomFloat called with insufficient parameters');\n      case 1:\n        min = 0.0;\n        max = Number(arguments[0]);\n        break;\n      default:\n        min = Number(arguments[0]);\n        max = Number(arguments[1]);\n        break;\n    }\n    if (Number.isNaN(min) || !Number.isFinite(min)) {\n      throw new TypeError('randomFloat min parameter must be a number');\n    }\n    if (Number.isNaN(max) || !Number.isFinite(max)) {\n      throw new TypeError('randomFloat max parameter must be a number');\n    }\n    if (min > max) {\n      var _ref8 = [max, min];\n      min = _ref8[0];\n      max = _ref8[1];\n    }\n    return State.random() * (max - min) + min;\n  }\n\n  /*\n  \tReturns the value of the given key from the story metadata store\n  \tor the given default value if the key does not exist.\n  */\n  function recall(key, defaultValue) {\n    if (typeof key !== 'string') {\n      throw new TypeError(\"recall key parameter must be a string (received: \".concat(getTypeOf(key), \")\"));\n    }\n    return State.metadata.has(key) ? State.metadata.get(key) : defaultValue;\n  }\n\n  /*\n  \tReturns a new array consisting of all of the tags of the given passages.\n  */\n  function tags( /* variadic */\n  ) {\n    if (arguments.length === 0) {\n      return Story.get(State.passage).tags;\n    }\n    var passages = Array.prototype.concat.apply([], arguments);\n    var tags = [];\n    for (var i = 0; i < passages.length; ++i) {\n      tags = tags.concat(Story.get(passages[i]).tags);\n    }\n    return tags;\n  }\n\n  /*\n  \tReturns a reference to the current temporary _variables store.\n  */\n  function temporary() {\n    return State.temporary;\n  }\n\n  /*\n  \tReturns the number of milliseconds which have passed since the current passage was rendered.\n  */\n  function time() {\n    return Engine.lastPlay === null ? 0 : now() - Engine.lastPlay;\n  }\n\n  /*\n  \tReturns the number of passages that the player has visited.\n  \t\tNOTE: Passages which were visited but have been undone—e.g. via the backward\n  \tbutton or the `<<back>>` macro—are no longer part of the in-play story\n  \thistory and thus are not tallied.  Passages which were visited but have\n  \texpired from the story history, on the other hand, are tallied.\n  */\n  function turns() {\n    return State.turns;\n  }\n\n  /*\n  \tReturns a reference to the current story $variables store.\n  */\n  function variables() {\n    return State.variables;\n  }\n\n  /*\n  \tReturns the number of times that the passage with the given title exists within the story\n  \thistory.  If multiple passage titles are given, returns the lowest count.\n  */\n  function visited( /* variadic */\n  ) {\n    if (State.isEmpty()) {\n      return 0;\n    }\n    var needles = Array.prototype.concat.apply([], arguments.length === 0 ? [State.passage] : arguments);\n    var played = State.passages;\n    var count = State.turns;\n    for (var i = 0; i < needles.length && count > 0; ++i) {\n      count = Math.min(count, played.count(needles[i]));\n    }\n    return count;\n  }\n\n  /*\n  \tReturns the number of passages within the story history which are tagged with all of the given tags.\n  */\n  function visitedTags( /* variadic */\n  ) {\n    if (arguments.length === 0) {\n      throw new Error('visitedTags called with insufficient parameters');\n    }\n    if (State.isEmpty()) {\n      return 0;\n    }\n    var needles = Array.prototype.concat.apply([], arguments);\n    var nLength = needles.length;\n    var played = State.passages;\n    var seen = new Map();\n    var count = 0;\n    for (var i = 0; i < played.length; ++i) {\n      var title = played[i];\n      if (seen.has(title)) {\n        if (seen.get(title)) {\n          ++count;\n        }\n      } else {\n        var _tags2 = Story.get(title).tags;\n        if (_tags2.length > 0) {\n          var found = 0;\n          for (var j = 0; j < nLength; ++j) {\n            if (_tags2.includes(needles[j])) {\n              ++found;\n            }\n          }\n          if (found === nLength) {\n            ++count;\n            seen.set(title, true);\n          } else {\n            seen.set(title, false);\n          }\n        }\n      }\n    }\n    return count;\n  }\n\n  /* eslint-enable no-unused-vars */\n\n  /*******************************************************************************\n  \tImport Functions.\n  *******************************************************************************/\n\n  var _ref9 = function () {\n      // Slugify the given URL.\n      function slugifyUrl(url) {\n        return parseURL(url).path.replace(/^[^\\w]+|[^\\w]+$/g, '').replace(/[^\\w]+/g, '-').toLocaleLowerCase();\n      }\n\n      // Add a <script> element which will load the script from the given URL.\n      function addScript(url) {\n        return new Promise(function (resolve, reject) {\n          var kind;\n          var src;\n          if (typeof url === 'string') {\n            kind = url.trim().toLowerCase().endsWith('.mjs') ? 'module' : 'text/javascript';\n            src = url;\n          } else if (_typeof(url) === 'object') {\n            kind = url.type;\n            src = url.src;\n          } else {\n            throw new Error('importScripts url parameter must be a string or object');\n          }\n\n          /*\n          \tWARNING: The ordering of the code within this function is important,\n          \tas some browsers don't play well with different arrangements, so\n          \tbe careful when mucking around with it.\n          \t\tThe best supported ordering seems be: events → DOM append → attributes.\n          */\n          jQuery(document.createElement('script')).one('load abort error', function (ev) {\n            jQuery(ev.target).off();\n            if (ev.type === 'load') {\n              resolve(ev.target);\n            } else {\n              reject(new Error(\"importScripts failed to load the script \\\"\".concat(src, \"\\\"\")));\n            }\n          }).appendTo(document.head).attr({\n            id: \"script-imported-\".concat(slugifyUrl(src)),\n            type: kind,\n            src: src\n          });\n        });\n      }\n\n      // Add a <link> element which will load the stylesheet from the given URL.\n      function addStyle(url) {\n        return new Promise(function (resolve, reject) {\n          if (typeof url !== 'string') {\n            throw new Error('importStyles url parameter must be a string');\n          }\n\n          /*\n          \tWARNING: The ordering of the code within this function is important,\n          \tas some browsers don't play well with different arrangements, so\n          \tbe careful when mucking around with it.\n          \t\tThe best supported ordering seems be: events → DOM append → attributes.\n          */\n          jQuery(document.createElement('link')).one('load abort error', function (ev) {\n            jQuery(ev.target).off();\n            if (ev.type === 'load') {\n              resolve(ev.target);\n            } else {\n              reject(new Error(\"importStyles failed to load the stylesheet \\\"\".concat(url, \"\\\"\")));\n            }\n          }).appendTo(document.head).attr({\n            id: \"style-imported-\".concat(slugifyUrl(url)),\n            rel: 'stylesheet',\n            href: url\n          });\n        });\n      }\n\n      // Turn a list of callbacks into a sequential chain of `Promise` objects.\n      function sequence(callbacks) {\n        return callbacks.reduce(function (seq, fn) {\n          return seq = seq.then(fn);\n        }, Promise.resolve()); // eslint-disable-line no-param-reassign\n      }\n\n      /*\n      \tImport scripts from a URL.\n      */\n      function importScripts() {\n        for (var _len12 = arguments.length, urls = new Array(_len12), _key12 = 0; _key12 < _len12; _key12++) {\n          urls[_key12] = arguments[_key12];\n        }\n        return Promise.all(urls.map(function (oneOrSeries) {\n          // Array of URLs to be imported in sequence.\n          if (Array.isArray(oneOrSeries)) {\n            return sequence(oneOrSeries.map(function (url) {\n              return function () {\n                return addScript(url);\n              };\n            }));\n          }\n\n          // Single URL to be imported.\n          return addScript(oneOrSeries);\n        }));\n      }\n\n      /*\n      \tImport stylesheets from a URL.\n      */\n      function importStyles() {\n        for (var _len13 = arguments.length, urls = new Array(_len13), _key13 = 0; _key13 < _len13; _key13++) {\n          urls[_key13] = arguments[_key13];\n        }\n        return Promise.all(urls.map(function (oneOrSeries) {\n          // Array of URLs to be imported in sequence.\n          if (Array.isArray(oneOrSeries)) {\n            return sequence(oneOrSeries.map(function (url) {\n              return function () {\n                return addStyle(url);\n              };\n            }));\n          }\n\n          // Single URL to be imported.\n          return addStyle(oneOrSeries);\n        }));\n      }\n\n      // Exports.\n      return {\n        importScripts: importScripts,\n        importStyles: importStyles\n      };\n    }(),\n    importScripts = _ref9.importScripts,\n    importStyles = _ref9.importStyles;\n\n  /*******************************************************************************\n  \tDesugaring Functions.\n  *******************************************************************************/\n\n  /*\n  \tReturns the given string after converting all TwineScript syntactical sugars\n  \tto their native JavaScript counterparts.\n  */\n  var desugar = function () {\n    var tokenTable = enumFrom({\n      /* eslint-disable quote-props */\n      // Story $variable sigil-prefix.\n      '$': 'State.variables.',\n      // Temporary _variable sigil-prefix.\n      '_': 'State.temporary.',\n      // Assignment operator.\n      'to': '=',\n      // Equality operators.\n      'eq': '==',\n      'neq': '!=',\n      'is': '===',\n      'isnot': '!==',\n      // Relational operators.\n      'gt': '>',\n      'gte': '>=',\n      'lt': '<',\n      'lte': '<=',\n      // Logical operators.\n      'and': '&&',\n      'or': '||',\n      // Unary operators.\n      'not': '!',\n      'def': '\"undefined\" !== typeof',\n      'ndef': '\"undefined\" === typeof'\n      /* eslint-enable quote-props */\n    });\n    var desugarRE = new RegExp(['(?:\"\"|\\'\\'|``)',\n    //   Empty quotes (incl. template literal)\n    '(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")',\n    //   Double quoted, non-empty\n    \"(?:'(?:\\\\\\\\.|[^'\\\\\\\\])+')\",\n    //   Single quoted, non-empty\n    '(`(?:\\\\\\\\.|[^`\\\\\\\\])+`)',\n    // 1=Template literal, non-empty\n    '(?:[=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}]+)',\n    //   Operator characters\n    '(?:\\\\.{3})',\n    //   Spread/rest syntax\n    '([^\"\\'=+\\\\-*\\\\/%<>&\\\\|\\\\^~!?:,;\\\\(\\\\)\\\\[\\\\]{}\\\\s]+)' // 2=Barewords\n    ].join('|'), 'g');\n    var varTest = new RegExp(\"^\".concat(Patterns.variable));\n    function desugar(sugaredCode) {\n      desugarRE.lastIndex = 0;\n      var code = sugaredCode;\n      var match;\n      while ((match = desugarRE.exec(code)) !== null) {\n        // no-op: Empty quotes, Double quoted, Single quoted, Operator characters, Spread/rest syntax\n\n        // Template literal, non-empty.\n        if (match[1]) {\n          var sugaredTemplate = match[1];\n          var template = desugarTemplate(sugaredTemplate);\n          if (template !== sugaredTemplate) {\n            code = code.splice(match.index,\n            // starting index\n            sugaredTemplate.length,\n            // replace how many\n            template // replacement string\n            );\n            desugarRE.lastIndex += template.length - sugaredTemplate.length;\n          }\n        }\n\n        // Barewords.\n        else if (match[2]) {\n          var token = match[2];\n\n          // If the token is simply a dollar-sign or underscore, then it's either\n          // just the raw character or, probably, a function alias, so skip it.\n          if (token === '$' || token === '_') {\n            continue;\n          }\n\n          // If the token is a story $variable or temporary _variable, then reset\n          // it to just its sigil for replacement.\n          if (varTest.test(token)) {\n            token = token[0];\n          }\n\n          // If the finalized token has a mapping, replace it within the code string\n          // with its counterpart.\n          if (tokenTable[token]) {\n            code = code.splice(match.index,\n            // starting index\n            token.length,\n            // replace how many\n            tokenTable[token] // replacement string\n            );\n            desugarRE.lastIndex += tokenTable[token].length - token.length;\n          }\n        }\n      }\n      return code;\n    }\n    var templateGroupStartRE = /\\$\\{/g;\n    var templateGroupParseRE = new RegExp(['(?:\"\"|\\'\\')',\n    //   Empty quotes\n    '(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")',\n    //   Double quoted, non-empty\n    \"(?:'(?:\\\\\\\\.|[^'\\\\\\\\])+')\",\n    //   Single quoted, non-empty\n    '(\\\\{)',\n    // 1=Opening curly brace\n    '(\\\\})' // 2=Closing curly brace\n    ].join('|'), 'g');\n\n    // WARNING: Does not currently handle nested template strings.\n    function desugarTemplate(sugaredLiteral) {\n      templateGroupStartRE.lastIndex = 0;\n      var template = sugaredLiteral;\n      var startMatch;\n      while ((startMatch = templateGroupStartRE.exec(template)) !== null) {\n        var startIndex = startMatch.index + 2;\n        var endIndex = startIndex;\n        var depth = 1;\n        var endMatch = void 0;\n        templateGroupParseRE.lastIndex = startIndex;\n        while ((endMatch = templateGroupParseRE.exec(template)) !== null) {\n          // Opening curly brace.\n          if (endMatch[1]) {\n            ++depth;\n          }\n          // Closing curly brace.\n          else if (endMatch[2]) {\n            --depth;\n          }\n          if (depth === 0) {\n            endIndex = endMatch.index;\n            break;\n          }\n        }\n\n        // If the group is not empty, replace it within the template\n        // with its desugared counterpart.\n        if (endIndex > startIndex) {\n          var desugarREIndex = desugarRE.lastIndex;\n          var sugaredGroup = template.slice(startIndex, endIndex);\n          var group = desugar(sugaredGroup);\n          desugarRE.lastIndex = desugarREIndex;\n          template = template.splice(startIndex,\n          // starting index\n          sugaredGroup.length,\n          // replace how many\n          group // replacement string\n          );\n          templateGroupStartRE.lastIndex += group.length - sugaredGroup.length;\n        }\n      }\n      return template;\n    }\n    return desugar;\n  }();\n\n  /*******************************************************************************\n  \tEval Functions.\n  *******************************************************************************/\n\n  /* eslint-disable no-eval, no-extra-parens, no-unused-vars */\n  /*\n  \tEvaluates the given JavaScript code and returns the result, throwing if there were errors.\n  */\n  function evalJavaScript(code, output, data) {\n    return function (code, output, SCRIPT$DATA$) {\n      return eval(code);\n    }.call(output ? {\n      output: output\n    } : null, String(code), output, data);\n  }\n\n  /*\n  \tEvaluates the given TwineScript code and returns the result, throwing if there were errors.\n  */\n  function evalTwineScript(code, output, data) {\n    // WARNING: Do not use a dollar sign or underscore as the first character of the\n    // data variable, `SCRIPT$DATA$`, as `desugar()` will break references to it within\n    // the code string.\n    return function (code, output, SCRIPT$DATA$) {\n      return eval(code);\n    }.call(output ? {\n      output: output\n    } : null, desugar(String(code)), output, data);\n  }\n  /* eslint-enable no-eval, no-extra-parens, no-unused-vars */\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    desugar: {\n      value: desugar\n    },\n    evalJavaScript: {\n      value: evalJavaScript\n    },\n    evalTwineScript: {\n      value: evalTwineScript\n    },\n    /*\n    \tLegacy Functions.\n    */\n    parse: {\n      value: desugar\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tmarkup/lexer.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n\nvar _ref10 = function () {\n    // End of file (string, actually).\n    var EOF = -1;\n\n    /*******************************************************************************\n    \tLexer Class.\n    *******************************************************************************/\n    var Lexer = /*#__PURE__*/function () {\n      function Lexer(source, initialState) {\n        _classCallCheck(this, Lexer);\n        if (arguments.length < 2) {\n          throw new Error('Lexer constructor called with too few parameters (source:string , initialState:function)');\n        }\n\n        /*\n        \tthis.source  → the string to be scanned\n        \tthis.initial → initial state\n        \tthis.state   → current state\n        \tthis.start   → start position of an item\n        \tthis.pos     → current position in the source string\n        \tthis.depth   → current brace/bracket/parenthesis nesting depth\n        \tthis.items   → scanned item queue\n        \tthis.data    → lexing data\n        */\n        Object.defineProperties(this, {\n          source: {\n            value: source\n          },\n          initial: {\n            value: initialState\n          },\n          state: {\n            writable: true,\n            value: initialState\n          },\n          start: {\n            writable: true,\n            value: 0\n          },\n          pos: {\n            writable: true,\n            value: 0\n          },\n          depth: {\n            writable: true,\n            value: 0\n          },\n          items: {\n            writable: true,\n            value: []\n          },\n          data: {\n            writable: true,\n            value: {}\n          }\n        });\n      }\n      return _createClass(Lexer, [{\n        key: \"reset\",\n        value: function reset() {\n          this.state = this.initial;\n          this.start = 0;\n          this.pos = 0;\n          this.depth = 0;\n          this.items = [];\n          this.data = {};\n        }\n      }, {\n        key: \"run\",\n        value: function run() {\n          // scan the source string until no states remain\n          while (this.state !== null) {\n            this.state = this.state(this);\n          }\n\n          // return the array of items\n          return this.items;\n        }\n      }, {\n        key: \"nextItem\",\n        value: function nextItem() {\n          // scan the source string until we have an item or no states remain\n          while (this.items.length === 0 && this.state !== null) {\n            this.state = this.state(this);\n          }\n\n          // return the current item\n          return this.items.shift();\n        }\n      }, {\n        key: \"next\",\n        value: function next() {\n          if (this.pos >= this.source.length) {\n            return EOF;\n          }\n          return this.source[this.pos++];\n        }\n      }, {\n        key: \"peek\",\n        value: function peek() {\n          if (this.pos >= this.source.length) {\n            return EOF;\n          }\n          return this.source[this.pos];\n        }\n      }, {\n        key: \"backup\",\n        value: function backup(num) {\n          // if (num) {\n          // \tthis.pos -= num;\n          // }\n          // else {\n          // \t--this.pos;\n          // }\n          this.pos -= num || 1;\n        }\n      }, {\n        key: \"forward\",\n        value: function forward(num) {\n          // if (num) {\n          // \tthis.pos += num;\n          // }\n          // else {\n          // \t++this.pos;\n          // }\n          this.pos += num || 1;\n        }\n      }, {\n        key: \"ignore\",\n        value: function ignore() {\n          this.start = this.pos;\n        }\n      }, {\n        key: \"accept\",\n        value: function accept(valid) {\n          var ch = this.next();\n          if (ch === EOF) {\n            return false;\n          }\n          if (valid.includes(ch)) {\n            return true;\n          }\n          this.backup();\n          return false;\n        }\n      }, {\n        key: \"acceptRe\",\n        value: function acceptRe(validRe) {\n          var ch = this.next();\n          if (ch === EOF) {\n            return false;\n          }\n          if (validRe.test(ch)) {\n            return true;\n          }\n          this.backup();\n          return false;\n        }\n      }, {\n        key: \"acceptRun\",\n        value: function acceptRun(valid) {\n          for (;;) {\n            var ch = this.next();\n            if (ch === EOF) {\n              return;\n            }\n            if (!valid.includes(ch)) {\n              break;\n            }\n          }\n          this.backup();\n        }\n      }, {\n        key: \"acceptRunRe\",\n        value: function acceptRunRe(validRe) {\n          for (;;) {\n            var ch = this.next();\n            if (ch === EOF) {\n              return;\n            }\n            if (!validRe.test(ch)) {\n              break;\n            }\n          }\n          this.backup();\n        }\n      }, {\n        key: \"emit\",\n        value: function emit(type) {\n          this.items.push({\n            type: type,\n            text: this.source.slice(this.start, this.pos),\n            start: this.start,\n            pos: this.pos\n          });\n          this.start = this.pos;\n        }\n      }, {\n        key: \"error\",\n        value: function error(type, message) {\n          if (arguments.length < 2) {\n            throw new Error('Lexer.prototype.error called with too few parameters (type:number , message:string)');\n          }\n          this.items.push({\n            type: type,\n            message: message,\n            text: this.source.slice(this.start, this.pos),\n            start: this.start,\n            pos: this.pos\n          });\n          return null;\n        }\n      }], [{\n        key: \"enumFromNames\",\n        value: function enumFromNames(names) {\n          var obj = names.reduce(function (obj, name, i) {\n            obj[name] = i; // eslint-disable-line no-param-reassign\n            return obj;\n          }, {});\n          return Object.freeze(Object.assign(Object.create(null), obj));\n        }\n      }]);\n    }();\n    /*******************************************************************************\n    \tObject Exports.\n    *******************************************************************************/\n    return {\n      EOF: EOF,\n      Lexer: Lexer\n    };\n  }(),\n  EOF = _ref10.EOF,\n  Lexer = _ref10.Lexer;\n\n/***********************************************************************************************************************\n\n\tmarkup/wikifier.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Config, EOF, Engine, Lexer, Patterns, Scripting, State, Story, TempState, convertBreaks,\n\t       cssPropToDOMProp, errorPrologRegExp, getTypeOf, isExternalLink\n*/\n\n/*\n\tTODO: The Wikifier, and associated code, could stand to receive a serious refactoring.\n*/\n/* eslint-disable max-len */\nvar Wikifier = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Wikifier call depth.\n  var _callDepth = 0;\n\n  /*******************************************************************************\n  \tWikifier Class.\n  *******************************************************************************/\n  var Wikifier = /*#__PURE__*/function () {\n    function Wikifier(destination, source, options) {\n      _classCallCheck(this, Wikifier);\n      if (Wikifier.Parser.Profile.isEmpty()) {\n        Wikifier.Parser.Profile.compile();\n      }\n      Object.defineProperties(this, {\n        // General Wikifier properties.\n        source: {\n          value: String(source)\n        },\n        options: {\n          writable: true,\n          value: Object.assign({\n            profile: 'all'\n          }, options)\n        },\n        nextMatch: {\n          writable: true,\n          value: 0\n        },\n        output: {\n          writable: true,\n          value: null\n        },\n        // Macro parser ('macro') related properties.\n        _rawArgs: {\n          writable: true,\n          value: ''\n        }\n      });\n\n      // No destination specified.  Create a fragment to act as the output buffer.\n      if (destination == null) {\n        // lazy equality for null\n        this.output = document.createDocumentFragment();\n      }\n\n      // jQuery-wrapped destination.  Grab the first element.\n      else if (destination instanceof jQuery) {\n        this.output = destination[0];\n      }\n\n      // Normal destination.\n      else {\n        this.output = destination;\n      }\n\n      /*\n      \tWikify the source into the output buffer element, possibly converting line\n      \tbreaks into paragraphs.\n      \t\tNOTE: There's no catch clause here because this try/finally exists solely\n      \tto ensure that the call depth is properly restored in the event that an\n      \tuncaught exception is thrown during the call to `subWikify()`.\n      */\n      try {\n        ++_callDepth;\n        this.subWikify(this.output);\n\n        // Limit line break conversion to non-recursive calls.\n        if (_callDepth === 1 && (Object.hasOwn(this.options, 'cleanup') && this.options.cleanup != null // lazy equality for null\n        ? this.options.cleanup : Config.cleanupWikifierOutput)) {\n          convertBreaks(this.output);\n        }\n      } finally {\n        --_callDepth;\n      }\n    }\n    return _createClass(Wikifier, [{\n      key: \"subWikify\",\n      value: function subWikify(output, terminator, options) {\n        // Cache and temporarily replace the current output buffer.\n        var oldOutput = this.output;\n        this.output = output;\n        var newOptions;\n        var oldOptions;\n\n        // Parser option overrides.\n        if (Wikifier.Option.length > 0) {\n          newOptions = Object.assign(newOptions || {}, Wikifier.Option.options);\n        }\n        // Local parameter option overrides.\n        if (options !== null && _typeof(options) === 'object') {\n          newOptions = Object.assign(newOptions || {}, options);\n        }\n        // If new options exist, cache and temporarily replace the current options.\n        if (newOptions) {\n          oldOptions = this.options;\n          this.options = Object.assign({}, this.options, newOptions);\n        }\n        var parsersProfile = Wikifier.Parser.Profile.get(this.options.profile);\n        var terminatorRegExp = terminator ? new RegExp(\"(?:\".concat(terminator, \")\"), this.options.ignoreTerminatorCase ? 'gim' : 'gm') : null;\n        var terminatorMatch;\n        var parserMatch;\n        do {\n          // Prepare the RegExp match positions.\n          parsersProfile.parserRegExp.lastIndex = this.nextMatch;\n          if (terminatorRegExp) {\n            terminatorRegExp.lastIndex = this.nextMatch;\n          }\n\n          // Get the first matches.\n          parserMatch = parsersProfile.parserRegExp.exec(this.source);\n          terminatorMatch = terminatorRegExp ? terminatorRegExp.exec(this.source) : null;\n\n          // Try for a terminator match, unless there's a closer parser match.\n          if (terminatorMatch && (!parserMatch || terminatorMatch.index <= parserMatch.index)) {\n            // Output any text before the match.\n            if (terminatorMatch.index > this.nextMatch) {\n              this.outputText(this.output, this.nextMatch, terminatorMatch.index);\n            }\n\n            // Set the match parameters.\n            this.matchStart = terminatorMatch.index;\n            this.matchLength = terminatorMatch[0].length;\n            this.matchText = terminatorMatch[0];\n            this.nextMatch = terminatorRegExp.lastIndex;\n\n            // Restore the original output buffer and options.\n            this.output = oldOutput;\n            if (oldOptions) {\n              this.options = oldOptions;\n            }\n\n            // Exit.\n            return;\n          }\n\n          // Try for a parser match.\n          else if (parserMatch) {\n            // Output any text before the match.\n            if (parserMatch.index > this.nextMatch) {\n              this.outputText(this.output, this.nextMatch, parserMatch.index);\n            }\n\n            // Set the match parameters.\n            this.matchStart = parserMatch.index;\n            this.matchLength = parserMatch[0].length;\n            this.matchText = parserMatch[0];\n            this.nextMatch = parsersProfile.parserRegExp.lastIndex;\n\n            // Figure out which parser matched.\n            var matchingParser = void 0;\n            for (var i = 1, iend = parserMatch.length; i < iend; ++i) {\n              if (parserMatch[i]) {\n                matchingParser = i - 1;\n                break; // stop once we've found the matching parser\n              }\n            }\n\n            // Call the parser.\n            parsersProfile.parsers[matchingParser].handler(this);\n            if (TempState.break != null) {\n              // lazy equality for null\n              break;\n            }\n          }\n        } while (terminatorMatch || parserMatch);\n\n        // Output any text after the last match.\n        if (TempState.break == null) {\n          // lazy equality for null\n          if (this.nextMatch < this.source.length) {\n            this.outputText(this.output, this.nextMatch, this.source.length);\n            this.nextMatch = this.source.length;\n          }\n        }\n\n        // In case of <<break>>/<<continue>>, remove the last <br>.\n        else if (this.output.lastChild && this.output.lastChild.nodeType === Node.ELEMENT_NODE && this.output.lastChild.nodeName.toUpperCase() === 'BR') {\n          jQuery(this.output.lastChild).remove();\n        }\n\n        // Restore the original output buffer and options.\n        this.output = oldOutput;\n        if (oldOptions) {\n          this.options = oldOptions;\n        }\n      }\n    }, {\n      key: \"outputText\",\n      value: function outputText(destination, startPos, endPos) {\n        jQuery(destination).append(document.createTextNode(this.source.substring(startPos, endPos)));\n      }\n\n      /*\n      \t[DEPRECATED] Meant to be called by legacy macros, this returns the raw, unprocessed\n      \ttext given to the currently executing macro.\n      */\n    }, {\n      key: \"rawArgs\",\n      value: function rawArgs() {\n        console.warn('[DEPRECATED] Wikifier.rawArgs() is deprecated.');\n        return this._rawArgs;\n      }\n\n      /*\n      \t[DEPRECATED] Meant to be called by legacy macros, this returns the text given to\n      \tthe currently executing macro after doing TwineScript to JavaScript desugaring.\n      */\n    }, {\n      key: \"fullArgs\",\n      value: function fullArgs() {\n        console.warn('[DEPRECATED] Wikifier.fullArgs() is deprecated.');\n        return Scripting.desugar(this._rawArgs);\n      }\n\n      /*\n      \tReturns the output generated by wikifying the given text, throwing if there were errors.\n      */\n    }], [{\n      key: \"wikifyEval\",\n      value: function wikifyEval(text) {\n        var output = document.createDocumentFragment();\n        new Wikifier(output, text);\n        var errors = output.querySelector('.error');\n        if (errors !== null) {\n          throw new Error(errors.textContent.replace(errorPrologRegExp, ''));\n        }\n        return output;\n      }\n\n      /*\n      \tCreate and return an internal link.\n      */\n    }, {\n      key: \"createInternalLink\",\n      value: function createInternalLink(destination, passage, text, callback) {\n        var $link = jQuery(document.createElement('a'));\n        if (passage != null) {\n          // lazy equality for null\n          $link.attr('data-passage', passage);\n          if (Story.has(passage)) {\n            $link.addClass('link-internal');\n            if (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n              $link.addClass('link-visited');\n            }\n          } else {\n            $link.addClass('link-broken');\n          }\n          $link.ariaClick({\n            one: true\n          }, function () {\n            if (typeof callback === 'function') {\n              callback();\n            }\n            Engine.play(passage);\n          });\n        }\n        if (text) {\n          $link.append(document.createTextNode(text));\n        }\n        if (destination) {\n          $link.appendTo(destination);\n        }\n\n        // For legacy-compatibility we must return the DOM node.\n        return $link[0];\n      }\n\n      /*\n      \tCreate and return an external link.\n      */\n    }, {\n      key: \"createExternalLink\",\n      value: function createExternalLink(destination, url, text) {\n        var $link = jQuery(document.createElement('a')).attr('target', '_blank').addClass('link-external').text(text).appendTo(destination);\n        if (url != null) {\n          // lazy equality for null\n          $link.attr({\n            href: url,\n            tabindex: 0 // for accessibility\n          });\n        }\n\n        // For legacy-compatibility we must return the DOM node.\n        return $link[0];\n      }\n    }]);\n  }();\n  /*******************************************************************************\n  \tOption Static Object.\n  *******************************************************************************/\n  Object.defineProperty(Wikifier, 'Option', {\n    value: function () {\n      // Options array (stack).\n      var _optionsStack = [];\n\n      /*\n      \tGlobalOption Functions.\n      */\n      function optionLength() {\n        return _optionsStack.length;\n      }\n      function optionGetter() {\n        return Object.assign.apply(Object, [{}].concat(_toConsumableArray(_optionsStack)));\n      }\n      function optionClear() {\n        _optionsStack = [];\n      }\n      function optionGet(index) {\n        return _optionsStack[index];\n      }\n      function optionPop() {\n        return _optionsStack.pop();\n      }\n      function optionPush(options) {\n        if (_typeof(options) !== 'object' || options === null) {\n          throw new TypeError(\"Wikifier.Option.push options parameter must be an object (received: \".concat(getTypeOf(options), \")\"));\n        }\n        return _optionsStack.push(options);\n      }\n\n      /*\n      \tExports.\n      */\n      return Object.preventExtensions(Object.create(null, {\n        length: {\n          get: optionLength\n        },\n        options: {\n          get: optionGetter\n        },\n        clear: {\n          value: optionClear\n        },\n        get: {\n          value: optionGet\n        },\n        pop: {\n          value: optionPop\n        },\n        push: {\n          value: optionPush\n        }\n      }));\n    }()\n  });\n\n  /*******************************************************************************\n  \tParser Static Object.\n  *******************************************************************************/\n\n  Object.defineProperty(Wikifier, 'Parser', {\n    value: function () {\n      // Parser definition array.  Ordering matters, so this must be an ordered list.\n      var _parsers = [];\n\n      // Parser profiles object.\n      var _profiles;\n\n      /*\n      \tParser Functions.\n      */\n      function parsersGetter() {\n        return _parsers;\n      }\n      function parsersAdd(parser) {\n        // Parser object sanity checks.\n        if (_typeof(parser) !== 'object') {\n          throw new Error('Wikifier.Parser.add parser parameter must be an object');\n        }\n        if (!Object.hasOwn(parser, 'name')) {\n          throw new Error('parser object missing required \"name\" property');\n        } else if (typeof parser.name !== 'string') {\n          throw new Error('parser object \"name\" property must be a string');\n        }\n        if (!Object.hasOwn(parser, 'match')) {\n          throw new Error('parser object missing required \"match\" property');\n        } else if (typeof parser.match !== 'string') {\n          throw new Error('parser object \"match\" property must be a string');\n        }\n        if (!Object.hasOwn(parser, 'handler')) {\n          throw new Error('parser object missing required \"handler\" property');\n        } else if (typeof parser.handler !== 'function') {\n          throw new Error('parser object \"handler\" property must be a function');\n        }\n        if (Object.hasOwn(parser, 'profiles') && !Array.isArray(parser.profiles)) {\n          throw new Error('parser object \"profiles\" property must be an array');\n        }\n\n        // Check for an existing parser with the same name.\n        if (parsersHas(parser.name)) {\n          throw new Error(\"cannot clobber existing parser \\\"\".concat(parser.name, \"\\\"\"));\n        }\n\n        // Add the parser to the end of the array.\n        _parsers.push(parser);\n      }\n      function parsersDelete(name) {\n        var parser = _parsers.find(function (parser) {\n          return parser.name === name;\n        });\n        if (parser) {\n          _parsers.delete(parser);\n        }\n      }\n      function parsersIsEmpty() {\n        return _parsers.length === 0;\n      }\n      function parsersHas(name) {\n        return !!_parsers.find(function (parser) {\n          return parser.name === name;\n        });\n      }\n      function parsersGet(name) {\n        return _parsers.find(function (parser) {\n          return parser.name === name;\n        }) || null;\n      }\n\n      /*\n      \tParser Profile Functions.\n      */\n      function profilesGetter() {\n        return _profiles;\n      }\n      function profilesCompile() {\n        if (BUILD_DEBUG) {\n          console.log('[Wikifier.Parser/profilesCompile()]');\n        }\n        var all = _parsers;\n        var core = all.filter(function (parser) {\n          return !Array.isArray(parser.profiles) || parser.profiles.includes('core');\n        });\n        _profiles = Object.freeze({\n          all: {\n            parsers: all,\n            parserRegExp: new RegExp(all.map(function (parser) {\n              return \"(\".concat(parser.match, \")\");\n            }).join('|'), 'gm')\n          },\n          core: {\n            parsers: core,\n            parserRegExp: new RegExp(core.map(function (parser) {\n              return \"(\".concat(parser.match, \")\");\n            }).join('|'), 'gm')\n          }\n        });\n        return _profiles;\n      }\n      function profilesIsEmpty() {\n        return _typeof(_profiles) !== 'object' || Object.keys(_profiles).length === 0;\n      }\n      function profilesGet(profile) {\n        if (_typeof(_profiles) !== 'object' || !Object.hasOwn(_profiles, profile)) {\n          throw new Error(\"nonexistent parser profile \\\"\".concat(profile, \"\\\"\"));\n        }\n        return _profiles[profile];\n      }\n      function profilesHas(profile) {\n        return _typeof(_profiles) === 'object' && Object.hasOwn(_profiles, profile);\n      }\n\n      /*\n      \tExports.\n      */\n      return Object.preventExtensions(Object.create(null, {\n        /*\n        \tParser Containers.\n        */\n        parsers: {\n          get: parsersGetter\n        },\n        /*\n        \tParser Functions.\n        */\n        add: {\n          value: parsersAdd\n        },\n        delete: {\n          value: parsersDelete\n        },\n        isEmpty: {\n          value: parsersIsEmpty\n        },\n        has: {\n          value: parsersHas\n        },\n        get: {\n          value: parsersGet\n        },\n        /*\n        \tParser Profile.\n        */\n        Profile: {\n          value: Object.preventExtensions(Object.create(null, {\n            /*\n            \tProfiles Containers.\n            */\n            profiles: {\n              get: profilesGetter\n            },\n            /*\n            \tProfiles Functions.\n            */\n            compile: {\n              value: profilesCompile\n            },\n            isEmpty: {\n              value: profilesIsEmpty\n            },\n            has: {\n              value: profilesHas\n            },\n            get: {\n              value: profilesGet\n            }\n          }))\n        }\n      }));\n    }()\n  });\n\n  /*******************************************************************************\n  \tAdditional Static Properties.\n  *******************************************************************************/\n\n  Object.defineProperties(Wikifier, {\n    helpers: {\n      value: {}\n    },\n    /*\n    \tLegacy Aliases.\n    */\n    isExternalLink: {\n      value: isExternalLink\n    },\n    getValue: {\n      value: State.getVar\n    },\n    // SEE: `state.js`.\n    setValue: {\n      value: State.setVar\n    },\n    // SEE: `state.js`.\n    parse: {\n      value: Scripting.desugar\n    },\n    // SEE: `markup/scripting.js`.\n    evalExpression: {\n      value: Scripting.evalTwineScript\n    },\n    // SEE: `markup/scripting.js`.\n    evalStatements: {\n      value: Scripting.evalTwineScript\n    },\n    // SEE: `markup/scripting.js`.\n    textPrimitives: {\n      value: Patterns\n    } // SEE: `lib/patterns.js`.\n  });\n\n  /*******************************************************************************\n  \tHelper Static Methods.\n  *******************************************************************************/\n\n  Object.defineProperties(Wikifier.helpers, {\n    inlineCss: {\n      value: function () {\n        var lookaheadRe = new RegExp(Patterns.inlineCss, 'gm');\n        var idOrClassRe = new RegExp(\"(\".concat(Patterns.cssIdOrClassSigil, \")(\").concat(Patterns.anyLetter, \"+)\"), 'g');\n        function helperInlineCss(w) {\n          var css = {\n            classes: [],\n            id: '',\n            styles: {}\n          };\n          var matched;\n          do {\n            lookaheadRe.lastIndex = w.nextMatch;\n            var match = lookaheadRe.exec(w.source);\n            matched = match && match.index === w.nextMatch;\n            if (matched) {\n              if (match[1]) {\n                css.styles[cssPropToDOMProp(match[1])] = match[2].trim();\n              } else if (match[3]) {\n                css.styles[cssPropToDOMProp(match[3])] = match[4].trim();\n              } else if (match[5]) {\n                var subMatch = void 0;\n                idOrClassRe.lastIndex = 0; // NOTE: Guard against buggy implementations.\n\n                while ((subMatch = idOrClassRe.exec(match[5])) !== null) {\n                  if (subMatch[1] === '.') {\n                    css.classes.push(subMatch[2]);\n                  } else {\n                    css.id = subMatch[2];\n                  }\n                }\n              }\n              w.nextMatch = lookaheadRe.lastIndex; // eslint-disable-line no-param-reassign\n            }\n          } while (matched);\n          return css;\n        }\n        return helperInlineCss;\n      }()\n    },\n    evalText: {\n      value: function value(text) {\n        var result;\n        try {\n          result = Scripting.evalTwineScript(text);\n\n          /*\n          \tAttempt to prevent the leakage of auto-globals by enforcing that\n          \tthe resultant value be either a string or a number.\n          \t\tNOTE: This is not a foolproof solution to the problem of auto-global\n          \tleakage.  Various auto-globals, which return strings or numbers, can\n          \tstill leak through—e.g. `window.status` → string.\n          */\n          switch (_typeof(result)) {\n            case 'string':\n              if (result.trim() === '') {\n                result = text;\n              }\n              break;\n            case 'number':\n              result = String(result);\n              break;\n            default:\n              result = text;\n              break;\n          }\n        } catch (ex) {\n          result = text;\n        }\n        return result;\n      }\n    },\n    evalPassageId: {\n      value: function value(passage) {\n        if (passage == null || Story.has(passage)) {\n          // lazy equality for null; `0` is a valid name, so we cannot simply evaluate `passage`\n          return passage;\n        }\n        return Wikifier.helpers.evalText(passage);\n      }\n    },\n    hasBlockContext: {\n      value: function value(nodes) {\n        var hasGCS = typeof window.getComputedStyle === 'function';\n        for (var i = nodes.length - 1; i >= 0; --i) {\n          var node = nodes[i];\n          switch (node.nodeType) {\n            case Node.ELEMENT_NODE:\n              {\n                var tagName = node.nodeName.toUpperCase();\n                if (tagName === 'BR') {\n                  return true;\n                }\n                var styles = hasGCS ? window.getComputedStyle(node, null) : node.currentStyle;\n                if (styles && styles.display) {\n                  if (styles.display === 'none') {\n                    continue;\n                  }\n                  return styles.display === 'block';\n                }\n\n                /*\n                \tWebKit/Blink-based browsers do not attach any computed style\n                \tinformation to elements until they're inserted into the DOM\n                \t(and probably visible), not even the default browser styles\n                \tand any user styles.  So, we make an assumption based on the\n                \telement.\n                */\n                switch (tagName) {\n                  case 'ADDRESS':\n                  case 'ARTICLE':\n                  case 'ASIDE':\n                  case 'BLOCKQUOTE':\n                  case 'CENTER':\n                  case 'DIV':\n                  case 'DL':\n                  case 'FIGURE':\n                  case 'FOOTER':\n                  case 'FORM':\n                  case 'H1':\n                  case 'H2':\n                  case 'H3':\n                  case 'H4':\n                  case 'H5':\n                  case 'H6':\n                  case 'HEADER':\n                  case 'HR':\n                  case 'MAIN':\n                  case 'NAV':\n                  case 'OL':\n                  case 'P':\n                  case 'PRE':\n                  case 'SECTION':\n                  case 'TABLE':\n                  case 'UL':\n                    return true;\n                }\n                return false;\n              }\n            case Node.COMMENT_NODE:\n              continue;\n            default:\n              return false;\n          }\n        }\n        return true;\n      }\n    },\n    shadowHandler: {\n      value: function () {\n        var macroParser = null;\n        function cacheMacroParser() {\n          if (!macroParser) {\n            macroParser = Wikifier.Parser.get('macro');\n            if (!macroParser) {\n              throw new Error('cannot find \"macro\" parser');\n            }\n          }\n          return macroParser;\n        }\n        function helperShadowHandler(code) {\n          var shadowStore = Object.create(null);\n          if (!macroParser) {\n            cacheMacroParser();\n          }\n          if (macroParser.context) {\n            macroParser.context.shadowView.forEach(function (varName) {\n              var varKey = varName.slice(1);\n              var store = varName[0] === '$' ? State.variables : State.temporary;\n              shadowStore[varName] = store[varKey];\n            });\n          }\n          return function () {\n            var shadowNames = Object.keys(shadowStore);\n            var valueCache = shadowNames.length > 0 ? {} : null;\n\n            /*\n            \tThere's no catch clause because this try/finally is here simply to ensure that\n            \tproper cleanup is done in the event that an exception is thrown during the\n            \tevaluation.\n            */\n            try {\n              /*\n              \tCache the existing values of the variables to be shadowed and assign the\n              \tshadow values.\n              */\n              shadowNames.forEach(function (varName) {\n                var varKey = varName.slice(1);\n                var store = varName[0] === '$' ? State.variables : State.temporary;\n                if (Object.hasOwn(store, varKey)) {\n                  valueCache[varKey] = store[varKey];\n                }\n                store[varKey] = shadowStore[varName];\n              });\n\n              // Evaluate the JavaScript.\n              return Scripting.evalJavaScript(code);\n            } finally {\n              // Revert the variable shadowing.\n              shadowNames.forEach(function (varName) {\n                var varKey = varName.slice(1);\n                var store = varName[0] === '$' ? State.variables : State.temporary;\n\n                /*\n                \tUpdate the shadow store with the variable's current value, in case it\n                \twas modified during the callback.\n                */\n                shadowStore[varName] = store[varKey];\n                if (Object.hasOwn(valueCache, varKey)) {\n                  store[varKey] = valueCache[varKey];\n                } else {\n                  delete store[varKey];\n                }\n              });\n            }\n          };\n        }\n        return helperShadowHandler;\n      }()\n    },\n    /* legacy */\n    // createShadowSetterCallback : {\n    // \tvalue : Wikifier.helpers.shadowHandler\n    // },\n    /* /legacy */\n\n    parseSquareBracketedMarkup: {\n      value: function () {\n        /* eslint-disable no-param-reassign */\n        // Lex item types object.\n        var Item = Lexer.enumFromNames(['Error',\n        // error\n        'DelimLTR',\n        // '|' or '->'\n        'DelimRTL',\n        // '<-'\n        'InnerMeta',\n        // ']['\n        'ImageMeta',\n        // '[img[', '[<img[', or '[>img['\n        'LinkMeta',\n        // '[['\n        'Link',\n        // link destination\n        'RightMeta',\n        // ']]'\n        'Setter',\n        // setter expression\n        'Source',\n        // image source\n        'Text' // link text or image alt text\n        ]);\n\n        // Delimiter state object.\n        var Delim = Lexer.enumFromNames(['None',\n        // no delimiter encountered\n        'LTR',\n        // '|' or '->'\n        'RTL' // '<-'\n        ]);\n\n        // Lexing functions.\n        function slurpQuote(lexer, endQuote) {\n          loop: for (;;) {\n            /* eslint-disable indent */\n            switch (lexer.next()) {\n              case '\\\\':\n                {\n                  var ch = lexer.next();\n                  if (ch !== EOF && ch !== '\\n') {\n                    break;\n                  }\n                }\n              /* falls through */\n              case EOF:\n              case '\\n':\n                return EOF;\n              case endQuote:\n                break loop;\n            }\n            /* eslint-enable indent */\n          }\n          return lexer.pos;\n        }\n        function lexLeftMeta(lexer) {\n          if (!lexer.accept('[')) {\n            return lexer.error(Item.Error, 'malformed square-bracketed markup');\n          }\n\n          // Is link markup.\n          if (lexer.accept('[')) {\n            lexer.data.isLink = true;\n            lexer.emit(Item.LinkMeta);\n          }\n\n          // May be image markup.\n          else {\n            lexer.accept('<>'); // aligner syntax\n\n            if (!lexer.accept('Ii') || !lexer.accept('Mm') || !lexer.accept('Gg') || !lexer.accept('[')) {\n              return lexer.error(Item.Error, 'malformed square-bracketed markup');\n            }\n            lexer.data.isLink = false;\n            lexer.emit(Item.ImageMeta);\n          }\n          lexer.depth = 2; // account for both initial left square brackets\n          return lexCoreComponents;\n        }\n        function lexCoreComponents(lexer) {\n          var what = lexer.data.isLink ? 'link' : 'image';\n          var delim = Delim.None;\n          for (;;) {\n            switch (lexer.next()) {\n              case EOF:\n              case '\\n':\n                return lexer.error(Item.Error, \"unterminated \".concat(what, \" markup\"));\n              case '\"':\n                /*\n                \tThis is not entirely reliable within sections that allow raw strings, since\n                \tit's possible, however unlikely, for a raw string to contain unpaired double\n                \tquotes.  The likelihood is low enough, however, that I'm deeming the risk as\n                \tacceptable—for now, at least.\n                */\n                if (slurpQuote(lexer, '\"') === EOF) {\n                  return lexer.error(Item.Error, \"unterminated double quoted string in \".concat(what, \" markup\"));\n                }\n                break;\n              case '|':\n                // possible pipe ('|') delimiter\n                if (delim === Delim.None) {\n                  delim = Delim.LTR;\n                  lexer.backup();\n                  lexer.emit(Item.Text);\n                  lexer.forward();\n                  lexer.emit(Item.DelimLTR);\n                  // lexer.ignore();\n                }\n                break;\n              case '-':\n                // possible right arrow ('->') delimiter\n                if (delim === Delim.None && lexer.peek() === '>') {\n                  delim = Delim.LTR;\n                  lexer.backup();\n                  lexer.emit(Item.Text);\n                  lexer.forward(2);\n                  lexer.emit(Item.DelimLTR);\n                  // lexer.ignore();\n                }\n                break;\n              case '<':\n                // possible left arrow ('<-') delimiter\n                if (delim === Delim.None && lexer.peek() === '-') {\n                  delim = Delim.RTL;\n                  lexer.backup();\n                  lexer.emit(lexer.data.isLink ? Item.Link : Item.Source);\n                  lexer.forward(2);\n                  lexer.emit(Item.DelimRTL);\n                  // lexer.ignore();\n                }\n                break;\n              case '[':\n                ++lexer.depth;\n                break;\n              case ']':\n                {\n                  --lexer.depth;\n                  if (lexer.depth === 1) {\n                    switch (lexer.peek()) {\n                      case '[':\n                        ++lexer.depth;\n                        lexer.backup();\n                        if (delim === Delim.RTL) {\n                          lexer.emit(Item.Text);\n                        } else {\n                          lexer.emit(lexer.data.isLink ? Item.Link : Item.Source);\n                        }\n                        lexer.forward(2);\n                        lexer.emit(Item.InnerMeta);\n                        // lexer.ignore();\n                        return lexer.data.isLink ? lexSetter : lexImageLink;\n                      case ']':\n                        --lexer.depth;\n                        lexer.backup();\n                        if (delim === Delim.RTL) {\n                          lexer.emit(Item.Text);\n                        } else {\n                          lexer.emit(lexer.data.isLink ? Item.Link : Item.Source);\n                        }\n                        lexer.forward(2);\n                        lexer.emit(Item.RightMeta);\n                        // lexer.ignore();\n                        return null;\n                      default:\n                        return lexer.error(Item.Error, \"malformed \".concat(what, \" markup\"));\n                    }\n                  }\n                  break;\n                }\n            }\n          }\n        }\n        function lexImageLink(lexer) {\n          var what = lexer.data.isLink ? 'link' : 'image';\n          for (;;) {\n            switch (lexer.next()) {\n              case EOF:\n              case '\\n':\n                return lexer.error(Item.Error, \"unterminated \".concat(what, \" markup\"));\n              case '\"':\n                /*\n                \tThis is not entirely reliable within sections that allow raw strings, since\n                \tit's possible, however unlikely, for a raw string to contain unpaired double\n                \tquotes.  The likelihood is low enough, however, that I'm deeming the risk as\n                \tacceptable—for now, at least.\n                */\n                if (slurpQuote(lexer, '\"') === EOF) {\n                  return lexer.error(Item.Error, \"unterminated double quoted string in \".concat(what, \" markup link component\"));\n                }\n                break;\n              case '[':\n                ++lexer.depth;\n                break;\n              case ']':\n                {\n                  --lexer.depth;\n                  if (lexer.depth === 1) {\n                    switch (lexer.peek()) {\n                      case '[':\n                        {\n                          ++lexer.depth;\n                          lexer.backup();\n                          lexer.emit(Item.Link);\n                          lexer.forward(2);\n                          lexer.emit(Item.InnerMeta);\n                          // lexer.ignore();\n                          return lexSetter;\n                        }\n                      case ']':\n                        {\n                          --lexer.depth;\n                          lexer.backup();\n                          lexer.emit(Item.Link);\n                          lexer.forward(2);\n                          lexer.emit(Item.RightMeta);\n                          // lexer.ignore();\n                          return null;\n                        }\n                      default:\n                        return lexer.error(Item.Error, \"malformed \".concat(what, \" markup\"));\n                    }\n                  }\n                  break;\n                }\n            }\n          }\n        }\n        function lexSetter(lexer) {\n          var what = lexer.data.isLink ? 'link' : 'image';\n          for (;;) {\n            switch (lexer.next()) {\n              case EOF:\n              case '\\n':\n                return lexer.error(Item.Error, \"unterminated \".concat(what, \" markup\"));\n              case '\"':\n                if (slurpQuote(lexer, '\"') === EOF) {\n                  return lexer.error(Item.Error, \"unterminated double quoted string in \".concat(what, \" markup setter component\"));\n                }\n                break;\n              case \"'\":\n                if (slurpQuote(lexer, \"'\") === EOF) {\n                  return lexer.error(Item.Error, \"unterminated single quoted string in \".concat(what, \" markup setter component\"));\n                }\n                break;\n              case '[':\n                ++lexer.depth;\n                break;\n              case ']':\n                {\n                  --lexer.depth;\n                  if (lexer.depth === 1) {\n                    if (lexer.peek() !== ']') {\n                      return lexer.error(Item.Error, \"malformed \".concat(what, \" markup\"));\n                    }\n                    --lexer.depth;\n                    lexer.backup();\n                    lexer.emit(Item.Setter);\n                    lexer.forward(2);\n                    lexer.emit(Item.RightMeta);\n                    // lexer.ignore();\n                    return null;\n                  }\n                  break;\n                }\n            }\n          }\n        }\n\n        // Parse function.\n        function parseSquareBracketedMarkup(w) {\n          // Initialize the lexer.\n          var lexer = new Lexer(w.source, lexLeftMeta);\n\n          // Set the initial positions within the source string.\n          lexer.start = lexer.pos = w.matchStart;\n\n          // Lex the raw argument string.\n          var markup = {};\n          var items = lexer.run();\n          var last = items.last();\n          if (last && last.type === Item.Error) {\n            markup.error = last.message;\n          } else {\n            items.forEach(function (item) {\n              var text = item.text.trim();\n              switch (item.type) {\n                case Item.ImageMeta:\n                  markup.isImage = true;\n                  if (text[1] === '<') {\n                    markup.align = 'left';\n                  } else if (text[1] === '>') {\n                    markup.align = 'right';\n                  }\n                  break;\n                case Item.LinkMeta:\n                  markup.isLink = true;\n                  break;\n                case Item.Link:\n                  if (text[0] === '~') {\n                    markup.forceInternal = true;\n                    markup.link = text.slice(1);\n                  } else {\n                    markup.link = text;\n                  }\n                  break;\n                case Item.Setter:\n                  markup.setter = text;\n                  break;\n                case Item.Source:\n                  markup.source = text;\n                  break;\n                case Item.Text:\n                  markup.text = text;\n                  break;\n              }\n            });\n          }\n          markup.pos = lexer.pos;\n          return markup;\n        }\n        return parseSquareBracketedMarkup;\n        /* eslint-enable no-param-reassign */\n      }()\n    }\n  });\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Wikifier;\n}();\n/* eslint-enable max-len */\n\n/***********************************************************************************************************************\n\n\tmarkup/parserlib.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Config, DebugView, EOF, Engine, Lexer, Macro, MacroContext, Patterns, Scripting, State, Story, Template,\n\t       Wikifier, stringFrom, appendError\n*/\n/* eslint \"no-param-reassign\": [ 2, { \"props\" : false } ] */\n\n(function () {\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function _verbatimTagHandler(w) {\n    this.lookahead.lastIndex = w.matchStart;\n    var match = this.lookahead.exec(w.source);\n    if (match && match.index === w.matchStart) {\n      w.nextMatch = this.lookahead.lastIndex;\n      jQuery(document.createDocumentFragment()).append(match[1]).appendTo(w.output);\n    }\n  }\n\n  /*******************************************************************************\n  \tParsers.\n  *******************************************************************************/\n\n  Wikifier.Parser.add({\n    name: 'quoteByBlock',\n    profiles: ['block'],\n    match: '^<<<\\\\n',\n    terminator: '^<<<\\\\n',\n    handler: function handler(w) {\n      if (!Wikifier.helpers.hasBlockContext(w.output.childNodes)) {\n        jQuery(w.output).append(document.createTextNode(w.matchText));\n        return;\n      }\n      w.subWikify(jQuery(document.createElement('blockquote')).appendTo(w.output).get(0), this.terminator);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'quoteByLine',\n    profiles: ['block'],\n    match: '^>+',\n    lookahead: /^>+/gm,\n    terminator: '\\\\n',\n    handler: function handler(w) {\n      if (!Wikifier.helpers.hasBlockContext(w.output.childNodes)) {\n        jQuery(w.output).append(document.createTextNode(w.matchText));\n        return;\n      }\n      var destStack = [w.output];\n      var curLevel = 0;\n      var newLevel = w.matchLength;\n      var matched;\n      var i;\n      do {\n        if (newLevel > curLevel) {\n          for (i = curLevel; i < newLevel; ++i) {\n            destStack.push(jQuery(document.createElement('blockquote')).appendTo(destStack[destStack.length - 1]).get(0));\n          }\n        } else if (newLevel < curLevel) {\n          for (i = curLevel; i > newLevel; --i) {\n            destStack.pop();\n          }\n        }\n        curLevel = newLevel;\n        w.subWikify(destStack[destStack.length - 1], this.terminator);\n        jQuery(document.createElement('br')).appendTo(destStack[destStack.length - 1]);\n        this.lookahead.lastIndex = w.nextMatch;\n        var match = this.lookahead.exec(w.source);\n        matched = match && match.index === w.nextMatch;\n        if (matched) {\n          newLevel = match[0].length;\n          w.nextMatch += match[0].length;\n        }\n      } while (matched);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'macro',\n    profiles: ['core'],\n    match: '<<',\n    lookahead: new RegExp(\"<<(/?\".concat(Patterns.macroName, \")(?:\\\\s*)((?:(?:/\\\\*[^*]*\\\\*+(?:[^/*][^*]*\\\\*+)*/)|(?://.*\\\\n)|(?:`(?:\\\\\\\\.|[^`\\\\\\\\])*`)|(?:\\\"(?:\\\\\\\\.|[^\\\"\\\\\\\\])*\\\")|(?:'(?:\\\\\\\\.|[^'\\\\\\\\])*')|(?:\\\\[(?:[<>]?[Ii][Mm][Gg])?\\\\[[^\\\\r\\\\n]*?\\\\]\\\\]+)|[^>]|(?:>(?!>)))*)>>\"), 'gm'),\n    working: {\n      source: '',\n      name: '',\n      arguments: '',\n      index: 0\n    },\n    // the working parse object\n    context: null,\n    // last execution context object (top-level macros, hierarchically, have a null context)\n    handler: function handler(w) {\n      var matchStart = this.lookahead.lastIndex = w.matchStart;\n      if (this.parseTag(w)) {\n        /*\n        \tIf `parseBody()` is called below, it will modify the current working\n        \tvalues, so we must cache them now.\n        */\n        var nextMatch = w.nextMatch;\n        var name = this.working.name;\n        var rawArgs = this.working.arguments;\n        var macro;\n        try {\n          macro = Macro.get(name);\n          if (macro) {\n            var payload = null;\n            if (typeof macro.tags !== 'undefined') {\n              payload = this.parseBody(w, macro);\n              if (!payload) {\n                w.nextMatch = nextMatch; // we must reset `w.nextMatch` here, as `parseBody()` modifies it\n                return appendError(w.output, \"cannot find a closing tag for macro <<\".concat(name, \">>\"), \"\".concat(w.source.slice(matchStart, w.nextMatch), \"\\u2026\"));\n              }\n            }\n            if (typeof macro.handler === 'function') {\n              var args = !payload ? this.createArgs(rawArgs, this.skipArgs(macro, macro.name)) : payload[0].args;\n\n              /*\n              \tNew-style macros.\n              */\n              if (typeof macro._MACRO_API !== 'undefined') {\n                /*\n                \tAdd the macro's execution context to the context chain.\n                */\n                this.context = new MacroContext({\n                  macro: macro,\n                  name: name,\n                  args: args,\n                  payload: payload,\n                  source: w.source.slice(matchStart, w.nextMatch),\n                  parent: this.context,\n                  parser: w\n                });\n\n                /*\n                \tCall the handler.\n                \t\tNOTE: There's no catch clause here because this try/finally exists solely\n                \tto ensure that the execution context is properly restored in the event\n                \tthat an uncaught exception is thrown during the handler call.\n                */\n                try {\n                  macro.handler.call(this.context);\n                  /*\n                  \tQUESTION: Swap to the following, which passes macro arguments in\n                  \tas parameters to the handler function, in addition to them being\n                  \tavailable on its `this`?  If so, it might still be something to\n                  \thold off on until v3, when the legacy macro API is removed.\n                  \t\tmacro.handler.apply(this.context, this.context.args);\n                  */\n                } finally {\n                  this.context = this.context.parent;\n                }\n              }\n\n              /*\n              \t[DEPRECATED] Old-style/legacy macros.\n              */else {\n                console.warn(\"[DEPRECATED] The legacy macro API, used by <<\".concat(name, \">>, is deprecated.\"));\n\n                /*\n                \tSet up the raw arguments string.\n                */\n                var prevRawArgs = w._rawArgs;\n                w._rawArgs = rawArgs;\n\n                /*\n                \tCall the handler.\n                \t\tNOTE: There's no catch clause here because this try/finally exists solely\n                \tto ensure that the previous raw arguments string is properly restored in\n                \tthe event that an uncaught exception is thrown during the handler call.\n                */\n                try {\n                  macro.handler(w.output, name, args, w, payload);\n                } finally {\n                  w._rawArgs = prevRawArgs;\n                }\n              }\n            } else {\n              return appendError(w.output, \"macro <<\".concat(name, \">> handler function \").concat(typeof macro.handler === 'undefined' ? 'does not exist' : 'is not a function'), w.source.slice(matchStart, w.nextMatch));\n            }\n          } else if (Macro.tags.has(name)) {\n            var tags = Macro.tags.get(name);\n            return appendError(w.output, \"child tag <<\".concat(name, \">> was found outside of a call to its parent macro\").concat(tags.length === 1 ? '' : 's', \" <<\").concat(tags.join('>>, <<'), \">>\"), w.source.slice(matchStart, w.nextMatch));\n          } else {\n            return appendError(w.output, \"macro <<\".concat(name, \">> does not exist\"), w.source.slice(matchStart, w.nextMatch));\n          }\n        } catch (ex) {\n          return appendError(w.output, \"cannot execute \".concat(macro && macro.isWidget ? 'widget' : 'macro', \" <<\").concat(name, \">>: \").concat(ex.message), w.source.slice(matchStart, w.nextMatch));\n        } finally {\n          this.working.source = '';\n          this.working.name = '';\n          this.working.arguments = '';\n          this.working.index = 0;\n        }\n      } else {\n        w.outputText(w.output, w.matchStart, w.nextMatch);\n      }\n    },\n    parseTag: function parseTag(w) {\n      var match = this.lookahead.exec(w.source);\n      if (match && match.index === w.matchStart && match[1]) {\n        w.nextMatch = this.lookahead.lastIndex;\n        this.working.source = w.source.slice(match.index, this.lookahead.lastIndex);\n        this.working.name = match[1];\n        this.working.arguments = match[2];\n        this.working.index = match.index;\n        return true;\n      }\n      return false;\n    },\n    parseBody: function parseBody(w, macro) {\n      var openTag = this.working.name;\n      var closeTag = \"/\".concat(openTag);\n      var closeAlt = \"end\".concat(openTag);\n      var bodyTags = Array.isArray(macro.tags) ? macro.tags : false;\n      var payload = [];\n      var end = -1;\n      var opened = 1;\n      var curSource = this.working.source;\n      var curTag = this.working.name;\n      var curArgument = this.working.arguments;\n      var contentStart = w.nextMatch;\n      while ((w.matchStart = w.source.indexOf(this.match, w.nextMatch)) !== -1) {\n        if (!this.parseTag(w)) {\n          this.lookahead.lastIndex = w.nextMatch = w.matchStart + this.match.length;\n          continue;\n        }\n        var tagSource = this.working.source;\n        var tagName = this.working.name;\n        var tagArgs = this.working.arguments;\n        var tagBegin = this.working.index;\n        var tagEnd = w.nextMatch;\n        var hasArgs = tagArgs.trim() !== '';\n        switch (tagName) {\n          case openTag:\n            ++opened;\n            break;\n          case closeAlt:\n          case closeTag:\n            {\n              if (hasArgs) {\n                // Skip over malformed closing tags and throw.\n                w.nextMatch = tagBegin + 2 + tagName.length;\n                throw new Error(\"malformed closing tag: \\\"\".concat(tagSource, \"\\\"\"));\n              }\n              --opened;\n              break;\n            }\n          default:\n            {\n              if (hasArgs && (tagName.startsWith('/') || tagName.startsWith('end'))) {\n                // Skip over malformed alien closing tags.\n                this.lookahead.lastIndex = w.nextMatch = tagBegin + 2 + tagName.length;\n                continue;\n              }\n              if (opened === 1 && bodyTags) {\n                for (var i = 0, iend = bodyTags.length; i < iend; ++i) {\n                  if (tagName === bodyTags[i]) {\n                    payload.push({\n                      source: curSource,\n                      name: curTag,\n                      arguments: curArgument,\n                      args: this.createArgs(curArgument, this.skipArgs(macro, curTag)),\n                      contents: w.source.slice(contentStart, tagBegin)\n                    });\n                    curSource = tagSource;\n                    curTag = tagName;\n                    curArgument = tagArgs;\n                    contentStart = tagEnd;\n                  }\n                }\n              }\n              break;\n            }\n        }\n        if (opened === 0) {\n          payload.push({\n            source: curSource,\n            name: curTag,\n            arguments: curArgument,\n            args: this.createArgs(curArgument, this.skipArgs(macro, curTag)),\n            contents: w.source.slice(contentStart, tagBegin)\n          });\n          end = tagEnd;\n          break;\n        }\n      }\n      if (end !== -1) {\n        w.nextMatch = end;\n        return payload;\n      }\n      return null;\n    },\n    createArgs: function createArgs(rawArgsString, skipArgs) {\n      var args = skipArgs ? [] : this.parseArgs(rawArgsString);\n\n      // Extend the args array with the raw and full argument strings.\n      Object.defineProperties(args, {\n        raw: {\n          value: rawArgsString\n        },\n        full: {\n          value: Scripting.desugar(rawArgsString)\n        }\n      });\n      return args;\n    },\n    skipArgs: function skipArgs(macro, tagName) {\n      if (typeof macro.skipArgs !== 'undefined') {\n        var sa = macro.skipArgs;\n        return typeof sa === 'boolean' && sa || Array.isArray(sa) && sa.includes(tagName);\n      }\n      /* legacy */else if (typeof macro.skipArg0 !== 'undefined') {\n        return macro.skipArg0 && macro.name === tagName;\n      }\n      /* /legacy */\n\n      return false;\n    },\n    parseArgs: function () {\n      // Lex item types object.\n      var Item = Lexer.enumFromNames(['Error',\n      // error\n      'Bareword',\n      // bare identifier\n      'Expression',\n      // expression (backquoted)\n      'String',\n      // quoted string (single or double)\n      'SquareBracket' // [[…]] or [img[…]]\n      ]);\n      var spaceRe = new RegExp(Patterns.space);\n      var notSpaceRe = new RegExp(Patterns.notSpace);\n      var varTest = new RegExp(\"^\".concat(Patterns.variable));\n\n      // Lexing functions.\n      function slurpQuote(lexer, endQuote) {\n        loop: for (;;) {\n          /* eslint-disable indent */\n          switch (lexer.next()) {\n            case '\\\\':\n              {\n                var ch = lexer.next();\n                if (ch !== EOF && ch !== '\\n') {\n                  break;\n                }\n              }\n            /* falls through */\n            case EOF:\n            case '\\n':\n              return EOF;\n            case endQuote:\n              break loop;\n          }\n          /* eslint-enable indent */\n        }\n        return lexer.pos;\n      }\n      function lexSpace(lexer) {\n        var offset = lexer.source.slice(lexer.pos).search(notSpaceRe);\n        if (offset === EOF) {\n          // no non-whitespace characters, so bail\n          return null;\n        } else if (offset !== 0) {\n          lexer.pos += offset;\n          lexer.ignore();\n        }\n\n        // determine what the next state is\n        switch (lexer.next()) {\n          case '`':\n            return lexExpression;\n          case '\"':\n            return lexDoubleQuote;\n          case \"'\":\n            return lexSingleQuote;\n          case '[':\n            return lexSquareBracket;\n          default:\n            return lexBareword;\n        }\n      }\n      function lexExpression(lexer) {\n        if (slurpQuote(lexer, '`') === EOF) {\n          return lexer.error(Item.Error, 'unterminated backquote expression');\n        }\n        lexer.emit(Item.Expression);\n        return lexSpace;\n      }\n      function lexDoubleQuote(lexer) {\n        if (slurpQuote(lexer, '\"') === EOF) {\n          return lexer.error(Item.Error, 'unterminated double quoted string');\n        }\n        lexer.emit(Item.String);\n        return lexSpace;\n      }\n      function lexSingleQuote(lexer) {\n        if (slurpQuote(lexer, \"'\") === EOF) {\n          return lexer.error(Item.Error, 'unterminated single quoted string');\n        }\n        lexer.emit(Item.String);\n        return lexSpace;\n      }\n      function lexSquareBracket(lexer) {\n        var imgMeta = '<>IiMmGg';\n        var what;\n        if (lexer.accept(imgMeta)) {\n          what = 'image';\n          lexer.acceptRun(imgMeta);\n        } else {\n          what = 'link';\n        }\n        if (!lexer.accept('[')) {\n          return lexer.error(Item.Error, \"malformed \".concat(what, \" markup\"));\n        }\n        lexer.depth = 2; // account for both initial left square brackets\n\n        loop: for (;;) {\n          /* eslint-disable indent */\n          switch (lexer.next()) {\n            case '\\\\':\n              {\n                var ch = lexer.next();\n                if (ch !== EOF && ch !== '\\n') {\n                  break;\n                }\n              }\n            /* falls through */\n            case EOF:\n            case '\\n':\n              return lexer.error(Item.Error, \"unterminated \".concat(what, \" markup\"));\n            case '[':\n              ++lexer.depth;\n              break;\n            case ']':\n              --lexer.depth;\n              if (lexer.depth < 0) {\n                return lexer.error(Item.Error, \"unexpected right square bracket ']'\");\n              }\n              if (lexer.depth === 1) {\n                if (lexer.next() === ']') {\n                  --lexer.depth;\n                  break loop;\n                }\n                lexer.backup();\n              }\n              break;\n          }\n          /* eslint-enable indent */\n        }\n        lexer.emit(Item.SquareBracket);\n        return lexSpace;\n      }\n      function lexBareword(lexer) {\n        var offset = lexer.source.slice(lexer.pos).search(spaceRe);\n        lexer.pos = offset === EOF ? lexer.source.length : lexer.pos + offset;\n        lexer.emit(Item.Bareword);\n        return offset === EOF ? null : lexSpace;\n      }\n\n      // Parse function.\n      function parseMacroArgs(rawArgsString) {\n        // Initialize the lexer.\n        var lexer = new Lexer(rawArgsString, lexSpace);\n        var args = [];\n\n        // Lex the raw argument string.\n        lexer.run().forEach(function (item) {\n          var arg = item.text;\n          switch (item.type) {\n            case Item.Error:\n              throw new Error(\"unable to parse macro argument \\\"\".concat(arg, \"\\\": \").concat(item.message));\n            case Item.Bareword:\n              {\n                // A variable, so substitute its value.\n                if (varTest.test(arg)) {\n                  arg = State.getVar(arg);\n                }\n\n                // Property access on the settings or setup objects, so try to evaluate it.\n                else if (/^(?:settings|setup)[.[]/.test(arg)) {\n                  try {\n                    arg = Scripting.evalTwineScript(arg);\n                  } catch (ex) {\n                    throw new Error(\"unable to parse macro argument \\\"\".concat(arg, \"\\\": \").concat(ex.message));\n                  }\n                }\n\n                // Null literal, so convert it into null.\n                else if (arg === 'null') {\n                  arg = null;\n                }\n\n                // Undefined literal, so convert it into undefined.\n                else if (arg === 'undefined') {\n                  arg = undefined;\n                }\n\n                // Boolean true literal, so convert it into true.\n                else if (arg === 'true') {\n                  arg = true;\n                }\n\n                // Boolean false literal, so convert it into false.\n                else if (arg === 'false') {\n                  arg = false;\n                }\n\n                // NaN literal, so convert it into NaN.\n                else if (arg === 'NaN') {\n                  arg = NaN;\n                }\n\n                // Attempt to convert it into a number, in case it's a numeric literal.\n                else {\n                  var argAsNum = Number(arg);\n                  if (!Number.isNaN(argAsNum)) {\n                    arg = argAsNum;\n                  }\n                }\n                break;\n              }\n            case Item.Expression:\n              {\n                arg = arg.slice(1, -1).trim(); // remove the backquotes and trim the expression\n\n                // Empty backquotes.\n                if (arg === '') {\n                  arg = undefined;\n                }\n\n                // Evaluate the expression.\n                else {\n                  try {\n                    /*\n                    \tThe enclosing parenthesis here are necessary to force a code string\n                    \tconsisting solely of an object literal to be evaluated as such, rather\n                    \tthan as a code block.\n                    */\n                    arg = Scripting.evalTwineScript(\"(\".concat(arg, \")\"));\n                  } catch (ex) {\n                    throw new Error(\"unable to parse macro argument expression \\\"\".concat(arg, \"\\\": \").concat(ex.message));\n                  }\n                }\n                break;\n              }\n            case Item.String:\n              {\n                // Evaluate the string to handle escaped characters.\n                try {\n                  arg = Scripting.evalJavaScript(arg);\n                } catch (ex) {\n                  throw new Error(\"unable to parse macro argument string \\\"\".concat(arg, \"\\\": \").concat(ex.message));\n                }\n                break;\n              }\n            case Item.SquareBracket:\n              {\n                var markup = Wikifier.helpers.parseSquareBracketedMarkup({\n                  source: arg,\n                  matchStart: 0\n                });\n                if (Object.hasOwn(markup, 'error')) {\n                  throw new Error(\"unable to parse macro argument \\\"\".concat(arg, \"\\\": \").concat(markup.error));\n                }\n                if (markup.pos < arg.length) {\n                  throw new Error(\"unable to parse macro argument \\\"\".concat(arg, \"\\\": unexpected character(s) \\\"\").concat(arg.slice(markup.pos), \"\\\" (pos: \").concat(markup.pos, \")\"));\n                }\n\n                // Convert to a link or image object.\n                if (markup.isLink) {\n                  // .isLink, [.text], [.forceInternal], .link, [.setter]\n                  arg = {\n                    isLink: true\n                  };\n                  arg.count = Object.hasOwn(markup, 'text') ? 2 : 1;\n                  arg.link = Wikifier.helpers.evalPassageId(markup.link);\n                  arg.text = Object.hasOwn(markup, 'text') ? Wikifier.helpers.evalText(markup.text) : arg.link;\n                  arg.external = !markup.forceInternal && Wikifier.isExternalLink(arg.link);\n                  arg.setFn = Object.hasOwn(markup, 'setter') ? Wikifier.helpers.shadowHandler(Scripting.desugar(markup.setter)) : null;\n                } else if (markup.isImage) {\n                  // .isImage, [.align], [.title], .source, [.forceInternal], [.link], [.setter]\n                  arg = function (source) {\n                    var imgObj = {\n                      source: source,\n                      isImage: true\n                    };\n\n                    // Check for Twine 1.4 Base64 image passage transclusion.\n                    if (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n                      var passage = Story.get(source);\n                      if (passage.tags.includes('Twine.image')) {\n                        imgObj.source = passage.text;\n                        imgObj.passage = passage.name;\n                      }\n                    }\n                    return imgObj;\n                  }(Wikifier.helpers.evalPassageId(markup.source));\n                  if (Object.hasOwn(markup, 'align')) {\n                    arg.align = markup.align;\n                  }\n                  if (Object.hasOwn(markup, 'text')) {\n                    arg.title = Wikifier.helpers.evalText(markup.text);\n                  }\n                  if (Object.hasOwn(markup, 'link')) {\n                    arg.link = Wikifier.helpers.evalPassageId(markup.link);\n                    arg.external = !markup.forceInternal && Wikifier.isExternalLink(arg.link);\n                  }\n                  arg.setFn = Object.hasOwn(markup, 'setter') ? Wikifier.helpers.shadowHandler(Scripting.desugar(markup.setter)) : null;\n                }\n                break;\n              }\n          }\n          args.push(arg);\n        });\n        return args;\n      }\n      return parseMacroArgs;\n    }()\n  });\n  Wikifier.Parser.add({\n    name: 'link',\n    profiles: ['core'],\n    match: '\\\\[\\\\[[^[]',\n    handler: function handler(w) {\n      var markup = Wikifier.helpers.parseSquareBracketedMarkup(w);\n      if (Object.hasOwn(markup, 'error')) {\n        w.outputText(w.output, w.matchStart, w.nextMatch);\n        return;\n      }\n      w.nextMatch = markup.pos;\n\n      // text=(text), forceInternal=(~), link=link, setter=(setter)\n      var link = Wikifier.helpers.evalPassageId(markup.link);\n      var text = Object.hasOwn(markup, 'text') ? Wikifier.helpers.evalText(markup.text) : link;\n      var setFn = Object.hasOwn(markup, 'setter') ? Wikifier.helpers.shadowHandler(Scripting.desugar(markup.setter)) : null;\n\n      // Debug view setup.\n      var output = (Config.debug ? new DebugView(w.output, 'link-markup', '[[link]]', w.source.slice(w.matchStart, w.nextMatch)) : w).output;\n      if (markup.forceInternal || !Wikifier.isExternalLink(link)) {\n        Wikifier.createInternalLink(output, link, text, setFn);\n      } else {\n        Wikifier.createExternalLink(output, link, text);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'urlLink',\n    profiles: ['core'],\n    match: Patterns.url,\n    handler: function handler(w) {\n      w.outputText(Wikifier.createExternalLink(w.output, w.matchText), w.matchStart, w.nextMatch);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'image',\n    profiles: ['core'],\n    match: '\\\\[[<>]?[Ii][Mm][Gg]\\\\[',\n    handler: function handler(w) {\n      var markup = Wikifier.helpers.parseSquareBracketedMarkup(w);\n      if (Object.hasOwn(markup, 'error')) {\n        w.outputText(w.output, w.matchStart, w.nextMatch);\n        return;\n      }\n      w.nextMatch = markup.pos;\n\n      // Debug view setup.\n      var debugView;\n      if (Config.debug) {\n        debugView = new DebugView(w.output, 'image-markup', Object.hasOwn(markup, 'link') ? '[img[][link]]' : '[img[]]', w.source.slice(w.matchStart, w.nextMatch));\n        debugView.modes({\n          block: true\n        });\n      }\n\n      // align=(left|right), title=(title), source=source, forceInternal=(~), link=(link), setter=(setter)\n      var setFn = Object.hasOwn(markup, 'setter') ? Wikifier.helpers.shadowHandler(Scripting.desugar(markup.setter)) : null;\n      var el = (Config.debug ? debugView : w).output;\n      var source;\n      if (Object.hasOwn(markup, 'link')) {\n        var link = Wikifier.helpers.evalPassageId(markup.link);\n        if (markup.forceInternal || !Wikifier.isExternalLink(link)) {\n          el = Wikifier.createInternalLink(el, link, null, setFn);\n        } else {\n          el = Wikifier.createExternalLink(el, link);\n        }\n        el.classList.add('link-image');\n      }\n      el = jQuery(document.createElement('img')).appendTo(el).get(0);\n      source = Wikifier.helpers.evalPassageId(markup.source);\n\n      // Check for image passage transclusion.\n      if (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n        var passage = Story.get(source);\n        if (passage.tags.includes('Twine.image')) {\n          el.setAttribute('data-passage', passage.name);\n          source = passage.text.trim();\n        }\n      }\n      el.src = source;\n      if (Object.hasOwn(markup, 'text')) {\n        el.title = Wikifier.helpers.evalText(markup.text);\n      }\n      if (Object.hasOwn(markup, 'align')) {\n        el.align = markup.align;\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'monospacedByBlock',\n    profiles: ['block'],\n    match: '^\\\\{\\\\{\\\\{\\\\n',\n    lookahead: /^\\{\\{\\{\\n((?:^[^\\n]*\\n)+?)(^\\}\\}\\}$\\n?)/gm,\n    handler: function handler(w) {\n      this.lookahead.lastIndex = w.matchStart;\n      var match = this.lookahead.exec(w.source);\n      if (match && match.index === w.matchStart) {\n        var pre = jQuery(document.createElement('pre'));\n        jQuery(document.createElement('code')).text(match[1]).appendTo(pre);\n        pre.appendTo(w.output);\n        w.nextMatch = this.lookahead.lastIndex;\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'formatByChar',\n    profiles: ['core'],\n    match: \"''|//|__|\\\\^\\\\^|~~|==|\\\\{\\\\{\\\\{\",\n    handler: function handler(w) {\n      switch (w.matchText) {\n        case \"''\":\n          w.subWikify(jQuery(document.createElement('strong')).appendTo(w.output).get(0), \"''\");\n          break;\n        case '//':\n          w.subWikify(jQuery(document.createElement('em')).appendTo(w.output).get(0), '//');\n          break;\n        case '__':\n          w.subWikify(jQuery(document.createElement('u')).appendTo(w.output).get(0), '__');\n          break;\n        case '^^':\n          w.subWikify(jQuery(document.createElement('sup')).appendTo(w.output).get(0), '\\\\^\\\\^');\n          break;\n        case '~~':\n          w.subWikify(jQuery(document.createElement('sub')).appendTo(w.output).get(0), '~~');\n          break;\n        case '==':\n          w.subWikify(jQuery(document.createElement('s')).appendTo(w.output).get(0), '==');\n          break;\n        case '{{{':\n          {\n            var lookahead = /\\{\\{\\{((?:.|\\n)*?)\\}\\}\\}/gm;\n            lookahead.lastIndex = w.matchStart;\n            var match = lookahead.exec(w.source);\n            if (match && match.index === w.matchStart) {\n              jQuery(document.createElement('code')).text(match[1]).appendTo(w.output);\n              w.nextMatch = lookahead.lastIndex;\n            }\n            break;\n          }\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'customStyle',\n    profiles: ['core'],\n    match: '@@',\n    terminator: '@@',\n    blockRe: /\\s*\\n/gm,\n    handler: function handler(w) {\n      var css = Wikifier.helpers.inlineCss(w);\n      this.blockRe.lastIndex = w.nextMatch; // must follow the call to `inlineCss()`\n\n      var blockMatch = this.blockRe.exec(w.source);\n      var blockLevel = blockMatch && blockMatch.index === w.nextMatch;\n      var $el = jQuery(document.createElement(blockLevel ? 'div' : 'span')).appendTo(w.output);\n      if (css.classes.length === 0 && css.id === '' && Object.keys(css.styles).length === 0) {\n        $el.addClass('marked');\n      } else {\n        css.classes.forEach(function (className) {\n          return $el.addClass(className);\n        });\n        if (css.id !== '') {\n          $el.attr('id', css.id);\n        }\n        $el.css(css.styles);\n      }\n      if (blockLevel) {\n        // Skip the leading and, if it exists, trailing newlines.\n        w.nextMatch += blockMatch[0].length;\n        w.subWikify($el[0], \"\\\\n?\".concat(this.terminator));\n      } else {\n        w.subWikify($el[0], this.terminator);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'verbatimText',\n    profiles: ['core'],\n    match: '\"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',\n    lookahead: /(?:\"{3}((?:.|\\n)*?)\"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\\n)*?)<\\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,\n    handler: function handler(w) {\n      this.lookahead.lastIndex = w.matchStart;\n      var match = this.lookahead.exec(w.source);\n      if (match && match.index === w.matchStart) {\n        w.nextMatch = this.lookahead.lastIndex;\n        jQuery(document.createElement('span')).addClass('verbatim').text(match[1] || match[2]).appendTo(w.output);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'horizontalRule',\n    profiles: ['core'],\n    match: '^----+\\\\s*$',\n    handler: function handler(w) {\n      jQuery(document.createElement('hr')).appendTo(w.output);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'emdash',\n    profiles: ['core'],\n    match: '--',\n    handler: function handler(w) {\n      jQuery(document.createTextNode(\"\\u2014\")).appendTo(w.output);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'doubleDollarSign',\n    profiles: ['core'],\n    match: '\\\\${2}',\n    // eslint-disable-line no-template-curly-in-string\n    handler: function handler(w) {\n      jQuery(document.createTextNode('$')).appendTo(w.output);\n    }\n  });\n  Wikifier.Parser.add({\n    /*\n    \tSupported syntax:\n    \t\t$variable\n    \t\t$variable.property\n    \t\t$variable[numericIndex]\n    \t\t$variable[\"property\"]\n    \t\t$variable['property']\n    \t\t$variable[$indexOrPropertyVariable]\n    \t\tNOTE: I really do not like how the initial bit of the regexp matches.\n    */\n    name: 'nakedVariable',\n    profiles: ['core'],\n    match: \"\".concat(Patterns.variable, \"(?:(?:\\\\.\").concat(Patterns.identifier, \")|(?:\\\\[\\\\d+\\\\])|(?:\\\\[\\\"(?:\\\\\\\\.|[^\\\"\\\\\\\\])+\\\"\\\\])|(?:\\\\['(?:\\\\\\\\.|[^'\\\\\\\\])+'\\\\])|(?:\\\\[\").concat(Patterns.variable, \"\\\\]))*\"),\n    handler: function handler(w) {\n      var result = State.getVar(w.matchText);\n      if (result == null) {\n        // lazy equality for null\n        jQuery(document.createTextNode(w.matchText)).appendTo(w.output);\n      } else {\n        new Wikifier((Config.debug ? new DebugView(w.output, 'variable', w.matchText, w.matchText) // Debug view setup.\n        : w).output, stringFrom(result));\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'template',\n    profiles: ['core'],\n    match: \"\\\\?\".concat(Patterns.templateName),\n    handler: function handler(w) {\n      var name = w.matchText.slice(1);\n      var template = Template.get(name);\n      var result = null;\n\n      // If we have an array of templates, randomly choose one.\n      if (template instanceof Array) {\n        template = template.random();\n      }\n      switch (_typeof(template)) {\n        case 'function':\n          {\n            try {\n              result = stringFrom(template.call({\n                name: name\n              }));\n            } catch (ex) {\n              return appendError(w.output, \"cannot execute function template ?\".concat(name, \": \").concat(ex.message), w.source.slice(w.matchStart, w.nextMatch));\n            }\n            break;\n          }\n        case 'string':\n          result = template;\n          break;\n      }\n      if (result === null) {\n        jQuery(document.createTextNode(w.matchText)).appendTo(w.output);\n      } else {\n        new Wikifier((Config.debug ? new DebugView(w.output, 'template', w.matchText, w.matchText) // Debug view setup.\n        : w).output, result);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'heading',\n    profiles: ['block'],\n    match: '^!{1,6}',\n    terminator: '\\\\n',\n    handler: function handler(w) {\n      if (!Wikifier.helpers.hasBlockContext(w.output.childNodes)) {\n        jQuery(w.output).append(document.createTextNode(w.matchText));\n        return;\n      }\n      w.subWikify(jQuery(document.createElement(\"h\".concat(w.matchLength))).appendTo(w.output).get(0), this.terminator);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'table',\n    profiles: ['block'],\n    match: '^\\\\|(?:[^\\\\n]*)\\\\|(?:[fhck]?)$',\n    lookahead: /^\\|([^\\n]*)\\|([fhck]?)$/gm,\n    rowTerminator: '\\\\|(?:[cfhk]?)$\\\\n?',\n    cellPattern: '(?:\\\\|([^\\\\n\\\\|]*)\\\\|)|(\\\\|[cfhk]?$\\\\n?)',\n    cellTerminator: \"(?:\\\\u0020*)\\\\|\",\n    rowTypes: {\n      c: 'caption',\n      f: 'tfoot',\n      h: 'thead',\n      '': 'tbody'\n    },\n    // eslint-disable-line id-length\n    handler: function handler(w) {\n      if (!Wikifier.helpers.hasBlockContext(w.output.childNodes)) {\n        jQuery(w.output).append(document.createTextNode(w.matchText));\n        return;\n      }\n      var table = jQuery(document.createElement('table')).appendTo(w.output).get(0);\n      var prevColumns = [];\n      var curRowType = null;\n      var $rowContainer = null;\n      var rowCount = 0;\n      var matched;\n      w.nextMatch = w.matchStart;\n      do {\n        this.lookahead.lastIndex = w.nextMatch;\n        var match = this.lookahead.exec(w.source);\n        matched = match && match.index === w.nextMatch;\n        if (matched) {\n          var nextRowType = match[2];\n          if (nextRowType === 'k') {\n            table.className = match[1];\n            w.nextMatch += match[0].length + 1;\n          } else {\n            if (nextRowType !== curRowType) {\n              curRowType = nextRowType;\n              $rowContainer = jQuery(document.createElement(this.rowTypes[nextRowType])).appendTo(table);\n            }\n            if (curRowType === 'c') {\n              $rowContainer.css('caption-side', rowCount === 0 ? 'top' : 'bottom');\n              w.nextMatch += 1;\n              w.subWikify($rowContainer[0], this.rowTerminator);\n            } else {\n              this.rowHandler(w, jQuery(document.createElement('tr')).appendTo($rowContainer).get(0), prevColumns);\n            }\n            ++rowCount;\n          }\n        }\n      } while (matched);\n    },\n    rowHandler: function rowHandler(w, rowEl, prevColumns) {\n      var _this10 = this;\n      var cellRe = new RegExp(this.cellPattern, 'gm');\n      var col = 0;\n      var curColCount = 1;\n      var matched;\n      var _loop5 = function _loop5() {\n        cellRe.lastIndex = w.nextMatch;\n        var cellMatch = cellRe.exec(w.source);\n        matched = cellMatch && cellMatch.index === w.nextMatch;\n        if (matched) {\n          if (cellMatch[1] === '~') {\n            var last = prevColumns[col];\n            if (last) {\n              ++last.rowCount;\n              last.$element.attr('rowspan', last.rowCount).css('vertical-align', 'middle');\n            }\n            w.nextMatch = cellMatch.index + cellMatch[0].length - 1;\n          } else if (cellMatch[1] === '>') {\n            ++curColCount;\n            w.nextMatch = cellMatch.index + cellMatch[0].length - 1;\n          } else if (cellMatch[2]) {\n            w.nextMatch = cellMatch.index + cellMatch[0].length;\n            return 1; // break\n          } else {\n            ++w.nextMatch;\n            var css = Wikifier.helpers.inlineCss(w);\n            var spaceLeft = false;\n            var spaceRight = false;\n            var $cell;\n            while (w.source.substr(w.nextMatch, 1) === ' ') {\n              spaceLeft = true;\n              ++w.nextMatch;\n            }\n            if (w.source.substr(w.nextMatch, 1) === '!') {\n              $cell = jQuery(document.createElement('th')).appendTo(rowEl);\n              ++w.nextMatch;\n            } else {\n              $cell = jQuery(document.createElement('td')).appendTo(rowEl);\n            }\n            prevColumns[col] = {\n              rowCount: 1,\n              $element: $cell\n            };\n            if (curColCount > 1) {\n              $cell.attr('colspan', curColCount);\n              curColCount = 1;\n            }\n            w.subWikify($cell[0], _this10.cellTerminator);\n            if (w.matchText.substr(w.matchText.length - 2, 1) === ' ') {\n              spaceRight = true;\n            }\n            css.classes.forEach(function (className) {\n              return $cell.addClass(className);\n            });\n            if (css.id !== '') {\n              $cell.attr('id', css.id);\n            }\n            if (spaceLeft && spaceRight) {\n              css.styles['text-align'] = 'center';\n            } else if (spaceLeft) {\n              css.styles['text-align'] = 'right';\n            } else if (spaceRight) {\n              css.styles['text-align'] = 'left';\n            }\n            $cell.css(css.styles);\n            w.nextMatch = w.nextMatch - 1;\n          }\n          ++col;\n        }\n      };\n      do {\n        if (_loop5()) break;\n      } while (matched);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'list',\n    profiles: ['block'],\n    match: '^(?:(?:\\\\*+)|(?:#+))',\n    lookahead: /^(?:(\\*+)|(#+))/gm,\n    terminator: '\\\\n',\n    handler: function handler(w) {\n      if (!Wikifier.helpers.hasBlockContext(w.output.childNodes)) {\n        jQuery(w.output).append(document.createTextNode(w.matchText));\n        return;\n      }\n      w.nextMatch = w.matchStart;\n      var destStack = [w.output];\n      var curType = null;\n      var curLevel = 0;\n      var matched;\n      var i;\n      do {\n        this.lookahead.lastIndex = w.nextMatch;\n        var match = this.lookahead.exec(w.source);\n        matched = match && match.index === w.nextMatch;\n        if (matched) {\n          var newType = match[2] ? 'ol' : 'ul';\n          var newLevel = match[0].length;\n          w.nextMatch += match[0].length;\n          if (newLevel > curLevel) {\n            for (i = curLevel; i < newLevel; ++i) {\n              destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length - 1]).get(0));\n            }\n          } else if (newLevel < curLevel) {\n            for (i = curLevel; i > newLevel; --i) {\n              destStack.pop();\n            }\n          } else if (newLevel === curLevel && newType !== curType) {\n            destStack.pop();\n            destStack.push(jQuery(document.createElement(newType)).appendTo(destStack[destStack.length - 1]).get(0));\n          }\n          curLevel = newLevel;\n          curType = newType;\n          w.subWikify(jQuery(document.createElement('li')).appendTo(destStack[destStack.length - 1]).get(0), this.terminator);\n        }\n      } while (matched);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'commentByBlock',\n    profiles: ['core'],\n    match: '(?:/(?:%|\\\\*))|(?:<!--)',\n    lookahead: /(?:\\/(%|\\*)(?:(?:.|\\n)*?)\\1\\/)|(?:<!--(?:(?:.|\\n)*?)-->)/gm,\n    handler: function handler(w) {\n      this.lookahead.lastIndex = w.matchStart;\n      var match = this.lookahead.exec(w.source);\n      if (match && match.index === w.matchStart) {\n        w.nextMatch = this.lookahead.lastIndex;\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'lineContinuation',\n    profiles: ['core'],\n    // WARNING: The ordering here is important: end-of-line, start-of-line, end-of-string, start-of-string.\n    match: \"\\\\\\\\\".concat(Patterns.spaceNoTerminator, \"*\\\\n|\\\\n\").concat(Patterns.spaceNoTerminator, \"*\\\\\\\\|\\\\n?\\\\\\\\\").concat(Patterns.spaceNoTerminator, \"*$|^\").concat(Patterns.spaceNoTerminator, \"*\\\\\\\\\\\\n?\"),\n    handler: function handler(w) {\n      w.nextMatch = w.matchStart + w.matchLength;\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'lineBreak',\n    profiles: ['core'],\n    match: '\\\\n',\n    handler: function handler(w) {\n      if (!w.options.nobr) {\n        jQuery(document.createElement('br')).appendTo(w.output);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'htmlCharacterReference',\n    profiles: ['core'],\n    match: '(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)',\n    handler: function handler(w) {\n      jQuery(document.createDocumentFragment()).append(w.matchText).appendTo(w.output);\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'xmlProlog',\n    profiles: ['core'],\n    match: '<\\\\?[Xx][Mm][Ll][^>]*\\\\?>',\n    handler: function handler(w) {\n      w.nextMatch = w.matchStart + w.matchLength;\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'verbatimHtml',\n    profiles: ['core'],\n    match: '<[Hh][Tt][Mm][Ll]>',\n    lookahead: /<[Hh][Tt][Mm][Ll]>((?:.|\\n)*?)<\\/[Hh][Tt][Mm][Ll]>/gm,\n    handler: _verbatimTagHandler\n  });\n  Wikifier.Parser.add({\n    name: 'verbatimScriptTag',\n    profiles: ['core'],\n    match: '<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>',\n    lookahead: /(<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>(?:.|\\n)*?<\\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,\n    handler: _verbatimTagHandler\n  });\n  Wikifier.Parser.add({\n    name: 'styleTag',\n    profiles: ['core'],\n    match: '<[Ss][Tt][Yy][Ll][Ee][^>]*>',\n    lookahead: /(<[Ss][Tt][Yy][Ll][Ee][^>]*>)((?:.|\\n)*?)(<\\/[Ss][Tt][Yy][Ll][Ee]>)/gm,\n    imageMarkup: new RegExp(Patterns.cssImage, 'g'),\n    hasImageMarkup: new RegExp(Patterns.cssImage),\n    handler: function handler(w) {\n      this.lookahead.lastIndex = w.matchStart;\n      var match = this.lookahead.exec(w.source);\n      if (match && match.index === w.matchStart) {\n        w.nextMatch = this.lookahead.lastIndex;\n        var css = match[2];\n\n        // Check for wiki image transclusion.\n        if (this.hasImageMarkup.test(css)) {\n          this.imageMarkup.lastIndex = 0;\n          css = css.replace(this.imageMarkup, function (wikiImage) {\n            var markup = Wikifier.helpers.parseSquareBracketedMarkup({\n              source: wikiImage,\n              matchStart: 0\n            });\n            if (Object.hasOwn(markup, 'error') || markup.pos < wikiImage.length) {\n              return wikiImage;\n            }\n            var source = Wikifier.helpers.evalPassageId(markup.source);\n\n            // Handle image passage transclusion.\n            if (source.slice(0, 5) !== 'data:' && Story.has(source)) {\n              var passage = Story.get(source);\n              if (passage.tags.includes('Twine.image')) {\n                source = passage.text;\n              }\n            }\n\n            /*\n            \tThe source may be URI- or Base64-encoded, so we cannot use `encodeURIComponent()`\n            \there.  Instead, we simply encode any double quotes, since the URI will be\n            \tdelimited by them.\n            */\n            return \"url(\\\"\".concat(source.replace(/\"/g, '%22'), \"\\\")\");\n          });\n        }\n        jQuery(document.createDocumentFragment()).append(match[1] + css + match[3]).appendTo(w.output);\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    name: 'svgTag',\n    profiles: ['core'],\n    match: '<[Ss][Vv][Gg][^>]*>',\n    lookahead: /<(\\/?)[Ss][Vv][Gg][^>]*>/gm,\n    namespace: 'http://www.w3.org/2000/svg',\n    handler: function handler(w) {\n      var _this11 = this;\n      this.lookahead.lastIndex = w.nextMatch;\n      var depth = 1;\n      var match;\n      while (depth > 0 && (match = this.lookahead.exec(w.source)) !== null) {\n        depth += match[1] === '/' ? -1 : 1;\n      }\n      if (depth === 0) {\n        w.nextMatch = this.lookahead.lastIndex;\n        var svgTag = w.source.slice(w.matchStart, this.lookahead.lastIndex);\n        var $frag = jQuery(document.createDocumentFragment()).append(svgTag);\n\n        // Postprocess the relevant SVG element nodes.\n        $frag.find('a[data-passage],image[data-passage]').each(function (_, el) {\n          var tagName = el.tagName.toLowerCase();\n          try {\n            _this11.processAttributeDirectives(el);\n          } catch (ex) {\n            return appendError(w.output, \"svg|<\".concat(tagName, \">: \").concat(ex.message), \"\".concat(w.matchText, \"\\u2026\"));\n          }\n          if (el.hasAttribute('data-passage')) {\n            _this11.processDataAttributes(el, tagName);\n          }\n        });\n        $frag.appendTo(w.output);\n      }\n    },\n    processAttributeDirectives: function processAttributeDirectives(el) {\n      // NOTE: The `.attributes` property yields a live collection, so we\n      // must make a non-live copy of it as we will be adding and removing\n      // members of said collection if any directives are found.\n      Array.from(el.attributes).forEach(function (_ref11) {\n        var name = _ref11.name,\n          value = _ref11.value;\n        var evalShorthand = name[0] === '@';\n        if (evalShorthand || name.startsWith('sc-eval:')) {\n          var newName = name.slice(evalShorthand ? 1 : 8); // Remove eval directive prefix.\n\n          if (newName === 'data-setter') {\n            throw new Error(\"evaluation directive is not allowed on the data-setter attribute: \\\"\".concat(name, \"\\\"\"));\n          }\n          var result;\n\n          // Evaluate the value as TwineScript.\n          try {\n            result = Scripting.evalTwineScript(value);\n          } catch (ex) {\n            throw new Error(\"bad evaluation from attribute directive \\\"\".concat(name, \"\\\": \").concat(ex.message));\n          }\n\n          // Assign the result to the new attribute and remove the old one.\n          try {\n            /*\n            \tNOTE: Most browsers (ca. Nov 2017) have broken `setAttribute()`\n            \tmethod implementations that throw on attribute names that start\n            \twith, or contain, various symbols that are completely valid per\n            \tthe specification.  Thus this code could fail if the user chooses\n            \tattribute names that, after removing the directive prefix, are\n            \tunpalatable to `setAttribute()`.\n            */\n            el.setAttribute(newName, result);\n            el.removeAttribute(name);\n          } catch (ex) {\n            throw new Error(\"cannot transform attribute directive \\\"\".concat(name, \"\\\" into attribute \\\"\").concat(newName, \"\\\"\"));\n          }\n        }\n      });\n    },\n    processDataAttributes: function processDataAttributes(el, tagName) {\n      var passage = el.getAttribute('data-passage');\n      if (passage == null) {\n        // lazy equality for null\n        return;\n      }\n      var evaluated = Wikifier.helpers.evalPassageId(passage);\n      if (evaluated !== passage) {\n        passage = evaluated;\n        el.setAttribute('data-passage', evaluated);\n      }\n      if (passage !== '') {\n        // '<image>' element, so attempt media passage transclusion.\n        if (tagName === 'image') {\n          if (passage.slice(0, 5) !== 'data:' && Story.has(passage)) {\n            passage = Story.get(passage);\n            if (passage.tags.includes('Twine.image')) {\n              // NOTE: SVG `.href` IDL attribute is read-only,\n              // so set its `href` content attribute instead.\n              el.setAttribute('href', passage.text.trim());\n            }\n          }\n        }\n\n        // Elsewise, assume a link element of some type—e.g., '<a>'.\n        else {\n          var setter = el.getAttribute('data-setter');\n          var setFn;\n          if (setter != null) {\n            // lazy equality for null\n            setter = String(setter).trim();\n            if (setter !== '') {\n              setFn = Wikifier.helpers.shadowHandler(Scripting.desugar(setter));\n            }\n          }\n          if (Story.has(passage)) {\n            el.classList.add('link-internal');\n            if (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n              el.classList.add('link-visited');\n            }\n          } else {\n            el.classList.add('link-broken');\n          }\n          jQuery(el).ariaClick({\n            one: true\n          }, function () {\n            if (typeof setFn === 'function') {\n              setFn.call(this);\n            }\n            Engine.play(passage);\n          });\n        }\n      }\n    }\n  });\n  Wikifier.Parser.add({\n    /*\n    \tNOTE: This parser MUST come after any parser which handles HTML tag-\n    \tlike constructs—e.g. 'verbatimText', 'horizontalRule', 'lineBreak',\n    \t'xmlProlog', 'verbatimHtml', 'verbatimSvgTag', 'verbatimScriptTag',\n    \tand 'styleTag'.\n    */\n    name: 'htmlTag',\n    profiles: ['core'],\n    match: \"<\".concat(Patterns.htmlTagName, \"(?:\\\\s+[^\\\\u0000-\\\\u001F\\\\u007F-\\\\u009F\\\\s\\\"'>\\\\/=]+(?:\\\\s*=\\\\s*(?:\\\"[^\\\"]*?\\\"|'[^']*?'|[^\\\\s\\\"'=<>`]+))?)*\\\\s*\\\\/?>\"),\n    tagRe: new RegExp(\"^<(\".concat(Patterns.htmlTagName, \")\")),\n    mediaTags: ['audio', 'img', 'source', 'track', 'video'],\n    // NOTE: The `<picture>` element should not be in this list.\n    nobrTags: ['audio', 'colgroup', 'datalist', 'dl', 'figure', 'meter', 'ol', 'optgroup', 'picture', 'progress', 'ruby', 'select', 'table', 'tbody', 'tfoot', 'thead', 'tr', 'ul', 'video'],\n    voidTags: ['area', 'base', 'br', 'col', 'embed', 'hr', 'img', 'input', 'keygen', 'link', 'menuitem', 'meta', 'param', 'source', 'track', 'wbr'],\n    handler: function handler(w) {\n      var tagMatch = this.tagRe.exec(w.matchText);\n      var tag = tagMatch && tagMatch[1];\n      var tagName = tag && tag.toLowerCase();\n      if (tagName) {\n        var isVoid = this.voidTags.includes(tagName) || w.matchText.endsWith('/>');\n        var isNobr = this.nobrTags.includes(tagName);\n        var terminator;\n        var terminatorMatch;\n        if (!isVoid) {\n          terminator = \"<\\\\/\".concat(tagName, \"\\\\s*>\");\n          var terminatorRe = new RegExp(terminator, 'gim'); // ignore case during match\n\n          terminatorRe.lastIndex = w.matchStart;\n          terminatorMatch = terminatorRe.exec(w.source);\n        }\n        if (isVoid || terminatorMatch) {\n          var output = w.output;\n          var el = document.createElement(w.output.tagName);\n          var debugView;\n          el.innerHTML = w.matchText;\n\n          /*\n          \tNOTE: The use of a `while` statement here is curious, however,\n          \tI'm hesitant to change it for fear of breaking some edge case.\n          */\n          while (el.firstChild) {\n            el = el.firstChild;\n          }\n          try {\n            this.processAttributeDirectives(el);\n          } catch (ex) {\n            return appendError(w.output, \"<\".concat(tagName, \">: \").concat(ex.message), \"\".concat(w.matchText, \"\\u2026\"));\n          }\n          if (el.hasAttribute('data-passage')) {\n            if (el.hasAttribute('href')) {\n              return appendError(w.output, \"<\".concat(tagName, \">: elements may not include both \\\"data-passage\\\" and \\\"href\\\" atttributes\"), \"\".concat(w.matchText, \"\\u2026\"));\n            }\n            this.processDataAttributes(el, tagName);\n\n            // Debug view setup.\n            if (Config.debug) {\n              debugView = new DebugView(w.output, \"html-\".concat(tagName), tagName, w.matchText);\n              debugView.modes({\n                block: tagName === 'img',\n                nonvoid: terminatorMatch\n              });\n              output = debugView.output;\n            }\n          } else if (el.hasAttribute('href')) {\n            // WARNING: Do not replace `el.getAttribute('href')` with `el.href`.\n            if (Wikifier.isExternalLink(el.getAttribute('href'))) {\n              el.classList.add('link-external');\n            }\n          }\n          if (terminatorMatch) {\n            /*\n            \tNOTE: There's no catch clause here because this try/finally exists\n            \tsolely to ensure that the options stack is properly restored in\n            \tthe event that an uncaught exception is thrown during the call to\n            \t`subWikify()`.\n            */\n            try {\n              Wikifier.Option.push({\n                nobr: isNobr\n              });\n              w.subWikify(el, terminator, {\n                ignoreTerminatorCase: true\n              });\n            } finally {\n              Wikifier.Option.pop();\n            }\n\n            /*\n            \tDebug view modification.  If the current element has any debug\n            \tview descendants who have \"block\" mode set, then set its debug\n            \tview to the same.  It just makes things look a bit nicer.\n            */\n            if (debugView && jQuery(el).find('.debug.block').length > 0) {\n              debugView.modes({\n                block: true\n              });\n            }\n          }\n\n          /*\n          \tNOTE: The use of `cloneNode(true)` here for `<track>` elements\n          \tis necessary to workaround a poorly understood rehoming issue.\n          */\n          output.appendChild(tagName === 'track' ? el.cloneNode(true) : el);\n        } else {\n          return appendError(w.output, \"cannot find a closing tag for HTML <\".concat(tag, \">\"), \"\".concat(w.matchText, \"\\u2026\"));\n        }\n      }\n    },\n    processAttributeDirectives: function processAttributeDirectives(el) {\n      // NOTE: The `.attributes` property yields a live collection, so we\n      // must make a non-live copy of it as we will be adding and removing\n      // members of said collection if any directives are found.\n      Array.from(el.attributes).forEach(function (_ref12) {\n        var name = _ref12.name,\n          value = _ref12.value;\n        var evalShorthand = name[0] === '@';\n        if (evalShorthand || name.startsWith('sc-eval:')) {\n          var newName = name.slice(evalShorthand ? 1 : 8); // Remove eval directive prefix.\n\n          if (newName === 'data-setter') {\n            throw new Error(\"evaluation directive is not allowed on the data-setter attribute: \\\"\".concat(name, \"\\\"\"));\n          }\n          var result;\n\n          // Evaluate the value as TwineScript.\n          try {\n            result = Scripting.evalTwineScript(value);\n          } catch (ex) {\n            throw new Error(\"bad evaluation from attribute directive \\\"\".concat(name, \"\\\": \").concat(ex.message));\n          }\n\n          // Assign the result to the new attribute and remove the old one.\n          try {\n            /*\n            \tNOTE: Most browsers (ca. Nov 2017) have broken `setAttribute()`\n            \tmethod implementations that throw on attribute names that start\n            \twith, or contain, various symbols that are completely valid per\n            \tthe specification.  Thus this code could fail if the user chooses\n            \tattribute names that, after removing the directive prefix, are\n            \tunpalatable to `setAttribute()`.\n            */\n            el.setAttribute(newName, result);\n            el.removeAttribute(name);\n          } catch (ex) {\n            throw new Error(\"cannot transform attribute directive \\\"\".concat(name, \"\\\" into attribute \\\"\").concat(newName, \"\\\"\"));\n          }\n        }\n      });\n    },\n    processDataAttributes: function processDataAttributes(el, tagName) {\n      var passage = el.getAttribute('data-passage');\n      if (passage == null) {\n        // lazy equality for null\n        return;\n      }\n      var evaluated = Wikifier.helpers.evalPassageId(passage);\n      if (evaluated !== passage) {\n        passage = evaluated;\n        el.setAttribute('data-passage', evaluated);\n      }\n      if (passage !== '') {\n        // Media element, so attempt media passage transclusion.\n        if (this.mediaTags.includes(tagName)) {\n          if (passage.slice(0, 5) !== 'data:' && Story.has(passage)) {\n            passage = Story.get(passage);\n            var parentName;\n            var twineTag;\n            switch (tagName) {\n              case 'audio':\n              case 'video':\n                twineTag = \"Twine.\".concat(tagName);\n                break;\n              case 'img':\n                twineTag = 'Twine.image';\n                break;\n              case 'track':\n                twineTag = 'Twine.vtt';\n                break;\n              case 'source':\n                {\n                  var $parent = $(el).closest('audio,picture,video');\n                  if ($parent.length > 0) {\n                    parentName = $parent.get(0).tagName.toLowerCase();\n                    twineTag = \"Twine.\".concat(parentName === 'picture' ? 'image' : parentName);\n                  }\n                  break;\n                }\n            }\n            if (passage.tags.includes(twineTag)) {\n              el[parentName === 'picture' ? 'srcset' : 'src'] = passage.text.trim();\n            }\n          }\n        }\n\n        // Elsewise, assume a link element of some type—e.g., '<a>', '<area>', '<button>', etc.\n        else {\n          var setter = el.getAttribute('data-setter');\n          var setFn;\n          if (setter != null) {\n            // lazy equality for null\n            setter = String(setter).trim();\n            if (setter !== '') {\n              setFn = Wikifier.helpers.shadowHandler(Scripting.desugar(setter));\n            }\n          }\n          if (Story.has(passage)) {\n            el.classList.add('link-internal');\n            if (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n              el.classList.add('link-visited');\n            }\n          } else {\n            el.classList.add('link-broken');\n          }\n          jQuery(el).ariaClick({\n            one: true\n          }, function () {\n            if (typeof setFn === 'function') {\n              setFn.call(this);\n            }\n            Engine.play(passage);\n          });\n        }\n      }\n    }\n  });\n})();\n\n/***********************************************************************************************************************\n\n\tmarkup/template.js\n\n\tCopyright © 2019–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns */\n\nvar Template = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Template definitions.\n  var _templates = new Map();\n\n  // Valid template name regular expression.\n  var _validNameRe = new RegExp(\"^(?:\".concat(Patterns.templateName, \")$\"));\n\n  // Valid template type predicate.\n  var _validType = function _validType(template) {\n    var templateType = _typeof(template);\n    return templateType === 'function' || templateType === 'string';\n  };\n\n  /*******************************************************************************\n  \tTemplate Functions.\n  *******************************************************************************/\n\n  function templateAdd(name, template) {\n    if (!_validType(template) && !(template instanceof Array && template.length > 0 && template.every(_validType))) {\n      throw new TypeError(\"invalid template type (\".concat(name, \"); templates must be: functions, strings, or an array of either\"));\n    }\n    (name instanceof Array ? name : [name]).forEach(function (name) {\n      if (!_validNameRe.test(name)) {\n        throw new Error(\"invalid template name \\\"\".concat(name, \"\\\"\"));\n      }\n      if (_templates.has(name)) {\n        throw new Error(\"cannot clobber existing template ?\".concat(name));\n      }\n      _templates.set(name, template);\n    });\n  }\n  function templateDelete(name) {\n    (name instanceof Array ? name : [name]).forEach(function (name) {\n      return _templates.delete(name);\n    });\n  }\n  function templateGet(name) {\n    return _templates.has(name) ? _templates.get(name) : null;\n  }\n  function templateHas(name) {\n    return _templates.has(name);\n  }\n  function templateSize() {\n    return _templates.size;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    add: {\n      value: templateAdd\n    },\n    delete: {\n      value: templateDelete\n    },\n    get: {\n      value: templateGet\n    },\n    has: {\n      value: templateHas\n    },\n    size: {\n      get: templateSize\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tmacro/macro.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Patterns, Scripting, macros */\n\nvar Macro = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Macro definitions.\n  var _macros = {};\n\n  // Map of all macro tags and their parents (key: 'tag name' => value: ['list of parent names']).\n  var _tags = {};\n\n  // Valid macro name regular expression.\n  var _validNameRe = new RegExp(\"^(?:\".concat(Patterns.macroName, \")$\"));\n\n  /*******************************************************************************\n  \tMacros Functions.\n  *******************************************************************************/\n\n  function macrosAdd(name, def) {\n    if (Array.isArray(name)) {\n      name.forEach(function (name) {\n        return macrosAdd(name, def);\n      });\n      return;\n    }\n    if (!_validNameRe.test(name)) {\n      throw new Error(\"invalid macro name \\\"\".concat(name, \"\\\"\"));\n    }\n    if (macrosHas(name)) {\n      throw new Error(\"cannot clobber existing macro <<\".concat(name, \">>\"));\n    } else if (tagsHas(name)) {\n      throw new Error(\"cannot clobber child tag <<\".concat(name, \">> of parent macro\").concat(_tags[name].length === 1 ? '' : 's', \" <<\").concat(_tags[name].join('>>, <<'), \">>\"));\n    }\n    try {\n      if (_typeof(def) === 'object') {\n        // Add the macro definition.\n        //\n        // NOTE: Since `macrosGet()` may return legacy macros, we add the `_MACRO_API`\n        // flag to (modern) API macros, so that the macro formatter will know how to\n        // call the macro.  This should be removed in v3.\n        _macros[name] = Object.assign(Object.create(null), def, {\n          _MACRO_API: true\n        });\n      } else {\n        // Add the macro alias.\n        if (macrosHas(def)) {\n          _macros[name] = Object.create(_macros[def], {\n            _ALIAS_OF: {\n              enumerable: true,\n              value: def\n            }\n          });\n        } else {\n          throw new Error(\"cannot create alias of nonexistent macro <<\".concat(def, \">>\"));\n        }\n      }\n      Object.defineProperty(_macros, name, {\n        writable: false\n      });\n    } catch (ex) {\n      if (ex.name === 'TypeError') {\n        throw new Error(\"cannot clobber protected macro <<\".concat(name, \">>\"));\n      } else {\n        throw new Error(\"unknown error when attempting to add macro <<\".concat(name, \">>: [\").concat(ex.name, \"] \").concat(ex.message));\n      }\n    }\n\n    // Tags post-processing.\n    if (typeof _macros[name].tags !== 'undefined') {\n      if (_macros[name].tags == null) {\n        // lazy equality for null\n        tagsRegister(name);\n      } else if (Array.isArray(_macros[name].tags)) {\n        tagsRegister(name, _macros[name].tags);\n      } else {\n        throw new Error(\"bad value for \\\"tags\\\" property of macro <<\".concat(name, \">>\"));\n      }\n    }\n  }\n  function macrosDelete(name) {\n    if (Array.isArray(name)) {\n      name.forEach(function (name) {\n        return macrosDelete(name);\n      });\n      return;\n    }\n    if (macrosHas(name)) {\n      // Tags pre-processing.\n      if (typeof _macros[name].tags !== 'undefined') {\n        tagsUnregister(name);\n      }\n      try {\n        // Remove the macro definition.\n        Object.defineProperty(_macros, name, {\n          writable: true\n        });\n        delete _macros[name];\n      } catch (ex) {\n        throw new Error(\"unknown error removing macro <<\".concat(name, \">>: \").concat(ex.message));\n      }\n    } else if (tagsHas(name)) {\n      throw new Error(\"cannot remove child tag <<\".concat(name, \">> of parent macro <<\").concat(_tags[name], \">>\"));\n    }\n  }\n  function macrosIsEmpty() {\n    return Object.keys(_macros).length === 0;\n  }\n  function macrosHas(name) {\n    return Object.hasOwn(_macros, name);\n  }\n  function macrosGet(name) {\n    var macro = null;\n    if (macrosHas(name) && typeof _macros[name].handler === 'function') {\n      macro = _macros[name];\n    }\n    /* legacy macro support */else if (Object.hasOwn(macros, name) && typeof macros[name].handler === 'function') {\n      macro = macros[name];\n    }\n    /* /legacy macro support */\n\n    return macro;\n  }\n  function macrosInit() {\n    var handler = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'init';\n    // eslint-disable-line no-unused-vars\n    Object.keys(_macros).forEach(function (name) {\n      if (typeof _macros[name][handler] === 'function') {\n        _macros[name][handler](name);\n      }\n    });\n\n    /* legacy macro support */\n    Object.keys(macros).forEach(function (name) {\n      if (typeof macros[name][handler] === 'function') {\n        macros[name][handler](name);\n      }\n    });\n    /* /legacy macro support */\n  }\n\n  /*******************************************************************************\n  \tTags Functions.\n  *******************************************************************************/\n\n  function tagsRegister(parent, bodyTags) {\n    if (!parent) {\n      throw new Error('no parent specified');\n    }\n    var endTags = [\"/\".concat(parent), \"end\".concat(parent)]; // automatically create the closing tags\n    var allTags = [].concat(endTags, Array.isArray(bodyTags) ? bodyTags : []);\n    for (var i = 0; i < allTags.length; ++i) {\n      var tag = allTags[i];\n      if (macrosHas(tag)) {\n        throw new Error('cannot register tag for an existing macro');\n      }\n      if (tagsHas(tag)) {\n        if (!_tags[tag].includes(parent)) {\n          _tags[tag].push(parent);\n          _tags[tag].sort();\n        }\n      } else {\n        _tags[tag] = [parent];\n      }\n    }\n  }\n  function tagsUnregister(parent) {\n    if (!parent) {\n      throw new Error('no parent specified');\n    }\n    Object.keys(_tags).forEach(function (tag) {\n      var i = _tags[tag].indexOf(parent);\n      if (i !== -1) {\n        if (_tags[tag].length === 1) {\n          delete _tags[tag];\n        } else {\n          _tags[tag].splice(i, 1);\n        }\n      }\n    });\n  }\n  function tagsHas(name) {\n    return Object.hasOwn(_tags, name);\n  }\n  function tagsGet(name) {\n    return tagsHas(name) ? _tags[name] : null;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    /*\n    \tMacro Functions.\n    */\n    add: {\n      value: macrosAdd\n    },\n    delete: {\n      value: macrosDelete\n    },\n    isEmpty: {\n      value: macrosIsEmpty\n    },\n    has: {\n      value: macrosHas\n    },\n    get: {\n      value: macrosGet\n    },\n    init: {\n      value: macrosInit\n    },\n    /*\n    \tTags Functions.\n    */\n    tags: {\n      value: Object.preventExtensions(Object.create(null, {\n        register: {\n          value: tagsRegister\n        },\n        unregister: {\n          value: tagsUnregister\n        },\n        has: {\n          value: tagsHas\n        },\n        get: {\n          value: tagsGet\n        }\n      }))\n    },\n    /*\n    \tLegacy Aliases.\n    */\n    evalStatements: {\n      value: function value() {\n        return Scripting.evalJavaScript.apply(Scripting, arguments);\n      }\n    } // SEE: `markup/scripting.js`.\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tmacro/macrocontext.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, DebugView, Patterns, State, Wikifier, appendError */\n\nvar MacroContext = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tMacroContext Class.\n  *******************************************************************************/\n  var MacroContext = /*#__PURE__*/function () {\n    function MacroContext(contextData) {\n      _classCallCheck(this, MacroContext);\n      var context = Object.assign({\n        parent: null,\n        macro: null,\n        name: '',\n        displayName: '',\n        args: null,\n        payload: null,\n        parser: null,\n        source: ''\n      }, contextData);\n      if (context.macro === null || context.name === '' || context.parser === null) {\n        throw new TypeError('context object missing required properties');\n      }\n      Object.defineProperties(this, {\n        self: {\n          value: context.macro\n        },\n        name: {\n          value: typeof context.macro._ALIAS_OF === 'undefined' ? context.name : context.macro._ALIAS_OF\n        },\n        displayName: {\n          value: context.name\n        },\n        args: {\n          value: context.args\n        },\n        payload: {\n          value: context.payload\n        },\n        source: {\n          value: context.source\n        },\n        parent: {\n          value: context.parent\n        },\n        parser: {\n          value: context.parser\n        },\n        _output: {\n          value: context.parser.output\n        },\n        _shadows: {\n          writable: true,\n          value: null\n        },\n        _debugView: {\n          writable: true,\n          value: null\n        },\n        _debugViewEnabled: {\n          writable: true,\n          value: Config.debug\n        }\n      });\n    }\n    return _createClass(MacroContext, [{\n      key: \"output\",\n      get: function get() {\n        return this._debugViewEnabled ? this.debugView.output : this._output;\n      }\n    }, {\n      key: \"shadows\",\n      get: function get() {\n        return Array.from(this._shadows);\n      }\n    }, {\n      key: \"shadowView\",\n      get: function get() {\n        var view = new Set();\n        for (var context = this; context !== null; context = context.parent) {\n          if (context._shadows) {\n            context._shadows.forEach(function (name) {\n              return view.add(name);\n            });\n          }\n        }\n        return Array.from(view);\n      }\n    }, {\n      key: \"debugView\",\n      get: function get() {\n        if (this._debugViewEnabled) {\n          return this._debugView !== null ? this._debugView : this.createDebugView();\n        }\n        return null;\n      }\n    }, {\n      key: \"contextFilter\",\n      value: function contextFilter(predicate, thisArg) {\n        if (typeof predicate !== 'function') {\n          throw new TypeError('<MacroContext>.contextFilter() predicate parameter must be a function');\n        }\n        var result = [];\n        for (var context = this.parent; context !== null; context = context.parent) {\n          if (predicate.call(typeof thisArg === 'undefined' ? this : thisArg, context)) {\n            result.push(context);\n          }\n        }\n        return result;\n      }\n    }, {\n      key: \"contextFind\",\n      value: function contextFind(predicate, thisArg) {\n        if (typeof predicate !== 'function') {\n          throw new TypeError('<MacroContext>.contextFind() predicate parameter must be a function');\n        }\n        for (var context = this.parent; context !== null; context = context.parent) {\n          if (predicate.call(typeof thisArg === 'undefined' ? this : thisArg, context)) {\n            return context;\n          }\n        }\n      }\n    }, {\n      key: \"contextSome\",\n      value: function contextSome(predicate, thisArg) {\n        if (typeof predicate !== 'function') {\n          throw new TypeError('<MacroContext>.contextSome() predicate parameter must be a function');\n        }\n        for (var context = this.parent; context !== null; context = context.parent) {\n          if (predicate.call(typeof thisArg === 'undefined' ? this : thisArg, context)) {\n            return true;\n          }\n        }\n        return false;\n      }\n    }, {\n      key: \"addShadow\",\n      value: function addShadow() {\n        var _this12 = this;\n        if (!this._shadows) {\n          this._shadows = new Set();\n        }\n        var varRe = new RegExp(\"^\".concat(Patterns.variable, \"$\"));\n        for (var _len14 = arguments.length, names = new Array(_len14), _key14 = 0; _key14 < _len14; _key14++) {\n          names[_key14] = arguments[_key14];\n        }\n        names.flat(Infinity).forEach(function (name) {\n          if (typeof name !== 'string') {\n            throw new TypeError(\"variable name must be a string; type: \".concat(_typeof(name)));\n          }\n          if (!varRe.test(name)) {\n            throw new Error(\"invalid variable name \\\"\".concat(name, \"\\\"\"));\n          }\n          _this12._shadows.add(name);\n        });\n      }\n    }, {\n      key: \"shadowHandler\",\n      value: function shadowHandler(callback, doneCallback, startCallback) {\n        var shadowContext = this;\n        var shadowStore;\n        if (typeof callback === 'function') {\n          shadowStore = Object.create(null);\n          this.shadowView.forEach(function (varName) {\n            var varKey = varName.slice(1);\n            var store = varName[0] === '$' ? State.variables : State.temporary;\n            shadowStore[varName] = store[varKey];\n          });\n        }\n        return function () {\n          for (var _len15 = arguments.length, args = new Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n            args[_key15] = arguments[_key15];\n          }\n          if (typeof startCallback === 'function') {\n            startCallback.apply(this, args);\n          }\n          if (typeof callback === 'function') {\n            var shadowNames = Object.keys(shadowStore);\n            var valueCache = shadowNames.length > 0 ? {} : null;\n            var macroParser = Wikifier.Parser.get('macro');\n            var contextCache;\n\n            /*\n            \tThere's no catch clause because this try/finally is here simply to ensure that\n            \tproper cleanup is done in the event that an exception is thrown during the\n            \tcallback.\n            */\n            try {\n              /*\n              \tCache the existing values of the variables to be shadowed and assign the\n              \tshadow values.\n              */\n              shadowNames.forEach(function (varName) {\n                var varKey = varName.slice(1);\n                var store = varName[0] === '$' ? State.variables : State.temporary;\n                if (Object.hasOwn(store, varKey)) {\n                  valueCache[varKey] = store[varKey];\n                }\n                store[varKey] = shadowStore[varName];\n              });\n\n              // Cache the existing macro execution context and assign the shadow context.\n              contextCache = macroParser.context;\n              macroParser.context = shadowContext;\n\n              // Call the callback function.\n              callback.apply(this, args);\n            } finally {\n              // Revert the macro execution context shadowing.\n              if (contextCache !== undefined) {\n                macroParser.context = contextCache;\n              }\n\n              // Revert the variable shadowing.\n              shadowNames.forEach(function (varName) {\n                var varKey = varName.slice(1);\n                var store = varName[0] === '$' ? State.variables : State.temporary;\n\n                /*\n                \tUpdate the shadow store with the variable's current value, in case it\n                \twas modified during the callback.\n                */\n                shadowStore[varName] = store[varKey];\n                if (Object.hasOwn(valueCache, varKey)) {\n                  store[varKey] = valueCache[varKey];\n                } else {\n                  delete store[varKey];\n                }\n              });\n            }\n          }\n          if (typeof doneCallback === 'function') {\n            doneCallback.apply(this, args);\n          }\n        };\n      }\n    }, {\n      key: \"createDebugView\",\n      value: function createDebugView(name, title) {\n        this._debugView = new DebugView(this._output, 'macro', name ? name : this.displayName, title ? title : this.source);\n        if (this.payload !== null && this.payload.length > 0) {\n          this._debugView.modes({\n            nonvoid: true\n          });\n        }\n        this._debugViewEnabled = true;\n        return this._debugView;\n      }\n    }, {\n      key: \"removeDebugView\",\n      value: function removeDebugView() {\n        if (this._debugView !== null) {\n          this._debugView.remove();\n          this._debugView = null;\n        }\n        this._debugViewEnabled = false;\n      }\n    }, {\n      key: \"error\",\n      value: function error(message, source) {\n        return appendError(this._output, \"<<\".concat(this.displayName, \">>: \").concat(message), source ? source : this.source);\n      }\n    }]);\n  }();\n  /* legacy */\n  // Attach legacy aliases.\n  Object.defineProperties(MacroContext.prototype, {\n    contextHas: {\n      value: function value() {\n        console.warn('[DEPRECATED] <MacroContext>.contextHas() is deprecated.');\n        for (var _len16 = arguments.length, args = new Array(_len16), _key16 = 0; _key16 < _len16; _key16++) {\n          args[_key16] = arguments[_key16];\n        }\n        return MacroContext.prototype.contextSome.apply(this, args);\n      }\n    },\n    contextSelect: {\n      value: function value() {\n        console.warn('[DEPRECATED] <MacroContext>.contextSelect() is deprecated.');\n        for (var _len17 = arguments.length, args = new Array(_len17), _key17 = 0; _key17 < _len17; _key17++) {\n          args[_key17] = arguments[_key17];\n        }\n        return MacroContext.prototype.contextFind.apply(this, args);\n      }\n    },\n    contextSelectAll: {\n      value: function value() {\n        console.warn('[DEPRECATED] <MacroContext>.contextSelectAll() is deprecated.');\n        for (var _len18 = arguments.length, args = new Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n          args[_key18] = arguments[_key18];\n        }\n        return MacroContext.prototype.contextFilter.apply(this, args);\n      }\n    },\n    createShadowWrapper: {\n      value: function value() {\n        console.warn('[DEPRECATED] <MacroContext>.createShadowWrapper() is deprecated.');\n        for (var _len19 = arguments.length, args = new Array(_len19), _key19 = 0; _key19 < _len19; _key19++) {\n          args[_key19] = arguments[_key19];\n        }\n        return MacroContext.prototype.shadowHandler.apply(this, args);\n      }\n    }\n  });\n  /* /legacy */\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return MacroContext;\n}();\n\n/***********************************************************************************************************************\n\n\tmacro/macros/addclass-toggleclass.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro */\n\n/*\n\t<<addclass>> & <<toggleclass>>\n*/\nMacro.add(['addclass', 'toggleclass'], {\n  handler: function handler() {\n    if (this.args.length < 2) {\n      var errors = [];\n      if (this.args.length < 1) {\n        errors.push('selector');\n      }\n      if (this.args.length < 2) {\n        errors.push('class names');\n      }\n      return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n    var $targets = jQuery(this.args[0]);\n    if ($targets.length === 0) {\n      return this.error(\"no elements matched the selector \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    switch (this.name) {\n      case 'addclass':\n        $targets.addClass(this.args[1].trim());\n        break;\n      case 'toggleclass':\n        $targets.toggleClass(this.args[1].trim());\n        break;\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/append-prepend-replace.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro */\n\n/*\n\t<<append>>, <<prepend>>, & <<replace>>\n*/\nMacro.add(['append', 'prepend', 'replace'], {\n  tags: null,\n  t8nRe: /^(?:transition|t8n)$/,\n  handler: function handler() {\n    var _this13 = this;\n    if (this.args.length === 0) {\n      return this.error('no selector specified');\n    }\n    var $targets = jQuery(this.args[0]);\n    if ($targets.length === 0) {\n      return this.error(\"no elements matched the selector \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    if (this.payload[0].contents !== '') {\n      var transition = this.args.length > 1 && this.self.t8nRe.test(this.args[1]);\n      var $insert;\n      if (transition) {\n        $insert = jQuery(document.createElement('span'));\n        $insert.addClass(\"macro-\".concat(this.name, \"-insert macro-\").concat(this.name, \"-in\"));\n        setTimeout(function () {\n          return $insert.removeClass(\"macro-\".concat(_this13.name, \"-in\"));\n        }, Engine.DOM_DELAY);\n      } else {\n        $insert = jQuery(document.createDocumentFragment());\n      }\n      $insert.wiki(this.payload[0].contents);\n      switch (this.name) {\n        case 'replace':\n          $targets.empty();\n        /* falls through */\n\n        case 'append':\n          $targets.append($insert);\n          break;\n        case 'prepend':\n          $targets.prepend($insert);\n          break;\n      }\n    } else if (this.name === 'replace') {\n      $targets.empty();\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/audio-macros.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Has, Macro, SimpleAudio, Story */\n\n(function () {\n  if (Has.audio) {\n    var errorOnePlaybackAction = function errorOnePlaybackAction(cur, prev) {\n      return \"only one playback action allowed per invocation, \\\"\".concat(cur, \"\\\" cannot be combined with \\\"\").concat(prev, \"\\\"\");\n    };\n\n    /*\n    \t<<audio>>\n    */\n    Macro.add('audio', {\n      handler: function handler() {\n        if (this.args.length < 2) {\n          var errors = [];\n          if (this.args.length < 1) {\n            errors.push('track and/or group IDs');\n          }\n          if (this.args.length < 2) {\n            errors.push('actions');\n          }\n          return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n        }\n        var selected;\n\n        // Process the track and/or group IDs.\n        try {\n          selected = SimpleAudio.select(this.args[0]);\n        } catch (ex) {\n          return this.error(ex.message);\n        }\n        var args = this.args.slice(1);\n        var action;\n        var fadeOver = 5;\n        var fadeTo;\n        var loop;\n        var mute;\n        var passage;\n        var time;\n        var volume;\n\n        // Process arguments.\n        while (args.length > 0) {\n          var arg = args.shift();\n          var raw = void 0;\n          switch (arg) {\n            case 'load':\n            case 'pause':\n            case 'play':\n            case 'stop':\n            case 'unload':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = arg;\n                break;\n              }\n            case 'fadein':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = 'fade';\n                fadeTo = 1;\n                break;\n              }\n            case 'fadeout':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = 'fade';\n                fadeTo = 0;\n                break;\n              }\n            case 'fadeto':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                if (args.length === 0) {\n                  return this.error('fadeto missing required level value');\n                }\n                action = 'fade';\n                raw = args.shift();\n                fadeTo = Number.parseFloat(raw);\n                if (Number.isNaN(fadeTo) || !Number.isFinite(fadeTo)) {\n                  return this.error(\"cannot parse fadeto: \".concat(raw));\n                }\n                break;\n              }\n            case 'fadeoverto':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                if (args.length < 2) {\n                  var _errors = [];\n                  if (args.length < 1) {\n                    _errors.push('seconds');\n                  }\n                  if (args.length < 2) {\n                    _errors.push('level');\n                  }\n                  return this.error(\"fadeoverto missing required \".concat(_errors.join(' and '), \" value\").concat(_errors.length > 1 ? 's' : ''));\n                }\n                action = 'fade';\n                raw = args.shift();\n                fadeOver = Number.parseFloat(raw);\n                if (Number.isNaN(fadeOver) || !Number.isFinite(fadeOver)) {\n                  return this.error(\"cannot parse fadeoverto: \".concat(raw));\n                }\n                raw = args.shift();\n                fadeTo = Number.parseFloat(raw);\n                if (Number.isNaN(fadeTo) || !Number.isFinite(fadeTo)) {\n                  return this.error(\"cannot parse fadeoverto: \".concat(raw));\n                }\n                break;\n              }\n            case 'volume':\n              {\n                if (args.length === 0) {\n                  return this.error('volume missing required level value');\n                }\n                raw = args.shift();\n                volume = Number.parseFloat(raw);\n                if (Number.isNaN(volume) || !Number.isFinite(volume)) {\n                  return this.error(\"cannot parse volume: \".concat(raw));\n                }\n                break;\n              }\n            case 'mute':\n            case 'unmute':\n              mute = arg === 'mute';\n              break;\n            case 'time':\n              {\n                if (args.length === 0) {\n                  return this.error('time missing required seconds value');\n                }\n                raw = args.shift();\n                time = Number.parseFloat(raw);\n                if (Number.isNaN(time) || !Number.isFinite(time)) {\n                  return this.error(\"cannot parse time: \".concat(raw));\n                }\n                break;\n              }\n            case 'loop':\n            case 'unloop':\n              loop = arg === 'loop';\n              break;\n            case 'goto':\n              {\n                if (args.length === 0) {\n                  return this.error('goto missing required passage title');\n                }\n                raw = args.shift();\n                if (_typeof(raw) === 'object') {\n                  // Argument was in wiki link syntax.\n                  passage = raw.link;\n                } else {\n                  // Argument was simply the passage name.\n                  passage = raw;\n                }\n                if (!Story.has(passage)) {\n                  return this.error(\"passage \\\"\".concat(passage, \"\\\" does not exist\"));\n                }\n                break;\n              }\n            default:\n              return this.error(\"unknown action: \".concat(arg));\n          }\n        }\n        try {\n          if (volume != null) {\n            // lazy equality for null\n            selected.volume(volume);\n          }\n          if (time != null) {\n            // lazy equality for null\n            selected.time(time);\n          }\n          if (mute != null) {\n            // lazy equality for null\n            selected.mute(mute);\n          }\n          if (loop != null) {\n            // lazy equality for null\n            selected.loop(loop);\n          }\n          if (passage != null) {\n            // lazy equality for null\n            var nsEnded = \"ended.macros.macro-\".concat(this.name, \"_goto\");\n            selected.off(nsEnded).one(nsEnded, function () {\n              selected.off(nsEnded);\n              Engine.play(passage);\n            });\n          }\n          switch (action) {\n            case 'fade':\n              selected.fade(fadeOver, fadeTo);\n              break;\n            case 'load':\n              selected.load();\n              break;\n            case 'pause':\n              selected.pause();\n              break;\n            case 'play':\n              selected.playWhenAllowed();\n              break;\n            case 'stop':\n              selected.stop();\n              break;\n            case 'unload':\n              selected.unload();\n              break;\n          }\n\n          // Custom debug view setup.\n          if (Config.debug) {\n            this.debugView.modes({\n              hidden: true\n            });\n          }\n        } catch (ex) {\n          return this.error(\"error executing action: \".concat(ex.message));\n        }\n      }\n    });\n\n    /*\n    \t<<cacheaudio track_id source_list>>\n    */\n    Macro.add('cacheaudio', {\n      handler: function handler() {\n        if (this.args.length < 2) {\n          var errors = [];\n          if (this.args.length < 1) {\n            errors.push('track ID');\n          }\n          if (this.args.length < 2) {\n            errors.push('sources');\n          }\n          return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n        }\n        var id = String(this.args[0]).trim();\n        try {\n          SimpleAudio.tracks.add(id, this.args.slice(1));\n        } catch (ex) {\n          return this.error(ex.message);\n        }\n\n        // If in Test Mode and no supported sources were specified, return an error.\n        if (Config.debug && !SimpleAudio.tracks.get(id).hasSource()) {\n          return this.error(\"track ID \\\"\".concat(id, \"\\\": no supported audio sources found\"));\n        }\n\n        // Custom debug view setup.\n        if (Config.debug) {\n          this.debugView.modes({\n            hidden: true\n          });\n        }\n      }\n    });\n\n    /*\n    \t<<createaudiogroup group_id>>\n    \t\t<<track track_id>>\n    \t\t…\n    \t<</createaudiogroup>>\n    */\n    Macro.add('createaudiogroup', {\n      tags: ['track'],\n      handler: function handler() {\n        if (this.args.length === 0) {\n          return this.error('no group ID specified');\n        }\n        if (this.payload.length === 1) {\n          return this.error('no tracks defined via <<track>>');\n        }\n\n        // Initial debug view setup for `<<createaudiogroup>>`.\n        if (Config.debug) {\n          this.debugView.modes({\n            nonvoid: false,\n            hidden: true\n          });\n        }\n        var groupId = String(this.args[0]).trim();\n        var trackIds = [];\n        for (var i = 1, len = this.payload.length; i < len; ++i) {\n          if (this.payload[i].args.length < 1) {\n            return this.error('no track ID specified');\n          }\n          trackIds.push(String(this.payload[i].args[0]).trim());\n\n          // Custom debug view setup for the current `<<track>>`.\n          if (Config.debug) {\n            this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n              nonvoid: false,\n              hidden: true\n            });\n          }\n        }\n        try {\n          SimpleAudio.groups.add(groupId, trackIds);\n        } catch (ex) {\n          return this.error(ex.message);\n        }\n\n        // Custom fake debug view setup for `<</createaudiogroup>>`.\n        if (Config.debug) {\n          this.createDebugView(\"/\".concat(this.name), \"<</\".concat(this.name, \">>\")).modes({\n            nonvoid: false,\n            hidden: true\n          });\n        }\n      }\n    });\n\n    /*\n    \t<<createplaylist list_id>>\n    \t\t<<track track_id action_list>>\n    \t\t…\n    \t<</createplaylist>>\n    */\n    Macro.add('createplaylist', {\n      tags: ['track'],\n      handler: function handler() {\n        if (this.args.length === 0) {\n          return this.error('no list ID specified');\n        }\n        if (this.payload.length === 1) {\n          return this.error('no tracks defined via <<track>>');\n        }\n\n        // Initial debug view setup for `<<createplaylist>>`.\n        if (Config.debug) {\n          this.debugView.modes({\n            nonvoid: false,\n            hidden: true\n          });\n        }\n        var listId = String(this.args[0]).trim();\n        var trackObjs = [];\n        for (var i = 1, len = this.payload.length; i < len; ++i) {\n          if (this.payload[i].args.length === 0) {\n            return this.error('no track ID specified');\n          }\n          var trackObj = {\n            id: String(this.payload[i].args[0]).trim()\n          };\n          var args = this.payload[i].args.slice(1);\n\n          // Process arguments.\n          while (args.length > 0) {\n            var arg = args.shift();\n            var raw = void 0;\n            var parsed = void 0;\n            switch (arg) {\n              case 'own':\n                trackObj.own = true;\n                break;\n              case 'rate':\n                {\n                  // if (args.length === 0) {\n                  // \treturn this.error('rate missing required speed value');\n                  // }\n                  //\n                  // raw = args.shift();\n                  // parsed = Number.parseFloat(raw);\n                  //\n                  // if (Number.isNaN(parsed) || !Number.isFinite(parsed)) {\n                  // \treturn this.error(`cannot parse rate: ${raw}`);\n                  // }\n                  //\n                  // trackObj.rate = parsed;\n\n                  if (args.length > 0) {\n                    args.shift();\n                  }\n                  break;\n                }\n              case 'volume':\n                {\n                  if (args.length === 0) {\n                    return this.error('volume missing required level value');\n                  }\n                  raw = args.shift();\n                  parsed = Number.parseFloat(raw);\n                  if (Number.isNaN(parsed) || !Number.isFinite(parsed)) {\n                    return this.error(\"cannot parse volume: \".concat(raw));\n                  }\n                  trackObj.volume = parsed;\n                  break;\n                }\n              default:\n                return this.error(\"unknown action: \".concat(arg));\n            }\n          }\n          trackObjs.push(trackObj);\n\n          // Custom debug view setup for the current `<<track>>`.\n          if (Config.debug) {\n            this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n              nonvoid: false,\n              hidden: true\n            });\n          }\n        }\n        try {\n          SimpleAudio.lists.add(listId, trackObjs);\n        } catch (ex) {\n          return this.error(ex.message);\n        }\n\n        // Custom fake debug view setup for `<</createplaylist>>`.\n        if (Config.debug) {\n          this.createDebugView(\"/\".concat(this.name), \"<</\".concat(this.name, \">>\")).modes({\n            nonvoid: false,\n            hidden: true\n          });\n        }\n      }\n    });\n\n    /*\n    \t<<masteraudio action_list>>\n    */\n    Macro.add('masteraudio', {\n      handler: function handler() {\n        if (this.args.length === 0) {\n          return this.error('no actions specified');\n        }\n        var args = this.args.slice(0);\n        var action;\n        var mute;\n        var muteOnHide;\n        var volume;\n\n        // Process arguments.\n        while (args.length > 0) {\n          var arg = args.shift();\n          var raw = void 0;\n          switch (arg) {\n            case 'load':\n            case 'stop':\n            case 'unload':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = arg;\n                break;\n              }\n            case 'mute':\n            case 'unmute':\n              mute = arg === 'mute';\n              break;\n            case 'muteonhide':\n            case 'nomuteonhide':\n              muteOnHide = arg === 'muteonhide';\n              break;\n            case 'volume':\n              {\n                if (args.length === 0) {\n                  return this.error('volume missing required level value');\n                }\n                raw = args.shift();\n                volume = Number.parseFloat(raw);\n                if (Number.isNaN(volume) || !Number.isFinite(volume)) {\n                  return this.error(\"cannot parse volume: \".concat(raw));\n                }\n                break;\n              }\n            default:\n              return this.error(\"unknown action: \".concat(arg));\n          }\n        }\n        try {\n          if (mute != null) {\n            // lazy equality for null\n            SimpleAudio.mute(mute);\n          }\n          if (muteOnHide != null) {\n            // lazy equality for null\n            SimpleAudio.muteOnHidden(muteOnHide);\n          }\n          if (volume != null) {\n            // lazy equality for null\n            SimpleAudio.volume(volume);\n          }\n          switch (action) {\n            case 'load':\n              SimpleAudio.load();\n              break;\n            case 'stop':\n              SimpleAudio.stop();\n              break;\n            case 'unload':\n              SimpleAudio.unload();\n              break;\n          }\n\n          // Custom debug view setup.\n          if (Config.debug) {\n            this.debugView.modes({\n              hidden: true\n            });\n          }\n        } catch (ex) {\n          return this.error(\"error executing action: \".concat(ex.message));\n        }\n      }\n    });\n\n    /*\n    \t<<playlist list_id action_list>>\n    */\n    Macro.add('playlist', {\n      handler: function handler() {\n        if (this.args.length < 2) {\n          var errors = [];\n          if (this.args.length < 1) {\n            errors.push('list ID');\n          }\n          if (this.args.length < 2) {\n            errors.push('actions');\n          }\n          return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n        }\n        var id = String(this.args[0]).trim();\n        if (!SimpleAudio.lists.has(id)) {\n          return this.error(\"playlist \\\"\".concat(id, \"\\\" does not exist\"));\n        }\n        var list = SimpleAudio.lists.get(id);\n        var args = this.args.slice(1);\n        var action;\n        var fadeOver = 5;\n        var fadeTo;\n        var loop;\n        var mute;\n        var shuffle;\n        var volume;\n\n        // Process arguments.\n        while (args.length > 0) {\n          var arg = args.shift();\n          var raw = void 0;\n          switch (arg) {\n            case 'load':\n            case 'pause':\n            case 'play':\n            case 'skip':\n            case 'stop':\n            case 'unload':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = arg;\n                break;\n              }\n            case 'fadein':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = 'fade';\n                fadeTo = 1;\n                break;\n              }\n            case 'fadeout':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                action = 'fade';\n                fadeTo = 0;\n                break;\n              }\n            case 'fadeto':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                if (args.length === 0) {\n                  return this.error('fadeto missing required level value');\n                }\n                action = 'fade';\n                raw = args.shift();\n                fadeTo = Number.parseFloat(raw);\n                if (Number.isNaN(fadeTo) || !Number.isFinite(fadeTo)) {\n                  return this.error(\"cannot parse fadeto: \".concat(raw));\n                }\n                break;\n              }\n            case 'fadeoverto':\n              {\n                if (action) {\n                  return this.error(errorOnePlaybackAction(arg, action));\n                }\n                if (args.length < 2) {\n                  var _errors2 = [];\n                  if (args.length < 1) {\n                    _errors2.push('seconds');\n                  }\n                  if (args.length < 2) {\n                    _errors2.push('level');\n                  }\n                  return this.error(\"fadeoverto missing required \".concat(_errors2.join(' and '), \" value\").concat(_errors2.length > 1 ? 's' : ''));\n                }\n                action = 'fade';\n                raw = args.shift();\n                fadeOver = Number.parseFloat(raw);\n                if (Number.isNaN(fadeOver) || !Number.isFinite(fadeOver)) {\n                  return this.error(\"cannot parse fadeoverto: \".concat(raw));\n                }\n                raw = args.shift();\n                fadeTo = Number.parseFloat(raw);\n                if (Number.isNaN(fadeTo) || !Number.isFinite(fadeTo)) {\n                  return this.error(\"cannot parse fadeoverto: \".concat(raw));\n                }\n                break;\n              }\n            case 'volume':\n              {\n                if (args.length === 0) {\n                  return this.error('volume missing required level value');\n                }\n                raw = args.shift();\n                volume = Number.parseFloat(raw);\n                if (Number.isNaN(volume) || !Number.isFinite(volume)) {\n                  return this.error(\"cannot parse volume: \".concat(raw));\n                }\n                break;\n              }\n            case 'mute':\n            case 'unmute':\n              mute = arg === 'mute';\n              break;\n            case 'loop':\n            case 'unloop':\n              loop = arg === 'loop';\n              break;\n            case 'shuffle':\n            case 'unshuffle':\n              shuffle = arg === 'shuffle';\n              break;\n            default:\n              return this.error(\"unknown action: \".concat(arg));\n          }\n        }\n        try {\n          if (volume != null) {\n            // lazy equality for null\n            list.volume(volume);\n          }\n          if (mute != null) {\n            // lazy equality for null\n            list.mute(mute);\n          }\n          if (loop != null) {\n            // lazy equality for null\n            list.loop(loop);\n          }\n          if (shuffle != null) {\n            // lazy equality for null\n            list.shuffle(shuffle);\n          }\n          switch (action) {\n            case 'fade':\n              list.fade(fadeOver, fadeTo);\n              break;\n            case 'load':\n              list.load();\n              break;\n            case 'pause':\n              list.pause();\n              break;\n            case 'play':\n              list.playWhenAllowed();\n              break;\n            case 'skip':\n              list.skip();\n              break;\n            case 'stop':\n              list.stop();\n              break;\n            case 'unload':\n              list.unload();\n              break;\n          }\n\n          // Custom debug view setup.\n          if (Config.debug) {\n            this.debugView.modes({\n              hidden: true\n            });\n          }\n        } catch (ex) {\n          return this.error(\"error executing action: \".concat(ex.message));\n        }\n      }\n    });\n\n    /*\n    \t<<removeaudiogroup group_id>>\n    */\n    Macro.add('removeaudiogroup', {\n      handler: function handler() {\n        if (this.args.length === 0) {\n          return this.error('no group ID specified');\n        }\n        var id = String(this.args[0]).trim();\n        if (!SimpleAudio.groups.has(id)) {\n          return this.error(\"group \\\"\".concat(id, \"\\\" does not exist\"));\n        }\n        SimpleAudio.groups.delete(id);\n\n        // Custom debug view setup.\n        if (Config.debug) {\n          this.debugView.modes({\n            hidden: true\n          });\n        }\n      }\n    });\n\n    /*\n    \t<<removeplaylist list_id>>\n    */\n    Macro.add('removeplaylist', {\n      handler: function handler() {\n        if (this.args.length === 0) {\n          return this.error('no list ID specified');\n        }\n        var id = String(this.args[0]).trim();\n        if (!SimpleAudio.lists.has(id)) {\n          return this.error(\"playlist \\\"\".concat(id, \"\\\" does not exist\"));\n        }\n        SimpleAudio.lists.delete(id);\n\n        // Custom debug view setup.\n        if (Config.debug) {\n          this.debugView.modes({\n            hidden: true\n          });\n        }\n      }\n    });\n\n    /*\n    \t<<waitforaudio>>\n    */\n    Macro.add('waitforaudio', {\n      skipArgs: true,\n      handler: function handler() {\n        SimpleAudio.loadWithScreen();\n      }\n    });\n  } else {\n    // The HTML5 <audio> API is unavailable, so add no-op versions.\n    Macro.add(['audio', 'cacheaudio', 'createaudiogroup', 'createplaylist', 'masteraudio', 'playlist', 'removeaudiogroup', 'removeplaylist', 'waitforaudio'], {\n      skipArgs: true,\n      handler: function handler() {\n        /* no-op */\n\n        // Custom debug view setup.\n        if (Config.debug) {\n          this.debugView.modes({\n            hidden: true\n          });\n        }\n      }\n    });\n  }\n})();\n\n/***********************************************************************************************************************\n\n\tmacro/macros/back-return.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Engine, L10n, Macro, State, Story */\n\n/*\n\t<<back>> & <<return>>\n*/\nMacro.add(['back', 'return'], {\n  handler: function handler() {\n    var momentIndex = -1;\n    var passage;\n    var content;\n    if (this.args.length > 0) {\n      if (_typeof(this.args[0]) === 'object') {\n        // Argument was in wiki image syntax.\n        if (this.args[0].isImage) {\n          content = document.createElement('img');\n          var $image = jQuery(content).attr('src', this.args[0].source);\n          if (Object.hasOwn(this.args[0], 'passage')) {\n            $image.attr('data-passage', this.args[0].passage);\n          }\n          if (Object.hasOwn(this.args[0], 'title')) {\n            $image.attr('title', this.args[0].title);\n          }\n          if (Object.hasOwn(this.args[0], 'align')) {\n            $image.attr('align', this.args[0].align);\n          }\n          if (Object.hasOwn(this.args[0], 'link')) {\n            passage = this.args[0].link;\n          }\n        }\n        // Argument was in wiki link syntax.\n        else {\n          content = document.createTextNode(this.args[0].text);\n          passage = this.args[0].link;\n        }\n      }\n      // Argument was simply the link text.\n      else {\n        content = document.createDocumentFragment();\n        var $frag = jQuery(content).wikiWithOptions({\n          cleanup: false,\n          profile: 'core'\n        }, this.args[0]);\n\n        // Sanity check for interactive content shenanigans.\n        var forbidden = $frag.getForbiddenInteractiveContentTagNames();\n        if (forbidden.length > 0) {\n          throw new Error(\"text content contains restricted elements: <\".concat(forbidden.join('>, <'), \">\"));\n        }\n        passage = this.args.length > 1 ? this.args[1] : undefined;\n      }\n    }\n    if (passage == null) {\n      // lazy equality for null\n      // Find the index and title of the most recent moment whose title does not match\n      // that of the active (present) moment's.\n      for (var i = State.length - 2; i >= 0; --i) {\n        if (State.history[i].title !== State.passage) {\n          momentIndex = i;\n          passage = State.history[i].title;\n          break;\n        }\n      }\n\n      // If we failed to find a passage and we're `<<return>>`, fallback to `State.expired`.\n      if (passage == null && this.name === 'return') {\n        // lazy equality for null\n        for (var _i6 = State.expired.length - 1; _i6 >= 0; --_i6) {\n          if (State.expired[_i6] !== State.passage) {\n            passage = State.expired[_i6];\n            break;\n          }\n        }\n      }\n    } else {\n      if (!Story.has(passage)) {\n        return this.error(\"passage \\\"\".concat(passage, \"\\\" does not exist\"));\n      }\n      if (this.name === 'back') {\n        // Find the index of the most recent moment whose title matches that of the\n        // specified passage.\n        for (var _i7 = State.length - 2; _i7 >= 0; --_i7) {\n          if (State.history[_i7].title === passage) {\n            momentIndex = _i7;\n            break;\n          }\n        }\n        if (momentIndex === -1) {\n          return this.error(\"cannot find passage \\\"\".concat(passage, \"\\\" in the current story history\"));\n        }\n      }\n    }\n    if (passage == null) {\n      // lazy equality for null\n      return this.error('cannot find passage');\n    }\n\n    // if (this.name === \"back\" && momentIndex === -1) {\n    // \t// no-op; we're already at the first passage in the current story history\n    // \treturn;\n    // }\n\n    var $link;\n    if (this.name !== 'back' || momentIndex !== -1) {\n      $link = jQuery(document.createElement('a')).addClass('link-internal').ariaClick({\n        one: true\n      }, this.name === 'return' ? function () {\n        return Engine.play(passage);\n      } : function () {\n        return Engine.goTo(momentIndex);\n      });\n      if (content instanceof HTMLImageElement) {\n        $link.addClass('link-image');\n      }\n    } else {\n      $link = jQuery(document.createElement('span')).addClass('link-disabled');\n    }\n    $link.addClass(\"macro-\".concat(this.name)).append(content || document.createTextNode(L10n.get(\"macro\".concat(this.name.toUpperFirst(), \"Text\")))).appendTo(this.output);\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/button-link.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, State, Story, Wikifier */\n\n/*\n\t<<button>> & <<link>>\n*/\nMacro.add(['button', 'link'], {\n  isAsync: true,\n  tags: null,\n  handler: function handler() {\n    var _this14 = this;\n    if (this.args.length === 0) {\n      return this.error(\"no \".concat(this.name === 'button' ? 'button' : 'link', \" text specified\"));\n    }\n    var $link = jQuery(document.createElement(this.name === 'button' ? 'button' : 'a'));\n    var passage;\n    if (_typeof(this.args[0]) === 'object') {\n      // Argument was in wiki image syntax.\n      if (this.args[0].isImage) {\n        var $image = jQuery(document.createElement('img')).attr('src', this.args[0].source).appendTo($link);\n        $link.addClass('link-image');\n        if (Object.hasOwn(this.args[0], 'passage')) {\n          $image.attr('data-passage', this.args[0].passage);\n        }\n        if (Object.hasOwn(this.args[0], 'title')) {\n          $image.attr('title', this.args[0].title);\n        }\n        if (Object.hasOwn(this.args[0], 'align')) {\n          $image.attr('align', this.args[0].align);\n        }\n        passage = this.args[0].link;\n      }\n      // Argument was in wiki link syntax.\n      else {\n        $link.append(document.createTextNode(this.args[0].text));\n        passage = this.args[0].link;\n      }\n    }\n    // Argument was simply the link text.\n    else {\n      var $frag = jQuery(document.createDocumentFragment()).wikiWithOptions({\n        cleanup: false,\n        profile: 'core'\n      }, this.args[0]);\n\n      // Sanity check for interactive content shenanigans.\n      var forbidden = $frag.getForbiddenInteractiveContentTagNames();\n      if (forbidden.length > 0) {\n        throw new Error(\"text content contains restricted elements: <\".concat(forbidden.join('>, <'), \">\"));\n      }\n      $link.append($frag);\n      passage = this.args.length > 1 ? this.args[1] : undefined;\n    }\n    if (passage != null) {\n      // lazy equality for null\n      $link.attr('data-passage', passage);\n      if (Story.has(passage)) {\n        $link.addClass('link-internal');\n        if (Config.addVisitedLinkClass && State.hasPlayed(passage)) {\n          $link.addClass('link-visited');\n        }\n      } else {\n        $link.addClass('link-broken');\n      }\n    } else {\n      $link.addClass('link-internal');\n    }\n    $link.addClass(\"macro-\".concat(this.name)).ariaClick({\n      namespace: '.macros',\n      role: passage != null ? 'link' : 'button',\n      // lazy equality for null\n      one: passage != null // lazy equality for null\n    }, this.shadowHandler(this.payload[0].contents !== '' ? function () {\n      return Wikifier.wikifyEval(_this14.payload[0].contents.trim());\n    } : null, passage != null // lazy equality for null\n    ? function () {\n      return Engine.play(passage);\n    } : null)).appendTo(this.output);\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/capture.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, Patterns, State, Wikifier */\n\n/*\n\t<<capture>>\n*/\nMacro.add('capture', {\n  skipArgs: true,\n  tags: null,\n  tsVarRe: new RegExp(\"(\".concat(Patterns.variable, \")\"), 'g'),\n  handler: function handler() {\n    if (this.args.raw.length === 0) {\n      return this.error('no story/temporary variable list specified');\n    }\n    var valueCache = {};\n\n    /*\n    \tThere's no catch clause because this try/finally is here simply to ensure that\n    \tproper cleanup is done in the event that an exception is thrown during the\n    \t`Wikifier` call.\n    */\n    try {\n      var tsVarRe = this.self.tsVarRe;\n      var match;\n\n      /*\n      \tCache the existing values of the variables and add a shadow.\n      */\n      while ((match = tsVarRe.exec(this.args.raw)) !== null) {\n        var varName = match[1];\n        var varKey = varName.slice(1);\n        var store = varName[0] === '$' ? State.variables : State.temporary;\n        if (Object.hasOwn(store, varKey)) {\n          valueCache[varKey] = store[varKey];\n        }\n        this.addShadow(varName);\n      }\n      new Wikifier(this.output, this.payload[0].contents);\n    } finally {\n      // Revert the variable shadowing.\n      this.shadows.forEach(function (varName) {\n        var varKey = varName.slice(1);\n        var store = varName[0] === '$' ? State.variables : State.temporary;\n        if (Object.hasOwn(valueCache, varKey)) {\n          store[varKey] = valueCache[varKey];\n        } else {\n          delete store[varKey];\n        }\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/checkbox.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, State, createSlug */\n\n/*\n\t<<checkbox>>\n*/\nMacro.add('checkbox', {\n  isAsync: true,\n  handler: function handler() {\n    if (this.args.length < 3) {\n      var errors = [];\n      if (this.args.length < 1) {\n        errors.push('variable name');\n      }\n      if (this.args.length < 2) {\n        errors.push('unchecked value');\n      }\n      if (this.args.length < 3) {\n        errors.push('checked value');\n      }\n      return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n\n    // Ensure that the variable name argument is a string.\n    if (typeof this.args[0] !== 'string') {\n      return this.error('variable name argument is not a string');\n    }\n    var varName = this.args[0].trim();\n\n    // Try to ensure that we receive the variable's name (incl. sigil), not its value.\n    if (varName[0] !== '$' && varName[0] !== '_') {\n      return this.error(\"variable name \\\"\".concat(this.args[0], \"\\\" is missing its sigil ($ or _)\"));\n    }\n    var varId = createSlug(varName);\n    var uncheckValue = this.args[1];\n    var checkValue = this.args[2];\n    var el = document.createElement('input');\n\n    /*\n    \tSet up and append the input element to the output buffer.\n    */\n    jQuery(el).attr({\n      id: \"\".concat(this.name, \"-\").concat(varId),\n      name: \"\".concat(this.name, \"-\").concat(varId),\n      type: 'checkbox',\n      tabindex: 0 // for accessibility\n    }).addClass(\"macro-\".concat(this.name)).on('change.macros', this.shadowHandler(function () {\n      State.setVar(varName, this.checked ? checkValue : uncheckValue);\n    })).appendTo(this.output);\n\n    /*\n    \tSet the variable and input element to the appropriate value and state, as requested.\n    */\n    switch (this.args[3]) {\n      case 'autocheck':\n        {\n          if (State.getVar(varName) === checkValue) {\n            el.checked = true;\n          } else {\n            State.setVar(varName, uncheckValue);\n          }\n          break;\n        }\n      case 'checked':\n        {\n          el.checked = true;\n          State.setVar(varName, checkValue);\n          break;\n        }\n      default:\n        {\n          State.setVar(varName, uncheckValue);\n          break;\n        }\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/copy.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro */\n\n/*\n\t<<copy>>\n*/\nMacro.add('copy', {\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no selector specified');\n    }\n    var $targets = jQuery(this.args[0]);\n    if ($targets.length === 0) {\n      return this.error(\"no elements matched the selector \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    jQuery(this.output).append($targets.html());\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/cycle-listbox.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, Scripting, State, createSlug, getErrorMessage, getToStringTag, sameValueZero */\n\n/*\n\t<<cycle>>, <<listbox>>, <<option>>, & <<optionsfrom>>\n*/\nMacro.add(['cycle', 'listbox'], {\n  isAsync: true,\n  skipArgs: ['optionsfrom'],\n  tags: ['option', 'optionsfrom'],\n  handler: function handler() {\n    var _this15 = this;\n    if (this.args.length === 0) {\n      return this.error('no variable name specified');\n    }\n\n    // Ensure that the variable name argument is a string.\n    if (typeof this.args[0] !== 'string') {\n      return this.error('variable name argument is not a string');\n    }\n    var varName = this.args[0].trim();\n\n    // Try to ensure that we receive the variable's name (incl. sigil), not its value.\n    if (varName[0] !== '$' && varName[0] !== '_') {\n      return this.error(\"variable name \\\"\".concat(this.args[0], \"\\\" is missing its sigil ($ or _)\"));\n    }\n    var varId = createSlug(varName);\n    var len = this.payload.length;\n    if (len === 1) {\n      return this.error('no options specified');\n    }\n    var config = {\n      autoselect: false,\n      once: false\n    };\n\n    // Process arguments.\n    for (var i = 1; i < this.args.length; ++i) {\n      var arg = this.args[i];\n      switch (arg) {\n        case 'once':\n          config.once = true;\n          break;\n        case 'autoselect':\n          config.autoselect = true;\n          break;\n        default:\n          return this.error(\"unknown argument: \".concat(arg));\n      }\n    }\n    var options = [];\n    var tagCount = {\n      option: 0,\n      optionsfrom: 0\n    };\n    var index = -1;\n\n    // Get the options and selected index, if any.\n    var _loop6 = function _loop6() {\n        var payload = _this15.payload[_i8];\n\n        // <<option label value [selected]>>\n        if (payload.name === 'option') {\n          ++tagCount.option;\n          if (payload.args.length === 0) {\n            return {\n              v: _this15.error(\"no arguments specified for <<\".concat(payload.name, \">> (#\").concat(tagCount.option, \")\"))\n            };\n          }\n          var option = {\n            label: String(payload.args[0])\n          };\n          var isSelected = false;\n          switch (payload.args.length) {\n            case 1:\n              {\n                option.value = payload.args[0];\n                break;\n              }\n            case 2:\n              {\n                if (payload.args[1] === 'selected') {\n                  option.value = payload.args[0];\n                  isSelected = true;\n                } else {\n                  option.value = payload.args[1];\n                }\n                break;\n              }\n            default:\n              {\n                option.value = payload.args[1];\n                if (payload.args[2] === 'selected') {\n                  isSelected = true;\n                }\n                break;\n              }\n          }\n          options.push(option);\n          if (isSelected) {\n            if (config.autoselect) {\n              return {\n                v: _this15.error('cannot specify both the autoselect and selected keywords')\n              };\n            } else if (index !== -1) {\n              return {\n                v: _this15.error(\"multiple selected keywords specified for <<\".concat(payload.name, \">> (#\").concat(index + 1, \" & #\").concat(tagCount.option, \")\"))\n              };\n            }\n            index = options.length - 1;\n          }\n        }\n\n        // <<optionsfrom expression>>\n        else {\n          ++tagCount.optionsfrom;\n          if (payload.args.full.length === 0) {\n            return {\n              v: _this15.error(\"no expression specified for <<\".concat(payload.name, \">> (#\").concat(tagCount.optionsfrom, \")\"))\n            };\n          }\n          var result;\n          try {\n            /*\n            \tNOTE: If the first character is the left curly brace, then we\n            \tassume that it's part of an object literal and wrap it within\n            \tparenthesis to ensure that it is not mistaken for a block\n            \tduring evaluation—which would cause an error.\n            */\n            var exp = payload.args.full;\n            result = Scripting.evalJavaScript(exp[0] === '{' ? \"(\".concat(exp, \")\") : exp);\n          } catch (ex) {\n            return {\n              v: _this15.error(\"bad evaluation: \".concat(getErrorMessage(ex)))\n            };\n          }\n          if (_typeof(result) !== 'object' || result === null) {\n            return {\n              v: _this15.error(\"expression must yield a supported collection or generic object (type: \".concat(result === null ? 'null' : _typeof(result), \")\"))\n            };\n          }\n          if (result instanceof Array || result instanceof Set) {\n            result.forEach(function (val) {\n              return options.push({\n                label: String(val),\n                value: val\n              });\n            });\n          } else if (result instanceof Map) {\n            result.forEach(function (val, key) {\n              return options.push({\n                label: String(key),\n                value: val\n              });\n            });\n          } else {\n            var oType = getToStringTag(result);\n            if (oType !== 'Object') {\n              return {\n                v: _this15.error(\"expression must yield a supported collection or generic object (object type: \".concat(oType, \")\"))\n              };\n            }\n            Object.keys(result).forEach(function (key) {\n              return options.push({\n                label: key,\n                value: result[key]\n              });\n            });\n          }\n        }\n      },\n      _ret;\n    for (var _i8 = 1; _i8 < len; ++_i8) {\n      _ret = _loop6();\n      if (_ret) return _ret.v;\n    }\n\n    // No options were selected by the user, so we must select one.\n    if (index === -1) {\n      // Attempt to automatically select an option by matching the variable's current value.\n      if (config.autoselect) {\n        // NOTE: This will usually fail for objects due to a variety of reasons.\n        var curValue = State.getVar(varName);\n        var curValueIndex = options.findIndex(function (opt) {\n          return sameValueZero(opt.value, curValue);\n        });\n        index = curValueIndex === -1 ? 0 : curValueIndex;\n      }\n\n      // Simply select the first option.\n      else {\n        index = 0;\n      }\n    }\n\n    // Set up and append the appropriate element to the output buffer.\n    if (this.name === 'cycle') {\n      var lastIndex = options.length - 1;\n      if (config.once && index === lastIndex) {\n        jQuery(this.output).wikiWithOptions({\n          cleanup: false,\n          profile: 'core'\n        }, options[index].label);\n      } else {\n        var cycleIndex = index;\n        jQuery(document.createElement('a')).wikiWithOptions({\n          cleanup: false,\n          profile: 'core'\n        }, options[index].label).attr('id', \"\".concat(this.name, \"-\").concat(varId)).addClass(\"macro-\".concat(this.name)).ariaClick({\n          namespace: '.macros',\n          role: 'button'\n        }, this.shadowHandler(function () {\n          var $this = $(this);\n          cycleIndex = (cycleIndex + 1) % options.length;\n          State.setVar(varName, options[cycleIndex].value);\n          $this.empty().wikiWithOptions({\n            cleanup: false,\n            profile: 'core'\n          }, options[cycleIndex].label);\n          if (config.once && cycleIndex === lastIndex) {\n            $this.off().contents().unwrap();\n          }\n        })).appendTo(this.output);\n      }\n    } else {\n      // this.name === 'listbox'\n      var $select = jQuery(document.createElement('select'));\n      options.forEach(function (opt, i) {\n        jQuery(document.createElement('option')).val(i).text(opt.label).appendTo($select);\n      });\n      $select.attr({\n        id: \"\".concat(this.name, \"-\").concat(varId),\n        name: \"\".concat(this.name, \"-\").concat(varId),\n        tabindex: 0 // for accessibility\n      }).addClass(\"macro-\".concat(this.name)).val(index).on('change.macros', this.shadowHandler(function () {\n        State.setVar(varName, options[Number(this.value)].value);\n      })).appendTo(this.output);\n    }\n\n    // Set the variable to the appropriate value, as requested.\n    State.setVar(varName, options[index].value);\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/do-redo.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, Wikifier, triggerEvent */\n\n(function () {\n  // Set up our event class name.\n  var eventClass = 'redo-target';\n\n  // Set up a global `:redo` event handler that sends non-bubbling\n  // `:redo-internal` events to `<<do>>` macros matching the given\n  // selector.\n  jQuery(document).on(':redo', function (ev) {\n    var evTags = ev.detail && ev.detail.tags || [];\n    var selector = evTags.length === 0 ? \".\".concat(eventClass) : evTags.map(function (tag) {\n      return \".\".concat(eventClass, \"[data-do-tags~=\\\"\").concat(tag, \"\\\"]\");\n    }).join(', ');\n    triggerEvent(':redo-internal', jQuery(selector), {\n      bubbles: false,\n      detail: ev.detail\n    });\n  });\n\n  /*\n  \t<<do [tag tags] [element tag]>>\n  */\n  Macro.add('do', {\n    tags: null,\n    handler: function handler() {\n      var elTag = 'span';\n      var tags = [];\n\n      // Process optional arguments.\n      var options = this.args.slice();\n      while (options.length > 0) {\n        var option = options.shift();\n        switch (option) {\n          case 'tag':\n            {\n              if (options.length === 0) {\n                return this.error('tag option missing required tag name(s)');\n              }\n              var raw = String(options.shift()).trim();\n              if (raw === '') {\n                throw new Error('tag option tag name(s) must be non-empty');\n              }\n              tags = String(raw).trim().splitOrEmpty(/\\s+/);\n              break;\n            }\n          case 'element':\n            {\n              if (options.length === 0) {\n                return this.error('element option missing required element tag name');\n              }\n              elTag = String(options.shift()).trim();\n              if (elTag === '') {\n                throw new Error('element option tag name must be non-empty');\n              }\n              break;\n            }\n          default:\n            return this.error(\"unknown option: \".concat(option));\n        }\n      }\n      var contents = this.payload[0].contents;\n\n      // Do nothing if there's no content to render.\n      if (contents.trim() === '') {\n        return;\n      }\n\n      // Custom debug view setup.\n      if (Config.debug) {\n        // QUESTION: Should this `elTag` check be more robust?\n        this.debugView.modes({\n          block: elTag !== 'span'\n        });\n      }\n\n      // Create a target to hold our contents.\n      var $target = jQuery(document.createElement(elTag)).addClass(\"macro-\".concat(this.name, \" \").concat(eventClass)).attr('data-do-tags', tags.join(' ')).wiki(contents).on(':redo-internal', jQuery.throttle(Engine.DOM_DELAY, this.shadowHandler(function () {\n        var frag = document.createDocumentFragment();\n        new Wikifier(frag, contents);\n        $target.empty().append(frag);\n      }))).appendTo(this.output);\n    }\n  });\n\n  /*\n  \t<<redo [tags]>>\n  */\n  Macro.add('redo', {\n    handler: function handler() {\n      // Sanity check to prevent out-of-control redoes.\n      //\n      // NOTE: This may be too restrictive.\n      var failRE = /^(?:do|for)$/;\n      var passRE = /^(?:button|link(?:append|prepend|replace)?)$/;\n      var closest = this.contextFind(function (ctx) {\n        return failRE.test(ctx.name) || passRE.test(ctx.name);\n      });\n      if (closest && failRE.test(closest.name)) {\n        return this.error(\"must not be used directly within macro <<\".concat(closest.name, \">>\"));\n      }\n\n      // Gather any given tags.\n      var tags = this.args.length > 0 ? String(this.args[0]).trim().splitOrEmpty(/\\s+/) : [];\n\n      // Trigger a redo, sending any tags along.\n      triggerEvent(':redo', document, {\n        detail: {\n          tags: tags\n        }\n      });\n    }\n  });\n})();\n\n/***********************************************************************************************************************\n\n\tmacro/macros/done.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Engine, Macro */\n\n/*\n\t<<done>>\n*/\nMacro.add('done', {\n  skipArgs: true,\n  tags: null,\n  handler: function handler() {\n    var contents = this.payload[0].contents.trim();\n\n    // Do nothing if there's no content to process.\n    if (contents === '') {\n      return;\n    }\n    setTimeout(this.shadowHandler(function () {\n      return $.wiki(contents);\n    }), Engine.DOM_DELAY);\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/for-break-continue.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Config, Macro, Patterns, Scripting, State, TempState, Wikifier, charAndPosAt, getErrorMessage,\n\t       getToStringTag, stringFrom\n*/\n\n/*\n\t<<for>>, <<break>>, & <<continue>>\n*/\nMacro.add('for', {\n  /* eslint-disable max-len */\n  skipArgs: true,\n  tags: null,\n  isRangeRe: new RegExp(\"^(?:\\\\S\".concat(Patterns.anyChar, \"*?\\\\s+)?range\\\\s+\\\\S\").concat(Patterns.anyChar, \"*?$\")),\n  rangeRe: new RegExp(\"^(?:(?:State\\\\.(variables|temporary)\\\\.(\".concat(Patterns.identifier, \")\\\\s*,\\\\s*)?State\\\\.(variables|temporary)\\\\.(\").concat(Patterns.identifier, \")\\\\s+)?range\\\\s+(\\\\S\").concat(Patterns.anyChar, \"*?)$\")),\n  threePartRe: /^([^;]*?)\\s*;\\s*([^;]*?)\\s*;\\s*([^;]*?)$/,\n  forInRe: /^\\S+\\s+in\\s+\\S+/i,\n  forOfRe: /^\\S+\\s+of\\s+\\S+/i,\n  /* eslint-enable max-len */handler: function handler() {\n    var argsStr = this.args.full.trim();\n    var payload = this.payload[0].contents.replace(/\\n$/, '');\n\n    // Empty form.\n    if (argsStr.length === 0) {\n      this.self.handleFor.call(this, payload, null, true, null);\n    }\n\n    // Range form.\n    else if (this.self.isRangeRe.test(argsStr)) {\n      var parts = argsStr.match(this.self.rangeRe);\n      if (parts === null) {\n        return this.error('invalid range form syntax, format: [[index ,] value] range collection');\n      }\n      this.self.handleForRange.call(this, payload, {\n        type: parts[1],\n        name: parts[2]\n      }, {\n        type: parts[3],\n        name: parts[4]\n      }, parts[5]);\n    }\n\n    // Conditional forms.\n    else {\n      var init;\n      var condition;\n      var post;\n\n      // Conditional-only form.\n      if (argsStr.indexOf(';') === -1) {\n        // Sanity checks.\n        if (this.self.forInRe.test(argsStr)) {\n          return this.error('invalid syntax, for…in is not supported; see: for…range');\n        } else if (this.self.forOfRe.test(argsStr)) {\n          return this.error('invalid syntax, for…of is not supported; see: for…range');\n        }\n        condition = argsStr;\n      }\n\n      // 3-part conditional form.\n      else {\n        var _parts = argsStr.match(this.self.threePartRe);\n        if (_parts === null) {\n          return this.error('invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]');\n        }\n        init = _parts[1];\n        condition = _parts[2].trim();\n        post = _parts[3];\n        if (condition.length === 0) {\n          condition = true;\n        }\n      }\n      this.self.handleFor.call(this, payload, init, condition, post);\n    }\n  },\n  handleFor: function handleFor(payload, init, condition, post) {\n    var evalJavaScript = Scripting.evalJavaScript;\n    var first = true;\n    var safety = Config.macros.maxLoopIterations;\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    try {\n      TempState.break = null;\n      if (init) {\n        try {\n          evalJavaScript(init);\n        } catch (ex) {\n          return this.error(\"bad init expression: \".concat(getErrorMessage(ex)));\n        }\n      }\n      while (evalJavaScript(condition)) {\n        if (--safety < 0) {\n          return this.error(\"exceeded configured maximum loop iterations (\".concat(Config.macros.maxLoopIterations, \")\"));\n        }\n        new Wikifier(this.output, first ? payload.replace(/^\\n/, '') : payload);\n        if (first) {\n          first = false;\n        }\n        if (TempState.break != null) {\n          // lazy equality for null\n          if (TempState.break === 1) {\n            TempState.break = null;\n          } else if (TempState.break === 2) {\n            TempState.break = null;\n            break;\n          }\n        }\n        if (post) {\n          try {\n            evalJavaScript(post);\n          } catch (ex) {\n            return this.error(\"bad post expression: \".concat(getErrorMessage(ex)));\n          }\n        }\n      }\n    } catch (ex) {\n      return this.error(\"bad conditional expression: \".concat(getErrorMessage(ex)));\n    } finally {\n      TempState.break = null;\n    }\n  },\n  handleForRange: function handleForRange(payload, keyVar, valueVar, rangeExp) {\n    var first = true;\n    var rangeable;\n    try {\n      rangeable = this.self.toRangeable(rangeExp);\n    } catch (ex) {\n      return this.error(ex.message);\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    try {\n      TempState.break = null;\n      for (;;) {\n        var entry = rangeable.next();\n        if (entry.done) {\n          break;\n        }\n        if (keyVar.name) {\n          State[keyVar.type][keyVar.name] = entry.key;\n        }\n        if (valueVar.name) {\n          State[valueVar.type][valueVar.name] = entry.value;\n        }\n        new Wikifier(this.output, first ? payload.replace(/^\\n/, '') : payload);\n        if (first) {\n          first = false;\n        }\n        if (TempState.break != null) {\n          // lazy equality for null\n          if (TempState.break === 1) {\n            TempState.break = null;\n          } else if (TempState.break === 2) {\n            TempState.break = null;\n            break;\n          }\n        }\n      }\n    } catch (ex) {\n      return this.error(getErrorMessage(ex));\n    } finally {\n      TempState.break = null;\n    }\n  },\n  toRangeable: function toRangeable(rangeExp) {\n    var collection;\n    try {\n      /*\n      \tNOTE: If the first character is the left curly brace, then we\n      \tassume that it's part of an object literal and wrap it within\n      \tparenthesis to ensure that it is not mistaken for a block\n      \tduring evaluation—which would cause an error.\n      */\n      collection = Scripting.evalJavaScript(rangeExp[0] === '{' ? \"(\".concat(rangeExp, \")\") : rangeExp);\n    } catch (ex) {\n      if (_typeof(ex) !== 'object') {\n        throw new Error(\"bad range expression: \".concat(ex));\n      }\n      ex.message = \"bad range expression: \".concat(ex.message);\n      throw ex;\n    }\n    switch (_typeof(collection)) {\n      case 'number':\n        {\n          if (Number.isNaN(collection) || !Number.isFinite(collection)) {\n            throw new Error(\"unsupported range expression type: \".concat(stringFrom(collection)));\n          }\n          if (!Number.isInteger(collection)) {\n            throw new Error('unsupported range expression type: floating-point number');\n          }\n          if (!Number.isSafeInteger(collection)) {\n            throw new Error('unsupported range expression type: unsafe integer');\n          }\n          if (collection <= 0) {\n            return {\n              next: function next() {\n                return {\n                  done: true\n                };\n              }\n            };\n          }\n          return {\n            end: collection,\n            pos: 0,\n            next: function next() {\n              if (this.pos < this.end) {\n                var key = this.pos++;\n                return {\n                  key: key,\n                  value: key,\n                  done: false\n                };\n              }\n              return {\n                done: true\n              };\n            }\n          };\n        }\n      case 'string':\n        {\n          return {\n            list: collection,\n            end: collection.length,\n            pos: 0,\n            next: function next() {\n              if (this.pos < this.end) {\n                var O = charAndPosAt(this.list, this.pos);\n                var key = this.pos;\n                this.pos = O.end + 1;\n                return {\n                  key: key,\n                  value: O.char,\n                  done: false\n                };\n              }\n              return {\n                done: true\n              };\n            }\n          };\n        }\n      case 'object':\n        {\n          if (collection instanceof Array) {\n            return {\n              list: collection,\n              end: collection.length,\n              pos: 0,\n              next: function next() {\n                if (this.pos < this.end) {\n                  var key = this.pos++;\n                  return {\n                    key: key,\n                    value: this.list[key],\n                    done: false\n                  };\n                }\n                return {\n                  done: true\n                };\n              }\n            };\n          } else if (collection instanceof Set) {\n            /* legacy */\n            // Convert the `Set` to an `Array` to provide indicies.\n            //\n            // TODO: Check what the polyfill's `<Set>.values()` method returns.\n            collection = Array.from(collection);\n            return {\n              list: collection,\n              end: collection.length,\n              pos: 0,\n              next: function next() {\n                if (this.pos < this.end) {\n                  var key = this.pos++;\n                  return {\n                    key: key,\n                    value: this.list[key],\n                    done: false\n                  };\n                }\n                return {\n                  done: true\n                };\n              }\n            };\n            /* /legacy */\n          } else if (collection instanceof Map) {\n            var keys = Array.from(collection.keys());\n            return {\n              keys: keys,\n              list: collection,\n              end: keys.length,\n              pos: 0,\n              next: function next() {\n                if (this.pos < this.end) {\n                  var key = this.keys[this.pos++];\n                  return {\n                    key: key,\n                    value: this.list.get(key),\n                    done: false\n                  };\n                }\n                return {\n                  done: true\n                };\n              }\n            };\n          } else if (getToStringTag(collection) === 'Object') {\n            var _keys = Object.keys(collection);\n            return {\n              keys: _keys,\n              list: collection,\n              end: _keys.length,\n              pos: 0,\n              next: function next() {\n                if (this.pos < this.end) {\n                  var key = this.keys[this.pos++];\n                  return {\n                    key: key,\n                    value: this.list[key],\n                    done: false\n                  };\n                }\n                return {\n                  done: true\n                };\n              }\n            };\n          }\n          throw new Error(\"unsupported range expression type: \".concat(getToStringTag(collection)));\n        }\n      default:\n        throw new Error(\"unsupported range expression type: \".concat(_typeof(collection)));\n    }\n  }\n});\nMacro.add(['break', 'continue'], {\n  skipArgs: true,\n  handler: function handler() {\n    if (this.contextSome(function (ctx) {\n      return ctx.name === 'for';\n    })) {\n      TempState.break = this.name === 'continue' ? 1 : 2;\n    } else {\n      return this.error('must only be used in conjunction with its parent macro <<for>>');\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/goto.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Engine, Macro, Story */\n\n/*\n\t<<goto>>\n*/\nMacro.add('goto', {\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no passage specified');\n    }\n    var passage;\n    if (_typeof(this.args[0]) === 'object') {\n      // Argument was in wiki link syntax.\n      passage = this.args[0].link;\n    } else {\n      // Argument was simply the passage name.\n      passage = this.args[0];\n    }\n    if (!Story.has(passage)) {\n      return this.error(\"passage \\\"\".concat(passage, \"\\\" does not exist\"));\n    }\n\n    /*\n    \tCall `Engine.play()` asynchronously.\n    \t\tNOTE: This does not terminate the current Wikifier call chain,\n    \tthough, ideally, it should.  Doing so would not be trivial, however,\n    \tand there's also the question of whether that behavior would be\n    \tunwanted by users, who are used to the current behavior from\n    \tsimilar macros and constructs.\n    */\n    setTimeout(function () {\n      return Engine.play(passage);\n    }, Engine.DOM_DELAY);\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/if.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Scripting, Wikifier, getErrorMessage */\n\n/*\n\t<<if>>, <<elseif>>, & <<else>>\n*/\nMacro.add('if', {\n  skipArgs: true,\n  tags: ['elseif', 'else'],\n  // Sanity check regular expressions.\n  isElseifWsRE: /^\\s*if\\b/i,\n  isAssignRE: /[^!%&*+\\-/<=>?^|]=[^=>]/,\n  isLiteralRE: new RegExp([\n  // Empty string & template literals\n  '(?:\"\"|\\'\\'|``)',\n  // Double quoted string literal\n  '(?:\"(?:\\\\\\\\.|[^\"\\\\\\\\])+\")',\n  // Single quoted string literal\n  \"(?:'(?:\\\\\\\\.|[^'\\\\\\\\])+')\",\n  // Template literal\n  '(?:`(?:\\\\\\\\.|[^`\\\\\\\\])+`)'].join('|'), 'g'),\n  handler: function handler() {\n    var i;\n    try {\n      var len = this.payload.length;\n\n      // Sanity checks.\n      var isElseifWsRE = this.self.isElseifWsRE;\n      var isAssignRE = this.self.isAssignRE;\n      var isLiteralRE = this.self.isLiteralRE;\n      for ( /* declared previously */i = 0; i < len; ++i) {\n        switch (this.payload[i].name) {\n          case 'else':\n            {\n              if (this.payload[i].args.raw.length > 0) {\n                if (isElseifWsRE.test(this.payload[i].args.raw)) {\n                  return this.error(\"whitespace is not allowed between the \\\"else\\\" and \\\"if\\\" in <<elseif>> clause\".concat(i > 0 ? \" (#\".concat(i, \")\") : ''));\n                }\n                return this.error(\"<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: \".concat(this.payload[i].args.raw));\n              }\n              if (i + 1 !== len) {\n                return this.error('<<else>> must be the final clause');\n              }\n              break;\n            }\n          default:\n            {\n              if (this.payload[i].args.full.length === 0) {\n                return this.error(\"no conditional expression specified for <<\".concat(this.payload[i].name, \">> clause\").concat(i > 0 ? \" (#\".concat(i, \")\") : ''));\n              } else if ((Config.debug || Config.enableOptionalDebugging) && isAssignRE.test(this.payload[i].args.full.replace(isLiteralRE, ''))) {\n                return this.error(\"assignment operator found within <<\".concat(this.payload[i].name, \">> clause\").concat(i > 0 ? \" (#\".concat(i, \")\") : '', \" (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: \").concat(this.payload[i].args.raw));\n              }\n              break;\n            }\n        }\n      }\n      var evalJavaScript = Scripting.evalJavaScript;\n      var success = false;\n\n      // Evaluate the clauses.\n      for ( /* declared previously */i = 0; i < len; ++i) {\n        // Custom debug view setup for the current clause.\n        if (Config.debug) {\n          this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n            nonvoid: false\n          });\n        }\n\n        // Conditional test.\n        if (this.payload[i].name === 'else' || !!evalJavaScript(this.payload[i].args.full)) {\n          success = true;\n          new Wikifier(this.output, this.payload[i].contents);\n          break;\n        } else if (Config.debug) {\n          // Custom debug view setup for a failed conditional.\n          this.debugView.modes({\n            hidden: true,\n            invalid: true\n          });\n        }\n      }\n\n      // Custom debug view setup for the remaining clauses.\n      if (Config.debug) {\n        for ( /* declared previously */++i; i < len; ++i) {\n          this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n            nonvoid: false,\n            hidden: true,\n            invalid: true\n          });\n        }\n\n        /*\n        \tFake a debug view for `<</if>>`.  We do this to aid the checking of nesting\n        \tand as a quick indicator of if any of the clauses matched.\n        */\n        this.createDebugView(\"/\".concat(this.name), \"<</\".concat(this.name, \">>\")).modes({\n          nonvoid: false,\n          hidden: !success,\n          invalid: !success\n        });\n      }\n    } catch (ex) {\n      return this.error(\"bad conditional expression in <<\".concat(i === 0 ? 'if' : 'elseif', \">> clause\").concat(i > 0 ? \" (#\".concat(i, \")\") : '', \": \").concat(getErrorMessage(ex)));\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/include.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Story */\n\n/*\n\t<<include>>\n*/\nMacro.add('include', {\n  handler: function handler() {\n    if (this.name === 'display') {\n      console.warn(\"[DEPRECATED] <<\".concat(this.name, \">> macro is deprecated.\"));\n    }\n    if (this.args.length === 0) {\n      return this.error('no passage specified');\n    }\n    var passage;\n    if (_typeof(this.args[0]) === 'object') {\n      // Argument was in wiki link syntax.\n      passage = this.args[0].link;\n    } else {\n      // Argument was simply the passage name.\n      passage = this.args[0];\n    }\n    if (!Story.has(passage)) {\n      return this.error(\"passage \\\"\".concat(passage, \"\\\" does not exist\"));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    passage = Story.get(passage);\n    var $el;\n    if (this.args[1]) {\n      $el = jQuery(document.createElement(this.args[1])).addClass(\"\".concat(passage.id, \" macro-\").concat(this.name)).attr('data-passage', passage.name).appendTo(this.output);\n    } else {\n      $el = jQuery(this.output);\n    }\n    $el.wiki(passage.processText());\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/linkappend-linkprepend-linkreplace.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Engine, Macro, Wikifier */\n\n/*\n\t<<linkappend>>, <<linkprepend>>, & <<linkreplace>>\n*/\nMacro.add(['linkappend', 'linkprepend', 'linkreplace'], {\n  isAsync: true,\n  tags: null,\n  t8nRe: /^(?:transition|t8n)$/,\n  handler: function handler() {\n    var _this16 = this;\n    if (this.args.length === 0) {\n      return this.error('no link text specified');\n    }\n    var $link = jQuery(document.createElement('a'));\n    var $insert = jQuery(document.createElement('span'));\n    var transition = this.args.length > 1 && this.self.t8nRe.test(this.args[1]);\n    $link.wikiWithOptions({\n      cleanup: false,\n      profile: 'core'\n    }, this.args[0]).addClass(\"link-internal macro-\".concat(this.name)).ariaClick({\n      namespace: '.macros',\n      one: true\n    }, this.shadowHandler(function () {\n      if (_this16.name === 'linkreplace') {\n        $link.remove();\n      } else {\n        $link.wrap(\"<span class=\\\"macro-\".concat(_this16.name, \"\\\"></span>\")).replaceWith(function () {\n          return $link.html();\n        });\n      }\n      if (_this16.payload[0].contents !== '') {\n        var frag = document.createDocumentFragment();\n        new Wikifier(frag, _this16.payload[0].contents, {\n          cleanup: false\n        });\n        $insert.append(frag);\n      }\n      if (transition) {\n        setTimeout(function () {\n          return $insert.removeClass(\"macro-\".concat(_this16.name, \"-in\"));\n        }, Engine.DOM_DELAY);\n      }\n    })).appendTo(this.output);\n    $insert.addClass(\"macro-\".concat(this.name, \"-insert\"));\n    if (transition) {\n      $insert.addClass(\"macro-\".concat(this.name, \"-in\"));\n    }\n    if (this.name === 'linkprepend') {\n      $insert.insertBefore($link);\n    } else {\n      $insert.insertAfter($link);\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/nobr.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, Wikifier */\n\n/*\n\t<<nobr>>\n*/\nMacro.add('nobr', {\n  skipArgs: true,\n  tags: null,\n  handler: function handler() {\n    /*\n    \tWikify the contents, after removing all leading & trailing newlines and compacting\n    \tall internal sequences of newlines into single spaces.\n    */\n    new Wikifier(this.output, this.payload[0].contents.replace(/^\\n+|\\n+$/g, '').replace(/\\n+/g, ' '));\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/numberbox-textbox.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, State, createSlug */\n\n/*\n\t<<numberbox>> & <<textbox>>\n*/\nMacro.add(['numberbox', 'textbox'], {\n  isAsync: true,\n  handler: function handler() {\n    if (this.args.length < 2) {\n      var errors = [];\n      if (this.args.length < 1) {\n        errors.push('variable name');\n      }\n      if (this.args.length < 2) {\n        errors.push('default value');\n      }\n      return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n\n    // Ensure that the variable name argument is a string.\n    if (typeof this.args[0] !== 'string') {\n      return this.error('variable name argument is not a string');\n    }\n    var varName = this.args[0].trim();\n\n    // Try to ensure that we receive the variable's name (incl. sigil), not its value.\n    if (varName[0] !== '$' && varName[0] !== '_') {\n      return this.error(\"variable name \\\"\".concat(this.args[0], \"\\\" is missing its sigil ($ or _)\"));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    var asNumber = this.name === 'numberbox';\n    var defaultValue = asNumber ? Number(this.args[1]) : this.args[1];\n    if (asNumber && Number.isNaN(defaultValue)) {\n      return this.error(\"default value \\\"\".concat(this.args[1], \"\\\" is neither a number nor can it be parsed into a number\"));\n    }\n    var varId = createSlug(varName);\n    var el = document.createElement('input');\n    var autofocus = false;\n    var passage;\n    if (this.args.length > 3) {\n      passage = this.args[2];\n      autofocus = this.args[3] === 'autofocus';\n    } else if (this.args.length > 2) {\n      if (this.args[2] === 'autofocus') {\n        autofocus = true;\n      } else {\n        passage = this.args[2];\n      }\n    }\n    if (_typeof(passage) === 'object') {\n      // Argument was in wiki link syntax.\n      passage = passage.link;\n    }\n\n    // Set up and append the input element to the output buffer.\n    jQuery(el).attr({\n      id: \"\".concat(this.name, \"-\").concat(varId),\n      name: \"\".concat(this.name, \"-\").concat(varId),\n      type: asNumber ? 'number' : 'text',\n      inputmode: asNumber ? 'decimal' : 'text',\n      tabindex: 0 // for accessibility\n    }).addClass(\"macro-\".concat(this.name)).on('change.macros', this.shadowHandler(function () {\n      State.setVar(varName, asNumber ? Number(this.value) : this.value);\n    })).on('keypress.macros', this.shadowHandler(function (ev) {\n      // If Enter/Return is pressed, set the variable and, optionally, forward to another passage.\n      if (ev.which === 13) {\n        // 13 is Enter/Return\n        ev.preventDefault();\n        State.setVar(varName, asNumber ? Number(this.value) : this.value);\n        if (passage != null) {\n          // lazy equality for null\n          Engine.play(passage);\n        }\n      }\n    })).appendTo(this.output);\n\n    // Set the step value for `<input type=\"number\">`.\n    if (asNumber) {\n      el.step = 'any';\n    }\n\n    // Set the variable and input element to the default value.\n    State.setVar(varName, defaultValue);\n    el.value = defaultValue;\n\n    // Autofocus the input element, if requested.\n    if (autofocus) {\n      // Set the element's \"autofocus\" attribute.\n      el.setAttribute('autofocus', 'autofocus');\n\n      // Set up a single-use task to autofocus the element.\n      if (Engine.isPlaying()) {\n        jQuery(document).one(':passageend', function () {\n          setTimeout(function () {\n            return el.focus();\n          }, Engine.DOM_DELAY);\n        });\n      } else {\n        setTimeout(function () {\n          return el.focus();\n        }, Engine.DOM_DELAY);\n      }\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/print.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, Scripting, Wikifier, encodeEntities, getErrorMessage, stringFrom */\n\n/*\n\t<<print>>, <<=>>, & <<->>\n*/\nMacro.add(['print', '=', '-'], {\n  skipArgs: true,\n  handler: function handler() {\n    if (this.args.full.length === 0) {\n      return this.error('no expression specified');\n    }\n    try {\n      var result = stringFrom(Scripting.evalJavaScript(this.args.full));\n      if (result !== null) {\n        new Wikifier(this.output, this.name === '-' ? encodeEntities(result) : result);\n      }\n    } catch (ex) {\n      return this.error(\"bad evaluation: \".concat(getErrorMessage(ex)));\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/radiobutton.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, State, TempState, createSlug */\n\n/*\n\t<<radiobutton>>\n*/\nMacro.add('radiobutton', {\n  isAsync: true,\n  handler: function handler() {\n    if (this.args.length < 2) {\n      var errors = [];\n      if (this.args.length < 1) {\n        errors.push('variable name');\n      }\n      if (this.args.length < 2) {\n        errors.push('checked value');\n      }\n      return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n\n    // Ensure that the variable name argument is a string.\n    if (typeof this.args[0] !== 'string') {\n      return this.error('variable name argument is not a string');\n    }\n    var varName = this.args[0].trim();\n\n    // Try to ensure that we receive the variable's name (incl. sigil), not its value.\n    if (varName[0] !== '$' && varName[0] !== '_') {\n      return this.error(\"variable name \\\"\".concat(this.args[0], \"\\\" is missing its sigil ($ or _)\"));\n    }\n    var varId = createSlug(varName);\n    var checkValue = this.args[1];\n    var el = document.createElement('input');\n\n    /*\n    \tSet up and initialize the group counter.\n    */\n    if (!Object.hasOwn(TempState, this.name)) {\n      TempState[this.name] = {};\n    }\n    if (!Object.hasOwn(TempState[this.name], varId)) {\n      TempState[this.name][varId] = 0;\n    }\n\n    /*\n    \tSet up and append the input element to the output buffer.\n    */\n    jQuery(el).attr({\n      id: \"\".concat(this.name, \"-\").concat(varId, \"-\").concat(TempState[this.name][varId]++),\n      name: \"\".concat(this.name, \"-\").concat(varId),\n      type: 'radio',\n      tabindex: 0 // for accessibility\n    }).addClass(\"macro-\".concat(this.name)).on('change.macros', this.shadowHandler(function () {\n      if (this.checked) {\n        State.setVar(varName, checkValue);\n      }\n    })).appendTo(this.output);\n\n    /*\n    \tSet the variable to the checked value and the input element to checked, if requested.\n    */\n    switch (this.args[2]) {\n      case 'autocheck':\n        {\n          if (State.getVar(varName) === checkValue) {\n            el.checked = true;\n          }\n          break;\n        }\n      case 'checked':\n        {\n          el.checked = true;\n          State.setVar(varName, checkValue);\n          break;\n        }\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/remove.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro */\n\n/*\n\t<<remove>>\n*/\nMacro.add('remove', {\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no selector specified');\n    }\n    var $targets = jQuery(this.args[0]);\n    if ($targets.length === 0) {\n      return this.error(\"no elements matched the selector \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    $targets.remove();\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/removeclass.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro */\n\n/*\n\t<<removeclass>>\n*/\nMacro.add('removeclass', {\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no selector specified');\n    }\n    var $targets = jQuery(this.args[0]);\n    if ($targets.length === 0) {\n      return this.error(\"no elements matched the selector \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    if (this.args.length > 1) {\n      $targets.removeClass(this.args[1].trim());\n    } else {\n      $targets.removeClass();\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/repeat-stop.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, State, TempState, Wikifier, cssTimeToMS */\n\n/*\n\t<<repeat>> & <<stop>>\n*/\nMacro.add('repeat', {\n  isAsync: true,\n  tags: null,\n  timers: new Set(),\n  t8nRe: /^(?:transition|t8n)$/,\n  handler: function handler() {\n    var _this17 = this;\n    if (this.args.length === 0) {\n      return this.error('no time value specified');\n    }\n    var delay;\n    try {\n      delay = Math.max(Engine.DOM_DELAY, cssTimeToMS(this.args[0]));\n    } catch (ex) {\n      return this.error(ex.message);\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    var transition = this.args.length > 1 && this.self.t8nRe.test(this.args[1]);\n    var $wrapper = jQuery(document.createElement('span')).addClass(\"macro-\".concat(this.name)).appendTo(this.output);\n\n    // Register the timer.\n    this.self.registerInterval(this.shadowHandler(function () {\n      var frag = document.createDocumentFragment();\n      new Wikifier(frag, _this17.payload[0].contents, {\n        cleanup: false\n      });\n      var $output = $wrapper;\n      if (transition) {\n        $output = jQuery(document.createElement('span')).addClass('macro-repeat-insert macro-repeat-in').appendTo($output);\n      }\n      $output.append(frag);\n      if (transition) {\n        setTimeout(function () {\n          return $output.removeClass('macro-repeat-in');\n        }, Engine.DOM_DELAY);\n      }\n    }), delay);\n  },\n  registerInterval: function registerInterval(callback, delay) {\n    var _this18 = this;\n    if (typeof callback !== 'function') {\n      throw new TypeError('callback parameter must be a function');\n    }\n\n    // Cache info about the current turn.\n    var passage = State.passage;\n    var turn = State.turns;\n\n    // Timer info.\n    var timers = this.timers;\n    var timerId = null;\n\n    // Set up the interval and record its ID.\n    timerId = setInterval(function () {\n      // Terminate if we've navigated away.\n      if (State.passage !== passage || State.turns !== turn) {\n        clearInterval(timerId);\n        timers.delete(timerId);\n        return;\n      }\n      var timerIdCache;\n      /*\n      \tThere's no catch clause because this try/finally is here simply to ensure that\n      \tproper cleanup is done in the event that an exception is thrown during the\n      \t`Wikifier` call.\n      */\n      try {\n        TempState.break = null;\n\n        // Set up the `repeatTimerId` value, caching the existing value, if necessary.\n        if (Object.hasOwn(TempState, 'repeatTimerId')) {\n          timerIdCache = TempState.repeatTimerId;\n        }\n        TempState.repeatTimerId = timerId;\n\n        // Execute the callback.\n        callback.call(_this18);\n      } finally {\n        // Teardown the `repeatTimerId` property, restoring the cached value, if necessary.\n        if (typeof timerIdCache !== 'undefined') {\n          TempState.repeatTimerId = timerIdCache;\n        } else {\n          delete TempState.repeatTimerId;\n        }\n        TempState.break = null;\n      }\n    }, delay);\n    timers.add(timerId);\n\n    // Set up a single-use event handler to remove pending timers upon passage navigation.\n    if (timers.size === 1) {\n      jQuery(document).one(':passageinit', function () {\n        timers.forEach(function (timerId) {\n          return clearInterval(timerId);\n        });\n        timers.clear();\n      });\n    }\n  }\n});\nMacro.add('stop', {\n  skipArgs: true,\n  handler: function handler() {\n    if (!Object.hasOwn(TempState, 'repeatTimerId')) {\n      return this.error('must only be used in conjunction with its parent macro <<repeat>>');\n    }\n    var timers = Macro.get('repeat').timers;\n    var timerId = TempState.repeatTimerId;\n    clearInterval(timerId);\n    timers.delete(timerId);\n    TempState.break = 2;\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/script.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Scripting, getErrorMessage */\n\n/*\n\t<<script>>\n*/\nMacro.add('script', {\n  tags: null,\n  handler: function handler() {\n    var lang = this.args.length > 0 ? String(this.args[0]).toLowerCase() : 'javascript';\n    var evalScript;\n    switch (lang) {\n      case 'javascript':\n        evalScript = Scripting.evalJavaScript;\n        break;\n      case 'twinescript':\n        evalScript = Scripting.evalTwineScript;\n        break;\n      default:\n        return this.error(\"unknown language \\\"\".concat(this.args[0], \"\\\"\"));\n    }\n    var output = document.createDocumentFragment();\n    try {\n      evalScript(this.payload[0].contents, output);\n    } catch (ex) {\n      return this.error(\"bad evaluation: \".concat(getErrorMessage(ex)));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.createDebugView();\n    }\n    if (output.hasChildNodes()) {\n      this.output.appendChild(output);\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/set-run.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Scripting, getErrorMessage */\n\n/*\n\t<<set>>\n*/\nMacro.add('set', {\n  skipArgs: true,\n  handler: function handler() {\n    if (this.args.full.length === 0) {\n      return this.error('no expression specified');\n    }\n    try {\n      Scripting.evalJavaScript(this.args.full);\n    } catch (ex) {\n      return this.error(\"bad evaluation: \".concat(getErrorMessage(ex)));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/*\n\t<<run>> — Alias of <<set>>\n*/\nMacro.add('run', 'set');\n\n/***********************************************************************************************************************\n\n\tmacro/macros/silent.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Wikifier */\n\n/*\n\t<<silent>>\n*/\nMacro.add('silent', {\n  skipArgs: true,\n  tags: null,\n  handler: function handler() {\n    if (this.name === 'silently') {\n      console.warn(\"[DEPRECATED] <<\".concat(this.name, \">> macro is deprecated.\"));\n    }\n    var frag = document.createDocumentFragment();\n    new Wikifier(frag, this.payload[0].contents.trim());\n    if (Config.debug) {\n      // Custom debug view setup.\n      this.debugView.modes({\n        block: true,\n        hidden: true\n      });\n      this.output.appendChild(frag);\n    } else {\n      // Discard the output, unless there were errors.\n      var errList = Array.from(frag.querySelectorAll('.error')).map(function (errEl) {\n        return errEl.textContent;\n      });\n      if (errList.length > 0) {\n        return this.error(\"error\".concat(errList.length === 1 ? '' : 's', \" within contents (\").concat(errList.join('; '), \")\"));\n      }\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/switch.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Scripting, Wikifier, getErrorMessage */\n\n/*\n\t<<switch>>, <<case>>, & <<default>>\n*/\nMacro.add('switch', {\n  skipArgs: ['switch'],\n  tags: ['case', 'default'],\n  handler: function handler() {\n    if (this.args.full.length === 0) {\n      return this.error('no expression specified');\n    }\n    var len = this.payload.length;\n\n    // if (len === 1 || !this.payload.some(p => p.name === 'case')) {\n    if (len === 1) {\n      return this.error('no cases specified');\n    }\n    var i;\n\n    // Sanity checks.\n    for ( /* declared previously */i = 1; i < len; ++i) {\n      switch (this.payload[i].name) {\n        case 'default':\n          {\n            if (this.payload[i].args.length > 0) {\n              return this.error(\"<<default>> does not accept values, invalid: \".concat(this.payload[i].args.raw));\n            }\n            if (i + 1 !== len) {\n              return this.error('<<default>> must be the final case');\n            }\n            break;\n          }\n        default:\n          {\n            if (this.payload[i].args.length === 0) {\n              return this.error(\"no value(s) specified for <<\".concat(this.payload[i].name, \">> (#\").concat(i, \")\"));\n            }\n            break;\n          }\n      }\n    }\n    var result;\n    try {\n      result = Scripting.evalJavaScript(this.args.full);\n    } catch (ex) {\n      return this.error(\"bad evaluation: \".concat(getErrorMessage(ex)));\n    }\n    var debugView = this.debugView; // cache it now, to be modified later\n    var success = false;\n\n    // Initial debug view setup for `<<switch>>`.\n    if (Config.debug) {\n      debugView.modes({\n        nonvoid: false,\n        hidden: true\n      });\n    }\n\n    // Evaluate the clauses.\n    for ( /* declared previously */i = 1; i < len; ++i) {\n      // Custom debug view setup for the current case.\n      if (Config.debug) {\n        this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n          nonvoid: false\n        });\n      }\n\n      // Case test(s).\n      if (this.payload[i].name === 'default' || this.payload[i].args.some(function (val) {\n        return val === result;\n      })) {\n        success = true;\n        new Wikifier(this.output, this.payload[i].contents);\n        break;\n      } else if (Config.debug) {\n        // Custom debug view setup for a failed case.\n        this.debugView.modes({\n          hidden: true,\n          invalid: true\n        });\n      }\n    }\n\n    // Custom debug view setup for the remaining cases.\n    if (Config.debug) {\n      for (++i; i < len; ++i) {\n        this.createDebugView(this.payload[i].name, this.payload[i].source).modes({\n          nonvoid: false,\n          hidden: true,\n          invalid: true\n        });\n      }\n\n      /*\n      \tFinalize the debug view for `<<switch>>` and fake a debug view for `<</switch>>`.\n      \tWe do both as a quick indicator of if any of the cases matched and the latter\n      \tto aid the checking of nesting.\n      */\n      debugView.modes({\n        nonvoid: false,\n        hidden: true,\n        // !success,\n        invalid: !success\n      });\n      this.createDebugView(\"/\".concat(this.name), \"<</\".concat(this.name, \">>\")).modes({\n        nonvoid: false,\n        hidden: true,\n        // !success,\n        invalid: !success\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/textarea.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, State, createSlug */\n\n/*\n\t<<textarea>>\n*/\nMacro.add('textarea', {\n  isAsync: true,\n  handler: function handler() {\n    if (this.args.length < 2) {\n      var errors = [];\n      if (this.args.length < 1) {\n        errors.push('variable name');\n      }\n      if (this.args.length < 2) {\n        errors.push('default value');\n      }\n      return this.error(\"no \".concat(errors.join(' or '), \" specified\"));\n    }\n\n    // Ensure that the variable name argument is a string.\n    if (typeof this.args[0] !== 'string') {\n      return this.error('variable name argument is not a string');\n    }\n    var varName = this.args[0].trim();\n\n    // Try to ensure that we receive the variable's name (incl. sigil), not its value.\n    if (varName[0] !== '$' && varName[0] !== '_') {\n      return this.error(\"variable name \\\"\".concat(this.args[0], \"\\\" is missing its sigil ($ or _)\"));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    var varId = createSlug(varName);\n    var defaultValue = this.args[1];\n    var autofocus = this.args[2] === 'autofocus';\n    var el = document.createElement('textarea');\n\n    // Set up and append the textarea element to the output buffer.\n    jQuery(el).attr({\n      id: \"\".concat(this.name, \"-\").concat(varId),\n      name: \"\".concat(this.name, \"-\").concat(varId),\n      rows: 4,\n      // cols     : 68, // instead of setting \"cols\" we set the `min-width` in CSS\n      tabindex: 0 // for accessibility\n    }).addClass(\"macro-\".concat(this.name)).on('change.macros', this.shadowHandler(function () {\n      State.setVar(varName, this.value);\n    })).appendTo(this.output);\n\n    // Set the variable and textarea element to the default value.\n    State.setVar(varName, defaultValue);\n    // Ideally, we should be setting `.defaultValue` here, but IE doesn't support it,\n    // so we have to use `.textContent`, which is equivalent.\n    el.textContent = defaultValue;\n\n    // Autofocus the textarea element, if requested.\n    if (autofocus) {\n      // Set the element's \"autofocus\" attribute.\n      el.setAttribute('autofocus', 'autofocus');\n\n      // Set up a single-use task to autofocus the element.\n      if (Engine.isPlaying()) {\n        jQuery(document).one(':passageend', function () {\n          setTimeout(function () {\n            return el.focus();\n          }, Engine.DOM_DELAY);\n        });\n      } else {\n        setTimeout(function () {\n          return el.focus();\n        }, Engine.DOM_DELAY);\n      }\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/timed.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, DebugView, Engine, Macro, State, Wikifier, cssTimeToMS */\n\n/*\n\t<<timed>> & <<next>>\n*/\nMacro.add('timed', {\n  isAsync: true,\n  tags: ['next'],\n  timers: new Set(),\n  t8nRe: /^(?:transition|t8n)$/,\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no time value specified in <<timed>>');\n    }\n    var items = [];\n    try {\n      items.push({\n        name: this.name,\n        source: this.source,\n        delay: Math.max(Engine.DOM_DELAY, cssTimeToMS(this.args[0])),\n        content: this.payload[0].contents\n      });\n    } catch (ex) {\n      return this.error(\"\".concat(ex.message, \" in <<timed>>\"));\n    }\n    if (this.payload.length > 1) {\n      var i;\n      try {\n        var len;\n        for (i = 1, len = this.payload.length; i < len; ++i) {\n          items.push({\n            name: this.payload[i].name,\n            source: this.payload[i].source,\n            delay: this.payload[i].args.length === 0 ? items[items.length - 1].delay : Math.max(Engine.DOM_DELAY, cssTimeToMS(this.payload[i].args[0])),\n            content: this.payload[i].contents\n          });\n        }\n      } catch (ex) {\n        return this.error(\"\".concat(ex.message, \" in <<next>> (#\").concat(i, \")\"));\n      }\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n    var transition = this.args.length > 1 && this.self.t8nRe.test(this.args[1]);\n    var $wrapper = jQuery(document.createElement('span')).addClass(\"macro-\".concat(this.name)).appendTo(this.output);\n\n    // Register the timer.\n    this.self.registerTimeout(this.shadowHandler(function (item) {\n      var frag = document.createDocumentFragment();\n      new Wikifier(frag, item.content, {\n        cleanup: false\n      });\n\n      // Output.\n      var $output = $wrapper;\n\n      // Custom debug view setup for `<<next>>`.\n      if (Config.debug && item.name === 'next') {\n        $output = jQuery(new DebugView(\n        // eslint-disable-line no-param-reassign\n        $output[0], 'macro', item.name, item.source).output);\n      }\n      if (transition) {\n        $output = jQuery(document.createElement('span')).addClass('macro-timed-insert macro-timed-in').appendTo($output);\n      }\n      $output.append(frag);\n      if (transition) {\n        setTimeout(function () {\n          return $output.removeClass('macro-timed-in');\n        }, Engine.DOM_DELAY);\n      }\n    }), items);\n  },\n  registerTimeout: function registerTimeout(callback, items) {\n    if (typeof callback !== 'function') {\n      throw new TypeError('callback parameter must be a function');\n    }\n\n    // Cache info about the current turn.\n    var passage = State.passage;\n    var turn = State.turns;\n\n    // Timer info.\n    var timers = this.timers;\n    var timerId = null;\n    var nextItem = items.shift();\n    var worker = function worker() {\n      // Bookkeeping.\n      timers.delete(timerId);\n\n      // Terminate if we've navigated away.\n      if (State.passage !== passage || State.turns !== turn) {\n        return;\n      }\n\n      // Set the current item and set up the next worker, if any.\n      var curItem = nextItem;\n      if ((nextItem = items.shift()) != null) {\n        // lazy equality for null\n        timerId = setTimeout(worker, nextItem.delay);\n        timers.add(timerId);\n      }\n\n      // Execute the callback.\n      callback.call(this, curItem);\n    };\n\n    // Set up the timeout and record its ID.\n    timerId = setTimeout(worker, nextItem.delay);\n    timers.add(timerId);\n\n    // Set up a single-use event handler to remove pending timers upon passage navigation.\n    if (timers.size === 1) {\n      jQuery(document).one(':passageinit', function () {\n        timers.forEach(function (timerId) {\n          return clearTimeout(timerId);\n        });\n        timers.clear();\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/type.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, Macro, NodeTyper, State, TempState, Wikifier, cssTimeToMS, scrubEventKey, triggerEvent */\n\n/*\n\t<<type speed [start delay] [class classes] [element tag] [id ID] [keep|none] [skipkey key]>>\n*/\nMacro.add('type', {\n  isAsync: true,\n  tags: null,\n  typeId: 0,\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no speed specified');\n    }\n    var speed = cssTimeToMS(this.args[0]); // in milliseconds\n\n    if (speed < 0) {\n      return this.error(\"speed time value must be non-negative (received: \".concat(this.args[0], \")\"));\n    }\n    var cursor;\n    var elClass = '';\n    var elId = '';\n    var elTag = 'div';\n    var skipKey = Config.macros.typeSkipKey;\n    var start = 400; // in milliseconds\n\n    // Process optional arguments.\n    var options = this.args.slice(1);\n    while (options.length > 0) {\n      var option = options.shift();\n      switch (option) {\n        case 'class':\n          {\n            if (options.length === 0) {\n              return this.error('class option missing required class name(s)');\n            }\n            elClass = options.shift();\n            if (elClass === '') {\n              throw new Error('class option class name(s) must be non-empty (received: \"\")');\n            }\n            break;\n          }\n        case 'element':\n          {\n            if (options.length === 0) {\n              return this.error('element option missing required element tag name');\n            }\n            elTag = options.shift();\n            if (elTag === '') {\n              throw new Error('element option tag name must be non-empty (received: \"\")');\n            }\n            break;\n          }\n        case 'id':\n          {\n            if (options.length === 0) {\n              return this.error('id option missing required ID');\n            }\n            elId = options.shift();\n            if (elId === '') {\n              throw new Error('id option ID must be non-empty (received: \"\")');\n            }\n            break;\n          }\n        case 'keep':\n          cursor = 'keep';\n          break;\n        case 'none':\n          cursor = 'none';\n          break;\n        case 'skipkey':\n          {\n            if (options.length === 0) {\n              return this.error('skipkey option missing required key value');\n            }\n            skipKey = options.shift();\n            if (skipKey === '') {\n              throw new Error('skipkey option key value must be non-empty (received: \"\")');\n            }\n            break;\n          }\n        case 'start':\n          {\n            if (options.length === 0) {\n              return this.error('start option missing required time value');\n            }\n            var value = options.shift();\n            start = cssTimeToMS(value);\n            if (start < 0) {\n              throw new Error(\"start option time value must be non-negative (received: \".concat(value, \")\"));\n            }\n            break;\n          }\n        default:\n          return this.error(\"unknown option: \".concat(option));\n      }\n    }\n    var contents = this.payload[0].contents;\n\n    // Do nothing if there's no content to type out.\n    if (contents.trim() === '') {\n      return;\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        block: true\n      });\n    }\n\n    // Set up our base class name and event namespace.\n    var className = \"macro-\".concat(this.name);\n    var namespace = \".\".concat(className);\n\n    // Create a target to be later replaced by the typing wrapper.\n    var $target = jQuery(document.createElement(elTag)).addClass(\"\".concat(className, \" \").concat(className, \"-target\")).appendTo(this.output);\n\n    // Initialize the queue and clean up handlers.\n    if (!TempState.macroTypeQueue) {\n      // Set up the typing handler queue for all invocations.\n      TempState.macroTypeQueue = [];\n\n      // Immediately clear any existing handlers from our namespace and set up a\n      // `:passageinit` event handler to clean up after navigation.\n      $(document).off(namespace).one(\":passageinit\".concat(namespace), function () {\n        return $(document).off(namespace);\n      });\n    }\n\n    // If the queue is empty at this point, set the start typing flag.\n    var startTyping = TempState.macroTypeQueue.length === 0;\n\n    // Generate our unique ID.\n    var selfId = ++this.self.typeId;\n\n    // Push our typing handler onto the queue.\n    var allowCleanup = this.self.allowCleanup;\n    TempState.macroTypeQueue.push({\n      id: selfId,\n      handler: this.shadowHandler(function () {\n        var $wrapper = jQuery(document.createElement(elTag)).addClass(className);\n\n        // Add the user ID, if any.\n        if (elId) {\n          $wrapper.attr('id', elId);\n        }\n\n        // Add the user class(es), if any.\n        if (elClass) {\n          $wrapper.addClass(elClass);\n        }\n\n        // Wikify the contents into `$wrapper`.\n        new Wikifier($wrapper, contents, allowCleanup(elTag) ? undefined : {\n          cleanup: false\n        });\n\n        // Cache info about the current turn.\n        var passage = State.passage;\n        var turn = State.turns;\n\n        // Skip typing if…\n        if (\n        // …speed is zero.\n        speed === 0\n\n        // …we've visited the passage before.\n        || !Config.macros.typeVisitedPassages && State.passages.slice(0, -1).some(function (title) {\n          return title === passage;\n        })\n\n        // …there were any content errors.\n        || $wrapper.find('.error').length > 0) {\n          $target.replaceWith($wrapper);\n\n          // Remove this handler from the queue.\n          TempState.macroTypeQueue.shift();\n\n          // Run the next typing handler in the queue, if any.\n          if (TempState.macroTypeQueue.length > 0) {\n            TempState.macroTypeQueue.first().handler();\n          }\n\n          // Exit.\n          return;\n        }\n\n        // Create a new `NodeTyper` instance for the wrapper's contents and\n        // replace the target with the typing wrapper.\n        var typer = new NodeTyper({\n          targetNode: $wrapper.get(0),\n          classNames: cursor === 'none' ? null : \"\".concat(className, \"-cursor\")\n        });\n        $target.replaceWith($wrapper);\n\n        // Set up event IDs.\n        var typingCompleteId = ':typingcomplete';\n        var typingStartId = ':typingstart';\n        var typingStopId = ':typingstop';\n        var keydownAndNS = \"keydown\".concat(namespace);\n        var typingStopAndNS = \"\".concat(typingStopId).concat(namespace);\n\n        // Set up handlers for spacebar aborting and continuations.\n        $(document).off(keydownAndNS).on(keydownAndNS, function (ev) {\n          // Finish typing if the player aborts via the skip key.\n          if (scrubEventKey(ev.key) === skipKey && (ev.target === document.body || ev.target === document.documentElement)) {\n            ev.preventDefault();\n            $(document).off(keydownAndNS);\n            typer.finish();\n          }\n        }).one(typingStopAndNS, function () {\n          if (TempState.macroTypeQueue) {\n            // If the queue is empty, fire the typing complete event.\n            if (TempState.macroTypeQueue.length === 0) {\n              triggerEvent(typingCompleteId);\n            }\n            // Elsewise, run the next typing handler in the queue.\n            else {\n              TempState.macroTypeQueue.first().handler();\n            }\n          }\n        });\n\n        // Set up the typing interval and start/stop event firing.\n        var typeNode = function typeNode() {\n          var typeNodeMember = function typeNodeMember(typeIntervalId) {\n            // Stop typing if…\n            if (\n            // …we've navigated away.\n            State.passage !== passage || State.turns !== turn\n\n            // …we're done typing.\n            || !typer.type()) {\n              // Terminate the timer, if it exists.\n              if (typeIntervalId) {\n                clearInterval(typeIntervalId);\n              }\n\n              // Remove this handler from the queue, if the queue still exists and the\n              // handler IDs match.\n              if (TempState.macroTypeQueue && TempState.macroTypeQueue.length > 0 && TempState.macroTypeQueue.first().id === selfId) {\n                TempState.macroTypeQueue.shift();\n              }\n\n              // Fire the typing stop event.\n              triggerEvent(typingStopId, $wrapper);\n\n              // Add the done class to the wrapper.\n              $wrapper.addClass(\"\".concat(className, \"-done\"));\n\n              // Add the cursor class to the wrapper, if we're keeping it.\n              if (cursor === 'keep') {\n                $wrapper.addClass(\"\".concat(className, \"-cursor\"));\n              }\n            }\n          };\n\n          // Fire the typing start event.\n          triggerEvent(typingStartId, $wrapper);\n\n          // Type the initial node member.\n          typeNodeMember();\n\n          // Set up the interval to continue typing.\n          var typeNodeMemberId = setInterval(function () {\n            return typeNodeMember(typeNodeMemberId);\n          }, speed);\n        };\n\n        // Kick off typing the node.\n        if (start) {\n          setTimeout(typeNode, start);\n        } else {\n          typeNode();\n        }\n      })\n    });\n\n    // If we're to start typing, then either set up a `:passageend` event handler\n    // to do so or start it immediately, depending on the engine state.\n    if (startTyping) {\n      if (Engine.isPlaying()) {\n        $(document).one(\":passageend\".concat(namespace), function () {\n          return TempState.macroTypeQueue.first().handler();\n        });\n      } else {\n        TempState.macroTypeQueue.first().handler();\n      }\n    }\n  },\n  allowCleanup: function allowCleanup(tagName) {\n    switch (tagName.toUpperCase()) {\n      case 'ARTICLE':\n      case 'DIV':\n      case 'FOOTER':\n      case 'FORM':\n      case 'HEADER':\n      case 'MAIN':\n      case 'SECTION':\n        return true;\n    }\n    return false;\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/unset.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, Scripting, getErrorMessage */\n\n/*\n\t<<unset>>\n*/\nMacro.add('unset', {\n  skipArgs: true,\n  handler: function handler() {\n    if (this.args.full.length === 0) {\n      return this.error('no story/temporary variable list specified');\n    }\n    var searchRe = /[,;\\s]*((?:State\\.(?:variables|temporary)|setup)\\.)/g;\n    var replacer = function replacer(_, p1) {\n      return \"; delete \".concat(p1);\n    };\n    var cleanupRe = /^; /;\n    try {\n      var unsetExp = this.args.full.replace(searchRe, replacer).replace(cleanupRe, '');\n      Scripting.evalJavaScript(unsetExp);\n    } catch (ex) {\n      return this.error(\"bad evaluation: \".concat(getErrorMessage(ex)));\n    }\n\n    // Custom debug view setup.\n    if (Config.debug) {\n      this.debugView.modes({\n        hidden: true\n      });\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/macros/widget.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Macro, State, Wikifier */\n\n/*\n\t<<widget>>\n*/\nMacro.add('widget', {\n  tags: null,\n  handler: function handler() {\n    if (this.args.length === 0) {\n      return this.error('no widget name specified');\n    }\n    var widgetName = this.args[0];\n    var isNonVoid = this.args.length > 1 && this.args[1] === 'container';\n    if (Macro.has(widgetName)) {\n      return this.error(\"cannot clobber existing \".concat(Macro.get(widgetName).isWidget ? 'widget' : 'macro', \" \\\"\").concat(widgetName, \"\\\"\"));\n    }\n    try {\n      var widgetDef = {\n        isWidget: true,\n        handler: function (widgetCode) {\n          return function () {\n            var shadowStore = {};\n\n            // Cache the existing value of the `_args` variable, if necessary.\n            if (Object.hasOwn(State.temporary, 'args')) {\n              shadowStore._args = State.temporary.args;\n            }\n\n            // Set up the widget `_args` variable and add a shadow.\n            State.temporary.args = Array.from(this.args);\n            State.temporary.args.raw = this.args.raw;\n            State.temporary.args.full = this.args.full;\n            State.temporary.args.name = this.name;\n            this.addShadow('_args');\n            if (isNonVoid) {\n              // Cache the existing value of the `_contents` variable, if necessary.\n              if (Object.hasOwn(State.temporary, 'contents')) {\n                shadowStore._contents = State.temporary.contents;\n              }\n\n              // Set up the widget `_contents` variable and add a shadow.\n              State.temporary.contents = this.payload[0].contents;\n              this.addShadow('_contents');\n            }\n\n            /* legacy */\n            // Cache the existing value of the `$args` variable, if necessary.\n            if (Object.hasOwn(State.variables, 'args')) {\n              shadowStore.$args = State.variables.args;\n            }\n\n            // Set up the widget `$args` variable and add a shadow.\n            State.variables.args = State.temporary.args;\n            this.addShadow('$args');\n            /* /legacy */\n\n            try {\n              // Set up the error trapping variables.\n              var resFrag = document.createDocumentFragment();\n              var errList = [];\n\n              // Wikify the widget's code.\n              new Wikifier(resFrag, widgetCode);\n\n              // Carry over the output, unless there were errors.\n              Array.from(resFrag.querySelectorAll('.error')).forEach(function (errEl) {\n                errList.push(errEl.textContent);\n              });\n              if (errList.length === 0) {\n                this.output.appendChild(resFrag);\n              } else {\n                return this.error(\"error\".concat(errList.length > 1 ? 's' : '', \" within widget code (\").concat(errList.join('; '), \")\"));\n              }\n            } catch (ex) {\n              return this.error(\"cannot execute widget: \".concat(ex.message));\n            } finally {\n              // Revert the `_args` variable shadowing.\n              if (Object.hasOwn(shadowStore, '_args')) {\n                State.temporary.args = shadowStore._args;\n              } else {\n                delete State.temporary.args;\n              }\n              if (isNonVoid) {\n                // Revert the `_contents` variable shadowing.\n                if (Object.hasOwn(shadowStore, '_contents')) {\n                  State.temporary.contents = shadowStore._contents;\n                } else {\n                  delete State.temporary.contents;\n                }\n              }\n\n              /* legacy */\n              // Revert the `$args` variable shadowing.\n              if (Object.hasOwn(shadowStore, '$args')) {\n                State.variables.args = shadowStore.$args;\n              } else {\n                delete State.variables.args;\n              }\n              /* /legacy */\n            }\n          };\n        }(this.payload[0].contents)\n      };\n      if (isNonVoid) {\n        widgetDef.tags = [];\n      }\n      Macro.add(widgetName, widgetDef);\n\n      // Custom debug view setup.\n      if (Config.debug) {\n        this.debugView.modes({\n          hidden: true\n        });\n      }\n    } catch (ex) {\n      return this.error(\"cannot create widget macro \\\"\".concat(widgetName, \"\\\": \").concat(ex.message));\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tmacro/deprecated-macros.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Macro, State, Wikifier */\n\n/*******************************************************************************\n\tDisplay Macros.\n*******************************************************************************/\n\n/*\n\t[DEPRECATED] <<silently>> — Alias of <<silent>>\n*/\nMacro.add('silently', 'silent');\n\n/*******************************************************************************\n\tLinks Macros.\n*******************************************************************************/\n\n/*\n\t[DEPRECATED] <<actions>>\n*/\nMacro.add('actions', {\n  handler: function handler() {\n    console.warn(\"[DEPRECATED] <<\".concat(this.name, \">> macro is deprecated.\"));\n    var $list = jQuery(document.createElement('ul')).addClass(this.name).appendTo(this.output);\n    for (var i = 0; i < this.args.length; ++i) {\n      var passage = void 0;\n      var text = void 0;\n      var $image = void 0;\n      var setFn = void 0;\n      if (_typeof(this.args[i]) === 'object') {\n        if (this.args[i].isImage) {\n          // Argument was in wiki image syntax.\n          $image = jQuery(document.createElement('img')).attr('src', this.args[i].source);\n          if (Object.hasOwn(this.args[i], 'passage')) {\n            $image.attr('data-passage', this.args[i].passage);\n          }\n          if (Object.hasOwn(this.args[i], 'title')) {\n            $image.attr('title', this.args[i].title);\n          }\n          if (Object.hasOwn(this.args[i], 'align')) {\n            $image.attr('align', this.args[i].align);\n          }\n          passage = this.args[i].link;\n          setFn = this.args[i].setFn;\n        } else {\n          // Argument was in wiki link syntax.\n          text = this.args[i].text;\n          passage = this.args[i].link;\n          setFn = this.args[i].setFn;\n        }\n      } else {\n        // Argument was simply the passage name.\n        text = passage = this.args[i];\n      }\n      if (Object.hasOwn(State.variables, '#actions') && Object.hasOwn(State.variables['#actions'], passage) && State.variables['#actions'][passage]) {\n        continue;\n      }\n      var $link = jQuery(Wikifier.createInternalLink(jQuery(document.createElement('li')).appendTo($list), passage, null, function (passage, fn) {\n        return function () {\n          if (!Object.hasOwn(State.variables, '#actions')) {\n            State.variables['#actions'] = {};\n          }\n          State.variables['#actions'][passage] = true;\n          if (typeof fn === 'function') {\n            fn();\n          }\n        };\n      }(passage, setFn))).addClass(\"macro-\".concat(this.name)).append($image || document.createTextNode(text));\n      if ($image) {\n        $link.addClass('link-image');\n      }\n    }\n  }\n});\n\n/*\n\t[DEPRECATED] <<choice>>\n*/\nMacro.add('choice', {\n  handler: function handler() {\n    console.warn(\"[DEPRECATED] <<\".concat(this.name, \">> macro is deprecated.\"));\n    if (this.args.length === 0) {\n      return this.error('no passage specified');\n    }\n    var choiceId = State.passage;\n    var passage;\n    var text;\n    var $image;\n    var setFn;\n    if (this.args.length === 1) {\n      if (_typeof(this.args[0]) === 'object') {\n        if (this.args[0].isImage) {\n          // Argument was in wiki image syntax.\n          $image = jQuery(document.createElement('img')).attr('src', this.args[0].source);\n          if (Object.hasOwn(this.args[0], 'passage')) {\n            $image.attr('data-passage', this.args[0].passage);\n          }\n          if (Object.hasOwn(this.args[0], 'title')) {\n            $image.attr('title', this.args[0].title);\n          }\n          if (Object.hasOwn(this.args[0], 'align')) {\n            $image.attr('align', this.args[0].align);\n          }\n          passage = this.args[0].link;\n          setFn = this.args[0].setFn;\n        } else {\n          // Argument was in wiki link syntax.\n          text = this.args[0].text;\n          passage = this.args[0].link;\n          setFn = this.args[0].setFn;\n        }\n      } else {\n        // Argument was simply the passage name.\n        text = passage = this.args[0];\n      }\n    } else {\n      // NOTE: The arguments here are backwards.\n      passage = this.args[0];\n      text = this.args[1];\n    }\n    var $link;\n    if (Object.hasOwn(State.variables, '#choice') && Object.hasOwn(State.variables['#choice'], choiceId) && State.variables['#choice'][choiceId]) {\n      $link = jQuery(document.createElement('span')).addClass(\"link-disabled macro-\".concat(this.name)).attr('tabindex', -1).append($image || document.createTextNode(text)).appendTo(this.output);\n      if ($image) {\n        $link.addClass('link-image');\n      }\n      return;\n    }\n    $link = jQuery(Wikifier.createInternalLink(this.output, passage, null, function () {\n      if (!Object.hasOwn(State.variables, '#choice')) {\n        State.variables['#choice'] = {};\n      }\n      State.variables['#choice'][choiceId] = true;\n      if (typeof setFn === 'function') {\n        setFn();\n      }\n    })).addClass(\"macro-\".concat(this.name)).append($image || document.createTextNode(text));\n    if ($image) {\n      $link.addClass('link-image');\n    }\n  }\n});\n\n/***********************************************************************************************************************\n\n\tdialog.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Has, L10n, Story, getActiveElement, getTypeOf, triggerEvent */\n\nvar Dialog = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Default top position.\n  var DEFAULT_TOP = 50; // in pixels w/o unit\n\n  // jQuery-wrapped dialog elements.\n  var $overlay = null;\n  var $dialog = null;\n  var $title = null;\n  var $body = null;\n\n  // Last active/focused non-dialog element.\n  var lastActive = null;\n\n  // Mutation resize handler.\n  var observer = null;\n\n  // Active close callback, if any.\n  var onCloseFn = null;\n\n  // Width of the browser's scrollbars.\n  var scrollbarWidth = 0;\n\n  /*******************************************************************************\n  \tInitialization Functions.\n  *******************************************************************************/\n\n  function init() {\n    if (BUILD_DEBUG) {\n      console.log('[Dialog/init()]');\n    }\n    if (document.getElementById('ui-dialog')) {\n      return;\n    }\n\n    // Calculate and record the width of scrollbars.\n    scrollbarWidth = function () {\n      var calcWidth;\n      try {\n        var inner = document.createElement('p');\n        inner.style.width = '100%';\n        inner.style.height = '200px';\n        var outer = document.createElement('div');\n        outer.style.position = 'absolute';\n        outer.style.left = '0';\n        outer.style.top = '0';\n        outer.style.width = '100px';\n        outer.style.height = '100px';\n        outer.style.visibility = 'hidden';\n        outer.style.overflow = 'hidden';\n        outer.appendChild(inner);\n        document.body.appendChild(outer);\n        var w1 = inner.offsetWidth;\n        // The `overflow: scroll` style property value does not work consistently\n        // with scrollbars which are styled with `::-webkit-scrollbar`, so we use\n        // `overflow: auto` with dimensions guaranteed to force a scrollbar.\n        outer.style.overflow = 'auto';\n        var w2 = inner.offsetWidth;\n        if (w1 === w2) {\n          w2 = outer.clientWidth;\n        }\n        document.body.removeChild(outer);\n        calcWidth = w1 - w2;\n      } catch (ex) {/* no-op */}\n      return calcWidth || 17; // 17px is a reasonable failover\n    }();\n\n    // Generate the dialog elements.\n    var $elems = jQuery(document.createDocumentFragment()).append( /* eslint-disable max-len */\n    '<div id=\"ui-overlay\" class=\"ui-close\"></div>' + '<div id=\"ui-dialog\" tabindex=\"0\" role=\"dialog\" aria-labelledby=\"ui-dialog-title\" aria-modal=\"true\">' + '<div id=\"ui-dialog-titlebar\">' + '<h1 id=\"ui-dialog-title\"></h1>' + \"<button id=\\\"ui-dialog-close\\\" class=\\\"ui-close\\\" tabindex=\\\"0\\\" aria-label=\\\"\".concat(L10n.get('textClose'), \"\\\">\\uF00D</button>\") + '</div>' + '<div id=\"ui-dialog-body\"></div>' + '</div>'\n    /* eslint-enable max-len */);\n\n    // Cache the dialog elements, since they're going to be used often.\n    //\n    // NOTE: We rewrap the elements themselves, rather than simply using\n    // the results of `find()`, so that we cache uncluttered jQuery-wrappers\n    // (i.e. `context` refers to the elements and there is no `prevObject`).\n    $overlay = jQuery($elems.find('#ui-overlay').get(0));\n    $dialog = jQuery($elems.find('#ui-dialog').get(0));\n    $title = jQuery($elems.find('#ui-dialog-title').get(0));\n    $body = jQuery($elems.find('#ui-dialog-body').get(0));\n\n    // Insert the dialog elements into the page before the main script.\n    $elems.insertBefore('body>script#script-sugarcube');\n  }\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  /*\n  \tCalculate the inset values, in pixels, required to fit the dialog within\n  \tthe current viewport based on the size of its contents and the viewport's\n  \tdimentions.\n  */\n  function calcInset(top) {\n    var $window = jQuery(window);\n    var inset = {\n      left: '',\n      right: '',\n      top: '',\n      bottom: ''\n    };\n    var minPos = 10;\n\n    // Unset the dialog's inset values, so the browser can resize it based on\n    // its content.\n    $dialog.css(inset);\n\n    // Calculate the dialog's new inset values based on its current dimensions.\n    //\n    // NOTE: Subtract `1` from both space values to address a Firefox issue.\n    // QUESTION: Is this still necessary?\n    var horzSpace = $window.width() - $dialog.outerWidth(true) - 1;\n    var vertSpace = $window.height() - $dialog.outerHeight(true) - 1;\n    if (horzSpace <= minPos * 2 + scrollbarWidth) {\n      vertSpace -= scrollbarWidth;\n    }\n    if (vertSpace <= minPos * 2 + scrollbarWidth) {\n      horzSpace -= scrollbarWidth;\n    }\n\n    /* eslint-disable prefer-template */\n    // Calculate the horizontal inset values in pixels.\n    if (horzSpace <= minPos * 2) {\n      inset.left = inset.right = minPos + 'px';\n    } else {\n      inset.left = inset.right = (horzSpace / 2 >> 0) + 'px';\n    }\n\n    // Calculate the vertical inset values in pixels.\n    if (vertSpace <= minPos * 2) {\n      inset.top = inset.bottom = minPos + 'px';\n    } else {\n      var vertPos = vertSpace / 2 >> 0;\n      if (vertPos > top) {\n        inset.top = top + 'px';\n      } else {\n        inset.top = inset.bottom = vertPos + 'px';\n      }\n    }\n    /* eslint-enable prefer-template */\n\n    return inset;\n  }\n\n  /*\n  \tResize handler.\n  */\n  function onResize(top) {\n    if ($dialog.css('display') === 'block') {\n      $dialog.css(calcInset(top != null ? top : DEFAULT_TOP)); // lazy equality for null\n    }\n  }\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  /*\n  \tAppends the specified content sources to the dialog's body container.\n  \tReturns `Dialog` for further chaining.\n  */\n  function append() {\n    var _$body;\n    (_$body = $body).append.apply(_$body, arguments);\n    return Dialog;\n  }\n\n  /*\n  \tCloses and resets the dialog.\n  \tReturns `Dialog` for further chaining.\n  */\n  function close(ev) {\n    // Trigger a `:dialogclosing` event on the dialog body.\n    triggerEvent(':dialogclosing', $body);\n\n    // Largely reverse the actions taken in `dialogOpen()`.\n    jQuery(document).off('.dialog-close');\n    if (observer) {\n      observer.disconnect();\n      observer = null;\n    } else {\n      $body.off('.dialog-resize');\n    }\n    jQuery(window).off('.dialog-resize');\n    $dialog.removeClass('open').css({\n      left: '',\n      right: '',\n      top: '',\n      bottom: ''\n    });\n    jQuery('#ui-bar,#story').find('[tabindex=-2]').removeAttr('aria-hidden').attr('tabindex', 0);\n    jQuery('body>[tabindex=-3]').removeAttr('aria-hidden').removeAttr('tabindex');\n    $overlay.removeClass('open');\n    jQuery(document.documentElement).removeAttr('data-dialog');\n\n    // Clear the dialog's content.\n    $title.empty();\n    $body.empty().removeClass();\n\n    // Attempt to restore focus to whichever element had it prior to opening the dialog.\n    if (lastActive) {\n      lastActive.focus();\n      lastActive = null;\n    }\n\n    // Call the given close callback, if any.\n    if (onCloseFn) {\n      // NOTE: There's no catch clause here because this try/finally exists\n      // solely to ensure that the close callback is properly reset in the\n      // event that an uncaught exception is thrown during the callback call.\n      try {\n        onCloseFn(ev);\n      } finally {\n        onCloseFn = null;\n      }\n    }\n\n    // Trigger a `:dialogclosed` event on the dialog body.\n    /* legacy */\n    triggerEvent(':dialogclose', $body);\n    /* /legacy */\n    triggerEvent(':dialogclosed', $body);\n    return Dialog;\n  }\n\n  /*\n  \tPrepares the dialog for use.\n  \tReturns `Dialog` for further chaining.\n  */\n  function create(title, classNames) {\n    $title.empty().append((title != null ? String(title) : '') || \"\\xA0\"); // lazy equality for null\n\n    $body.empty().removeClass();\n    if (classNames != null) {\n      // lazy equality for null\n      $body.addClass(classNames);\n    }\n    return Dialog;\n  }\n\n  /*\n  \tEmpties the dialog's body container.\n  \tReturns `Dialog` for further chaining.\n  */\n  function empty() {\n    $body.empty();\n    return Dialog;\n  }\n\n  /*\n  \tReturns the dialog's body container.\n  */\n  function getBody() {\n    return $body.get(0);\n  }\n\n  /*\n  \tReturns whether the dialog is open.\n  \tThe test may be narrowed by specifing class names.\n  */\n  function isOpen(classNames) {\n    return $dialog.hasClass('open') && (classNames ? classNames.splitOrEmpty(/\\s+/).every(function (cn) {\n      return $body.hasClass(cn);\n    }) : true);\n  }\n\n  /*\n  \tOpens the dialog.\n  \tReturns `Dialog` for further chaining.\n  */\n  function open(options, onClose) {\n    // Grab the options we care about.\n    var _Object$assign3 = Object.assign({\n        top: DEFAULT_TOP\n      }, options),\n      top = _Object$assign3.top;\n\n    // Record the given close callback.\n    if (onClose != null) {\n      // lazy equality for null\n      var closeType = getTypeOf(onClose);\n      if (closeType !== 'function') {\n        throw new TypeError(\"Dialog.open onClose parameter must be a function (received: \".concat(closeType, \")\"));\n      }\n      onCloseFn = onClose;\n    } else {\n      onCloseFn = null;\n    }\n\n    // Trigger a `:dialogopening` event on the dialog body.\n    triggerEvent(':dialogopening', $body);\n\n    // Record the last active/focused non-dialog element.\n    if (!isOpen()) {\n      lastActive = getActiveElement();\n    }\n\n    // Add the `data-dialog` attribute to <html> (mostly used to style <body>).\n    jQuery(document.documentElement).attr('data-dialog', 'open');\n\n    // Display the overlay.\n    $overlay.addClass('open');\n\n    // Add `aria-hidden=true` to all direct non-dialog-children of <body> to\n    // hide the underlying page from screen readers while the dialog is open.\n    jQuery('body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)').attr('tabindex', -3).attr('aria-hidden', true);\n    jQuery('#ui-bar,#story').find('[tabindex]:not([tabindex^=-])').attr('tabindex', -2).attr('aria-hidden', true);\n\n    // Create our throttled resize handler.\n    var resizeHandler = jQuery.throttle(40, function () {\n      return onResize(top);\n    });\n\n    // Add the imagesLoaded handlers to images.\n    $body.imagesLoaded().always(resizeHandler);\n\n    // Display the dialog.\n    $dialog.css(calcInset(top)).addClass('open').focus();\n\n    // Attach the window `resize` event resize handler.\n    jQuery(window).off('.dialog-resize').on('resize.dialog-resize', resizeHandler);\n\n    // Add the dialog mutation resize handler.\n    if (Has.mutationObserver) {\n      observer = new MutationObserver(function (mutations) {\n        for (var i = 0; i < mutations.length; ++i) {\n          if (mutations[i].type === 'childList') {\n            $body.imagesLoaded().always(resizeHandler);\n            resizeHandler();\n            break;\n          }\n        }\n      });\n      observer.observe(getBody(), {\n        childList: true,\n        subtree: true\n      });\n    } else {\n      $body.off('.dialog-resize').on('DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize', function () {\n        $body.imagesLoaded().always(resizeHandler);\n        resizeHandler();\n      });\n    }\n\n    // Set up the delegated close handler.\n    jQuery(document).off('.dialog-close').one('click.dialog-close', '.ui-close', function (ev) {\n      // NOTE: Do not allow this event handler to return the `Dialog` static object,\n      // as doing so causes Edge (ca. 18) to throw a \"Number expected\" exception due\n      // to `Dialog` not having a prototype.\n      close(ev);\n      /* implicit `return undefined;` */\n    }).one('keypress.dialog-close', '.ui-close', function (ev) {\n      // 13 is Enter/Return, 32 is Space.\n      if (ev.which === 13 || ev.which === 32) {\n        triggerEvent('click', this);\n      }\n    });\n\n    // Trigger a `:dialogopened` event on the dialog body.\n    /* legacy */\n    triggerEvent(':dialogopen', $body);\n    /* /legacy */\n    triggerEvent(':dialogopened', $body);\n    return Dialog;\n  }\n\n  /*\n  \tResize the dialog.\n  */\n  function resize(options) {\n    return onResize(_typeof(options) === 'object' ? options.top : undefined);\n  }\n\n  /*\n  \tRenders and appends the specified content sources to the dialog's body container.\n  \tReturns `Dialog` for further chaining.\n  */\n  function wiki() {\n    var _$body2;\n    (_$body2 = $body).wiki.apply(_$body2, arguments);\n    return Dialog;\n  }\n\n  /*\n  \tRenders and appends the specified passage to the dialog's body container.\n  \tReturns `Dialog` for further chaining.\n  */\n  function wikiPassage(name) {\n    return wiki(Story.get(name).processText());\n  }\n\n  /*******************************************************************************\n  \tDeprecated Functions.\n  *******************************************************************************/\n\n  /*\n  \t[DEPRECATED] Prepares the dialog for use.\n  \tReturns the dialog's body container.\n  */\n  function setup(title, classNames) {\n    console.warn('[DEPRECATED] Dialog.setup() is deprecated.');\n    create(title, classNames);\n    return getBody();\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    append: {\n      value: append\n    },\n    body: {\n      value: getBody\n    },\n    close: {\n      value: close\n    },\n    create: {\n      value: create\n    },\n    empty: {\n      value: empty\n    },\n    init: {\n      value: init\n    },\n    isOpen: {\n      value: isOpen\n    },\n    open: {\n      value: open\n    },\n    resize: {\n      value: resize\n    },\n    wiki: {\n      value: wiki\n    },\n    wikiPassage: {\n      value: wikiPassage\n    },\n    // Deprecated Functions.\n    setup: {\n      value: setup\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tengine.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Alert, Config, DebugView, Dialog, Has, LoadScreen, Save, Scripting, State, Story, StyleWrapper, UI,\n\t       UIBar, Wikifier, enumFrom, getErrorMessage, now, postdisplay, postrender, predisplay, prehistory,\n\t       prerender, triggerEvent\n*/\n\nvar Engine = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Engine state types object.\n  var States = enumFrom({\n    Init: 'init',\n    Idle: 'idle',\n    Playing: 'playing',\n    Rendering: 'rendering'\n  });\n\n  // Minimum delay for DOM actions (in milliseconds).\n  var DOM_DELAY = 40;\n\n  // Cache of the debug view(s) for initialization special passage(s).\n  var _initDebugViews = [];\n\n  // Current state of the engine.\n  var _state = States.Init;\n\n  // Last time `enginePlay()` was called (in milliseconds).\n  var _lastPlay = null;\n\n  // jQuery event namespace.\n  var EVENT_NS = '.engine';\n\n  /*******************************************************************************\n  \tEngine Functions.\n  *******************************************************************************/\n\n  /*\n  \tInitialize the core story elements and perform some bookkeeping.\n  */\n  function engineInit() {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineInit()]');\n    }\n    if (_state !== States.Init) {\n      return;\n    }\n\n    // Remove #init-no-js & #init-lacking from #init-screen.\n    jQuery('#init-no-js,#init-lacking').remove();\n\n    // Generate the main UI container.\n    var $main = jQuery('<div id=\"story\" role=\"main\"></div>');\n\n    // Get the user's UI markup, if any.\n    var markup = Story.has('StoryInterface') && Story.get('StoryInterface').text.trim();\n\n    // If user markup exists, remove unnecessary default UI and process the markup.\n    if (markup) {\n      // Disable updates on default UI elements.\n      Config.ui.updateStoryElements = false;\n\n      // Remove the default UI bar, including its styles and events.\n      UIBar.destroy();\n\n      // Remove the default passage display area styles.\n      jQuery(document.head).find('#style-core-display').remove();\n\n      // Append the user's UI elements to the main UI container.\n      $main.append(markup);\n\n      // Bail out if a child `#story` exists.\n      if ($main.find('#story').length > 0) {\n        throw new Error('element with ID \"story\" found within \"StoryInterface\" special passage');\n      }\n\n      // Cache the `#passages` element.\n      var $passages = $main.find('#passages');\n\n      // Bail out if `#passages` is nonexistent.\n      if ($passages.length === 0) {\n        throw new Error('no element with ID \"passages\" found within \"StoryInterface\" special passage');\n      }\n\n      // Empty `#passages` and, if necessary, add an `aria-live=\"polite\"` content attribute.\n      $passages.empty()\n      // Without an existing `aria-live`.\n      .not('[aria-live]').attr('aria-live', 'polite').end();\n\n      // Cache the data passage elements now to prevent recursive processing.\n      var $dataInitPassages = $main.find('[data-init-passage]');\n      var $dataPassages = $main.find('[data-passage]');\n\n      // Data passage elements updated once during initialization.\n      $dataInitPassages.each(function (i, el) {\n        if (el.id === 'passages') {\n          throw new Error(\"\\\"StoryInterface\\\" element <\".concat(el.nodeName.toLowerCase(), \" id=\\\"passages\\\"> must not contain a \\\"data-init-passage\\\" content attribute\"));\n        }\n        var passage = el.getAttribute('data-init-passage').trim();\n        if (el.hasAttribute('data-passage')) {\n          throw new Error(\"\\\"StoryInterface\\\" element <\".concat(el.nodeName.toLowerCase(), \" data-init-passage=\\\"\").concat(passage, \"\\\"> must not contain a \\\"data-passage\\\" content attribute\"));\n        }\n        if (el.firstElementChild !== null) {\n          throw new Error(\"\\\"StoryInterface\\\" element <\".concat(el.nodeName.toLowerCase(), \" data-init-passage=\\\"\").concat(passage, \"\\\"> contains child elements\"));\n        }\n        if (Story.has(passage)) {\n          jQuery(document).one(\":uiupdate\".concat(EVENT_NS), function () {\n            var frag = document.createDocumentFragment();\n            new Wikifier(frag, Story.get(passage).processText().trim());\n            jQuery(el).empty().append(frag);\n          });\n        }\n      });\n\n      // Data passage elements updated upon navigation.\n      $dataPassages.each(function (i, el) {\n        if (el.id === 'passages') {\n          throw new Error(\"\\\"StoryInterface\\\" element <\".concat(el.nodeName.toLowerCase(), \" id=\\\"passages\\\"> must not contain a \\\"data-passage\\\" content attribute\"));\n        }\n        var passage = el.getAttribute('data-passage').trim();\n        if (el.firstElementChild !== null) {\n          throw new Error(\"\\\"StoryInterface\\\" element <\".concat(el.nodeName.toLowerCase(), \" data-passage=\\\"\").concat(passage, \"\\\"> contains child elements\"));\n        }\n        if (Story.has(passage)) {\n          jQuery(document).on(\":uiupdate\".concat(EVENT_NS), function () {\n            var frag = document.createDocumentFragment();\n            new Wikifier(frag, Story.get(passage).processText().trim());\n            jQuery(el).empty().append(frag);\n          });\n        }\n      });\n    }\n\n    // Elsewise, generate the default passage display area UI elements.\n    else {\n      $main.append('<div id=\"passages\" aria-live=\"polite\"></div>');\n    }\n\n    // Insert the main UI into the page before the main script.\n    $main.insertBefore('body>script#script-sugarcube');\n  }\n\n  /*\n  \tRun user scripts (user stylesheet, JavaScript, and widgets).\n  */\n  function engineRunUserScripts() {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineRunUserScripts()]');\n    }\n    if (_state !== States.Init) {\n      return;\n    }\n\n    // Load the user styles.\n    (function () {\n      var storyStyle = document.createElement('style');\n      new StyleWrapper(storyStyle).add(Story.getStyles().map(function (style) {\n        return style.text.trim();\n      }).join('\\n'));\n      jQuery(storyStyle).appendTo(document.head).attr({\n        id: 'style-story',\n        type: 'text/css'\n      });\n    })();\n\n    // Load the user scripts.\n    Story.getScripts().forEach(function (script) {\n      try {\n        Scripting.evalJavaScript(script.text);\n      } catch (ex) {\n        console.error(ex);\n        Alert.error(script.name, getErrorMessage(ex));\n      }\n    });\n\n    // Load the user widgets.\n    Story.getWidgets().forEach(function (widget) {\n      try {\n        Wikifier.wikifyEval(widget.processText());\n      } catch (ex) {\n        console.error(ex);\n        Alert.error(widget.name, getErrorMessage(ex));\n      }\n    });\n  }\n\n  /*\n  \tRun the user init passages.\n  */\n  function engineRunUserInit() {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineRunUserInit()]');\n    }\n    if (_state !== States.Init) {\n      return;\n    }\n\n    /*\n    \tExecute `init`-tagged special passages.\n    */\n    Story.getInits().forEach(function (passage) {\n      try {\n        var debugBuffer = Wikifier.wikifyEval(passage.text);\n        if (Config.debug) {\n          var debugView = new DebugView(document.createDocumentFragment(), 'special', \"\".concat(passage.name, \" [init-tagged]\"), \"\".concat(passage.name, \" [init-tagged]\"));\n          debugView.modes({\n            hidden: true\n          });\n          debugView.append(debugBuffer);\n          _initDebugViews.push(debugView.output);\n        }\n      } catch (ex) {\n        console.error(ex);\n        Alert.error(\"\".concat(passage.name, \" [init-tagged]\"), getErrorMessage(ex));\n      }\n    });\n\n    /*\n    \tExecute the StoryInit special passage.\n    */\n    if (Story.has('StoryInit')) {\n      try {\n        var debugBuffer = Wikifier.wikifyEval(Story.get('StoryInit').text);\n        if (Config.debug) {\n          var debugView = new DebugView(document.createDocumentFragment(), 'special', 'StoryInit', 'StoryInit');\n          debugView.modes({\n            hidden: true\n          });\n          debugView.append(debugBuffer);\n          _initDebugViews.push(debugView.output);\n        }\n      } catch (ex) {\n        console.error(ex);\n        Alert.error('StoryInit', getErrorMessage(ex));\n      }\n    }\n  }\n\n  /*\n  \tStarts the story.\n  */\n  function engineStart() {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineStart()]');\n    }\n    if (_state !== States.Init) {\n      return;\n    }\n\n    // Sanity checks.\n    if (Config.passages.start == null) {\n      // lazy equality for null\n      throw new Error('starting passage not selected');\n    }\n    if (!Story.has(Config.passages.start)) {\n      throw new Error(\"starting passage (\\\"\".concat(Config.passages.start, \"\\\") not found\"));\n    }\n\n    // Update the engine state.\n    _state = States.Idle;\n\n    // Focus the document element initially.\n    document.documentElement.focus();\n\n    // Attempt to restore an active session.  Failing that, attempt to\n    // autoload the auto save, if requested.  Failing that, display the\n    // starting passage.\n    if (State.restore()) {\n      engineShow();\n    } else {\n      var autoloadType = _typeof(Config.saves._internal_autoload_);\n      if (autoloadType === 'string') {\n        if (Config.saves._internal_autoload_ === 'prompt') {\n          UI.buildAutoload();\n          Dialog.open();\n        }\n      } else {\n        new Promise(function (resolve, reject) {\n          if (Save.browser.size > 0 && (autoloadType === 'boolean' && Config.saves._internal_autoload_ || autoloadType === 'function' && Config.saves._internal_autoload_())) {\n            return resolve();\n          }\n          reject(); // eslint-disable-line prefer-promise-reject-errors\n        }).then(function () {\n          if (BUILD_DEBUG) {\n            console.log('\\tattempting autoload of browser continue');\n          }\n          Save.browser.continue();\n          engineShow();\n        }).catch(function () {\n          if (BUILD_DEBUG) {\n            console.log(\"\\tstarting passage: \\\"\".concat(Config.passages.start, \"\\\"\"));\n          }\n          enginePlay(Config.passages.start);\n        });\n      }\n    }\n  }\n\n  /*\n  \tRestarts the story.\n  */\n  function engineRestart() {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineRestart()]');\n    }\n\n    // Show the loading screen to hide any unsightly rendering shenanigans\n    // during the page reload.\n    LoadScreen.show();\n\n    // Scroll the window to the top.\n    //\n    // NOTE: This is required by most browsers for the starting passage or\n    // it will remain at whatever its current scroll position is after the\n    // page reload.  We do it generally, rather than only for the currently\n    // set starting passage, since the starting passage may be dynamically\n    // manipulated.\n    window.scroll(0, 0);\n\n    // Delete the active session.\n    State.reset();\n\n    // Trigger an ':enginerestart' event.\n    triggerEvent(':enginerestart');\n\n    // Reload the page.\n    window.location.reload();\n  }\n\n  /*\n  \tReturns the current state of the engine.\n  */\n  function engineState() {\n    return _state;\n  }\n\n  /*\n  \tReturns whether the engine is idle.\n  */\n  function engineIsIdle() {\n    return _state === States.Idle;\n  }\n\n  /*\n  \tReturns whether the engine is playing.\n  */\n  function engineIsPlaying() {\n    return _state !== States.Idle;\n  }\n\n  /*\n  \tReturns whether the engine is rendering.\n  */\n  function engineIsRendering() {\n    return _state === States.Rendering;\n  }\n\n  /*\n  \tReturns a timestamp representing the last time `Engine.play()` was called.\n  */\n  function engineLastPlay() {\n    return _lastPlay;\n  }\n\n  /*\n  \tActivate the moment at the given index within the state history and show it.\n  */\n  function engineGoTo(index) {\n    var succeeded = State.goTo(index);\n    if (succeeded) {\n      engineShow();\n    }\n    return succeeded;\n  }\n\n  /*\n  \tActivate the moment at the given offset from the active moment within the state history\n  \tand show it.\n  */\n  function engineGo(offset) {\n    var succeeded = State.go(offset);\n    if (succeeded) {\n      engineShow();\n    }\n    return succeeded;\n  }\n\n  /*\n  \tGo to the moment which directly precedes the active moment and show it.\n  */\n  function engineBackward() {\n    return engineGo(-1);\n  }\n\n  /*\n  \tGo to the moment which directly follows the active moment and show it.\n  */\n  function engineForward() {\n    return engineGo(1);\n  }\n\n  /*\n  \tRenders and displays the active (present) moment's associated passage without adding\n  \ta new moment to the history.\n  */\n  function engineShow() {\n    return enginePlay(State.passage, true);\n  }\n\n  /*\n  \tRenders and displays the passage referenced by the given title, optionally without\n  \tadding a new moment to the history.\n  */\n  function enginePlay(title, noHistory) {\n    if (_state === States.Init) {\n      return false;\n    }\n    if (BUILD_DEBUG) {\n      console.log(\"[Engine/enginePlay(title: \\\"\".concat(title, \"\\\", noHistory: \").concat(noHistory, \")]\"));\n    }\n    var passageTitle = title;\n\n    // Update the engine state.\n    _state = States.Playing;\n\n    // Reset the temporary state and variables objects.\n    TempState = {}; // eslint-disable-line no-undef\n    State.clearTemporary();\n\n    // Debug view setup.\n    var passageReadyOutput;\n    var passageDoneOutput;\n\n    // Execute the navigation override callback.\n    if (typeof Config.navigation.override === 'function') {\n      try {\n        var overrideTitle = Config.navigation.override(passageTitle);\n        if (overrideTitle) {\n          passageTitle = overrideTitle;\n        }\n      } catch (ex) {/* no-op */}\n    }\n\n    // Retrieve the passage by the given title.\n    //\n    // NOTE: The values of the `title` parameter and `passageTitle` variable\n    // may be empty, strings, or numbers (though using a number as reference\n    // to a numeric title should be discouraged), so after loading the passage,\n    // always refer to `passage.name` and never to the others.\n    var passage = Story.get(passageTitle);\n\n    // Execute the pre-history events and tasks.\n    jQuery.event.trigger({\n      /* legacy */\n      passage: passage,\n      /* /legacy */\n\n      type: ':passageinit',\n      detail: {\n        passage: passage\n      }\n    });\n    Object.keys(prehistory).forEach(function (task) {\n      if (typeof prehistory[task] === 'function') {\n        prehistory[task].call(passage, task);\n      }\n    });\n\n    // Create a new entry in the history.\n    if (!noHistory) {\n      State.create(passage.name);\n    }\n\n    // Clear the document body's classes.\n    if (document.body.className) {\n      document.body.className = '';\n    }\n\n    // Update the last play time.\n    //\n    // NOTE: This is mostly for event, task, and special passage code,\n    // though the likelihood of it being needed this early is low.  This\n    // will be updated again later at the end.\n    _lastPlay = now();\n\n    // Execute pre-display tasks and the `PassageReady` special passage.\n    Object.keys(predisplay).forEach(function (task) {\n      if (typeof predisplay[task] === 'function') {\n        predisplay[task].call(passage, task);\n      }\n    });\n    if (Story.has('PassageReady')) {\n      try {\n        passageReadyOutput = Wikifier.wikifyEval(Story.get('PassageReady').text);\n      } catch (ex) {\n        console.error(ex);\n        Alert.error('PassageReady', ex.message);\n      }\n    }\n\n    // Update the engine state.\n    _state = States.Rendering;\n\n    // Get the passage's tags as a string, or `null` if there aren't any.\n    var dataTags = passage.tags.length > 0 ? passage.tags.join(' ') : null;\n\n    // Create and set up the incoming passage element.\n    var passageEl = document.createElement('div');\n    jQuery(passageEl).attr({\n      id: passage.id,\n      'data-passage': passage.name,\n      'data-tags': dataTags\n    }).addClass(\"passage passage-in \".concat(passage.className));\n\n    // Add the passage's classes and tags to the document body.\n    jQuery(document.body).attr('data-tags', dataTags).addClass(passage.className);\n\n    // Add the passage's tags to the document element.\n    jQuery(document.documentElement).attr('data-tags', dataTags);\n\n    // Execute pre-render events and tasks.\n    jQuery.event.trigger({\n      /* legacy */\n      content: passageEl,\n      passage: passage,\n      /* /legacy */\n\n      type: ':passagestart',\n      detail: {\n        content: passageEl,\n        passage: passage\n      }\n    });\n    Object.keys(prerender).forEach(function (task) {\n      if (typeof prerender[task] === 'function') {\n        prerender[task].call(passage, passageEl, task);\n      }\n    });\n\n    // Render the `PassageHeader` passage, if it exists, into the passage element.\n    if (Story.has('PassageHeader')) {\n      new Wikifier(passageEl, Story.get('PassageHeader').processText());\n    }\n\n    // Render the passage into its element.\n    passageEl.appendChild(passage.render());\n\n    // Render the `PassageFooter` passage, if it exists, into the passage element.\n    if (Story.has('PassageFooter')) {\n      new Wikifier(passageEl, Story.get('PassageFooter').processText());\n    }\n\n    // Execute post-render events and tasks.\n    jQuery.event.trigger({\n      /* legacy */\n      content: passageEl,\n      passage: passage,\n      /* /legacy */\n\n      type: ':passagerender',\n      detail: {\n        content: passageEl,\n        passage: passage\n      }\n    });\n    Object.keys(postrender).forEach(function (task) {\n      if (typeof postrender[task] === 'function') {\n        postrender[task].call(passage, passageEl, task);\n      }\n    });\n\n    // Cache the passage container.\n    var containerEl = document.getElementById('passages');\n\n    // Empty the passage container.\n    if (containerEl.hasChildNodes()) {\n      if (typeof Config.passages.transitionOut === 'number' || typeof Config.passages.transitionOut === 'string' && Config.passages.transitionOut !== '' && Has.transitionEndEvent) {\n        Array.from(containerEl.childNodes).forEach(function (outgoing) {\n          var $outgoing = jQuery(outgoing);\n          if (outgoing.nodeType === Node.ELEMENT_NODE && $outgoing.hasClass('passage')) {\n            if ($outgoing.hasClass('passage-out')) {\n              return;\n            }\n            $outgoing.attr({\n              id: \"out-\".concat($outgoing.attr('id')),\n              'aria-hidden': 'true',\n              'aria-live': 'off'\n            }).addClass('passage-out');\n            if (typeof Config.passages.transitionOut === 'string') {\n              $outgoing.on(Has.transitionEndEvent, function (ev) {\n                if (ev.originalEvent.propertyName === Config.passages.transitionOut) {\n                  $outgoing.remove();\n                }\n              });\n            } else {\n              setTimeout(function () {\n                return $outgoing.remove();\n              }, Math.max(DOM_DELAY, Config.passages.transitionOut));\n            }\n          } else {\n            $outgoing.remove();\n          }\n        });\n      } else {\n        jQuery(containerEl).empty();\n      }\n    }\n\n    // Append the passage element to the passage container and initiate\n    // its transition animation.\n    jQuery(passageEl).appendTo(containerEl);\n    setTimeout(function () {\n      return jQuery(passageEl).removeClass('passage-in');\n    }, DOM_DELAY / 2);\n\n    // Scroll the window to the top.\n    window.scroll(0, 0);\n\n    // Update the engine state.\n    _state = States.Playing;\n\n    // Execute post-display events, tasks, and the `PassageDone` special passage.\n    if (Story.has('PassageDone')) {\n      try {\n        passageDoneOutput = Wikifier.wikifyEval(Story.get('PassageDone').text);\n      } catch (ex) {\n        console.error(ex);\n        Alert.error('PassageDone', ex.message);\n      }\n    }\n    jQuery.event.trigger({\n      /* legacy */\n      content: passageEl,\n      passage: passage,\n      /* /legacy */\n\n      type: ':passagedisplay',\n      detail: {\n        content: passageEl,\n        passage: passage\n      }\n    });\n    Object.keys(postdisplay).forEach(function (task) {\n      if (typeof postdisplay[task] === 'function') {\n        postdisplay[task].call(passage, task);\n      }\n    });\n\n    // Execute UI update events.\n    UI.update();\n\n    // Add the completed debug views for `StoryInit`, `PassageReady`, and `PassageDone`\n    // to the incoming passage element.\n    if (Config.debug) {\n      var debugView;\n\n      // Prepend the `PassageReady` debug view.\n      if (passageReadyOutput != null) {\n        // lazy equality for null\n        debugView = new DebugView(document.createDocumentFragment(), 'special', 'PassageReady', 'PassageReady');\n        debugView.modes({\n          hidden: true\n        });\n        debugView.append(passageReadyOutput);\n        jQuery(passageEl).prepend(debugView.output);\n      }\n\n      // Append the `PassageDone` debug view.\n      if (passageDoneOutput != null) {\n        // lazy equality for null\n        debugView = new DebugView(document.createDocumentFragment(), 'special', 'PassageDone', 'PassageDone');\n        debugView.modes({\n          hidden: true\n        });\n        debugView.append(passageDoneOutput);\n        jQuery(passageEl).append(debugView.output);\n      }\n\n      // Prepend the cached initialization debug views, if we're showing the first moment/turn.\n      if (State.turns === 1 && _initDebugViews.length > 0) {\n        jQuery(passageEl).prepend(_initDebugViews);\n      }\n    }\n\n    // Last second post-processing for accessibility and other things.\n    jQuery('#story')\n    // Add `tabindex=0` to all interactive elements that don't have it.\n    .find('a,link,button,input,select,textarea').not('[tabindex]').attr('tabindex', 0);\n\n    // Handle autosaves.\n    if (State.turns > 1 && Save.browser.auto.isEnabled()) {\n      Save.browser.auto.save();\n    }\n\n    // Execute post-play events.\n    jQuery.event.trigger({\n      /* legacy */\n      content: passageEl,\n      passage: passage,\n      /* /legacy */\n\n      type: ':passageend',\n      detail: {\n        content: passageEl,\n        passage: passage\n      }\n    });\n\n    // Reset the engine state.\n    _state = States.Idle;\n\n    // Update the last play time.\n    _lastPlay = now();\n    return passageEl;\n  }\n\n  /*******************************************************************************\n  \tDeprecated Functions.\n  *******************************************************************************/\n\n  /*\n  \t[DEPRECATED] Play the given passage, optionally without altering the history.\n  */\n  function engineDisplay(title, link, option) {\n    if (BUILD_DEBUG) {\n      console.log('[Engine/engineDisplay()]');\n    }\n    console.warn('[DEPRECATED] Engine.display() is deprecated.');\n    var noHistory = false;\n\n    // Process the option parameter.\n    switch (option) {\n      case undefined:\n        /* no-op */\n        break;\n      case 'replace':\n      case 'back':\n        noHistory = true;\n        break;\n      default:\n        throw new Error(\"Engine.display option parameter called with obsolete value \\\"\".concat(option, \"\\\"; please notify the developer\"));\n    }\n    enginePlay(title, noHistory);\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Constants.\n    States: {\n      value: States\n    },\n    DOM_DELAY: {\n      get: function get() {\n        return DOM_DELAY;\n      }\n    },\n    // Core Functions.\n    init: {\n      value: engineInit\n    },\n    runUserScripts: {\n      value: engineRunUserScripts\n    },\n    runUserInit: {\n      value: engineRunUserInit\n    },\n    start: {\n      value: engineStart\n    },\n    restart: {\n      value: engineRestart\n    },\n    state: {\n      get: engineState\n    },\n    isIdle: {\n      value: engineIsIdle\n    },\n    isPlaying: {\n      value: engineIsPlaying\n    },\n    isRendering: {\n      value: engineIsRendering\n    },\n    lastPlay: {\n      get: engineLastPlay\n    },\n    goTo: {\n      value: engineGoTo\n    },\n    go: {\n      value: engineGo\n    },\n    backward: {\n      value: engineBackward\n    },\n    forward: {\n      value: engineForward\n    },\n    show: {\n      value: engineShow\n    },\n    play: {\n      value: enginePlay\n    },\n    // Deprecated Functions.\n    display: {\n      value: engineDisplay\n    },\n    minDomActionDelay: {\n      get: function get() {\n        return DOM_DELAY;\n      }\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tpassage.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, L10n, State, Wikifier, createSlug, decodeEntities, encodeMarkup, enumFrom */\n\nvar Passage = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*\n  \tTags which should not be transformed into classes:\n  \t\tdebug      → special tag\n  \t\tnobr       → special tag\n  \t\tpassage    → the default class\n  \t\tscript     → special tag (only in Twine 1)\n  \t\tstylesheet → special tag (only in Twine 1)\n  \t\ttwine.*    → special tag\n  \t\twidget     → special tag\n  */\n  var tagsToSkip;\n\n  // Passage store text content decoding function.\n  var decodePassageText;\n\n  // For Twine 1.\n  if (BUILD_TWINE1) {\n    tagsToSkip = /^(?:debug|nobr|passage|script|stylesheet|widget|twine\\..*)$/i;\n    decodePassageText = function () {\n      var encodedMap = enumFrom({\n        '\\\\n': '\\n',\n        '\\\\t': '\\t',\n        '\\\\s': '\\\\',\n        '\\\\': '\\\\',\n        '\\r': ''\n      });\n      var encodedRE = new RegExp(\"(?:\".concat(Object.keys(encodedMap).map(function (ch) {\n        return RegExp.escape(ch);\n      }).join('|'), \")\"), 'g');\n      var hasEncodedRE = new RegExp(encodedRE.source); // to drop the global flag\n\n      /*\n      \tReturns a decoded version of the passed Twine 1 passage store encoded string.\n      */\n      function decodePassageText(str) {\n        if (str == null) {\n          // lazy equality for null\n          return '';\n        }\n        var val = String(str);\n        return val && hasEncodedRE.test(val) ? val.replace(encodedRE, function (esc) {\n          return encodedMap[esc];\n        }) : val;\n      }\n      return decodePassageText;\n    }();\n  }\n  // For Twine 2.\n  else {\n    tagsToSkip = /^(?:debug|nobr|passage|widget|twine\\..*)$/i;\n    decodePassageText = function () {\n      var encodedRE = /\\r/g;\n      var hasEncodedRE = new RegExp(encodedRE.source); // to drop the global flag\n\n      /*\n      \tReturns a decoded version of the passed Twine 2 passage store encoded string.\n      */\n      function decodePassageText(str) {\n        if (str == null) {\n          // lazy equality for null\n          return '';\n        }\n        var val = String(str);\n        return val && hasEncodedRE.test(val) ? val.replace(encodedRE, '') : val;\n      }\n      return decodePassageText;\n    }();\n  }\n\n  /*******************************************************************************\n  \tPassage Class.\n  *******************************************************************************/\n  var Passage = /*#__PURE__*/function () {\n    function Passage(name, el) {\n      var _this19 = this;\n      _classCallCheck(this, Passage);\n      Object.defineProperties(this, {\n        // Passage title.\n        name: {\n          value: decodeEntities(name)\n        },\n        // Passage data element (within the story data element; i.e. T1: '[tiddler]', T2: 'tw-passagedata').\n        element: {\n          value: el || null\n        },\n        // Passage tags array (unique).\n        tags: {\n          value: Object.freeze(el && el.hasAttribute('tags') ? Array.from(new Set(el.getAttribute('tags').trim().splitOrEmpty(/\\s+/))) : [])\n        }\n      });\n\n      // Properties dependant upon the above set.\n      Object.defineProperties(this, {\n        // Passage DOM-compatible ID.\n        id: {\n          value: \"passage-\".concat(createSlug(this.name))\n        },\n        // Passage classes array (sorted and unique).\n        classes: {\n          value: Object.freeze(this.tags.length === 0 ? [] : function () {\n            return (\n              /*\n              \tReturn the sorted list of unique classes.\n              \t\tNOTE: The `this.tags` array is already sorted and unique,\n              \tso we only need to filter and map here.\n              */\n              _this19.tags.filter(function (tag) {\n                return !tagsToSkip.test(tag);\n              }).map(function (tag) {\n                return createSlug(tag);\n              })\n            );\n          }())\n        },\n        /* legacy */\n        domId: {\n          get: function get() {\n            return this.id;\n          }\n        },\n        title: {\n          get: function get() {\n            return this.name;\n          }\n        }\n        /* /legacy */\n      });\n    }\n\n    // Getters.\n    return _createClass(Passage, [{\n      key: \"className\",\n      get: function get() {\n        return this.classes.join(' ');\n      }\n\n      // TODO: (v3) This should be → `get source`.\n    }, {\n      key: \"text\",\n      get: function get() {\n        if (this.element == null) {\n          // lazy equality for null\n          var passage = encodeMarkup(this.name);\n          var mesg = \"\".concat(L10n.get('errorViewTitle'), \": \").concat(L10n.get('errorNonexistentPassage', {\n            passage: passage\n          }));\n          return \"<div class=\\\"error-view\\\"><span class=\\\"error\\\">\".concat(mesg, \"</span></div>\");\n        }\n        return decodePassageText(this.element.textContent);\n      }\n\n      // TODO: (v3) This should be → `get text`.\n    }, {\n      key: \"processText\",\n      value: function processText() {\n        if (this.element == null) {\n          // lazy equality for null\n          return this.text;\n        }\n\n        // Handle image passage transclusion.\n        if (this.tags.includes('Twine.image')) {\n          return \"[img[\".concat(this.text, \"]]\");\n        }\n        var processed = this.text;\n\n        // Handle `Config.passages.onProcess`.\n        if (Config.passages.onProcess) {\n          processed = Config.passages.onProcess.call(null, {\n            title: this.name,\n            tags: this.tags,\n            text: processed\n          });\n        }\n\n        // Handle `Config.passages.nobr` and the `nobr` tag.\n        if (Config.passages.nobr || this.tags.includes('nobr')) {\n          // Remove all leading & trailing newlines and compact all internal sequences\n          // of newlines into single spaces.\n          processed = processed.replace(/^\\n+|\\n+$/g, '').replace(/\\n+/g, ' ');\n        }\n        return processed;\n      }\n    }, {\n      key: \"render\",\n      value: function render(options) {\n        var frag = document.createDocumentFragment();\n        new Wikifier(frag, this.processText(), options);\n        return frag;\n      }\n\n      /* legacy */\n    }, {\n      key: \"description\",\n      value: function description() {\n        // eslint-disable-line class-methods-use-this\n        return \"\".concat(L10n.get('textTurn'), \" \").concat(State.turns);\n      }\n      /* /legacy */\n    }]);\n  }();\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n  return Passage;\n}();\n\n/***********************************************************************************************************************\n\n\tsave.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, L10n, Serial, State, createFilename, enumFrom, getTypeOf, storage */\n\n/*\n\tSave API (v3) static object.\n*/\nvar Save = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Save type pseudo-enumeration.\n  var Type = enumFrom({\n    Unknown: 0,\n    Auto: 1,\n    Slot: 2,\n    Disk: 3,\n    Base64: 4\n\n    /* legacy */\n    /* eslint-disable comma-style */\n    // Duplicate `Auto` for v2 `'autosave'` compatibility.\n    ,\n    Autosave: 1\n    // Duplicate `Base64` for v2 `'serialize'` compatibility.\n    ,\n    Serialize: 4\n    /* eslint-enable comma-style */\n    /* /legacy */\n  });\n\n  // Save index maximum value constant (`0`-based).\n  var MAX_INDEX = 15;\n\n  // Browser save key constants.\n  var INDEX_DELIMITER = ':';\n  var SAVE_SUBKEY = 'save.';\n  var AUTO_SUBKEY = \"\".concat(SAVE_SUBKEY, \"auto.\");\n  var AUTO_DATA_SUBKEY = \"\".concat(AUTO_SUBKEY, \"data\").concat(INDEX_DELIMITER);\n  var AUTO_INFO_SUBKEY = \"\".concat(AUTO_SUBKEY, \"info\").concat(INDEX_DELIMITER);\n  var SLOT_SUBKEY = \"\".concat(SAVE_SUBKEY, \"slot.\");\n  var SLOT_DATA_SUBKEY = \"\".concat(SLOT_SUBKEY, \"data\").concat(INDEX_DELIMITER);\n  var SLOT_INFO_SUBKEY = \"\".concat(SLOT_SUBKEY, \"info\").concat(INDEX_DELIMITER);\n\n  // Save event handler sets.\n  var onLoadHandlers = new Set();\n  var onSaveHandlers = new Set();\n\n  /*******************************************************************************\n  \tInitialization Functions.\n  *******************************************************************************/\n\n  /*\n  \tInitialize the saves subsystem.\n  */\n  function init() {\n    if (BUILD_DEBUG) {\n      console.log('[Save/init()]');\n    }\n\n    // Migrate legacy browser saves from the old monolithic v2 save\n    // object to the new v3 style with separate entries for each save.\n    migrateLegacyV2BrowserSaves();\n    return true;\n  }\n  function migrateLegacyV2BrowserSaves() {\n    var oldSaves = storage.get('saves');\n\n    // Bail out if no old saves object exists.\n    if (oldSaves === null) {\n      return;\n    }\n\n    // Delete existing saves before storing the migrated saves.\n    autoClear();\n    slotClear();\n\n    // Old monolithic saves object:\n    // \t{\n    // \t\tautosave : save | null,\n    // \t\tslots    : Array<save | null>\n    // \t}\n    //\n    // Old auto & slot save objects:\n    // \t{\n    // \t\ttitle    : description,\n    // \t\tdate     : unix_datestamp,\n    // \t\tmetadata : metadata | undefined,\n    // \t\tid       : id,\n    // \t\tstate    : state,\n    // \t\tversion  : version | undefined\n    // \t}\n\n    // Migrate the auto save.\n    if (oldSaves.autosave) {\n      var _splitSave = splitSave(oldSaves.autosave),\n        info = _splitSave.info,\n        data = _splitSave.data;\n\n      // Property updates.\n      info.desc = info.title;\n      delete info.title;\n      info.type = Type.Auto;\n      var infoKey = getAutoInfoKeyFromIndex(0);\n      var dataKey = getAutoDataKeyFromIndex(0);\n\n      // If storing either chunk is going to fail, it's more likely\n      // to be the data chunk, so we attempt to store it first.\n      if (storage.set(dataKey, data)) {\n        if (!storage.set(infoKey, info)) {\n          storage.delete(dataKey);\n        }\n      }\n    }\n\n    // Migrate the slot saves.\n    oldSaves.slots.forEach(function (save, index) {\n      if (!save) {\n        return;\n      }\n      var _splitSave2 = splitSave(save),\n        info = _splitSave2.info,\n        data = _splitSave2.data;\n\n      // Property updates.\n      info.desc = info.title;\n      delete info.title;\n      info.type = Type.Slot;\n      var infoKey = getSlotInfoKeyFromIndex(index);\n      var dataKey = getSlotDataKeyFromIndex(index);\n\n      // If storing either chunk is going to fail, it's more likely\n      // to be the data chunk, so we attempt to store it first.\n      if (storage.set(dataKey, data)) {\n        if (!storage.set(infoKey, info)) {\n          storage.delete(dataKey);\n        }\n      }\n    });\n\n    // Delete the old saves object.\n    storage.delete('saves');\n  }\n\n  /*******************************************************************************\n  \tSaves Utility Functions.\n  *******************************************************************************/\n\n  function createDatestamp(date) {\n    if (!(date instanceof Date)) {\n      throw new TypeError('createDatestamp date parameter must be a Date object');\n    }\n    var MM = date.getMonth() + 1;\n    var DD = date.getDate();\n    var hh = date.getHours();\n    var mm = date.getMinutes();\n    var ss = date.getSeconds();\n    if (MM < 10) {\n      MM = \"0\".concat(MM);\n    }\n    if (DD < 10) {\n      DD = \"0\".concat(DD);\n    }\n    if (hh < 10) {\n      hh = \"0\".concat(hh);\n    }\n    if (mm < 10) {\n      mm = \"0\".concat(mm);\n    }\n    if (ss < 10) {\n      ss = \"0\".concat(ss);\n    }\n    return \"\".concat(date.getFullYear()).concat(MM).concat(DD, \"-\").concat(hh).concat(mm).concat(ss);\n  }\n  function createDetails(saveType, description, metadata) {\n    var metadataType = _typeof(metadata);\n    if (metadataType !== 'object' && metadataType !== 'undefined') {\n      throw new TypeError('metadata parameter must be an object or null/undefined');\n    }\n    var cfgMetadata = Config.saves.metadata ? Config.saves.metadata(saveType) : undefined;\n    var cfgMetadataType = _typeof(cfgMetadata);\n    if (cfgMetadataType !== 'object' && cfgMetadataType !== 'undefined') {\n      throw new TypeError('Config.saves.metadata function must return an object or null/undefined');\n    }\n    var details = {\n      type: saveType\n    };\n    var desc;\n    if (description != null) {\n      // lazy equality for null\n      desc = String(description).trim();\n    }\n    if (!desc && typeof Config.saves.descriptions === 'function') {\n      desc = Config.saves.descriptions(saveType);\n      if (typeof desc === 'string') {\n        desc = desc.trim();\n      }\n    }\n    details.desc = desc || \"\".concat(L10n.get('textTurn'), \" \").concat(State.turns);\n    var fullMetadata = Object.assign({}, cfgMetadata, metadata);\n    if (Object.keys(fullMetadata).length > 0) {\n      details.metadata = fullMetadata;\n    }\n    return details;\n  }\n\n  // Find the most recent index, ordered by date (descending).\n  function findNewest(saveType) {\n    var keys;\n    switch (saveType) {\n      case Type.Auto:\n        keys = getKeys(isAutoInfoKey);\n        break;\n      case Type.Slot:\n        keys = getKeys(isSlotInfoKey);\n        break;\n      default:\n        keys = getKeys(isInfoKey);\n        break;\n    }\n    switch (keys.length) {\n      case 0:\n        return {\n          index: -1\n        };\n      case 1:\n        return {\n          index: getIndexFromKey(keys[0]),\n          type: getTypeFromKey(keys[0])\n        };\n    }\n    return keys.map(function (key) {\n      return {\n        value: {\n          index: getIndexFromKey(key),\n          type: getTypeFromKey(key)\n        },\n        date: storage.get(key).date\n      };\n    }).sort(function (a, b) {\n      return b.date - a.date;\n    }).first().value;\n  }\n  function getIndexFromKey(key) {\n    var pos = key.lastIndexOf(INDEX_DELIMITER);\n    if (pos === -1) {\n      throw new Error(\"unable to get index from save key (received: \".concat(key, \")\"));\n    }\n    return Number(key.slice(pos + 1));\n  }\n  function getAutoInfoKeyFromIndex(index) {\n    return \"\".concat(AUTO_INFO_SUBKEY).concat(index);\n  }\n  function getAutoDataKeyFromIndex(index) {\n    return \"\".concat(AUTO_DATA_SUBKEY).concat(index);\n  }\n  function getSlotInfoKeyFromIndex(index) {\n    return \"\".concat(SLOT_INFO_SUBKEY).concat(index);\n  }\n  function getSlotDataKeyFromIndex(index) {\n    return \"\".concat(SLOT_DATA_SUBKEY).concat(index);\n  }\n  function getKeys(predicate) {\n    return storage.keys().filter(predicate);\n  }\n  function getTypeFromKey(key) {\n    return isAutoKey(key) ? Type.Auto : Type.Slot;\n  }\n  function isInfoKey(key) {\n    return key.startsWith(AUTO_INFO_SUBKEY) || key.startsWith(SLOT_INFO_SUBKEY);\n  }\n  function isAutoKey(key) {\n    return key.startsWith(AUTO_SUBKEY);\n  }\n  function isAutoInfoKey(key) {\n    return key.startsWith(AUTO_INFO_SUBKEY);\n  }\n  function isSlotKey(key) {\n    return key.startsWith(SLOT_SUBKEY);\n  }\n  function isSlotInfoKey(key) {\n    return key.startsWith(SLOT_INFO_SUBKEY);\n  }\n  function saveBlobToDiskAs(data, filename, extension) {\n    if (typeof filename !== 'string') {\n      throw new Error('filename parameter must be a string');\n    }\n    var baseName = createFilename(filename);\n    if (baseName === '') {\n      throw new Error('filename parameter must not consist solely of illegal characters');\n    }\n    var datestamp = createDatestamp(new Date());\n    var fileExt = createFilename(extension) || 'save';\n    saveAs(new Blob([data], {\n      type: 'text/plain;charset=UTF-8'\n    }), \"\".concat(baseName, \"-\").concat(datestamp, \".\").concat(fileExt));\n  }\n  function saveToBrowserStorage(saveData) {\n    var data = saveData.data,\n      dataKey = saveData.dataKey,\n      info = saveData.info,\n      infoKey = saveData.infoKey;\n    try {\n      // If storing either chunk is going to fail, it's more likely\n      // to be the data chunk, so we attempt to store it first.\n      if (storage.set(dataKey, data)) {\n        if (!storage.set(infoKey, info)) {\n          storage.delete(dataKey);\n        }\n      }\n    } catch (ex) {\n      // If the storage subsystem throws, attempt to clean up the mess\n      // and then rethrow the exception.\n      storage.delete(dataKey);\n      storage.delete(infoKey);\n      throw ex;\n    }\n  }\n\n  /*******************************************************************************\n  \tBrowser General Saves Functions.\n  *******************************************************************************/\n\n  function browserClear() {\n    autoClear();\n    slotClear();\n    return true;\n  }\n  function browserContinue() {\n    var newest = findNewest();\n    if (newest.index === -1) {\n      return Promise.reject(new Error(L10n.get('saveErrorNonexistent')));\n    }\n    return newest.type === Type.Auto ? autoLoad(newest.index) : slotLoad(newest.index);\n  }\n  function browserIsEnabled() {\n    return autoIsEnabled() || slotIsEnabled();\n  }\n  function browserSize() {\n    return getKeys(isInfoKey).length;\n  }\n\n  /*******************************************************************************\n  \tBrowser Auto Saves Functions.\n  *******************************************************************************/\n\n  function autoClear() {\n    getKeys(isAutoKey).forEach(function (key) {\n      return storage.delete(key);\n    });\n    return true;\n  }\n  function autoDelete(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('auto save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"auto save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    storage.delete(getAutoInfoKeyFromIndex(index));\n    storage.delete(getAutoDataKeyFromIndex(index));\n    return true;\n  }\n  function autoEntries() {\n    // NOTE: Order by date (descending).\n    return getKeys(isAutoInfoKey).map(function (key) {\n      return {\n        index: getIndexFromKey(key),\n        info: storage.get(key)\n      };\n    }).sort(function (a, b) {\n      return b.info.date - a.info.date;\n    });\n  }\n  function autoGet(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('auto save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"auto save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    return storage.get(getAutoInfoKeyFromIndex(index));\n  }\n  function autoHas(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('auto save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"auto save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    return storage.has(getAutoInfoKeyFromIndex(index));\n  }\n  function autoIsEnabled() {\n    return storage.name !== 'cookie' && Config.saves.maxAutoSaves > 0;\n  }\n  function autoLoad(index) {\n    return new Promise(function (resolve) {\n      if (!Number.isInteger(index)) {\n        throw new TypeError('auto save index must be an integer');\n      }\n      if (index < 0 || index > MAX_INDEX) {\n        throw new RangeError(\"auto save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n      }\n      if (Engine.state === Engine.States.Init) {\n        throw new Error(L10n.get('saveErrorLoadTooEarly'));\n      }\n      var info = storage.get(getAutoInfoKeyFromIndex(index));\n      var data = storage.get(getAutoDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error(L10n.get('saveErrorNonexistent'));\n      }\n\n      // NOTE: May throw exceptions.\n      unmarshal(Object.assign(info, data));\n      resolve(true);\n    });\n  }\n  function autoSave(desc, metadata) {\n    if (!autoIsEnabled() || typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed(Type.Auto)) {\n      return false;\n    }\n    var index = (findNewest(Type.Auto).index + 1) % Config.saves.maxAutoSaves;\n    var infoKey = getAutoInfoKeyFromIndex(index);\n    var dataKey = getAutoDataKeyFromIndex(index);\n    var _splitSave3 = splitSave(marshal(createDetails(Type.Auto, desc, metadata))),\n      info = _splitSave3.info,\n      data = _splitSave3.data;\n    saveToBrowserStorage({\n      data: data,\n      dataKey: dataKey,\n      info: info,\n      infoKey: infoKey\n    });\n  }\n  function autoSize() {\n    return getKeys(isAutoInfoKey).length;\n  }\n\n  /*******************************************************************************\n  \tBrowser Slot Saves Functions.\n  *******************************************************************************/\n\n  function slotClear() {\n    getKeys(isSlotKey).forEach(function (key) {\n      return storage.delete(key);\n    });\n    return true;\n  }\n  function slotDelete(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('slot save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"slot save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    storage.delete(getSlotInfoKeyFromIndex(index));\n    storage.delete(getSlotDataKeyFromIndex(index));\n    return true;\n  }\n  function slotEntries() {\n    // NOTE: Order by ID (ascending).\n    return getKeys(isSlotInfoKey).map(function (key) {\n      return {\n        index: getIndexFromKey(key),\n        info: storage.get(key)\n      };\n    }).sort(function (a, b) {\n      return a.index - b.index;\n    });\n  }\n  function slotGet(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('slot save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"slot save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    return storage.get(getSlotInfoKeyFromIndex(index));\n  }\n  function slotHas(index) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('slot save index must be an integer');\n    }\n    if (index < 0 || index > MAX_INDEX) {\n      throw new RangeError(\"slot save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n    }\n    return storage.has(getSlotInfoKeyFromIndex(index));\n  }\n  function slotIsEnabled() {\n    return storage.name !== 'cookie' && Config.saves.maxSlotSaves > 0;\n  }\n  function slotLoad(index) {\n    return new Promise(function (resolve) {\n      if (!Number.isInteger(index)) {\n        throw new TypeError('slot save index must be an integer');\n      }\n      if (index < 0 || index > MAX_INDEX) {\n        throw new RangeError(\"slot save index out of bounds (range: 0\\u2013\".concat(MAX_INDEX, \"; received: \").concat(index, \")\"));\n      }\n      if (Engine.state === Engine.States.Init) {\n        throw new Error(L10n.get('saveErrorLoadTooEarly'));\n      }\n      var info = storage.get(getSlotInfoKeyFromIndex(index));\n      var data = storage.get(getSlotDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error(L10n.get('saveErrorNonexistent'));\n      }\n\n      // NOTE: May throw exceptions.\n      unmarshal(Object.assign(info, data));\n      resolve(true);\n    });\n  }\n  function slotSave(index, desc, metadata) {\n    if (!Number.isInteger(index)) {\n      throw new TypeError('slot save index must be an integer');\n    }\n    if (index < 0 || index >= Config.saves.maxSlotSaves) {\n      throw new RangeError(\"slot save index out of bounds (range: 0\\u2013\".concat(Config.saves.maxSlotSaves - 1, \"; received: \").concat(index, \")\"));\n    }\n    if (!slotIsEnabled() || typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed(Type.Slot)) {\n      throw new Error(L10n.get('saveErrorDisallowed'));\n    }\n    var infoKey = getSlotInfoKeyFromIndex(index);\n    var dataKey = getSlotDataKeyFromIndex(index);\n    var _splitSave4 = splitSave(marshal(createDetails(Type.Slot, desc, metadata))),\n      info = _splitSave4.info,\n      data = _splitSave4.data;\n    saveToBrowserStorage({\n      data: data,\n      dataKey: dataKey,\n      info: info,\n      infoKey: infoKey\n    });\n  }\n  function slotSize() {\n    return getKeys(isSlotInfoKey).length;\n  }\n\n  /*******************************************************************************\n  \tDisk Saves Functions.\n  *******************************************************************************/\n\n  function diskExport(filename) {\n    if (filename == null) {\n      // lazy equality for null\n      throw new Error('Save.browser.export filename parameter is required');\n    }\n    var auto = getKeys(isAutoInfoKey).map(function (infoKey) {\n      var index = getIndexFromKey(infoKey);\n      var info = storage.get(infoKey);\n      var data = storage.get(getAutoDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error('during saves export auto save info or data nonexistent');\n      }\n      return {\n        index: index,\n        info: info,\n        data: data\n      };\n    });\n    var slot = getKeys(isSlotInfoKey).map(function (infoKey) {\n      var index = getIndexFromKey(infoKey);\n      var info = storage.get(infoKey);\n      var data = storage.get(getSlotDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error('during saves export slot save info or data nonexistent');\n      }\n      return {\n        index: index,\n        info: info,\n        data: data\n      };\n    });\n    saveBlobToDiskAs(LZString.compressToBase64(Serial.stringify({\n      auto: auto,\n      slot: slot\n    })), filename, 'savesbundle');\n  }\n  function diskImport(event) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n\n      // Add the handler that will capture the file data once the load is finished.\n      jQuery(reader).on('loadend', function () {\n        try {\n          if (reader.error) {\n            throw new Error(\"\".concat(L10n.get('saveErrorDiskLoadFail'), \": \").concat(reader.error));\n            // throw reader.error;\n          }\n          var badSave = function badSave(O) {\n            return !Object.hasOwn(O, 'index') || !Object.hasOwn(O, 'info') || !Object.hasOwn(O, 'data');\n          };\n          var bundle;\n          try {\n            bundle = Serial.parse(LZString.decompressFromBase64(reader.result));\n          } catch (ex) {\n            throw new Error(L10n.get('saveErrorDecodeFail'));\n          }\n          if (bundle == null // lazy equality for null\n          || _typeof(bundle) !== 'object' || !Object.hasOwn(bundle, 'auto') || !(bundle.auto instanceof Array) || bundle.auto.some(badSave) || !Object.hasOwn(bundle, 'slot') || !(bundle.slot instanceof Array) || bundle.slot.some(badSave)) {\n            throw new Error(L10n.get('saveErrorInvalidData'));\n          }\n\n          // Delete all existing saves before storing the imports.\n          autoClear();\n          slotClear();\n\n          // Attempt to store each of the imported browser saves.\n          bundle.auto.forEach(function (save) {\n            return saveToBrowserStorage({\n              data: save.data,\n              dataKey: getAutoDataKeyFromIndex(save.index),\n              info: save.info,\n              infoKey: getAutoInfoKeyFromIndex(save.index)\n            });\n          });\n          bundle.slot.forEach(function (save) {\n            return saveToBrowserStorage({\n              data: save.data,\n              dataKey: getSlotDataKeyFromIndex(save.index),\n              info: save.info,\n              infoKey: getSlotInfoKeyFromIndex(save.index)\n            });\n          });\n          resolve(true);\n        } catch (ex) {\n          reject(ex);\n        }\n      });\n\n      // Initiate the file load.\n      reader.readAsText(event.target.files[0]);\n    });\n  }\n  function diskLoad(event) {\n    return new Promise(function (resolve, reject) {\n      var reader = new FileReader();\n\n      // Add the handler that will capture the file data once the load is finished.\n      jQuery(reader).on('loadend', function () {\n        try {\n          if (Engine.state === Engine.States.Init) {\n            throw new Error(L10n.get('saveErrorLoadTooEarly'));\n          }\n          if (reader.error) {\n            throw new Error(\"\".concat(L10n.get('saveErrorDiskLoadFail'), \": \").concat(reader.error));\n          }\n          var save;\n          try {\n            save = Serial.parse(LZString.decompressFromBase64(reader.result));\n          } catch (ex) {\n            throw new Error(L10n.get('saveErrorDecodeFail'));\n          }\n\n          // NOTE: May throw exceptions.\n          unmarshal(save);\n          resolve(save.metadata);\n        } catch (ex) {\n          reject(ex);\n        }\n      });\n\n      // Initiate the file load.\n      reader.readAsText(event.target.files[0]);\n    });\n  }\n  function diskSave(filename, metadata) {\n    if (filename == null) {\n      // lazy equality for null\n      throw new Error('Save.disk.save filename parameter is required');\n    }\n    if (typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed(Type.Disk)) {\n      throw new Error(L10n.get('saveErrorDisallowed'));\n    }\n    var details = createDetails(Type.Disk, filename, metadata);\n    saveBlobToDiskAs(LZString.compressToBase64(Serial.stringify(marshal(details))), filename, 'save');\n  }\n\n  /*******************************************************************************\n  \tBase64 Saves Functions.\n  *******************************************************************************/\n\n  function base64Export() {\n    var auto = getKeys(isAutoInfoKey).map(function (infoKey) {\n      var index = getIndexFromKey(infoKey);\n      var info = storage.get(infoKey);\n      var data = storage.get(getAutoDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error('during saves export auto save info or data nonexistent');\n      }\n      return {\n        index: index,\n        info: info,\n        data: data\n      };\n    });\n    var slot = getKeys(isSlotInfoKey).map(function (infoKey) {\n      var index = getIndexFromKey(infoKey);\n      var info = storage.get(infoKey);\n      var data = storage.get(getSlotDataKeyFromIndex(index));\n      if (!info || !data) {\n        throw new Error('during saves export slot save info or data nonexistent');\n      }\n      return {\n        index: index,\n        info: info,\n        data: data\n      };\n    });\n    return LZString.compressToBase64(Serial.stringify({\n      auto: auto,\n      slot: slot\n    }));\n  }\n  function base64Import(base64) {\n    return new Promise(function (resolve) {\n      var badSave = function badSave(O) {\n        return !Object.hasOwn(O, 'index') || !Object.hasOwn(O, 'info') || !Object.hasOwn(O, 'data');\n      };\n      var bundle;\n      try {\n        bundle = Serial.parse(LZString.decompressFromBase64(base64));\n      } catch (ex) {\n        throw new Error(L10n.get('saveErrorDecodeFail'));\n      }\n      if (bundle == null // lazy equality for null\n      || _typeof(bundle) !== 'object' || !Object.hasOwn(bundle, 'auto') || !(bundle.auto instanceof Array) || bundle.auto.some(badSave) || !Object.hasOwn(bundle, 'slot') || !(bundle.slot instanceof Array) || bundle.slot.some(badSave)) {\n        throw new Error(L10n.get('saveErrorInvalidData'));\n      }\n\n      // Delete all existing saves before storing the imports.\n      autoClear();\n      slotClear();\n\n      // Attempt to store each of the imported browser saves.\n      bundle.auto.forEach(function (save) {\n        return saveToBrowserStorage({\n          data: save.data,\n          dataKey: getAutoDataKeyFromIndex(save.index),\n          info: save.info,\n          infoKey: getAutoInfoKeyFromIndex(save.index)\n        });\n      });\n      bundle.slot.forEach(function (save) {\n        return saveToBrowserStorage({\n          data: save.data,\n          dataKey: getSlotDataKeyFromIndex(save.index),\n          info: save.info,\n          infoKey: getSlotInfoKeyFromIndex(save.index)\n        });\n      });\n      resolve(true);\n    });\n  }\n  function base64Load(base64) {\n    return new Promise(function (resolve) {\n      if (Engine.state === Engine.States.Init) {\n        throw new Error(L10n.get('saveErrorLoadTooEarly'));\n      }\n      var save;\n      try {\n        save = Serial.parse(LZString.decompressFromBase64(base64));\n      } catch (ex) {\n        throw new Error(L10n.get('saveErrorDecodeFail'));\n      }\n\n      // NOTE: May throw exceptions.\n      unmarshal(save);\n      resolve(save.metadata);\n    });\n  }\n  function base64Save(metadata) {\n    if (typeof Config.saves.isAllowed === 'function' && !Config.saves.isAllowed(Type.Base64)) {\n      throw new Error(L10n.get('saveErrorDisallowed'));\n    }\n    var details = createDetails(Type.Base64, null, metadata);\n    return LZString.compressToBase64(Serial.stringify(marshal(details)));\n  }\n\n  /*******************************************************************************\n  \tMarshaling Functions.\n  *******************************************************************************/\n\n  /* legacy */\n  function migrateLegacyV2SaveDetail(save) {\n    switch (save.type) {\n      case Type.Auto:\n        return {\n          type: 'autosave'\n        };\n      case Type.Slot:\n        return {\n          type: 'slot'\n        };\n      case Type.Disk:\n        return {\n          type: 'disk'\n        };\n      case Type.Base64:\n        return {\n          type: 'serialize'\n        };\n    }\n    throw new Error(\"save.type must be an integer (received: \".concat(_typeof(save.type), \")\"));\n  }\n  /* /legacy */\n\n  function marshal(details) {\n    if (BUILD_DEBUG) {\n      console.log(\"[Save/marshal({ type : \\\"\".concat(details.type, \"\\\" })]\"));\n    }\n    var save = Object.assign({}, details, {\n      date: Date.now(),\n      id: Config.saves.id,\n      state: State.marshalForSave()\n    });\n    if (Config.saves.version != null) {\n      // lazy equality for null\n      save.version = Config.saves.version;\n    }\n\n    // Call any `onSave` handlers.\n    onSaveHandlers.forEach(function (fn) {\n      return fn(save\n      /* legacy */, migrateLegacyV2SaveDetail(save)\n      /* /legacy */);\n    });\n\n    // Delta encode the state history and delete the non-encoded property.\n    save.state.delta = State.deltaEncode(save.state.history);\n    delete save.state.history;\n    return save;\n  }\n  function splitSave(save) {\n    var state = save.state,\n      info = _objectWithoutProperties(save, _excluded3);\n    return {\n      info: info,\n      data: {\n        state: state\n      }\n    };\n  }\n  function unmarshal(save) {\n    if (BUILD_DEBUG) {\n      console.log('[Save/unmarshal()]');\n    }\n    if (save == null // lazy equality for null\n    || _typeof(save) !== 'object' || !Object.hasOwn(save, 'id') || !Object.hasOwn(save, 'state') || _typeof(save.state) !== 'object' || !Object.hasOwn(save.state, 'delta')) {\n      throw new Error(L10n.get('saveErrorInvalidData'));\n    }\n    if (save.id !== Config.saves.id) {\n      throw new Error(L10n.get('saveErrorIdMismatch'));\n    }\n\n    // Delta decode the state history and delete the encoded property.\n    /* eslint-disable no-param-reassign */\n    save.state.history = State.deltaDecode(save.state.delta);\n    delete save.state.delta;\n    /* eslint-enable no-param-reassign */\n\n    /* legacy */\n    // TODO: Delete this in January 2025.\n    //\n    // Replace a string `save.type` with an integer.\n    if (typeof save.type === 'string') {\n      /* eslint-disable no-param-reassign */\n      switch (save.type) {\n        case 'auto':\n        case 'autosave':\n          {\n            save.type = Type.Auto;\n            break;\n          }\n        case 'slot':\n          {\n            save.type = Type.Slot;\n            break;\n          }\n        case 'disk':\n          {\n            save.type = Type.Disk;\n            break;\n          }\n        case 'base64':\n        case 'serialize':\n          {\n            save.type = Type.Base64;\n            break;\n          }\n      }\n      /* eslint-enable no-param-reassign */\n\n      if (typeof save.type !== 'number') {\n        throw new Error('save.type is unknown');\n      }\n    }\n    /* /legacy */\n\n    // Call any `onLoad` handlers.\n    onLoadHandlers.forEach(function (fn) {\n      return fn(save);\n    });\n\n    // Restore the state.\n    //\n    // NOTE: May throw exceptions.\n    State.unmarshalForSave(save.state);\n  }\n\n  /*******************************************************************************\n  \tEvent Functions.\n  *******************************************************************************/\n\n  function onLoadAdd(handler) {\n    var valueType = getTypeOf(handler);\n    if (valueType !== 'function') {\n      throw new TypeError(\"Save.onLoad.add handler parameter must be a function (received: \".concat(valueType, \")\"));\n    }\n    onLoadHandlers.add(handler);\n  }\n  function onLoadClear() {\n    onLoadHandlers.clear();\n  }\n  function onLoadDelete(handler) {\n    return onLoadHandlers.delete(handler);\n  }\n  function onLoadSize() {\n    return onLoadHandlers.size;\n  }\n  function onSaveAdd(handler) {\n    var valueType = getTypeOf(handler);\n    if (valueType !== 'function') {\n      throw new TypeError(\"Save.onSave.add handler parameter must be a function (received: \".concat(valueType, \")\"));\n    }\n    onSaveHandlers.add(handler);\n  }\n  function onSaveClear() {\n    onSaveHandlers.clear();\n  }\n  function onSaveDelete(handler) {\n    return onSaveHandlers.delete(handler);\n  }\n  function onSaveSize() {\n    return onSaveHandlers.size;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // General Save Constants.\n    Type: {\n      value: Type\n    },\n    MAX_INDEX: {\n      get: function get() {\n        return MAX_INDEX;\n      }\n    },\n    // General Save Functions.\n    init: {\n      value: init\n    },\n    // Browser Saves Functions.\n    browser: {\n      value: Object.preventExtensions(Object.create(null, {\n        // Browser General Saves Functions.\n        clear: {\n          value: browserClear\n        },\n        continue: {\n          value: browserContinue\n        },\n        isEnabled: {\n          value: browserIsEnabled\n        },\n        size: {\n          get: browserSize\n        },\n        // Browser Auto Saves Functions.\n        auto: {\n          value: Object.preventExtensions(Object.create(null, {\n            clear: {\n              value: autoClear\n            },\n            delete: {\n              value: autoDelete\n            },\n            entries: {\n              value: autoEntries\n            },\n            get: {\n              value: autoGet\n            },\n            has: {\n              value: autoHas\n            },\n            isEnabled: {\n              value: autoIsEnabled\n            },\n            load: {\n              value: autoLoad\n            },\n            save: {\n              value: autoSave\n            },\n            size: {\n              get: autoSize\n            }\n          }))\n        },\n        // Browser Slot Saves Functions.\n        slot: {\n          value: Object.preventExtensions(Object.create(null, {\n            clear: {\n              value: slotClear\n            },\n            delete: {\n              value: slotDelete\n            },\n            entries: {\n              value: slotEntries\n            },\n            get: {\n              value: slotGet\n            },\n            has: {\n              value: slotHas\n            },\n            isEnabled: {\n              value: slotIsEnabled\n            },\n            load: {\n              value: slotLoad\n            },\n            save: {\n              value: slotSave\n            },\n            size: {\n              get: slotSize\n            }\n          }))\n        }\n      }))\n    },\n    // Disk Saves Functions.\n    disk: {\n      value: Object.preventExtensions(Object.create(null, {\n        export: {\n          value: diskExport\n        },\n        import: {\n          value: diskImport\n        },\n        load: {\n          value: diskLoad\n        },\n        save: {\n          value: diskSave\n        }\n      }))\n    },\n    // Base64 Saves Functions.\n    base64: {\n      value: Object.preventExtensions(Object.create(null, {\n        export: {\n          value: base64Export\n        },\n        import: {\n          value: base64Import\n        },\n        load: {\n          value: base64Load\n        },\n        save: {\n          value: base64Save\n        }\n      }))\n    },\n    // Event Functions.\n    onLoad: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: onLoadAdd\n        },\n        clear: {\n          value: onLoadClear\n        },\n        delete: {\n          value: onLoadDelete\n        },\n        size: {\n          get: onLoadSize\n        }\n      }))\n    },\n    onSave: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: onSaveAdd\n        },\n        clear: {\n          value: onSaveClear\n        },\n        delete: {\n          value: onSaveDelete\n        },\n        size: {\n          get: onSaveSize\n        }\n      }))\n    },\n    /*\n    \tLegacy API.\n    */\n    get: {\n      value: function value() {\n        throw new Error('[REMOVED] Save.get() has been removed.');\n      }\n    },\n    clear: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.clear() is deprecated.');\n        return browserClear();\n      }\n    },\n    ok: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.ok() is deprecated.');\n        return browserIsEnabled();\n      }\n    },\n    // Autosave Functions.\n    autosave: {\n      value: Object.preventExtensions(Object.create(null, {\n        ok: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.ok() is deprecated.');\n            return autoIsEnabled();\n          }\n        },\n        has: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.has() is deprecated.');\n            return autoHas(0);\n          }\n        },\n        get: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.get() is deprecated.');\n            return autoGet(0);\n          }\n        },\n        load: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.load() is deprecated.');\n            return autoLoad(0);\n          }\n        },\n        save: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.save() is deprecated.');\n            return autoSave.apply(void 0, arguments);\n          }\n        },\n        delete: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.autosave.delete() is deprecated.');\n            return autoDelete(0);\n          }\n        }\n      }))\n    },\n    // Slots Functions.\n    slots: {\n      value: Object.preventExtensions(Object.create(null, {\n        ok: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.ok() is deprecated.');\n            return slotIsEnabled();\n          }\n        },\n        length: {\n          get: function get() {\n            console.warn('[DEPRECATED] Save.slots.length is deprecated.');\n            return Config.saves.maxSlotSaves;\n          }\n        },\n        isEmpty: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.isEmpty() is deprecated.');\n            return slotSize() === 0;\n          }\n        },\n        count: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.count() is deprecated.');\n            return slotSize();\n          }\n        },\n        has: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.has() is deprecated.');\n            return slotHas.apply(void 0, arguments);\n          }\n        },\n        get: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.get() is deprecated.');\n            return slotGet.apply(void 0, arguments);\n          }\n        },\n        load: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.load() is deprecated.');\n            return slotLoad.apply(void 0, arguments);\n          }\n        },\n        save: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.save() is deprecated.');\n            return slotSave.apply(void 0, arguments);\n          }\n        },\n        delete: {\n          value: function value() {\n            console.warn('[DEPRECATED] Save.slots.delete() is deprecated.');\n            return slotDelete.apply(void 0, arguments);\n          }\n        }\n      }))\n    },\n    // Disk Import/Export Functions.\n    export: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.export() is deprecated.');\n        return diskSave.apply(void 0, arguments);\n      }\n    },\n    import: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.import() is deprecated.');\n        return diskLoad.apply(void 0, arguments);\n      }\n    },\n    // Serialization Saves Functions.\n    serialize: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.serialize() is deprecated.');\n        return base64Save.apply(void 0, arguments);\n      }\n    },\n    deserialize: {\n      value: function value() {\n        console.warn('[DEPRECATED] Save.deserialize() is deprecated.');\n        return base64Load.apply(void 0, arguments);\n      }\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tsetting.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global enumFrom, settings:true, storage */\n\nvar Setting = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Setting control types object.\n  var Types = enumFrom({\n    Header: 0,\n    Toggle: 1,\n    List: 2,\n    Range: 3,\n    Value: 4\n  });\n\n  // Setting definition array.\n  var _definitions = [];\n\n  /*******************************************************************************\n  \tInitialization Functions.\n  *******************************************************************************/\n\n  function init() {\n    if (BUILD_DEBUG) {\n      console.log('[Setting/init()]');\n    }\n\n    // Load existing settings.\n    load();\n\n    // Execute `onInit` callbacks.\n    _definitions.forEach(function (def) {\n      if (Object.hasOwn(def, 'onInit')) {\n        var data = createResultObject(def);\n        def.onInit.call(data, data);\n      }\n    });\n  }\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function updateSettingsObject(value) {\n    window.SugarCube.settings = settings = value;\n  }\n  function createResultObject(def) {\n    var result = {\n      name: def.name,\n      value: settings[def.name],\n      default: def.default\n    };\n    if (Object.hasOwn(def, 'list')) {\n      result.list = def.list;\n    }\n    if (Object.hasOwn(def, 'min')) {\n      result.min = def.min;\n    }\n    if (Object.hasOwn(def, 'max')) {\n      result.max = def.max;\n    }\n    if (Object.hasOwn(def, 'step')) {\n      result.step = def.step;\n    }\n    return result;\n  }\n\n  /*******************************************************************************\n  \tAPI Functions.\n  *******************************************************************************/\n\n  function clear() {\n    updateSettingsObject(create());\n    storage.delete('settings');\n    return true;\n  }\n  function create() {\n    return Object.create(null);\n  }\n  function load() {\n    var defaultSettings = create();\n    var loadedSettings = storage.get('settings') || create();\n\n    // Load the defaults.\n    _definitions.filter(function (def) {\n      return def.type !== Types.Header;\n    }).forEach(function (def) {\n      return defaultSettings[def.name] = def.default;\n    });\n\n    // Assign to the `settings` object while overwriting the defaults with the loaded settings.\n    updateSettingsObject(Object.assign(defaultSettings, loadedSettings));\n  }\n  function reset(name) {\n    if (arguments.length === 0) {\n      clear();\n      load();\n    } else {\n      if (name == null || !has(name)) {\n        // lazy equality for null\n        throw new Error(\"nonexistent setting \\\"\".concat(name, \"\\\"\"));\n      }\n      var def = get(name);\n      if (def.type !== Types.Header) {\n        settings[name] = def.default;\n      }\n    }\n    return save();\n  }\n  function save() {\n    var savedSettings = create();\n    if (Object.keys(settings).length > 0) {\n      _definitions.filter(function (def) {\n        return def.type !== Types.Header && settings[def.name] !== def.default;\n      }).forEach(function (def) {\n        return savedSettings[def.name] = settings[def.name];\n      });\n    }\n    if (Object.keys(savedSettings).length === 0) {\n      storage.delete('settings');\n      return true;\n    }\n    return storage.set('settings', savedSettings);\n  }\n\n  /*******************************************************************************\n  \tDefinitions Functions.\n  *******************************************************************************/\n\n  function add(type, name, def) {\n    if (arguments.length < 2) {\n      var errors = [];\n      if (arguments.length < 1) {\n        errors.push('type');\n      }\n      if (arguments.length < 2) {\n        errors.push('name');\n      }\n      throw new Error(\"missing parameters, no \".concat(errors.join(' or '), \" specified\"));\n    }\n    if (def == null) {\n      // lazy equality for null\n      def = {}; // eslint-disable-line no-param-reassign\n    } else if (_typeof(def) !== 'object') {\n      throw new TypeError('definition parameter must be an object');\n    }\n    if (has(name)) {\n      throw new Error(\"cannot clobber existing setting \\\"\".concat(name, \"\\\"\"));\n    }\n\n    /*\n    \tDefinition object properties and types:\n    \t\ttype      →  (all)   → Setting.Types\n    \t\tname      →  (all)   → string\n    \t\tlabel     →  (all)   → string\n    \t\tdesc      →  (all)   → string\n    \t\tdefault\n    \t\t\t(if defined)\n    \t\t\t\t  →  Toggle  → boolean\n    \t\t\t\t  →  List    → Array\n    \t\t\t\t  →  Range   → number\n    \t\t\t\t  →  Value   → any\n    \t\t\t(if undefined)\n    \t\t\t\t  →  Toggle  → false\n    \t\t\t\t  →  List    → list[0]\n    \t\t\t\t  →  Range   → max\n    \t\t\t\t  →  Value   → undefined\n    \t\tlist      →  List    → Array\n    \t\tmin       →  Range   → number\n    \t\tmax       →  Range   → number\n    \t\tstep      →  Range   → number\n    \t\tonInit    →  (all)   → function\n    \t\tonChange  →  (all)   → function\n    */\n    var definition = {\n      type: type,\n      name: name\n    };\n    if (type !== Types.Value) {\n      definition.label = typeof def.label === 'string' ? def.label.trim() : '';\n    }\n    if (typeof def.desc === 'string') {\n      var desc = def.desc.trim();\n      if (desc !== '') {\n        definition.desc = desc;\n      }\n    }\n    switch (type) {\n      case Types.Header:\n        break;\n      case Types.List:\n        {\n          if (!Object.hasOwn(def, 'list')) {\n            throw new Error('no list specified');\n          } else if (!Array.isArray(def.list)) {\n            throw new TypeError('list must be an array');\n          } else if (def.list.length === 0) {\n            throw new Error('list must not be empty');\n          }\n          definition.list = Object.freeze(def.list);\n          if (def.default == null) {\n            // lazy equality for null\n            definition.default = def.list[0];\n          } else {\n            var defaultIndex = def.list.indexOf(def.default);\n            if (defaultIndex === -1) {\n              throw new Error('list does not contain default');\n            }\n            definition.default = def.list[defaultIndex];\n          }\n          break;\n        }\n      case Types.Range:\n        {\n          if (!Object.hasOwn(def, 'min')) {\n            throw new Error('no min specified');\n          } else if (typeof def.min !== 'number' || Number.isNaN(def.min) || !Number.isFinite(def.min)) {\n            throw new TypeError('min must be a finite number');\n          }\n          if (!Object.hasOwn(def, 'max')) {\n            throw new Error('no max specified');\n          } else if (typeof def.max !== 'number' || Number.isNaN(def.max) || !Number.isFinite(def.max)) {\n            throw new TypeError('max must be a finite number');\n          }\n          if (!Object.hasOwn(def, 'step')) {\n            throw new Error('no step specified');\n          } else if (typeof def.step !== 'number' || Number.isNaN(def.step) || !Number.isFinite(def.step) || def.step <= 0) {\n            throw new TypeError('step must be a finite number greater than zero');\n          } else {\n            // Set up a function to validate a given value against the step value.\n            var stepValidate = function stepValidate(value) {\n              if (fracDigits > 0) {\n                var ma = Number(\"\".concat(def.min, \"e\").concat(fracDigits));\n                var sa = Number(\"\".concat(def.step, \"e\").concat(fracDigits));\n                var _va = Number(\"\".concat(value, \"e\").concat(fracDigits)) - ma;\n                return Number(\"\".concat(_va - _va % sa + ma, \"e-\").concat(fracDigits));\n              }\n              var va = value - def.min;\n              return va - va % def.step + def.min;\n            }; // Sanity check the max value against the step value.\n            // Determine how many fractional digits we need to be concerned with based on the step value.\n            var fracDigits = function () {\n              var str = String(def.step);\n              var pos = str.lastIndexOf('.');\n              return pos === -1 ? 0 : str.length - pos - 1;\n            }();\n            if (stepValidate(def.max) !== def.max) {\n              throw new RangeError(\"max (\".concat(def.max, \") is not a multiple of the step (\").concat(def.step, \") plus the min (\").concat(def.min, \")\"));\n            }\n          }\n          definition.max = def.max;\n          definition.min = def.min;\n          definition.step = def.step;\n          if (def.default == null) {\n            // lazy equality for null\n            definition.default = def.max;\n          } else {\n            if (typeof def.default !== 'number' || Number.isNaN(def.default) || !Number.isFinite(def.default)) {\n              throw new TypeError('default must be a finite number');\n            } else if (def.default < def.min) {\n              throw new RangeError(\"default (\".concat(def.default, \") is less than min (\").concat(def.min, \")\"));\n            } else if (def.default > def.max) {\n              throw new RangeError(\"default (\".concat(def.default, \") is greater than max (\").concat(def.max, \")\"));\n            }\n            definition.default = def.default;\n          }\n          break;\n        }\n      case Types.Toggle:\n        {\n          definition.default = Boolean(def.default);\n          break;\n        }\n      case Types.Value:\n        {\n          definition.default = def.default;\n          break;\n        }\n      default:\n        throw new Error(\"unknown Setting type: \".concat(type));\n    }\n    if (typeof def.onInit === 'function') {\n      definition.onInit = Object.freeze(def.onInit);\n    }\n    if (typeof def.onChange === 'function') {\n      definition.onChange = Object.freeze(def.onChange);\n    }\n    _definitions.push(Object.freeze(definition));\n  }\n  function addHeader(name, desc) {\n    add(Types.Header, name, {\n      desc: desc\n    });\n  }\n  function addList() {\n    for (var _len20 = arguments.length, args = new Array(_len20), _key20 = 0; _key20 < _len20; _key20++) {\n      args[_key20] = arguments[_key20];\n    }\n    add.apply(void 0, [Types.List].concat(args));\n  }\n  function addRange() {\n    for (var _len21 = arguments.length, args = new Array(_len21), _key21 = 0; _key21 < _len21; _key21++) {\n      args[_key21] = arguments[_key21];\n    }\n    add.apply(void 0, [Types.Range].concat(args));\n  }\n  function addToggle() {\n    for (var _len22 = arguments.length, args = new Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n      args[_key22] = arguments[_key22];\n    }\n    add.apply(void 0, [Types.Toggle].concat(args));\n  }\n  function addValue() {\n    for (var _len23 = arguments.length, args = new Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n      args[_key23] = arguments[_key23];\n    }\n    add.apply(void 0, [Types.Value].concat(args));\n  }\n  function forEach(callback, thisArg) {\n    _definitions.forEach(callback, thisArg);\n  }\n  function delete$(name) {\n    for (var i = 0; i < _definitions.length; ++i) {\n      if (_definitions[i].name === name) {\n        _definitions.splice(i, 1);\n        break;\n      }\n    }\n    if (Object.hasOwn(settings, name)) {\n      delete settings[name];\n    }\n  }\n  function get(name) {\n    return _definitions.find(function (definition) {\n      return definition.name === name;\n    });\n  }\n  function has(name) {\n    return _definitions.some(function (definition) {\n      return definition.name === name;\n    });\n  }\n  function isEmpty() {\n    return _definitions.length === 0;\n  }\n\n  /*******************************************************************************\n  \tValues Functions.\n  *******************************************************************************/\n\n  function getValue(name) {\n    return settings[name];\n  }\n  function setValue(name, value) {\n    if (!has(name)) {\n      throw new Error('no such setting');\n    }\n    settings[name] = value;\n\n    // QUESTION: Should we do something here upon failure?\n    save();\n    var def = get(name);\n    if (Object.hasOwn(def, 'onChange')) {\n      var data = createResultObject(def);\n      def.onChange.call(data, data);\n    }\n    return true;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Enumerations.\n    Types: {\n      value: Types\n    },\n    // Initialization Functions.\n    init: {\n      value: init\n    },\n    // Settings Functions.\n    clear: {\n      value: clear\n    },\n    create: {\n      value: create\n    },\n    load: {\n      value: load\n    },\n    reset: {\n      value: reset\n    },\n    save: {\n      value: save\n    },\n    // Definitions Functions.\n    add: {\n      value: add\n    },\n    addHeader: {\n      value: addHeader\n    },\n    addList: {\n      value: addList\n    },\n    addRange: {\n      value: addRange\n    },\n    addToggle: {\n      value: addToggle\n    },\n    addValue: {\n      value: addValue\n    },\n    delete: {\n      value: delete$\n    },\n    forEach: {\n      value: forEach\n    },\n    get: {\n      value: get\n    },\n    has: {\n      value: has\n    },\n    isEmpty: {\n      value: isEmpty\n    },\n    // Values Functions.\n    getValue: {\n      value: getValue\n    },\n    setValue: {\n      value: setValue\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tstory.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Passage, Wikifier, charAndPosAt, createSlug, decodeEntities, getTypeOf, sameValueZero */\n\nvar Story = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Story IFID.\n  var _ifId = '';\n\n  // DOM-compatible ID.\n  var _id = '';\n\n  // Story name.\n  var _name = '';\n\n  // Mapping of normal passages.\n  var _passages = createPassageStore();\n\n  // List of init passages.\n  var _inits = [];\n\n  // List of script passages.\n  var _scripts = [];\n\n  // List of style passages.\n  var _styles = [];\n\n  // List of widget passages.\n  var _widgets = [];\n\n  // List of code passages for sanity checks.\n  var codePassageNames = ['PassageDone', 'PassageFooter', 'PassageHeader', 'PassageReady', 'StoryAuthor', 'StoryBanner', 'StoryCaption', 'StoryDisplayTitle', 'StoryInit', 'StoryInterface', 'StoryMenu', 'StoryShare', 'StorySubtitle'];\n\n  // List of code tags for sanity checks.\n  var codeTagNames = ['init', 'widget'];\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function createPassageStore(passages) {\n    var store = Object.create(null);\n    return passages ? Object.assign(store, passages) : store;\n  }\n  function generateId(name) {\n    // TODO: In v3 the ID should be created from a combination of the\n    // name slug and the IFID, if available, to avoid collisions between\n    // stories whose names generate identical slugs.\n    var id = createSlug(name);\n\n    // [v2] Protect the ID against being an empty string.\n    //\n    // If `id` is empty, attempt a failover.\n    if (id === '') {\n      // If `_ifId` is not empty, then use it.\n      if (_ifId !== '') {\n        id = _ifId;\n      }\n\n      // Elsewise generate a string from the `name`'s code points (in hexadecimal).\n      else {\n        for (var i = 0; i < name.length; ++i) {\n          var _charAndPosAt2 = charAndPosAt(name, i),\n            char = _charAndPosAt2.char,\n            start = _charAndPosAt2.start,\n            end = _charAndPosAt2.end;\n          id += char.codePointAt(0).toString(16);\n          i += end - start;\n        }\n      }\n    }\n    return id;\n  }\n  function generateName(rawName) {\n    if (rawName == null) {\n      // lazy equality for null\n      throw new Error('story name must not be null or undefined');\n    }\n    var name = decodeEntities(String(rawName)).trim();\n    if (name === '') {\n      // lazy equality for null\n      throw new Error('story name must not be empty or consist solely of whitespace');\n    }\n    return name;\n  }\n\n  /*******************************************************************************\n  \tInitialization Functions.\n  *******************************************************************************/\n\n  function init() {\n    function assertNoCodeTags(passage, desc) {\n      // Code tags are completely disallowed.\n      if (passage.tags.includesAny(codeTagNames)) {\n        throw new Error(\"\".concat(desc, \" passage \\\"\").concat(passage.name, \"\\\" includes code tags; invalid: \\\"\").concat(passage.tags.filter(function (tag) {\n          return codeTagNames.includes(tag);\n        }).sort().join('\", \"'), \"\\\"\"));\n      }\n    }\n    function assertValidCodeTagUsage(passage) {\n      var found = passage.tags.filter(function (tag) {\n        return codeTagNames.includes(tag);\n      }).sort();\n\n      // Multiple code tags are disallowed.\n      if (found.length > 1) {\n        throw new Error(\"passage \\\"\".concat(passage.name, \"\\\" includes multiple code tags; invalid: \\\"\").concat(found.join('\", \"'), \"\\\"\"));\n      }\n    }\n    if (BUILD_DEBUG) {\n      console.log('[Story/init()]');\n    }\n\n    // For Twine 1.\n    if (BUILD_TWINE1) {\n      // Additional Twine 1 assertion setup.\n      codePassageNames.push('StorySettings', 'StoryTitle');\n      codeTagNames.push('script', 'stylesheet');\n\n      // Set the default starting passage.\n      Config.passages.start = function () {\n        // Handle the Twine 1.4+ Test Play From Here feature.\n        //\n        // WARNING: Do not remove the `String()` wrapper from or change the quote\n        // style of the `\"START_AT\"` replacement target.  The former is there to\n        // keep Terser from pruning the code into oblivion—i.e. minifying the\n        // code into something broken.  The latter is there because the Twine 1\n        // pattern that matches it depends upon the double quotes.\n        var testPlay = String(\"START_AT\"); // eslint-disable-line quotes\n\n        if (testPlay !== '') {\n          if (BUILD_DEBUG) {\n            console.log(\"\\tTest play; starting passage: \\\"\".concat(testPlay, \"\\\"\"));\n          }\n          Config.debug = true;\n          return testPlay;\n        }\n\n        // In the absence of a `testPlay` value, return 'Start'.\n        return 'Start';\n      }();\n\n      // Process passages, excluding any tagged 'Twine.private' or 'annotation'.\n      jQuery('#store-area').children(':not([tags~=\"Twine.private\"],[tags~=\"annotation\"])').each(function () {\n        var $this = jQuery(this);\n        var passage = new Passage($this.attr('tiddler'), this);\n\n        // WARNING: The ordering of the following `if` statements is important!\n\n        // Special case: starting passage.\n        if (passage.name === Config.passages.start) {\n          assertNoCodeTags(passage, 'starting');\n          _passages[passage.name] = passage;\n        }\n\n        // Special case: code passages.\n        else if (codePassageNames.includes(passage.name)) {\n          assertNoCodeTags(passage, 'code');\n          // NOTE: Ideally, these should be going into their own store, rather than `_passages`.\n          _passages[passage.name] = passage;\n        }\n\n        // Special case: init passages.\n        else if (passage.tags.includes('init')) {\n          assertValidCodeTagUsage(passage);\n          _inits.push(passage);\n        }\n\n        // Special case: script passages.\n        else if (passage.tags.includes('script')) {\n          assertValidCodeTagUsage(passage);\n          _scripts.push(passage);\n        }\n\n        // Special case: stylesheet passages.\n        else if (passage.tags.includes('stylesheet')) {\n          assertValidCodeTagUsage(passage);\n          _styles.push(passage);\n        }\n\n        // Special case: widget passages.\n        else if (passage.tags.includes('widget')) {\n          assertValidCodeTagUsage(passage);\n          _widgets.push(passage);\n        }\n\n        // All other passages.\n        else {\n          _passages[passage.name] = passage;\n        }\n      });\n\n      // Get the story's name.\n      if (Object.hasOwn(_passages, 'StoryTitle')) {\n        var buf = document.createDocumentFragment();\n        new Wikifier(buf, _passages.StoryTitle.processText().trim());\n        _name = generateName(buf.textContent);\n      } else {\n        throw new Error('cannot find the \"StoryTitle\" special passage');\n      }\n    }\n\n    // For Twine 2.\n    else {\n      var $storydata = jQuery('tw-storydata');\n      var startNode = $storydata.attr('startnode') || '';\n\n      // Set the default starting passage.\n      Config.passages.start = null; // no default in Twine 2\n\n      // Process story options.\n      //\n      // NOTE: Currently, the only option of interest is 'debug', so we\n      // simply use a regular expression to check for it.\n      Config.debug = /\\bdebug\\b/.test($storydata.attr('options'));\n\n      // Process stylesheets.\n      $storydata.children('style') // alternatively: '[type=\"text/twine-css\"]'\n      .each(function (i) {\n        _styles.push(new Passage(\"tw-user-style-\".concat(i), this));\n      });\n\n      // Process scripts.\n      $storydata.children('script') // alternatively: '[type=\"text/twine-javascript\"]'\n      .each(function (i) {\n        _scripts.push(new Passage(\"tw-user-script-\".concat(i), this));\n      });\n\n      // Process passages, excluding any tagged 'Twine.private' or 'annotation'.\n      $storydata.children('tw-passagedata:not([tags~=\"Twine.private\"],[tags~=\"annotation\"])').each(function () {\n        var $this = jQuery(this);\n        var pid = $this.attr('pid') || '';\n        var passage = new Passage($this.attr('name'), this);\n\n        // WARNING: The ordering of the following `if` statements is important!\n\n        // Special case: starting passage.\n        if (pid === startNode && startNode !== '') {\n          Config.passages.start = passage.name;\n          assertNoCodeTags(passage, 'starting');\n          _passages[passage.name] = passage;\n        }\n\n        // Special case: code passages.\n        else if (codePassageNames.includes(passage.name)) {\n          assertNoCodeTags(passage, 'code');\n          // NOTE: Ideally, these should be going into their own store, rather than `_passages`.\n          _passages[passage.name] = passage;\n        }\n\n        // Special case: init passages.\n        else if (passage.tags.includes('init')) {\n          assertValidCodeTagUsage(passage);\n          _inits.push(passage);\n        }\n\n        // Special case: widget passages.\n        else if (passage.tags.includes('widget')) {\n          assertValidCodeTagUsage(passage);\n          _widgets.push(passage);\n        }\n\n        // All other passages.\n        else {\n          _passages[passage.name] = passage;\n        }\n      });\n\n      // Get the story's IFID.\n      _ifId = $storydata.attr('ifid');\n\n      // Get the story's name.\n      //\n      // QUESTION: Maybe `$storydata.attr('name')` should be used instead of `'{{STORY_NAME}}'`?\n      // _name = generateName($storydata.attr('name'));\n      _name = generateName('{{STORY_NAME}}');\n    }\n\n    // Get the story's ID.\n    _id = generateId(_name);\n\n    // Set the default saves ID to the story's ID.\n    Config.saves.id = _id;\n\n    // Set the document's title to the story's name.\n    document.title = _name;\n  }\n\n  /*******************************************************************************\n  \tStory Functions.\n  *******************************************************************************/\n\n  function getId() {\n    return _id;\n  }\n  function getIfId() {\n    return _ifId;\n  }\n  function getName() {\n    return _name;\n  }\n\n  /*******************************************************************************\n  \tPassage Functions.\n  *******************************************************************************/\n\n  function add(descriptor) {\n    if (getTypeOf(descriptor) !== 'Object') {\n      throw new TypeError('Story.add() descriptor parameter must be a generic object');\n    }\n    if (Object.hasOwn(_passages, descriptor.name)) {\n      return false;\n    }\n    var elem = document.createElement('div');\n    elem.setAttribute('name', descriptor.name);\n    elem.setAttribute('tags', descriptor.tags);\n    elem.textContent = descriptor.text;\n    var passage = new Passage(descriptor.name, elem);\n    if (codePassageNames.includes(passage.name)) {\n      throw new Error(\"Story.add() passage descriptor object \\\"\".concat(passage.name, \"\\\" must not be a code passage\"));\n    }\n    if (passage.tags.includesAny(codeTagNames)) {\n      throw new Error(\"Story.add() passage descriptor object \\\"\".concat(passage.name, \"\\\" must not include code tags\"));\n    }\n    _passages[passage.name] = passage;\n    return true;\n  }\n  function delete$(name) {\n    var type = _typeof(name);\n    switch (type) {\n      // Valid types.\n      case 'number':\n      case 'string':\n        {\n          var key = String(name);\n          if (!Object.hasOwn(_passages, key)) {\n            return false;\n          }\n          if (key === Config.passages.start || codePassageNames.includes(key)) {\n            throw new Error(\"Story.delete() passage \\\"\".concat(key, \"\\\" must not be a code passage\"));\n          }\n          if (_passages[key].tags.includesAny(codeTagNames)) {\n            throw new Error(\"Story.delete() passage \\\"\".concat(key, \"\\\" must not include code tags\"));\n          }\n          delete _passages[key];\n          return true;\n        }\n\n      // Invalid types.  We do the extra processing just to make a nicer error.\n      case 'undefined':\n        /* no-op */\n        break;\n      case 'object':\n        type = name === null ? 'null' : 'an object';\n        break;\n      default:\n        // 'bigint', 'boolean', 'function', 'symbol'\n        type = \"a \".concat(type);\n        break;\n    }\n    throw new TypeError(\"Story.delete() name parameter cannot be \".concat(type));\n  }\n  function filter(predicate, thisArg) {\n    if (typeof predicate !== 'function') {\n      throw new TypeError('Story.filter() predicate parameter must be a function');\n    }\n    var results = [];\n    for (var i = 0, keys = Object.keys(_passages); i < keys.length; ++i) {\n      var passage = _passages[keys[i]];\n      if (predicate.call(typeof thisArg === 'undefined' ? this : thisArg, passage)) {\n        results.push(passage);\n      }\n    }\n    return results;\n  }\n  function find(predicate, thisArg) {\n    if (typeof predicate !== 'function') {\n      throw new TypeError('Story.find() predicate parameter must be a function');\n    }\n    for (var i = 0, keys = Object.keys(_passages); i < keys.length; ++i) {\n      var passage = _passages[keys[i]];\n      if (predicate.call(typeof thisArg === 'undefined' ? this : thisArg, passage)) {\n        return passage;\n      }\n    }\n  }\n  function get(name) {\n    var type = _typeof(name);\n    switch (type) {\n      // Valid types.\n      case 'number':\n      case 'string':\n        {\n          var key = String(name);\n          return Object.hasOwn(_passages, key) ? _passages[key] : new Passage(key || '(unknown)');\n        }\n\n      // Invalid types.  We do the extra processing just to make a nicer error.\n      case 'undefined':\n        /* no-op */\n        break;\n      case 'object':\n        type = name === null ? 'null' : 'an object';\n        break;\n      default:\n        // 'bigint', 'boolean', 'function', 'symbol'\n        type = \"a \".concat(type);\n        break;\n    }\n    throw new TypeError(\"Story.get() name parameter cannot be \".concat(type));\n  }\n  function getInits() {\n    // NOTE: Return an immutable copy, rather than the internal mutable original.\n    return Object.freeze(Array.from(_inits));\n  }\n  function getNormals() {\n    // NOTE: Return an immutable copy, rather than the internal mutable original.\n    return Object.freeze(createPassageStore(_passages));\n  }\n  function getScripts() {\n    // NOTE: Return an immutable copy, rather than the internal mutable original.\n    return Object.freeze(Array.from(_scripts));\n  }\n  function getStyles() {\n    // NOTE: Return an immutable copy, rather than the internal mutable original.\n    return Object.freeze(Array.from(_styles));\n  }\n  function getWidgets() {\n    // NOTE: Return an immutable copy, rather than the internal mutable original.\n    return Object.freeze(Array.from(_widgets));\n  }\n  function has(name) {\n    var type = _typeof(name);\n    switch (type) {\n      // Valid types.\n      case 'number':\n      case 'string':\n        return Object.hasOwn(_passages, String(name));\n\n      // Invalid types.  We do the extra processing just to make a nicer error.\n      case 'undefined':\n        /* no-op */\n        break;\n      case 'object':\n        type = name === null ? 'null' : 'an object';\n        break;\n      default:\n        // 'bigint', 'boolean', 'function', 'symbol'\n        type = \"a \".concat(type);\n        break;\n    }\n    throw new TypeError(\"Story.has name parameter cannot be \".concat(type));\n  }\n\n  /*******************************************************************************\n  \tDeprecated Functions.\n  *******************************************************************************/\n\n  function lookup(key, value /* legacy */) {\n    var sortKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'name';\n    console.warn('[DEPRECATED] Story.lookup() is deprecated.');\n\n    /* eslint-disable eqeqeq, no-nested-ternary, max-len */\n    return filter(function (passage) {\n      // Objects (sans `null`).\n      if (_typeof(passage[key]) === 'object' && passage[key] !== null) {\n        // The only object type currently supported is `Array`, since the\n        // non-method `Passage` object properties currently yield only either\n        // primitives or arrays.\n        return passage[key] instanceof Array && passage[key].some(function (m) {\n          return sameValueZero(m, value);\n        });\n      }\n\n      // All other types (incl. `null`).\n      return sameValueZero(passage[key], value);\n    }).sort(function (a, b) {\n      return a[sortKey] == b[sortKey] ? 0 : a[sortKey] < b[sortKey] ? -1 : +1;\n    }); // lazy equality for null\n    /* eslint-enable eqeqeq, no-nested-ternary, max-len */\n  }\n  function lookupWith(predicate /* legacy */) {\n    var sortKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'name';\n    console.warn('[DEPRECATED] Story.lookupWith() is deprecated.');\n    if (typeof predicate !== 'function') {\n      throw new TypeError('Story.lookupWith() predicate parameter must be a function');\n    }\n\n    /* eslint-disable eqeqeq, no-nested-ternary, max-len */\n    return filter(predicate).sort(function (a, b) {\n      return a[sortKey] == b[sortKey] ? 0 : a[sortKey] < b[sortKey] ? -1 : +1;\n    }); // lazy equality for null\n    /* eslint-enable eqeqeq, no-nested-ternary, max-len */\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Initialization Functions.\n    init: {\n      value: init\n    },\n    // Story Functions.\n    id: {\n      get: getId\n    },\n    ifId: {\n      get: getIfId\n    },\n    name: {\n      get: getName\n    },\n    // Passage Functions.\n    add: {\n      value: add\n    },\n    delete: {\n      value: delete$\n    },\n    filter: {\n      value: filter\n    },\n    find: {\n      value: find\n    },\n    get: {\n      value: get\n    },\n    getInits: {\n      value: getInits\n    },\n    getNormals: {\n      value: getNormals\n    },\n    getScripts: {\n      value: getScripts\n    },\n    getStyles: {\n      value: getStyles\n    },\n    getWidgets: {\n      value: getWidgets\n    },\n    has: {\n      value: has\n    },\n    /* legacy */\n    domId: {\n      get: function get() {\n        console.warn('[DEPRECATED] Story.domId is deprecated.');\n        return getId();\n      }\n    },\n    title: {\n      get: function get() {\n        console.warn('[DEPRECATED] Story.title is deprecated.');\n        return getName();\n      }\n    },\n    lookup: {\n      value: lookup\n    },\n    lookupWith: {\n      value: lookupWith\n    }\n    /* /legacy */\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tui.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Alert, Config, Dialog, Engine, Has, L10n, Save, Setting, State, Story, Wikifier,\n\t       createSlug, errorPrologRegExp, triggerEvent\n*/\n\nvar UI = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function assembleLinkList(passage, listEl) {\n    var list = listEl;\n\n    // Cache the value of `Config.debug`, then disable it during this method's run.\n    var debugState = Config.debug;\n    Config.debug = false;\n    try {\n      if (list == null) {\n        // lazy equality for null\n        list = document.createElement('ul');\n      }\n\n      // Wikify the content of the given source passage into a fragment.\n      var frag = document.createDocumentFragment();\n      new Wikifier(frag, Story.get(passage).processText().trim(), {\n        cleanup: false\n      });\n\n      // Gather the text of any error elements within the fragment…\n      var errors = Array.from(frag.querySelectorAll('.error')).map(function (errEl) {\n        return errEl.textContent.replace(errorPrologRegExp, '');\n      });\n\n      // …and throw an exception, if there were any errors.\n      if (errors.length > 0) {\n        throw new Error(errors.join('; '));\n      }\n      while (frag.hasChildNodes()) {\n        var node = frag.firstChild;\n\n        // Create list items for <a>-element nodes.\n        if (node.nodeType === Node.ELEMENT_NODE && node.nodeName.toUpperCase() === 'A') {\n          var li = document.createElement('li');\n          list.appendChild(li);\n          li.appendChild(node);\n        }\n\n        // Discard non-<a>-element nodes.\n        else {\n          frag.removeChild(node);\n        }\n      }\n    } finally {\n      // Restore `Config.debug` to its original value.\n      Config.debug = debugState;\n    }\n    return list;\n  }\n  function buildRestart() {\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildRestart()]');\n    }\n    Dialog.create(L10n.get('restartTitle'), 'restart').append( /* eslint-disable max-len */\n    \"<p>\".concat(L10n.get('restartMesgPrompt'), \"</p><ul class=\\\"buttons\\\">\") + \"<li><button id=\\\"restart-ok\\\">\".concat(L10n.get(['restartTextOk', 'textOk']), \"</button></li>\") + \"<li><button id=\\\"restart-cancel\\\" class=\\\"ui-close\\\">\".concat(L10n.get(['restartTextCancel', 'textCancel']), \"</button></li>\") + '</ul>'\n    /* eslint-enable max-len */);\n\n    // NOTE: Instead of adding '.ui-close' to the '#restart-ok' button (to receive\n    // the use of the default delegated dialog close handler), we set up a special\n    // case close handler here.  We do this to ensure that the invocation of\n    // `Engine.restart()` happens after the dialog has fully closed.  If we did not,\n    // then a race condition could occur, causing display shenanigans.\n    jQuery(Dialog.body()).find('#restart-ok').ariaClick({\n      one: true\n    }, function () {\n      jQuery(document).one(':dialogclosed', function () {\n        return Engine.restart();\n      });\n      Dialog.close();\n    });\n    return true;\n  }\n  function buildSaves() {\n    function createFileInput(id, callback) {\n      var input = document.createElement('input');\n      jQuery(input).attr({\n        id: id,\n        type: 'file',\n        tabindex: -1,\n        'aria-hidden': true\n      }).css({\n        display: 'block',\n        visibility: 'hidden',\n        position: 'fixed',\n        left: '-16128px',\n        // 8K UHD horizontal ×2.1\n        top: '-16128px',\n        // 8K UHD horizontal ×2.1\n        width: '1px',\n        height: '1px'\n      }).on('change', callback);\n      return input;\n    }\n    function createActionItem(id, classNames, text, label, callback) {\n      var $btn = jQuery(document.createElement('button')).attr('id', \"saves-\".concat(id)).text(text);\n      if (classNames) {\n        $btn.addClass(classNames);\n      }\n      if (callback) {\n        $btn.ariaClick({\n          label: label\n        }, callback);\n      } else {\n        $btn.ariaDisabled(true);\n      }\n      return jQuery(document.createElement('li')).append($btn);\n    }\n    function createSaveList() {\n      function createButton(id, classNames, kind, index, callback) {\n        var text;\n        switch (id) {\n          case 'delete':\n            text = L10n.get('textDelete');\n            break;\n          case 'load':\n            text = L10n.get('textLoad');\n            break;\n          case 'save':\n            text = L10n.get('textSave');\n            break;\n          default:\n            throw new Error(\"buildSaves unknown ID \\\"\".concat(id, \"\\\"\"));\n        }\n        var $btn = jQuery(document.createElement('button')).attr('id', \"saves-\".concat(id, \"-\").concat(index)).addClass(id);\n        if (classNames) {\n          $btn.addClass(classNames);\n        }\n        if (callback) {\n          $btn.ariaClick({\n            label: \"\".concat(text, \" \").concat(kind, \" \").concat(index + 1)\n          }, function () {\n            try {\n              callback(index);\n            } catch (ex) {\n              openAlert(\"\".concat(ex.message, \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n            }\n          });\n        } else {\n          $btn.ariaDisabled(true);\n        }\n        return $btn;\n      }\n      var $tbody = jQuery(document.createElement('tbody'));\n\n      // Create auto save UI entries.\n      Save.browser.auto.entries().forEach(function (_ref13) {\n        var index = _ref13.index,\n          info = _ref13.info;\n        /* legacy */\n        var $tdSlot = jQuery(document.createElement('td'));\n        /* /legacy */\n        var $tdLoad = jQuery(document.createElement('td'));\n        var $tdDesc = jQuery(document.createElement('td'));\n        var $tdDele = jQuery(document.createElement('td'));\n\n        // // Add the slot ID.\n        // $tdSlot\n        // \t.attr({\n        // \t\ttitle        : `${L10n.get('savesTextBrowserAuto')} ${index + 1}`,\n        // \t\t'aria-label' : `${L10n.get('savesTextBrowserAuto')} ${index + 1}`\n        // \t})\n        // \t.text(`A${index + 1}`);\n\n        // Add the description and details.\n        jQuery(document.createElement('div')).text(info.desc).appendTo($tdDesc);\n        jQuery(document.createElement('div')).addClass('details')\n        /* legacy */.addClass('datestamp')\n        /* /legacy */.text(\"\".concat(L10n.get('savesTextBrowserAuto'), \"\\xA0\").concat(index + 1, \"\\xA0\\xA0\\u2022\\xA0\\xA0\")).append(info.date ? \"\".concat(new Date(info.date).toLocaleString()) : \"<em>\".concat(L10n.get('savesTextNoDate'), \"</em>\")).appendTo($tdDesc);\n\n        // Add the load button.\n        $tdLoad.append(createButton('load', 'ui-close', L10n.get('savesTextBrowserAuto'), index, function (index) {\n          jQuery(document).one(':dialogclosed', function () {\n            Save.browser.auto.load(index).then(Engine.show, function (ex) {\n              return openAlert(\"\".concat(ex.message.toUpperFirst(), \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n            });\n          });\n        }));\n\n        // Add the delete button.\n        $tdDele.append(createButton('delete', null, L10n.get('savesTextBrowserAuto'), index, function (index) {\n          Save.browser.auto.delete(index);\n          buildSaves();\n        }));\n        jQuery(document.createElement('tr'))\n        /* legacy */.append($tdSlot)\n        /* /legacy */.append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody);\n      });\n      var slotAllowed = typeof Config.saves.isAllowed !== 'function' || Config.saves.isAllowed(Save.Type.Slot);\n\n      // Create slot save UI entries.\n      //\n      // NOTE: The array may be sparse.\n      Save.browser.slot.entries().reduce(\n      // Add slot entries.\n      function (slots, entry) {\n        slots[entry.index] = entry; // eslint-disable-line no-param-reassign\n        return slots;\n      },\n      // Fill configured slots with empty entries.\n      Array.from({\n        length: Config.saves.maxSlotSaves\n      }, function (_, i) {\n        return {\n          index: i\n        };\n      })).forEach(function (_ref14) {\n        var index = _ref14.index,\n          info = _ref14.info;\n        /* legacy */\n        var $tdSlot = jQuery(document.createElement('td'));\n        /* /legacy */\n        var $tdLoad = jQuery(document.createElement('td'));\n        var $tdDesc = jQuery(document.createElement('td'));\n        var $tdDele = jQuery(document.createElement('td'));\n\n        // // Add the slot ID.\n        // $tdSlot\n        // \t.attr({\n        // \t\ttitle        : `${L10n.get('savesTextBrowserSlot')} ${index + 1}`,\n        // \t\t'aria-label' : `${L10n.get('savesTextBrowserSlot')} ${index + 1}`\n        // \t})\n        // \t.text(index + 1);\n\n        if (info) {\n          // Add the description and details.\n          jQuery(document.createElement('div')).text(info.desc).appendTo($tdDesc);\n          jQuery(document.createElement('div')).addClass('details')\n          /* legacy */.addClass('datestamp')\n          /* /legacy */.text(\"\".concat(L10n.get('savesTextBrowserSlot'), \"\\xA0\").concat(index + 1, \"\\xA0\\xA0\\u2022\\xA0\\xA0\")).append(info.date ? \"\".concat(new Date(info.date).toLocaleString()) : \"<em>\".concat(L10n.get('savesTextNoDate'), \"</em>\")).appendTo($tdDesc);\n\n          // Add the load button.\n          $tdLoad.append(createButton('load', 'ui-close', L10n.get('savesTextBrowserSlot'), index, function (index) {\n            jQuery(document).one(':dialogclosed', function () {\n              Save.browser.slot.load(index).then(Engine.show, function (ex) {\n                return openAlert(\"\".concat(ex.message.toUpperFirst(), \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n              });\n            });\n          }));\n\n          // Add the delete button.\n          $tdDele.append(createButton('delete', null, L10n.get('savesTextBrowserSlot'), index, function (index) {\n            Save.browser.slot.delete(index);\n            buildSaves();\n          }));\n        } else {\n          // Add the, mostly empty, description and details.\n          //\n          // QUESTION: Should `$tdDesc` also get `aria-hidden=\"true\"`?  The\n          // `empty` class has `speak: none`, but that may be insufficient.\n          $tdDesc.addClass('empty');\n          jQuery(document.createElement('div')).text(\"\\xA0\").appendTo($tdDesc);\n          jQuery(document.createElement('div')).addClass('details')\n          /* legacy */.addClass('datestamp')\n          /* /legacy */.text(\"\".concat(L10n.get('savesTextBrowserSlot'), \"\\xA0\").concat(index + 1)).appendTo($tdDesc);\n\n          // Add the save button, possibly disabled.\n          $tdLoad.append(createButton('save', null, L10n.get('savesTextBrowserSlot'), index, index < Config.saves.maxSlotSaves && slotAllowed ? function (index) {\n            Save.browser.slot.save(index);\n            buildSaves();\n          } : null));\n\n          // Add the disabled delete button.\n          $tdDele.append(createButton('delete', null, L10n.get('savesTextBrowserSlot'), index));\n        }\n        jQuery(document.createElement('tr'))\n        /* legacy */.append($tdSlot)\n        /* /legacy */.append($tdLoad).append($tdDesc).append($tdDele).appendTo($tbody);\n      });\n      return jQuery(document.createElement('table')).attr('id', 'saves-list').append($tbody);\n    }\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildSaves()]');\n    }\n    var browserEnabled = Save.browser.isEnabled();\n\n    // Bail out if both saves and the file API are disabled/missing.\n    if (!browserEnabled && !Has.fileAPI) {\n      openAlert(L10n.get('warningNoSaves'));\n      return false;\n    }\n    Dialog.create(L10n.get('savesTitle'), 'saves');\n    var $dialogBody = jQuery(Dialog.body());\n\n    // Add slots header, list, and button list.\n    if (browserEnabled) {\n      jQuery(document.createElement('h2')).text(L10n.get('savesHeaderBrowser')).appendTo($dialogBody);\n      $dialogBody.append(createSaveList());\n      var $slotButtons = jQuery(document.createElement('ul')).addClass('buttons slots').appendTo($dialogBody);\n      if (Has.fileAPI) {\n        // Add the disk export/import buttons and the hidden `input[type=file]`\n        // element that will be triggered by the `#saves-import` button.\n        var slotImportInput = createFileInput('saves-import-handler', function (ev) {\n          Save.disk.import(ev).then(buildSaves, function (ex) {\n            return openAlert(\"\".concat(ex.message.toUpperFirst(), \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n          });\n        });\n        $slotButtons.append(createActionItem('export', null, \"\".concat(L10n.get('textExport'), \"\\u2026\"), L10n.get('savesLabelBrowserExport'), function () {\n          return Save.disk.export(\"saves-export-\".concat(Story.name));\n        })).append(createActionItem('import', null, \"\".concat(L10n.get('textImport'), \"\\u2026\"), L10n.get('savesLabelBrowserImport'), function () {\n          return slotImportInput.click();\n        }));\n        jQuery(slotImportInput).appendTo($dialogBody);\n      }\n\n      // Add the slots clear button.\n      $slotButtons.append(createActionItem('clear', null, L10n.get('textClear'), L10n.get('savesLabelBrowserClear'), Save.browser.size > 0 ? function () {\n        Save.browser.clear();\n        buildSaves();\n      } : null));\n    }\n\n    // Add the disk load and save buttons.\n    if (Has.fileAPI) {\n      jQuery(document.createElement('h2')).text(L10n.get('savesHeaderDisk')).appendTo($dialogBody);\n      var $diskButtons = jQuery(document.createElement('ul')).addClass('buttons').appendTo($dialogBody);\n\n      // Add the disk save/load buttons and the hidden `input[type=file]`\n      // element that will be triggered by the `#saves-disk-load` button.\n      var diskLoadInput = createFileInput('saves-disk-load-handler', function (ev) {\n        jQuery(document).one(':dialogclosed', function () {\n          Save.disk.load(ev).then(Engine.show, function (ex) {\n            return openAlert(\"\".concat(ex.message.toUpperFirst(), \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n          });\n        });\n        Dialog.close();\n      });\n      $diskButtons.append(createActionItem('disk-save', null, \"\".concat(L10n.get('textSave'), \"\\u2026\"), L10n.get('savesLabelDiskSave'), typeof Config.saves.isAllowed !== 'function' || Config.saves.isAllowed(Save.Type.Disk) ? function () {\n        return Save.disk.save(Story.name);\n      } : null)).append(createActionItem('disk-load', null, \"\".concat(L10n.get('textLoad'), \"\\u2026\"), L10n.get('savesLabelDiskLoad'), function () {\n        return diskLoadInput.click();\n      }));\n      jQuery(diskLoadInput).appendTo($dialogBody);\n    }\n    return true;\n  }\n  function buildSettings() {\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildSettings()]');\n    }\n    Dialog.create(L10n.get('settingsTitle'), 'settings');\n    var $dialogBody = jQuery(Dialog.body());\n    Setting.forEach(function (control) {\n      switch (control.type) {\n        case Setting.Types.Header:\n          {\n            var _name2 = control.name;\n            var _id2 = createSlug(_name2);\n            var $header = jQuery(document.createElement('div'));\n            var $heading = jQuery(document.createElement('h2'));\n            $header.attr('id', \"header-body-\".concat(_id2)).append($heading).appendTo($dialogBody);\n            $heading.attr('id', \"header-heading-\".concat(_id2)).wikiWithOptions({\n              cleanup: false\n            }, _name2);\n\n            // Set up the description, if any.\n            if (control.desc) {\n              jQuery(document.createElement('p')).attr('id', \"header-desc-\".concat(_id2)).wikiWithOptions({\n                cleanup: false\n              }, control.desc).appendTo($header);\n            }\n            return;\n          }\n        case Setting.Types.Value:\n          {\n            // no-op\n            return;\n          }\n      }\n      var name = control.name;\n      var id = createSlug(name);\n      var $setting = jQuery(document.createElement('div'));\n      var $label = jQuery(document.createElement('label'));\n      var $controlBox = jQuery(document.createElement('div'));\n      var $control;\n\n      // Set up the label+control wrapper.\n      jQuery(document.createElement('div')).append($label).append($controlBox).appendTo($setting);\n\n      // Set up the description, if any.\n      if (control.desc) {\n        jQuery(document.createElement('p')).attr('id', \"setting-desc-\".concat(id)).wikiWithOptions({\n          cleanup: false\n        }, control.desc).appendTo($setting);\n      }\n\n      // Set up the label.\n      $label.attr({\n        id: \"setting-label-\".concat(id),\n        for: \"setting-control-\".concat(id) // must be in sync with $control's ID (see below)\n      }).wikiWithOptions({\n        cleanup: false\n      }, control.label);\n\n      // Set up the control.\n      if (Setting.getValue(name) == null) {\n        // lazy equality for null\n        Setting.setValue(name, control.default);\n      }\n      switch (control.type) {\n        case Setting.Types.List:\n          {\n            $control = jQuery(document.createElement('select'));\n            for (var i = 0, iend = control.list.length; i < iend; ++i) {\n              jQuery(document.createElement('option')).val(i).text(control.list[i]).appendTo($control);\n            }\n            $control.val(control.list.indexOf(Setting.getValue(name))).attr('tabindex', 0).on('change', function () {\n              Setting.setValue(name, control.list[Number(this.value)]);\n            });\n            break;\n          }\n        case Setting.Types.Range:\n          {\n            $control = jQuery(document.createElement('input'));\n\n            // NOTE: Setting the value with `<jQuery>.val()` can cause odd behavior\n            // in Edge if it's called before the type is set, so we use the `value`\n            // content attribute here to dodge the entire issue.\n            $control.attr({\n              type: 'range',\n              min: control.min,\n              max: control.max,\n              step: control.step,\n              value: Setting.getValue(name),\n              tabindex: 0\n            }).on('change input', function () {\n              Setting.setValue(name, Number(this.value));\n            }).on('keypress', function (ev) {\n              if (ev.which === 13) {\n                ev.preventDefault();\n                triggerEvent('change', $control);\n              }\n            });\n            break;\n          }\n        case Setting.Types.Toggle:\n          {\n            $control = jQuery(document.createElement('button'));\n            if (Setting.getValue(name)) {\n              $control.addClass('enabled').text(L10n.get('textOn'));\n            } else {\n              $control.text(L10n.get('textOff'));\n            }\n            $control.ariaClick(function () {\n              var status = Setting.getValue(name);\n              if (status) {\n                jQuery(this).removeClass('enabled').text(L10n.get('textOff'));\n              } else {\n                jQuery(this).addClass('enabled').text(L10n.get('textOn'));\n              }\n              Setting.setValue(name, !status);\n            });\n            break;\n          }\n      }\n      $control.attr('id', \"setting-control-\".concat(id)).appendTo($controlBox);\n      $setting.attr('id', \"setting-body-\".concat(id)).appendTo($dialogBody);\n    });\n\n    // Add the button bar.\n    $dialogBody.append('<ul class=\"buttons\">' + \"<li><button id=\\\"settings-ok\\\" class=\\\"ui-close\\\">\".concat(L10n.get(['settingsTextOk', 'textOk']), \"</button></li>\") + \"<li><button id=\\\"settings-reset\\\">\".concat(L10n.get('settingsTextReset'), \"</button></li>\") + '</ul>').find('#settings-reset')\n    /*\n    \tInstead of adding '.ui-close' to '#settings-reset' (to receive the use of the default\n    \tdelegated dialog close handler), we set up a special case close handler here.  We\n    \tdo this to ensure that the invocation of `window.location.reload()` happens after the\n    \tdialog has fully closed.  If we did not, then a race condition could occur, causing\n    \tdisplay shenanigans.\n    */.ariaClick({\n      one: true\n    }, function () {\n      jQuery(document).one(':dialogclosed', function () {\n        Setting.reset();\n        window.location.reload();\n      });\n      Dialog.close();\n    });\n    return true;\n  }\n  function update() {\n    triggerEvent(':uiupdate');\n  }\n\n  /*******************************************************************************\n  \tBuilt-in Dialog Functions.\n  *******************************************************************************/\n\n  function openAlert(message) {\n    var _Dialog$create$append;\n    for (var _len24 = arguments.length, args = new Array(_len24 > 1 ? _len24 - 1 : 0), _key24 = 1; _key24 < _len24; _key24++) {\n      args[_key24 - 1] = arguments[_key24];\n    }\n    (_Dialog$create$append = Dialog.create(L10n.get('alertTitle'), 'alert').append(\"<p>\".concat(message, \"</p><ul class=\\\"buttons\\\">\") + \"<li><button id=\\\"alert-ok\\\" class=\\\"ui-close\\\">\".concat(L10n.get(['alertTextOk', 'textOk']), \"</button></li>\") + '</ul>')).open.apply(_Dialog$create$append, args);\n  }\n  function openRestart() {\n    buildRestart();\n    Dialog.open.apply(Dialog, arguments);\n  }\n  function openSaves() {\n    buildSaves();\n    Dialog.open.apply(Dialog, arguments);\n  }\n  function openSettings() {\n    buildSettings();\n    Dialog.open.apply(Dialog, arguments);\n  }\n\n  /*******************************************************************************\n  \tDeprecated Functions.\n  *******************************************************************************/\n\n  // [DEPRECATED]\n  function buildAutoload() {\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildAutoload()]');\n    }\n    console.warn('[DEPRECATED] UI.buildAutoload() is deprecated.');\n    Dialog.create(L10n.get('autoloadTitle'), 'autoload').append( /* eslint-disable max-len */\n    \"<p>\".concat(L10n.get('autoloadMesgPrompt'), \"</p><ul class=\\\"buttons\\\">\") + \"<li><button id=\\\"autoload-ok\\\" class=\\\"ui-close\\\">\".concat(L10n.get(['autoloadTextOk', 'textOk']), \"</button></li>\") + \"<li><button id=\\\"autoload-cancel\\\" class=\\\"ui-close\\\">\".concat(L10n.get(['autoloadTextCancel', 'textCancel']), \"</button></li>\") + '</ul>'\n    /* eslint-enable max-len */);\n\n    // Add an additional delegated click handler for the `.ui-close` elements to handle autoloading.\n    jQuery(document).one('click.autoload', '.ui-close', function (ev) {\n      var isAutoloadOk = ev.target.id === 'autoload-ok';\n      jQuery(document).one(':dialogclosed', function () {\n        new Promise(function (resolve, reject) {\n          if (isAutoloadOk) {\n            resolve();\n          }\n          reject(); // eslint-disable-line prefer-promise-reject-errors\n        }).then(function () {\n          if (BUILD_DEBUG) {\n            console.log('\\tattempting autoload of browser continue');\n          }\n          return Save.browser.continue();\n        }).catch(function () {\n          if (BUILD_DEBUG) {\n            console.log(\"\\tstarting passage: \\\"\".concat(Config.passages.start, \"\\\"\"));\n          }\n          Engine.play(Config.passages.start);\n        });\n      });\n    });\n    return true;\n  }\n\n  // [DEPRECATED]\n  function buildJumpto() {\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildJumpto()]');\n    }\n    console.warn('[DEPRECATED] UI.buildJumpto() is deprecated.');\n    var list = document.createElement('ul');\n    Dialog.create(L10n.get('jumptoTitle'), 'jumpto list').append(list);\n    var expired = State.expired.length;\n    for (var i = State.size - 1; i >= 0; --i) {\n      if (i === State.activeIndex) {\n        continue;\n      }\n      var passage = Story.get(State.history[i].title);\n      if (passage && passage.tags.includes('bookmark')) {\n        jQuery(document.createElement('li')).append(jQuery(document.createElement('a')).ariaClick({\n          one: true\n        }, function (index) {\n          return function () {\n            return jQuery(document).one(':dialogclosed', function () {\n              return Engine.goTo(index);\n            });\n          };\n        }(i)).addClass('ui-close').text(\"\".concat(L10n.get('textTurn'), \" \").concat(expired + i + 1))).appendTo(list);\n      }\n    }\n    if (!list.hasChildNodes()) {\n      jQuery(list).append(\"<li><a><em>\".concat(L10n.get('jumptoMesgUnavailable'), \"</em></a></li>\"));\n    }\n  }\n\n  // [DEPRECATED]\n  function buildShare() {\n    if (BUILD_DEBUG) {\n      console.log('[UI/buildShare()]');\n    }\n    console.warn('[DEPRECATED] UI.buildShare() is deprecated.');\n    try {\n      Dialog.create(L10n.get('shareTitle'), 'share list').append(assembleLinkList('StoryShare'));\n    } catch (ex) {\n      console.error(ex);\n      Alert.error('StoryShare', ex.message);\n      return false;\n    }\n    return true;\n  }\n\n  // [DEPRECATED]\n  function openJumpto() {\n    buildJumpto();\n    Dialog.open.apply(Dialog, arguments);\n  }\n\n  // [DEPRECATED]\n  function openShare() {\n    buildShare();\n    Dialog.open.apply(Dialog, arguments);\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Utility Functions.\n    assembleLinkList: {\n      value: assembleLinkList\n    },\n    buildRestart: {\n      value: buildRestart\n    },\n    buildSaves: {\n      value: buildSaves\n    },\n    buildSettings: {\n      value: buildSettings\n    },\n    update: {\n      value: update\n    },\n    // Built-in Dialog Functions.\n    alert: {\n      value: openAlert\n    },\n    restart: {\n      value: openRestart\n    },\n    saves: {\n      value: openSaves\n    },\n    settings: {\n      value: openSettings\n    },\n    // Deprecated Functions.\n    buildAutoload: {\n      value: buildAutoload\n    },\n    buildJumpto: {\n      value: buildJumpto\n    },\n    buildShare: {\n      value: buildShare\n    },\n    jumpto: {\n      value: openJumpto\n    },\n    share: {\n      value: openShare\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tuibar.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Alert, Config, Dialog, Engine, L10n, Save, Setting, State, Story, UI, Wikifier, setDisplayTitle\n*/\n\nvar UIBar = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // jQuery-wrapped UI bar element.\n  var _$uiBar = null;\n\n  // jQuery event namespace.\n  var EVENT_NS = '.ui-bar';\n\n  /*******************************************************************************\n  \tInitialization Functions.\n  *******************************************************************************/\n\n  function init() {\n    if (BUILD_DEBUG) {\n      console.log('[UIBar/init()]');\n    }\n\n    // UI bar already exists, so bail out.\n    if (document.getElementById('ui-bar')) {\n      return;\n    }\n\n    // Generate the UI bar elements.\n    var $elems = function () {\n      var toggleLabel = L10n.get('uiBarLabelToggle');\n      var backwardLabel = L10n.get('uiBarLabelBackward');\n      var jumptoLabel = L10n.get('uiBarLabelJumpto');\n      var forwardLabel = L10n.get('uiBarLabelForward');\n      return jQuery(document.createDocumentFragment()).append( /* eslint-disable max-len */\n      '<div id=\"ui-bar\" aria-live=\"polite\">' + '<div id=\"ui-bar-tray\">' + \"<button id=\\\"ui-bar-toggle\\\" tabindex=\\\"0\\\" title=\\\"\".concat(toggleLabel, \"\\\" aria-label=\\\"\").concat(toggleLabel, \"\\\"></button>\") + '<div id=\"ui-bar-history\">' + \"<button id=\\\"history-backward\\\" tabindex=\\\"0\\\" title=\\\"\".concat(backwardLabel, \"\\\" aria-label=\\\"\").concat(backwardLabel, \"\\\"></button>\") + \"<button id=\\\"history-jumpto\\\" tabindex=\\\"0\\\" title=\\\"\".concat(jumptoLabel, \"\\\" aria-label=\\\"\").concat(jumptoLabel, \"\\\"></button>\") + \"<button id=\\\"history-forward\\\" tabindex=\\\"0\\\" title=\\\"\".concat(forwardLabel, \"\\\" aria-label=\\\"\").concat(forwardLabel, \"\\\"></button>\") + '</div>' + '</div>' + '<div id=\"ui-bar-body\">' + '<header id=\"title\" role=\"banner\">' + '<div id=\"story-banner\"></div>' + '<h1 id=\"story-title\"></h1>' + '<div id=\"story-subtitle\"></div>' + '<div id=\"story-title-separator\"></div>' + '<p id=\"story-author\"></p>' + '</header>' + '<div id=\"story-caption\"></div>' + '<nav id=\"menu\" role=\"navigation\">' + '<ul id=\"menu-story\"></ul>' + '<ul id=\"menu-core\">' + \"<li id=\\\"menu-item-continue\\\"><a tabindex=\\\"0\\\">\".concat(L10n.get('continueTitle'), \"</a></li>\") + \"<li id=\\\"menu-item-saves\\\"><a tabindex=\\\"0\\\">\".concat(L10n.get('savesTitle'), \"</a></li>\") + \"<li id=\\\"menu-item-settings\\\"><a tabindex=\\\"0\\\">\".concat(L10n.get('settingsTitle'), \"</a></li>\") + \"<li id=\\\"menu-item-restart\\\"><a tabindex=\\\"0\\\">\".concat(L10n.get('restartTitle'), \"</a></li>\") + \"<li id=\\\"menu-item-share\\\"><a tabindex=\\\"0\\\">\".concat(L10n.get('shareTitle'), \"</a></li>\") + '</ul>' + '</nav>' + '</div>' + '</div>'\n      /* eslint-enable max-len */);\n    }();\n\n    /*\n    \tCache the UI bar element, since its going to be used often.\n    \t\tNOTE: We rewrap the element itself, rather than simply using the result\n    \tof `find()`, so that we cache an uncluttered jQuery-wrapper—i.e., `context`\n    \trefers to the element and there is no `prevObject`.\n    */\n    _$uiBar = jQuery($elems.find('#ui-bar').get(0));\n\n    // Insert the UI bar elements into the page before the main script.\n    $elems.insertBefore('body>script#script-sugarcube');\n\n    // Set up the UI bar's global event handlers.\n    jQuery(document)\n    // Set up a handler for the history-backward/-forward buttons.\n    .on(\":historyupdate\".concat(EVENT_NS), function ($backward, $forward) {\n      return function () {\n        $backward.ariaDisabled(State.length < 2);\n        $forward.ariaDisabled(State.length === State.size);\n      };\n    }(jQuery('#history-backward'), jQuery('#history-forward')));\n  }\n\n  /*******************************************************************************\n  \tCore Functions.\n  *******************************************************************************/\n\n  function destroy() {\n    if (BUILD_DEBUG) {\n      console.log('[UIBar/destroy()]');\n    }\n    if (!_$uiBar) {\n      return;\n    }\n\n    // Hide the UI bar.\n    _$uiBar.hide();\n\n    // Remove its namespaced events.\n    jQuery(document).off(EVENT_NS);\n\n    // Remove its styles.\n    jQuery(document.head).find('#style-ui-bar').remove();\n\n    // Remove it from the DOM.\n    _$uiBar.remove();\n\n    // Drop the reference to the element.\n    _$uiBar = null;\n  }\n  function hide() {\n    if (_$uiBar) {\n      _$uiBar.hide();\n    }\n    return UIBar;\n  }\n  function isHidden() {\n    return _$uiBar && _$uiBar.css('display') === 'none';\n  }\n  function isStowed() {\n    return _$uiBar && _$uiBar.hasClass('stowed');\n  }\n  function show() {\n    if (_$uiBar) {\n      _$uiBar.show();\n    }\n    return UIBar;\n  }\n  function start() {\n    if (BUILD_DEBUG) {\n      console.log('[UIBar/start()]');\n    }\n    if (!_$uiBar) {\n      return;\n    }\n\n    // Set up the #ui-bar's initial state.\n    if (typeof Config.ui.stowBarInitially === 'boolean' ? Config.ui.stowBarInitially : jQuery(window).width() <= Config.ui.stowBarInitially) {\n      stow(true);\n    }\n\n    // Set up the #ui-bar-toggle and #ui-bar-history widgets.\n    jQuery('#ui-bar-toggle').ariaClick({\n      label: L10n.get('uiBarLabelToggle')\n    }, function () {\n      return _$uiBar.toggleClass('stowed');\n    });\n    if (Config.history.controls) {\n      jQuery('#history-backward').ariaDisabled(State.length < 2).ariaClick({\n        label: L10n.get('uiBarLabelBackward')\n      }, function () {\n        return Engine.backward();\n      });\n\n      /* [DEPRECATED] */\n      if (Story.filter(function (passage) {\n        return passage.tags.includes('bookmark');\n      }).length > 0) {\n        jQuery('#history-jumpto').ariaClick({\n          label: L10n.get('uiBarLabelJumpto')\n        }, function () {\n          return UI.jumpto();\n        });\n      } else {\n        jQuery('#history-jumpto').remove();\n      }\n      /* /[DEPRECATED] */\n\n      jQuery('#history-forward').ariaDisabled(State.length === State.size).ariaClick({\n        label: L10n.get('uiBarLabelForward')\n      }, function () {\n        return Engine.forward();\n      });\n    } else {\n      jQuery('#ui-bar-history').remove();\n    }\n\n    // Create a few `:uiupdate` event helpers.\n    var addUiUpdateHandler = function addUiUpdateHandler(handler) {\n      return jQuery(document)[Config.ui.updateStoryElements ? 'on' : 'one'](\":uiupdate\".concat(EVENT_NS), handler);\n    };\n    var addUpdaterOrRemove = function addUpdaterOrRemove(selector, passageName) {\n      var $el = jQuery(selector);\n      if (Story.has(passageName)) {\n        addUiUpdateHandler(function () {\n          var frag = document.createDocumentFragment();\n          new Wikifier(frag, Story.get(passageName).processText().trim());\n          $el.empty().append(frag);\n        });\n      } else {\n        $el.remove();\n      }\n    };\n\n    // Set up the story display title.\n    {\n      var storyTitleHandler;\n      if (Story.has('StoryDisplayTitle')) {\n        storyTitleHandler = function storyTitleHandler() {\n          return setDisplayTitle(Story.get('StoryDisplayTitle').processText());\n        };\n      } else {\n        // For Twine 1.\n        if (BUILD_TWINE1) {\n          // for Twine 1\n          storyTitleHandler = function storyTitleHandler() {\n            return setDisplayTitle(Story.get('StoryTitle').processText());\n          };\n        }\n\n        // For Twine 2.\n        else {\n          storyTitleHandler = function storyTitleHandler() {\n            return setDisplayTitle(Story.name, true);\n          };\n        }\n      }\n      addUiUpdateHandler(storyTitleHandler);\n    }\n\n    // Set up our dynamic elements.\n    addUpdaterOrRemove('#story-banner', 'StoryBanner');\n    addUpdaterOrRemove('#story-subtitle', 'StorySubtitle');\n    addUpdaterOrRemove('#story-author', 'StoryAuthor');\n    addUpdaterOrRemove('#story-caption', 'StoryCaption');\n    if (Story.has('StoryMenu')) {\n      var $menuStory = jQuery('#menu-story');\n      jQuery(document).on(\":uiupdate\".concat(EVENT_NS), function () {\n        try {\n          var frag = UI.assembleLinkList('StoryMenu', document.createDocumentFragment());\n          $menuStory.empty().append(frag);\n        } catch (ex) {\n          console.error(ex);\n          Alert.error('StoryMenu', ex.message);\n        }\n      });\n    } else {\n      jQuery('#menu-story').remove();\n    }\n\n    // Set up the Continue menu item.\n    if (Save.browser.size > 0) {\n      jQuery('#menu-item-continue a').ariaClick({\n        role: 'button'\n      }, function (ev) {\n        ev.preventDefault();\n        Save.browser.continue().then(function () {\n          jQuery(document).off('.menu-item-continue');\n          jQuery('#menu-item-continue').remove();\n          Engine.show();\n        }, function (ex) {\n          return UI.alert(\"\".concat(ex.message.toUpperFirst(), \".</p><p>\").concat(L10n.get('textAborting'), \".\"));\n        });\n      }).text(L10n.get('continueTitle'));\n      jQuery(document).on(':passagestart.menu-item-continue', function () {\n        if (State.turns > 1) {\n          jQuery(document).off('.menu-item-continue');\n          jQuery('#menu-item-continue').remove();\n        }\n      });\n    } else {\n      jQuery('#menu-item-continue').remove();\n    }\n\n    // Set up the Saves menu item.\n    jQuery('#menu-item-saves a').ariaClick({\n      role: 'button'\n    }, function (ev) {\n      ev.preventDefault();\n      UI.buildSaves();\n      Dialog.open();\n    }).text(L10n.get('savesTitle'));\n\n    // Set up the Settings menu item.\n    if (!Setting.isEmpty()) {\n      jQuery('#menu-item-settings a').ariaClick({\n        role: 'button'\n      }, function (ev) {\n        ev.preventDefault();\n        UI.buildSettings();\n        Dialog.open();\n      }).text(L10n.get('settingsTitle'));\n    } else {\n      jQuery('#menu-item-settings').remove();\n    }\n\n    // Set up the Restart menu item.\n    jQuery('#menu-item-restart a').ariaClick({\n      role: 'button'\n    }, function (ev) {\n      ev.preventDefault();\n      UI.buildRestart();\n      Dialog.open();\n    }).text(L10n.get('restartTitle'));\n\n    // Set up the Share menu item.\n    if (Story.has('StoryShare')) {\n      jQuery('#menu-item-share a').ariaClick({\n        role: 'button'\n      }, function (ev) {\n        ev.preventDefault();\n        UI.buildShare();\n        Dialog.open();\n      }).text(L10n.get('shareTitle'));\n    } else {\n      jQuery('#menu-item-share').remove();\n    }\n  }\n  function stow(noAnimation) {\n    if (_$uiBar && !_$uiBar.hasClass('stowed')) {\n      var $story;\n      if (noAnimation) {\n        $story = jQuery('#story');\n        $story.addClass('no-transition');\n        _$uiBar.addClass('no-transition');\n      }\n      _$uiBar.addClass('stowed');\n      if (noAnimation) {\n        setTimeout(function () {\n          $story.removeClass('no-transition');\n          _$uiBar.removeClass('no-transition');\n        }, Engine.DOM_DELAY);\n      }\n    }\n    return UIBar;\n  }\n  function unstow(noAnimation) {\n    if (_$uiBar && _$uiBar.hasClass('stowed')) {\n      var $story;\n      if (noAnimation) {\n        $story = jQuery('#story');\n        $story.addClass('no-transition');\n        _$uiBar.addClass('no-transition');\n      }\n      _$uiBar.removeClass('stowed');\n      if (noAnimation) {\n        setTimeout(function () {\n          $story.removeClass('no-transition');\n          _$uiBar.removeClass('no-transition');\n        }, Engine.DOM_DELAY);\n      }\n    }\n    return UIBar;\n  }\n\n  /*******************************************************************************\n  \tDeprecated Functions.\n  *******************************************************************************/\n\n  // [DEPRECATED]\n  function update() {\n    if (BUILD_DEBUG) {\n      console.log('[UIBar/update()]');\n    }\n    console.warn('[DEPRECATED] UIBar.update() is deprecated.');\n    if (!_$uiBar) {\n      return;\n    }\n    UI.update();\n    return UIBar;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Initialization Functions.\n    init: {\n      value: init\n    },\n    // Core Functions.\n    destroy: {\n      value: destroy\n    },\n    hide: {\n      value: hide\n    },\n    isHidden: {\n      value: isHidden\n    },\n    isStowed: {\n      value: isStowed\n    },\n    show: {\n      value: show\n    },\n    start: {\n      value: start\n    },\n    stow: {\n      value: stow\n    },\n    unstow: {\n      value: unstow\n    },\n    // Deprecated Functions.\n    setStoryElements: {\n      value: update\n    },\n    update: {\n      value: update\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tdebugbar.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Config, DebugView, Engine, L10n, Patterns, State, Story, getToStringTag, session, triggerEvent\n*/\n\nvar DebugBar = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // The debug state storage key.\n  var STORAGE_KEY = 'debug.state';\n\n  // Update intervals.\n  var WATCH_LIST_DELAY = 200; // in milliseconds\n  var VAR_LIST_DELAY = 500; // in milliseconds\n\n  var variableRE = new RegExp(\"^\".concat(Patterns.variable, \"$\"));\n  var numericKeyRE = /^\\d+$/;\n  var watchList = [];\n  var varList = [];\n  var watchTimerId = null;\n  var listTimerId = null;\n  var stowed = true;\n  var $debugBar = null;\n  var $watchBody = null;\n  var $varDataList = null;\n  var $turnSelect = null;\n  var $passageDataList = null;\n\n  /*******************************************************************************\n  \tDebug Bar Functions.\n  *******************************************************************************/\n\n  function debugBarInit() {\n    if (BUILD_DEBUG) {\n      console.log('[DebugBar/debugBarInit()]');\n    }\n    if (!Config.debug) {\n      // Remove its styles.\n      jQuery(document.head).find('[id|=\"style-ui-debug\"]').remove();\n      return;\n    }\n\n    // Generate the debug bar elements and append them to <body>.\n    var barToggleLabel = L10n.get('debugBarLabelToggle');\n    var watchAddLabel = L10n.get('debugBarLabelWatchAdd');\n    var watchAllLabel = L10n.get('debugBarLabelWatchAll');\n    var watchClearLabel = L10n.get('debugBarLabelWatchClear');\n    var watchToggleLabel = L10n.get('debugBarLabelWatchToggle');\n    var viewsToggleLabel = L10n.get('debugBarLabelViewsToggle');\n    var passagePlayLabel = L10n.get('debugBarLabelPassagePlay');\n    jQuery(document.createDocumentFragment()).append( /* eslint-disable max-len */\n    '<div id=\"debug-bar\">' + '<div id=\"debug-bar-watch\">' + \"<div>\\u2014\\xA0\".concat(L10n.get('debugBarMesgNoWatches'), \"\\xA0\\u2014</div>\") + '</div>' + '<div>' + \"<label id=\\\"debug-bar-watch-label\\\" for=\\\"debug-bar-watch-input\\\">\".concat(L10n.get('debugBarTextWatch'), \"</label>\") + \"<input id=\\\"debug-bar-watch-input\\\" name=\\\"debug-bar-watch-input\\\" type=\\\"text\\\" placeholder=\\\"\".concat(L10n.get('debugBarLabelWatchPlaceholder'), \"\\\" list=\\\"debug-bar-var-list\\\" tabindex=\\\"0\\\">\") + '<datalist id=\"debug-bar-var-list\" aria-hidden=\"true\" hidden=\"hidden\"></datalist>' + \"<button id=\\\"debug-bar-watch-add\\\" tabindex=\\\"0\\\" title=\\\"\".concat(watchAddLabel, \"\\\" aria-label=\\\"\").concat(watchAddLabel, \"\\\"></button>\") + \"<button id=\\\"debug-bar-watch-all\\\" tabindex=\\\"0\\\" title=\\\"\".concat(watchAllLabel, \"\\\" aria-label=\\\"\").concat(watchAllLabel, \"\\\"></button>\") + \"<button id=\\\"debug-bar-watch-clear\\\" tabindex=\\\"0\\\" title=\\\"\".concat(watchClearLabel, \"\\\" aria-label=\\\"\").concat(watchClearLabel, \"\\\"></button>\") + '</div>' + '<div>' + \"<label id=\\\"debug-bar-turn-label\\\" for=\\\"debug-bar-turn-select\\\">\".concat(L10n.get('textTurn'), \"</label>\") + '<select id=\"debug-bar-turn-select\" tabindex=\"0\"></select>' + '</div>' + '<div>' + \"<label id=\\\"debug-bar-passage-label\\\" for=\\\"debug-bar-passage-input\\\">\".concat(L10n.get('debugBarTextPassage'), \"</label>\") + \"<input id=\\\"debug-bar-passage-input\\\" name=\\\"debug-bar-passage-input\\\" type=\\\"text\\\" placeholder=\\\"\".concat(L10n.get('debugBarLabelPassagePlaceholder'), \"\\\" list=\\\"debug-bar-passage-list\\\" tabindex=\\\"0\\\">\") + '<datalist id=\"debug-bar-passage-list\" aria-hidden=\"true\" hidden=\"hidden\"></datalist>' + \"<button id=\\\"debug-bar-passage-play\\\" tabindex=\\\"0\\\" title=\\\"\".concat(passagePlayLabel, \"\\\" aria-label=\\\"\").concat(passagePlayLabel, \"\\\"></button>\") + '</div>' + '<div>' + \"<button id=\\\"debug-bar-views-toggle\\\" tabindex=\\\"0\\\" title=\\\"\".concat(viewsToggleLabel, \"\\\" aria-label=\\\"\").concat(viewsToggleLabel, \"\\\">\").concat(L10n.get('debugBarTextViews'), \"</button>\") + \"<button id=\\\"debug-bar-watch-toggle\\\" tabindex=\\\"0\\\" title=\\\"\".concat(watchToggleLabel, \"\\\" aria-label=\\\"\").concat(watchToggleLabel, \"\\\">\").concat(L10n.get('debugBarTextWatch'), \"</button>\") + '</div>' + \"<button id=\\\"debug-bar-toggle\\\" tabindex=\\\"0\\\" title=\\\"\".concat(barToggleLabel, \"\\\" aria-label=\\\"\").concat(barToggleLabel, \"\\\"></button>\") + '</div>' + '<div id=\"debug-bar-hint\"></div>'\n    /* eslint-enable max-len */).appendTo('body');\n\n    // Cache the debug bar elements, since they're going to be used often.\n    //\n    // NOTE: We rewrap the elements themselves, rather than simply using\n    // the results of `find()`, so that we cache uncluttered jQuery-wrappers\n    // (i.e. `context` refers to the elements and there is no `prevObject`).\n    $debugBar = jQuery('#debug-bar');\n    $watchBody = jQuery($debugBar.find('#debug-bar-watch').get(0));\n    $varDataList = jQuery($debugBar.find('#debug-bar-var-list').get(0));\n    $turnSelect = jQuery($debugBar.find('#debug-bar-turn-select').get(0));\n    $passageDataList = jQuery($debugBar.find('#debug-bar-passage-list').get(0));\n    var $watchInput = jQuery($debugBar.find('#debug-bar-watch-input').get(0));\n    var $watchAdd = jQuery($debugBar.find('#debug-bar-watch-add').get(0));\n    var $watchAll = jQuery($debugBar.find('#debug-bar-watch-all').get(0));\n    var $watchClear = jQuery($debugBar.find('#debug-bar-watch-clear').get(0));\n    var $passageInput = jQuery($debugBar.find('#debug-bar-passage-input').get(0));\n    var $passagePlay = jQuery($debugBar.find('#debug-bar-passage-play').get(0));\n    var $viewsToggle = jQuery($debugBar.find('#debug-bar-views-toggle').get(0));\n    var $watchToggle = jQuery($debugBar.find('#debug-bar-watch-toggle').get(0));\n    var $barToggle = jQuery($debugBar.find('#debug-bar-toggle').get(0));\n\n    // Set up the debug bar's local event handlers.\n    $watchInput.on('sc:debug-watch-add', function () {\n      debugBarWatchAdd(this.value.trim());\n      this.value = '';\n    }).on('keypress', function (ev) {\n      if (ev.which === 13) {\n        // 13 is Enter/Return\n        ev.preventDefault();\n        triggerEvent('sc:debug-watch-add', $watchInput);\n      }\n    });\n    $watchAdd.ariaClick(function () {\n      return triggerEvent('sc:debug-watch-add', $watchInput);\n    });\n    $watchAll.ariaClick(debugBarWatchAddAll);\n    $watchClear.ariaClick(debugBarWatchClear);\n    $turnSelect.on('change', function () {\n      Engine.goTo(Number(this.value));\n    });\n    $passageInput.on('sc:debug-passage-play', function () {\n      Engine.play(this.value.trim());\n      this.value = '';\n    }).on('keypress', function (ev) {\n      if (ev.which === 13) {\n        // 13 is Enter/Return\n        ev.preventDefault();\n        triggerEvent('sc:debug-passage-play', $passageInput);\n      }\n    }).on('focus', updatePassageList);\n    $passagePlay.ariaClick(function () {\n      return triggerEvent('sc:debug-passage-play', $passageInput);\n    });\n    $viewsToggle.ariaClick(function () {\n      DebugView.toggle();\n      updateSession();\n    });\n    $watchToggle.ariaClick(debugBarWatchToggle);\n    $barToggle.ariaClick(debugBarToggle);\n\n    // Set up the debug bar's global event handlers.\n    jQuery(document)\n    // Set up a handler for the variables watch.\n    .on(':passageend.debug-bar', function () {\n      updateWatchBody();\n      updateVarList();\n    })\n    // Set up a handler for the history select.\n    .on(':historyupdate.debug-bar', updateTurnSelect)\n    // Set up a handler for engine resets to clear the active debug session.\n    .on(':enginerestart.debug-bar', clearSession);\n  }\n  function debugBarStart() {\n    if (BUILD_DEBUG) {\n      console.log('[DebugBar/debugBarStart()]');\n    }\n    if (!Config.debug) {\n      return;\n    }\n\n    // Attempt to restore an existing session.\n    if (!restoreSession()) {\n      // If there's no active debug session, then initially stow the debug bar,\n      // enable debug views, and enable variable watching.\n      debugBarStow();\n      DebugView.enable();\n      enableWatchUpdates();\n      enableWatch();\n    }\n\n    // Update the UI.\n    updateVarList();\n    updateTurnSelect();\n    // updatePassageList();\n  }\n  function debugBarIsStowed() {\n    return stowed;\n  }\n  function debugBarStow() {\n    disableWatchUpdates();\n    disableVarListUpdates();\n    stowDebugBar();\n    stowed = true;\n    updateSession();\n  }\n  function debugBarUnstow() {\n    if (debugBarWatchIsEnabled()) {\n      enableWatchUpdates();\n    }\n    enableVarListUpdates();\n    unstowDebugBar();\n    stowed = false;\n    updateSession();\n  }\n  function debugBarToggle() {\n    if (stowed) {\n      debugBarUnstow();\n    } else {\n      debugBarStow();\n    }\n  }\n  function debugBarWatchAdd(varName) {\n    if (!variableRE.test(varName)) {\n      return;\n    }\n    watchList.pushUnique(varName);\n    watchList.sort();\n    updateWatchBody();\n    updateVarList();\n    updateSession();\n  }\n  function debugBarWatchAddAll() {\n    Object.keys(State.variables).map(function (name) {\n      return watchList.pushUnique(\"$\".concat(name));\n    });\n    Object.keys(State.temporary).map(function (name) {\n      return watchList.pushUnique(\"_\".concat(name));\n    });\n    watchList.sort();\n    updateWatchBody();\n    updateVarList();\n    updateSession();\n  }\n  function debugBarWatchClear() {\n    watchList.length = 0;\n    $watchBody.empty().append(\"<div>\\u2014\\xA0\".concat(L10n.get('debugBarMesgNoWatches'), \"\\xA0\\u2014</div>\"));\n    updateWatchBody();\n    updateVarList();\n    updateSession();\n  }\n  function debugBarWatchDelete(varName) {\n    watchList.deleteFirst(varName);\n    $watchBody.find(\"tr[data-name=\\\"\".concat(varName, \"\\\"]\")).remove();\n    updateWatchBody();\n    updateVarList();\n    updateSession();\n  }\n  function debugBarWatchDisable() {\n    disableWatchUpdates();\n    disableWatch();\n    updateSession();\n  }\n  function debugBarWatchEnable() {\n    enableWatchUpdates();\n    enableWatch();\n    updateSession();\n  }\n  function debugBarWatchIsEnabled() {\n    return !$watchBody.attr('hidden');\n  }\n  function debugBarWatchToggle() {\n    if ($watchBody.attr('hidden')) {\n      debugBarWatchEnable();\n    } else {\n      debugBarWatchDisable();\n    }\n  }\n\n  /*******************************************************************************\n  \tUtility Functions.\n  *******************************************************************************/\n\n  function stowDebugBar() {\n    $debugBar.css('right', \"-\".concat($debugBar.outerWidth(), \"px\"));\n  }\n  function unstowDebugBar() {\n    $debugBar.css('right', 0);\n  }\n  function disableWatch() {\n    $watchBody.attr({\n      'aria-hidden': true,\n      hidden: 'hidden'\n    });\n    // DebugFlags.remove('watch');\n  }\n  function disableWatchUpdates() {\n    if (watchTimerId !== null) {\n      clearInterval(watchTimerId);\n      watchTimerId = null;\n    }\n  }\n  function enableWatch() {\n    // DebugFlags.add('watch');\n    $watchBody.removeAttr('aria-hidden hidden');\n  }\n  function enableWatchUpdates() {\n    if (watchTimerId === null) {\n      watchTimerId = setInterval(function () {\n        return updateWatchBody();\n      }, WATCH_LIST_DELAY);\n    }\n  }\n  function disableVarListUpdates() {\n    if (listTimerId !== null) {\n      clearInterval(listTimerId);\n      listTimerId = null;\n    }\n  }\n  function enableVarListUpdates() {\n    if (listTimerId === null) {\n      listTimerId = setInterval(function () {\n        return updateVarList();\n      }, VAR_LIST_DELAY);\n    }\n  }\n  function clearSession() {\n    session.delete(STORAGE_KEY);\n  }\n  function hasSession() {\n    return session.has(STORAGE_KEY);\n  }\n  function restoreSession() {\n    if (!hasSession()) {\n      return false;\n    }\n    var debugState = session.get(STORAGE_KEY);\n    watchList.push.apply(watchList, _toConsumableArray(debugState.watchList));\n    if (debugState.watchEnabled) {\n      if (stowed) {\n        disableWatchUpdates();\n      } else {\n        enableWatchUpdates();\n      }\n      enableWatch();\n    } else {\n      disableWatchUpdates();\n      disableWatch();\n    }\n    if (debugState.viewsEnabled) {\n      DebugView.enable();\n    } else {\n      DebugView.disable();\n    }\n    stowed = debugState.stowed;\n    if (stowed) {\n      disableVarListUpdates();\n      debugBarStow();\n    } else {\n      enableVarListUpdates();\n      debugBarUnstow();\n    }\n    return true;\n  }\n  function updateSession() {\n    session.set(STORAGE_KEY, {\n      stowed: stowed,\n      watchList: watchList,\n      watchEnabled: debugBarWatchIsEnabled(),\n      viewsEnabled: DebugView.isEnabled()\n    });\n  }\n  function updateWatchBody() {\n    if (watchList.length === 0) {\n      return;\n    }\n    var $rowMap = new Map();\n    var $table = jQuery($watchBody.children('table'));\n    var $tbody;\n\n    // If there's an existing watches table, cache its elements.\n    if ($table.length > 0) {\n      $tbody = jQuery($table.children('tbody'));\n      $tbody.children('tr').each(function (_, el) {\n        return $rowMap.set(el.getAttribute('data-name'), jQuery(el));\n      });\n    }\n    // Elsewise, create a new watches table.\n    else {\n      $table = jQuery(document.createElement('table'));\n      $tbody = jQuery(document.createElement('tbody'));\n      $table.append($tbody);\n      $watchBody.empty().append($table);\n    }\n\n    // Set up a function to add new watch rows.\n    var delLabel = L10n.get('debugBarLabelWatchDelete');\n    var createRow = function createRow(varName, value) {\n      var $row = jQuery(document.createElement('tr'));\n      var $delBtn = jQuery(document.createElement('button'));\n      var $code = jQuery(document.createElement('code'));\n      $row.attr('data-name', varName);\n      $delBtn.addClass('watch-delete').ariaClick({\n        one: true,\n        label: delLabel\n      }, function () {\n        return debugBarWatchDelete(varName);\n      });\n      $code.text(value);\n      jQuery(document.createElement('td')).append($delBtn).appendTo($row);\n      jQuery(document.createElement('td')).text(varName).appendTo($row);\n      jQuery(document.createElement('td')).append($code).appendTo($row);\n      return $row;\n    };\n    var cursor = $rowMap.size > 0 ? $tbody.children('tr').get(0) : null;\n    watchList.forEach(function (varName) {\n      var varKey = varName.slice(1);\n      var store = varName[0] === '$' ? State.variables : State.temporary;\n      var value = toWatchString(store[varKey]);\n      var $row = $rowMap.get(varName);\n\n      // If a watch row exists, update its code element value.\n      if ($row) {\n        var $code = $row.children().children('code');\n        if (value !== $code.text()) {\n          $code.text(value);\n        }\n      }\n      // Elsewise, insert a new watch row.\n      else {\n        $row = createRow(varName, value);\n        if (cursor) {\n          $row.insertAfter(cursor);\n        } else {\n          $row.appendTo($tbody);\n        }\n      }\n      cursor = $row.get(0);\n    });\n  }\n  function updateVarList() {\n    var names = [].concat(Object.keys(State.variables).map(function (name) {\n      return \"$\".concat(name);\n    }), Object.keys(State.temporary).map(function (name) {\n      return \"_\".concat(name);\n    }));\n\n    // If there are no variable names, then bail out.\n    if (names.length === 0) {\n      varList.length = 0;\n      $varDataList.empty();\n      return;\n    }\n\n    // Sort the variable names and remove those already being watched.\n    names.sort().deleteAll(watchList);\n\n    // If the new and existing lists of variable names match, then bail out.\n    if (names.length === varList.length && names.every(function (m, i) {\n      return m === varList[i];\n    })) {\n      return;\n    }\n\n    // Update the variable names list.\n    varList = names;\n    var options = document.createDocumentFragment();\n\n    // Generate the <option>s.\n    varList.forEach(function (name) {\n      jQuery(document.createElement('option')).val(name).appendTo(options);\n    });\n\n    // Update the <datalist>.\n    $varDataList.empty().append(options);\n  }\n  function updateTurnSelect() {\n    var histLen = State.size;\n    var expLen = State.expired.length;\n    var options = document.createDocumentFragment();\n\n    // Generate the <option>s.\n    for (var i = 0; i < histLen; ++i) {\n      jQuery(document.createElement('option')).val(i).text(\"\".concat(expLen + i + 1, \". \").concat(State.history[i].title)).appendTo(options);\n    }\n\n    // Update the <select>.\n    $turnSelect.empty().ariaDisabled(histLen < 2).append(options).val(State.activeIndex);\n  }\n  function updatePassageList() {\n    var passages = Object.keys(Story.getNormals()).sort();\n    var options = document.createDocumentFragment();\n\n    // Generate the <option>s.\n    passages.forEach(function (name) {\n      jQuery(document.createElement('option')).val(name).appendTo(options);\n    });\n\n    // Update the <datalist>.\n    $passageDataList.empty().append(options);\n  }\n  function toWatchString(O) {\n    // Handle the `null` primitive.\n    if (O === null) {\n      return 'null';\n    }\n\n    // Handle the rest of the primitives and functions.\n    switch (_typeof(O)) {\n      case 'bigint':\n      case 'boolean':\n      case 'number':\n      case 'symbol':\n      case 'undefined':\n        return String(O);\n      case 'string':\n        return JSON.stringify(O);\n      case 'function':\n        return 'Function';\n    }\n    var objType = getToStringTag(O);\n\n    // /*\n    // \tHandle instances of the primitive exemplar objects (`Boolean`, `Number`, `String`).\n    // */\n    // if (objType === 'Boolean') {\n    // \treturn `Boolean\\u202F{${String(O)}}`;\n    // }\n    // if (objType === 'Number') {\n    // \treturn `Number\\u202F{${String(O)}}`;\n    // }\n    // if (objType === 'String') {\n    // \treturn `String\\u202F{\"${String(O)}\"}`;\n    // }\n\n    // Handle `Date` objects.\n    if (objType === 'Date') {\n      // return `Date\\u202F${O.toISOString()}`;\n      return \"Date\\u202F{\".concat(O.toLocaleString(), \"}\");\n    }\n\n    // Handle `RegExp` objects.\n    if (objType === 'RegExp') {\n      return \"RegExp\\u202F\".concat(O.toString());\n    }\n    var result = [];\n\n    // Handle `Array` & `Set` objects.\n    if (O instanceof Array || O instanceof Set) {\n      var list = O instanceof Array ? O : Array.from(O);\n\n      // own numeric properties\n      // NOTE: Do not use `<Array>.forEach()` here as it skips undefined members.\n      for (var i = 0, len = list.length; i < len; ++i) {\n        result.push(Object.hasOwn(list, i) ? toWatchString(list[i]) : '<empty>');\n      }\n\n      // own enumerable non-numeric expando properties\n      Object.keys(list).filter(function (key) {\n        return !numericKeyRE.test(key);\n      }).forEach(function (key) {\n        return result.push(\"\".concat(toWatchString(key), \": \").concat(toWatchString(list[key])));\n      });\n      return \"\".concat(objType, \"(\").concat(list.length, \")\\u202F[\").concat(result.join(', '), \"]\");\n    }\n\n    // Handle `Map` objects.\n    if (O instanceof Map) {\n      O.forEach(function (val, key) {\n        return result.push(\"\".concat(toWatchString(key), \" \\u2192 \").concat(toWatchString(val)));\n      });\n      return \"\".concat(objType, \"(\").concat(O.size, \")\\u202F{\").concat(result.join(', '), \"}\");\n    }\n\n    // General object handling.\n    // own enumerable properties\n    Object.keys(O).forEach(function (key) {\n      return result.push(\"\".concat(toWatchString(key), \": \").concat(toWatchString(O[key])));\n    });\n    return \"\".concat(objType, \"\\u202F{\").concat(result.join(', '), \"}\");\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    // Debug Bar Functions.\n    init: {\n      value: debugBarInit\n    },\n    isStowed: {\n      value: debugBarIsStowed\n    },\n    start: {\n      value: debugBarStart\n    },\n    stow: {\n      value: debugBarStow\n    },\n    toggle: {\n      value: debugBarToggle\n    },\n    unstow: {\n      value: debugBarUnstow\n    },\n    // Watch Functions.\n    watch: {\n      value: Object.preventExtensions(Object.create(null, {\n        add: {\n          value: debugBarWatchAdd\n        },\n        all: {\n          value: debugBarWatchAddAll\n        },\n        clear: {\n          value: debugBarWatchClear\n        },\n        delete: {\n          value: debugBarWatchDelete\n        },\n        disable: {\n          value: debugBarWatchDisable\n        },\n        enable: {\n          value: debugBarWatchEnable\n        },\n        isEnabled: {\n          value: debugBarWatchIsEnabled\n        },\n        toggle: {\n          value: debugBarWatchToggle\n        }\n      }))\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tloadscreen.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/* global Config, Engine, triggerEvent */\n\nvar LoadScreen = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  // Locks collection.\n  var _locks = new Set();\n\n  // Auto-incrementing lock ID.\n  var _autoId = 0;\n\n  /*******************************************************************************\n  \tLoadScreen Functions.\n  *******************************************************************************/\n\n  /*\n  \tInitialize management of the loading screen.\n  */\n  function loadScreenInit() {\n    if (BUILD_DEBUG) {\n      console.log('[LoadScreen/loadScreenInit()]');\n    }\n\n    // Add a `readystatechange` listener for hiding/showing the loading screen.\n    jQuery(document).on('readystatechange.SugarCube', function () {\n      if (BUILD_DEBUG) {\n        console.log(\"[LoadScreen/<readystatechange>] document.readyState: \\\"\".concat(document.readyState, \"\\\"; locks(\").concat(_locks.size, \"):\"), _locks);\n      }\n      if (_locks.size > 0) {\n        return;\n      }\n\n      // The value of `document.readyState` may be: 'loading' -> 'interactive' -> 'complete'.\n      // Though, to reach this point, it must already be in, at least, the 'interactive' state.\n      if (document.readyState === 'complete') {\n        if (jQuery(document.documentElement).attr('data-init') === 'loading') {\n          if (Config.loadDelay > 0) {\n            setTimeout(function () {\n              if (_locks.size === 0) {\n                loadScreenHide();\n              }\n            }, Math.max(Engine.DOM_DELAY, Config.loadDelay));\n          } else {\n            loadScreenHide();\n          }\n        }\n      } else {\n        loadScreenShow();\n      }\n    });\n  }\n\n  /*\n  \tClear the loading screen.\n  */\n  function loadScreenClear() {\n    if (BUILD_DEBUG) {\n      console.log('[LoadScreen/loadScreenClear()]');\n    }\n\n    // Remove the event listener.\n    jQuery(document).off('readystatechange.SugarCube');\n\n    // Clear all locks.\n    _locks.clear();\n\n    // Hide the loading screen.\n    loadScreenHide();\n  }\n\n  /*\n  \tHide the loading screen.\n  */\n  function loadScreenHide() {\n    if (BUILD_DEBUG) {\n      console.log('[LoadScreen/loadScreenHide()]');\n    }\n    jQuery(document.documentElement).removeAttr('data-init');\n  }\n\n  /*\n  \tShow the loading screen.\n  */\n  function loadScreenShow() {\n    if (BUILD_DEBUG) {\n      console.log('[LoadScreen/loadScreenShow()]');\n    }\n    jQuery(document.documentElement).attr('data-init', 'loading');\n  }\n\n  /*\n  \tReturns a new lock ID after locking and showing the loading screen.\n  */\n  function loadScreenLock() {\n    if (BUILD_DEBUG) {\n      console.log('[LoadScreen/loadScreenLock()]');\n    }\n    ++_autoId;\n    _locks.add(_autoId);\n    if (BUILD_DEBUG) {\n      console.log(\"\\tacquired loading screen lock; id: \".concat(_autoId));\n    }\n    loadScreenShow();\n    return _autoId;\n  }\n\n  /*\n  \tRemove the lock associated with the given lock ID and, if no locks remain,\n  \ttrigger a `readystatechange` event.\n  */\n  function loadScreenUnlock(id) {\n    if (BUILD_DEBUG) {\n      console.log(\"[LoadScreen/loadScreenUnlock(id: \".concat(id, \")]\"));\n    }\n    if (id == null) {\n      // lazy equality for null\n      throw new Error('LoadScreen.unlock called with a null or undefined ID');\n    }\n    if (_locks.has(id)) {\n      _locks.delete(id);\n      if (BUILD_DEBUG) {\n        console.log(\"\\treleased loading screen lock; id: \".concat(id));\n      }\n    }\n    if (_locks.size === 0) {\n      triggerEvent('readystatechange');\n    }\n  }\n\n  /*\n  \tReturns the current number of locks.\n  */\n  function loadScreenLockSize() {\n    return _locks.size;\n  }\n\n  /*******************************************************************************\n  \tObject Exports.\n  *******************************************************************************/\n\n  return Object.preventExtensions(Object.create(null, {\n    init: {\n      value: loadScreenInit\n    },\n    clear: {\n      value: loadScreenClear\n    },\n    hide: {\n      value: loadScreenHide\n    },\n    show: {\n      value: loadScreenShow\n    },\n    lock: {\n      value: loadScreenLock\n    },\n    unlock: {\n      value: loadScreenUnlock\n    },\n    size: {\n      get: loadScreenLockSize\n    }\n  }));\n}();\n\n/***********************************************************************************************************************\n\n\tlib/deprecated-util.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal charAndPosAt, encodeEntities, encodeMarkup, cssPropToDOMProp, cssTimeToMS, getTypeOf, hasMediaQuery,\n\t       exceptionFrom, now, parseURL, sameValueZero, createFilename, scrubEventKey, createSlug, msToCSSTime,\n\t       enumFrom, getToStringTag, decodeEntities, decodeEntities, encodeEntities\n*/\n\n/*\n\tLegacy `Util` Exports.\n*/\nvar Util = Object.preventExtensions(Object.create(null, {\n  // eslint-disable-line no-unused-vars, no-var\n  charAndPosAt: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.charAndPosAt() is deprecated.');\n      return charAndPosAt.apply(void 0, arguments);\n    }\n  },\n  escape: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.escape() is deprecated.');\n      return encodeEntities.apply(void 0, arguments);\n    }\n  },\n  escapeMarkup: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.escapeMarkup() is deprecated.');\n      return encodeMarkup.apply(void 0, arguments);\n    }\n  },\n  fromCssProperty: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.fromCssProperty() is deprecated.');\n      return cssPropToDOMProp.apply(void 0, arguments);\n    }\n  },\n  fromCssTime: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.fromCssTime() is deprecated.');\n      return cssTimeToMS.apply(void 0, arguments);\n    }\n  },\n  getType: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.getType() is deprecated.');\n      return getTypeOf.apply(void 0, arguments);\n    }\n  },\n  hasMediaQuery: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.hasMediaQuery() is deprecated.');\n      return hasMediaQuery.apply(void 0, arguments);\n    }\n  },\n  newExceptionFrom: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.newExceptionFrom() is deprecated.');\n      return exceptionFrom.apply(void 0, arguments);\n    }\n  },\n  now: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.now() is deprecated.');\n      return now.apply(void 0, arguments);\n    }\n  },\n  parseUrl: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.parseUrl() is deprecated.');\n      return parseURL.apply(void 0, arguments);\n    }\n  },\n  sameValueZero: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.sameValueZero() is deprecated.');\n      return sameValueZero.apply(void 0, arguments);\n    }\n  },\n  sanitizeFilename: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.sanitizeFilename() is deprecated.');\n      return createFilename.apply(void 0, arguments);\n    }\n  },\n  scrubEventKey: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.scrubEventKey() is deprecated.');\n      return scrubEventKey.apply(void 0, arguments);\n    }\n  },\n  slugify: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.slugify() is deprecated.');\n      return createSlug.apply(void 0, arguments);\n    }\n  },\n  toCssTime: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.toCssTime() is deprecated.');\n      return msToCSSTime.apply(void 0, arguments);\n    }\n  },\n  toEnum: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.toEnum() is deprecated.');\n      return enumFrom.apply(void 0, arguments);\n    }\n  },\n  toStringTag: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.toStringTag() is deprecated.');\n      return getToStringTag.apply(void 0, arguments);\n    }\n  },\n  unescape: {\n    value: function value() {\n      console.warn('[DEPRECATED] Util.unescape() is deprecated.');\n      return decodeEntities.apply(void 0, arguments);\n    }\n  }\n}));\n\n/***********************************************************************************************************************\n\n\tsugarcube.js\n\n\tCopyright © 2013–2024 Thomas Michael Edwards <thomasmedwards@gmail.com>. All rights reserved.\n\tUse of this source code is governed by a BSD 2-clause \"Simplified\" License, which may be found in the LICENSE file.\n\n***********************************************************************************************************************/\n/*\n\tglobal Alert, Browser, Config, Dialog, Engine, Fullscreen, Has, LoadScreen, SimpleStore, L10n, Macro,\n\t       Outliner, Passage, Save, Scripting, Setting, SimpleAudio, State, Story, UI, UIBar, DebugBar,\n\t       Util, Visibility, Wikifier, triggerEvent\n*/\n/* eslint-disable no-var */\n\n/*\n\tVersion object.\n*/\nvar version = function () {\n  // eslint-disable-line no-unused-vars, no-var\n  var name = 'SugarCube';\n  var semVerRE = /^[Vv]?(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:-[0-9A-Za-z.-]+)?(?:\\+[0-9A-Za-z.-]+)?)?)?$/;\n  return Object.preventExtensions(Object.create(null, {\n    name: {\n      value: name\n    },\n    major: {\n      value: 2\n    },\n    minor: {\n      value: 37\n    },\n    patch: {\n      value: 3\n    },\n    prerelease: {\n      value: \"\"\n    },\n    build: {\n      value: 1\n    },\n    date: {\n      value: new Date(\"2025-04-05T10:50:35.967Z\")\n    },\n    isOk: {\n      value: function value(semver) {\n        if (typeof semver !== 'string') {\n          throw new Error(\"version.isOk semver parameter must be a string (received: \".concat(_typeof(semver), \")\"));\n        }\n        var trimmed = semver.trim();\n        if (trimmed === '') {\n          throw new Error('version.isOk semver parameter must not be empty');\n        }\n        var match = semVerRE.exec(trimmed);\n        if (!match) {\n          throw new Error(\"version.isOk semver parameter is invalid (format: [v]MAJOR[.MINOR[.PATCH[-PRERELEASE][+BUILD]]]; received: \".concat(trimmed));\n        }\n        var major = Number(match[1]);\n        var minor = Number(match[2]) || 0;\n        var patch = Number(match[3]) || 0;\n        return major === this.major && (minor < this.minor || minor === this.minor && patch <= this.patch);\n      }\n    },\n    long: {\n      value: function value() {\n        return \"\".concat(this.name, \" v\").concat(this.toString(), \" (\").concat(this.date.toUTCString(), \")\");\n      }\n    },\n    short: {\n      value: function value() {\n        var prerelease = this.prerelease ? \"-\".concat(this.prerelease) : '';\n        return \"\".concat(this.name, \" (v\").concat(this.major, \".\").concat(this.minor, \".\").concat(this.patch).concat(prerelease, \")\");\n      }\n    },\n    toString: {\n      value: function value() {\n        var prerelease = this.prerelease ? \"-\".concat(this.prerelease) : '';\n        return \"\".concat(this.major, \".\").concat(this.minor, \".\").concat(this.patch).concat(prerelease, \"+\").concat(this.build);\n      }\n    },\n    // Legacy.\n    title: {\n      value: name\n    }\n  }));\n}();\n\n/* eslint-disable no-unused-vars */\n/*\n\tInternal variables.\n*/\n// Temporary state object.\nvar TempState = {};\n\n// Session storage manager object.\nvar session = null;\n\n// Settings object.\nvar settings = Setting.create();\n\n// Setup object.\nvar setup = {};\n\n// Persistant storage manager object.\nvar storage = null;\n\n/*\n\tLegacy variables.\n*/\nvar macros = {}; // Legacy macros object.\nvar postdisplay = {}; // Post-display task callbacks object.\nvar postrender = {}; // Post-render task callbacks object.\nvar predisplay = {}; // Pre-display task callbacks object.\nvar prehistory = {}; // Pre-history task callbacks object.\nvar prerender = {}; // Pre-render task callbacks object.\n/* eslint-enable no-unused-vars */\n\n/*\n\tGlobal `SugarCube` object.  Allows scripts to detect if they're running in SugarCube by\n\ttesting for the object—e.g., `\"SugarCube\" in window`—and contains exported identifiers\n\tfor debugging purposes.\n*/\nObject.defineProperty(window, 'SugarCube', {\n  // WARNING: We need to assign new values at points, so seal it, do not freeze it.\n  value: Object.seal(Object.assign(Object.create(null), {\n    Browser: Browser,\n    Config: Config,\n    Dialog: Dialog,\n    Engine: Engine,\n    Fullscreen: Fullscreen,\n    Has: Has,\n    L10n: L10n,\n    Macro: Macro,\n    Passage: Passage,\n    Save: Save,\n    Scripting: Scripting,\n    Setting: Setting,\n    SimpleAudio: SimpleAudio,\n    State: State,\n    Story: Story,\n    UI: UI,\n    UIBar: UIBar,\n    DebugBar: DebugBar,\n    Util: Util,\n    Visibility: Visibility,\n    Wikifier: Wikifier,\n    session: session,\n    settings: settings,\n    setup: setup,\n    storage: storage,\n    version: version\n  }))\n});\n\n/*\n\tMain function, entry point for the story.\n*/\njQuery(function () {\n  if (BUILD_DEBUG) {\n    console.log('[SugarCube/main()] Document loaded; beginning startup.');\n  }\n\n  /*\n  \tWARNING!\n   \tThe ordering of the code within this function is critically important,\n  \tso be careful when mucking around with it.\n  */\n  var mainStart = function mainStart() {\n    // Acquire an initial lock for and initialize the loading screen.\n    var lockId = LoadScreen.lock();\n    LoadScreen.init();\n\n    // Normalize the document.\n    if (document.normalize) {\n      document.normalize();\n    }\n\n    // From this point on it's promises all the way down.\n    new Promise(function (resolve) {\n      // Initialize the story.\n      Story.init();\n\n      // Initialize the databases.\n      try {\n        SugarCube.storage = storage = SimpleStore.create(Story.id, true); // eslint-disable-line no-undef\n        SugarCube.session = session = SimpleStore.create(Story.id, false); // eslint-disable-line no-undef\n      } catch (ex) {\n        throw new Error(L10n.get('warningNoStorage'));\n      }\n\n      // Initialize the user interfaces.\n      //\n      // NOTE: Must be done before user scripts are loaded.\n      Dialog.init();\n      UIBar.init();\n      Engine.init();\n      Outliner.init();\n\n      // Run user scripts (user stylesheet, JavaScript, and widgets).\n      Engine.runUserScripts();\n\n      // Initialize the localization (must be done after user scripts).\n      L10n.init();\n\n      // Alert when the browser is degrading required capabilities.\n      if (!session.has('rcWarn') && storage.name === 'cookie') {\n        /* eslint-disable no-alert */\n        session.set('rcWarn', 1);\n        window.alert(L10n.get('warningNoWebStorage'));\n        /* eslint-enable no-alert */\n      }\n\n      // Initialize the saves.\n      Save.init();\n\n      // Initialize the settings.\n      Setting.init();\n\n      // Initialize the macros.\n      Macro.init();\n\n      // Initialize the debug bar interface.\n      DebugBar.init();\n\n      // Schedule the start of the engine and interfaces once both the DOM is\n      // reporting non-empty dimensions for the viewport and our loading screen\n      // lock is the only remaining one.\n      var $window = jQuery(window);\n      var vpReadyId = setInterval(function () {\n        if ($window.width() && LoadScreen.size <= 1) {\n          clearInterval(vpReadyId);\n          resolve();\n        }\n      }, Engine.DOM_DELAY);\n    }).then(function () {\n      // Run the user init passages.\n      Engine.runUserInit();\n\n      // Start the UI bar interface.\n      UIBar.start();\n\n      // Start the engine.\n      Engine.start();\n\n      // Start the debug bar interface.\n      DebugBar.start();\n\n      // Trigger the `:storyready` global synthetic event.\n      triggerEvent(':storyready');\n\n      // Release our loading screen lock after a short delay.\n      setTimeout(function () {\n        return LoadScreen.unlock(lockId);\n      }, Engine.DOM_DELAY * 2);\n      if (BUILD_DEBUG) {\n        console.log('[SugarCube/main()] Startup complete; story ready.');\n      }\n    }).catch(function (ex) {\n      console.error(ex);\n      LoadScreen.clear();\n      return Alert.fatal(null, ex.message, ex);\n    });\n  };\n\n  // inject ModLoader on there\n  if (typeof window.modSC2DataManager !== 'undefined') {\n    window.modSC2DataManager.startInit().then(function () {\n      return window.jsPreloader.startLoad();\n    }).then(function () {\n      return mainStart();\n    }).catch(function (err) {\n      console.error(err);\n    });\n  } else {\n    mainStart();\n  }\n});\n})(window, window.document, jQuery);\n}\n\t</script>\n</body>\n</html>\n"});